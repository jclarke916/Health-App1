<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>The Centurion | v46 Saturday CS4</title>
    <link href="https://fonts.googleapis.com/css2?family=Inter:wght@300;400;600;700&display=swap" rel="stylesheet">
    <style>
        :root {
            --bg-dark: #000000; 
            --card-bg: #111111; 
            --text-main: #E5E4E2; 
            --text-dim: #888888;
            --accent-gold: #D4AF37;
            --accent-silver: #C0C0C0;
            --badge-green: #00c853;
            --badge-orange: #ffab00;
            --alert-red: #ff3d00;
            --glute-pink: #d63384;
            --carb-high: #ff9100;
            --carb-low: #00b0ff;
        }
        
        body { font-family: 'Inter', sans-serif; background-color: var(--bg-dark); color: var(--text-main); margin: 0; display: flex; flex-direction: column; align-items: center; padding: 20px; }
        .container { max-width: 1000px; width: 100%; position: relative; }
        
        header { text-align: center; margin-bottom: 25px; border-bottom: 1px solid #333; padding-bottom: 20px; }
        h1 { font-weight: 300; letter-spacing: 2px; text-transform: uppercase; background: linear-gradient(to right, #E5E4E2, #888888); -webkit-background-clip: text; -webkit-text-fill-color: transparent; margin: 0; }
        
        .profile-badges { display: flex; justify-content: center; gap: 10px; margin-top: 20px; flex-wrap: wrap; }
        .badge { background: #1a1a1a; padding: 8px 16px; border-radius: 4px; border: 1px solid #333; font-size: 0.75rem; display: flex; align-items: center; gap: 8px; letter-spacing: 0.5px; text-transform: uppercase; color: var(--accent-silver); }
        .badge-interactive { cursor: pointer; transition: all 0.3s ease; border: 1px solid var(--accent-gold); color: var(--accent-gold); }
        .badge-interactive:hover { background: rgba(212, 175, 55, 0.1); box-shadow: 0 0 15px rgba(212, 175, 55, 0.1); }

        .status-bar { text-align: center; color: var(--text-dim); font-size: 0.85rem; margin-bottom: 20px; text-transform: uppercase; letter-spacing: 1.5px; }
        
        .controls { display: flex; justify-content: space-between; gap: 10px; margin-bottom: 25px; width: 100%; flex-wrap: wrap;}
        .nav-btn { flex: 1; padding: 14px; background: var(--card-bg); border: 1px solid #333; color: var(--text-main); border-radius: 6px; cursor: pointer; font-weight: 600; transition: 0.2s; font-size: 0.8rem; min-width: 100px; text-transform: uppercase; letter-spacing: 1px; }
        .nav-btn:hover { border-color: var(--accent-silver); background: #1a1a1a; }
        .action-btn { border-color: var(--accent-gold); color: var(--accent-gold); }
        .action-btn:hover { background: rgba(212, 175, 55, 0.1); }

        .tabs { display: flex; justify-content: space-between; background: var(--card-bg); padding: 5px; border-radius: 8px; margin-bottom: 25px; overflow-x: auto; border: 1px solid #222; }
        .tab-btn { background: none; border: none; color: #555; padding: 10px 8px; cursor: pointer; font-weight: 600; flex: 1; min-width: 60px; font-size: 0.8rem; text-align: center; transition: 0.3s; }
        .tab-btn span { display: block; font-size: 0.65rem; opacity: 0.7; margin-top: 4px; }
        .tab-btn.active { color: var(--accent-gold); background: rgba(255,255,255,0.03); border-radius: 4px; }
        
        /* CARD STYLES */
        .card { background: var(--card-bg); border-radius: 12px; padding: 30px; border: 1px solid #222; position: relative; overflow: hidden; margin-bottom: 20px; }
        .card::before { content: ""; position: absolute; top: 0; left: 0; width: 4px; height: 100%; background: var(--accent-gold); }
        
        .label { color: var(--accent-silver); font-size: 0.65rem; text-transform: uppercase; letter-spacing: 2px; font-weight: 700; margin-bottom: 5px; opacity: 0.8; }
        .value { font-size: 1.1rem; margin-bottom: 8px; font-weight: 500; color: #fff; cursor: pointer; transition: 0.2s; border-bottom: 1px solid transparent; display: inline-block;}
        .value:hover { color: var(--accent-gold); border-bottom: 1px solid var(--accent-gold); }
        
        .workout-tag { font-size: 0.9rem; color: var(--accent-gold); border-bottom: 1px solid #333; padding-bottom: 15px; margin-bottom: 20px; font-weight: 700; text-transform: uppercase; letter-spacing: 1px; }
        
        /* CARB CYCLING TAGS */
        .carb-tag { font-size: 0.7rem; padding: 2px 6px; border-radius: 4px; margin-left: 10px; text-transform: uppercase; font-weight: 800; letter-spacing: 0.5px; vertical-align: middle; }
        .carb-high { background: rgba(255, 145, 0, 0.15); color: var(--carb-high); border: 1px solid var(--carb-high); }
        .carb-low { background: rgba(0, 176, 255, 0.15); color: var(--carb-low); border: 1px solid var(--carb-low); }

        .protein-tag { color: var(--accent-gold); font-size: 0.75rem; font-weight: 700; margin-left: 8px; }
        .red-meat-tag { color: #ff6b6b; font-size: 0.6rem; border: 1px solid #ff6b6b; padding: 1px 4px; border-radius: 2px; margin-left: 6px; vertical-align: middle; text-transform: uppercase; }
        .ingredients-list { font-size: 0.85rem; color: var(--text-dim); margin-bottom: 15px; font-style: italic; }
        
        .juice-box { background: #0a0a0a; border-radius: 12px; padding: 30px; border: 1px solid #222; display: flex; flex-direction: column; gap: 15px; }
        .juice-header { font-weight: 700; color: var(--accent-gold); font-size: 1rem; letter-spacing: 1px; text-transform: uppercase; }
        .oz-tag { background: var(--accent-gold); color: #000; padding: 2px 6px; border-radius: 2px; font-size: 0.7rem; font-weight: 800; float: right; }
        .juice-benefit { color: var(--accent-silver); font-style: italic; font-size: 0.85rem; margin-top: 5px; border-left: 2px solid var(--accent-gold); padding-left: 10px; margin-bottom: 15px;}

        /* MODALS */
        .modal { display: none; position: fixed; z-index: 100; left: 0; top: 0; width: 100%; height: 100%; overflow: auto; background-color: rgba(0,0,0,0.9); backdrop-filter: blur(8px); }
        .modal-content { background-color: #050505; margin: 5% auto; padding: 30px; border: 1px solid #333; width: 90%; max-width: 650px; border-radius: 12px; box-shadow: 0 0 50px rgba(0,0,0,0.8); position: relative; }
        .close-btn { color: #555; float: right; font-size: 28px; font-weight: bold; cursor: pointer; }
        .close-btn:hover { color: var(--accent-gold); }
        
        /* RECIPE MODAL SPECIFIC */
        #recipeTitle { margin-bottom: 15px; border-bottom: none; padding-bottom: 0; font-size: 1.5rem; color: #fff;}
        .recipe-badge-container { margin-bottom: 25px; padding-bottom: 15px; border-bottom: 1px solid #333; display: flex; gap: 10px; flex-wrap: wrap;}
        .recipe-time-badge { display: inline-block; padding: 8px 16px; border-radius: 4px; font-size: 0.9rem; font-weight: 800; letter-spacing: 1px; color: #000; text-transform: uppercase; }
        .green-badge { background-color: var(--badge-green) !important; color: #000 !important;}
        .orange-badge { background-color: var(--badge-orange) !important; color: #000 !important;}
        .red-badge { background-color: var(--alert-red) !important; color: #fff !important;}

        .macro-grid { display: grid; grid-template-columns: 1fr 1fr 1fr; gap: 10px; margin-bottom: 20px; background: #111; padding: 15px; border-radius: 8px; border: 1px solid #333; }
        .macro-item { text-align: center; }
        .macro-label { font-size: 0.7rem; color: #888; text-transform: uppercase; letter-spacing: 1px; margin-bottom: 5px; }
        .macro-val { font-size: 1.1rem; color: #fff; font-weight: 700; }
        
        .lifestyle-box { background: rgba(212, 175, 55, 0.05); border: 1px solid rgba(212, 175, 55, 0.3); padding: 15px; border-radius: 8px; margin-bottom: 20px; }
        .lifestyle-text { font-size: 0.9rem; color: #ddd; font-style: italic; line-height: 1.5; }
        
        .sophia-mod-box { background: rgba(214, 51, 132, 0.1); border: 1px solid var(--glute-pink); padding: 15px; border-radius: 6px; margin-top: 20px; }
        .sophia-mod-title { color: var(--glute-pink); font-size: 0.85rem; font-weight: 800; text-transform: uppercase; letter-spacing: 1px; margin-bottom: 8px; }
        .sophia-mod-text { color: #e0e0e0; font-size: 0.9rem; line-height: 1.5; }

        .recipe-section-title { color: var(--accent-gold); font-size: 0.9rem; text-transform: uppercase; letter-spacing: 1px; margin-top: 20px; margin-bottom: 10px; font-weight: 700; }
        .recipe-list { list-style: none; padding: 0; margin: 0; }
        .recipe-list li { margin-bottom: 8px; color: #ccc; font-size: 0.9rem; line-height: 1.5; padding-left: 15px; position: relative; }
        .recipe-list li::before { content: "‚Ä¢"; color: var(--accent-gold); position: absolute; left: 0; }
        .recipe-steps { counter-reset: step; }
        .recipe-steps p { margin-bottom: 15px; color: #ccc; font-size: 0.95rem; line-height: 1.6; position: relative; padding-left: 25px; }
        .recipe-steps p::before { counter-increment: step; content: counter(step); position: absolute; left: 0; top: 0; background: var(--accent-gold); color: #000; width: 18px; height: 18px; border-radius: 50%; font-size: 0.7rem; display: flex; align-items: center; justify-content: center; font-weight: bold; }
        .recipe-steps strong { color: var(--accent-gold); font-weight: 700; }

        .portion-table { width: 100%; border-collapse: collapse; margin-top: 10px; }
        .portion-table th { text-align: left; border-bottom: 1px solid #333; padding: 12px 5px; color: var(--accent-silver); font-size: 0.7rem; text-transform: uppercase; letter-spacing: 1px; }
        .portion-table td { padding: 15px 5px; border-bottom: 1px solid #222; font-size: 0.9rem; color: #ccc; }
        
        .stat-grid { display: grid; grid-template-columns: 1fr 1fr; gap: 20px; margin-top: 20px; }
        .stat-box { background: #0f0f0f; padding: 20px; border-radius: 8px; border: 1px solid #222; }
        .stat-name { font-weight: 700; font-size: 1rem; margin-bottom: 15px; color: var(--accent-gold); text-transform: uppercase; letter-spacing: 1px; }
        .stat-row { display: flex; justify-content: space-between; align-items: center; font-size: 0.85rem; margin-bottom: 8px; color: #666; border-bottom: 1px solid #1a1a1a; padding-bottom: 5px; }
        .stat-row:last-child { border-bottom: none; }
        .stat-row strong { color: #eee; }
        .stat-target { color: var(--accent-gold) !important; font-weight: 800; }

        .workout-list { list-style: none; padding: 0; margin: 0; }
        .workout-list li { margin-bottom: 15px; border-bottom: 1px solid #222; padding-bottom: 10px; color: #aaa; font-size: 0.85rem; }
        .workout-list li strong { color: #E5E4E2; display: block; margin-bottom: 4px; font-size: 0.95rem; }
        .workout-day { color: var(--accent-gold); font-size: 0.75rem; text-transform: uppercase; letter-spacing: 1px; font-weight: 700; margin-right: 10px; }
        .recovery-badge { display: inline-block; background: #333; color: #fff; padding: 2px 6px; border-radius: 3px; font-size: 0.65rem; margin-top: 5px; text-transform: uppercase; }
        .recovery-badge.heat { background: #5a2a2a; color: #ffcccc; }
        .recovery-badge.cold { background: #2a3a5a; color: #ccccff; }
        .recovery-badge.tech { background: #2a5a4a; color: #ccffcc; }
        
        @media (max-width: 768px) { .main-layout { grid-template-columns: 1fr; } }
    </style>
</head>
<body>

<div class="container">
    <header>
        <h1>THE CENTURION</h1>
        <div class="profile-badges">
            <div class="badge badge-interactive" onclick="openProfileModal()">üßîüèæ‚Äç‚ôÇÔ∏è JERMAINE</div>
            <div class="badge badge-interactive" onclick="openProfileModal()">üë©üèæ‚Äçü¶± SOPHIA</div>
            <div class="badge">üåø SEA MOSS: 2 TBSP</div>
            <div class="badge">üõ°Ô∏è PROCESSED FREE</div>
        </div>
    </header>

    <div class="status-bar" id="syncStatus">initializing...</div>

    <div class="controls">
        <button class="nav-btn" onclick="changeWeek(-1)">PREV</button>
        <button class="nav-btn" onclick="resetToCurrent()">TODAY</button>
        <button class="nav-btn" onclick="changeWeek(1)">NEXT</button>
        <button class="nav-btn action-btn" onclick="openWorkoutModal()">üèãÔ∏è WORKOUTS</button>
        <button class="nav-btn action-btn" onclick="openPortionModal()">üìè PORTIONS</button>
    </div>

    <div class="tabs" id="dayTabs"></div>
    <div id="dayContent" class="main-layout"></div>
</div>

<div id="recipeModal" class="modal">
    <div class="modal-content">
        <span class="close-btn" onclick="closeModal('recipeModal')">&times;</span>
        <div class="guide-title" id="recipeTitle">Dish Title</div>
        
        <div class="recipe-badge-container">
             <span class="recipe-time-badge" id="recipeTime">30 mins</span>
        </div>

        <div class="lifestyle-box">
            <div class="recipe-section-title" style="margin-top:0;">Mission Critical</div>
            <div class="lifestyle-text" id="recipeWhy">Calculated for maximum nutrient density.</div>
        </div>

        <div class="macro-grid">
            <div class="macro-item">
                <div class="macro-label">Protein</div>
                <div class="macro-val" id="macroP">40g</div>
            </div>
            <div class="macro-item">
                <div class="macro-label">Carbs</div>
                <div class="macro-val" id="macroC">25g</div>
            </div>
            <div class="macro-item">
                <div class="macro-label">Fats</div>
                <div class="macro-val" id="macroF">15g</div>
            </div>
        </div>
        
        <div class="recipe-section-title">Ingredients Checklist</div>
        <ul class="recipe-list" id="recipeIngredients"></ul>
        <div class="recipe-section-title">Chef's Preparation</div>
        <div class="recipe-steps" id="recipeInstructions"></div>
        
        <div class="sophia-mod-box" id="leanModContainer" style="display:none;">
            <div class="sophia-mod-title">üçë Sophia's Glute & Ab Protocol</div>
            <div class="sophia-mod-text" id="leanModText"></div>
        </div>
    </div>
</div>

<div id="portionModal" class="modal">
    <div class="modal-content">
        <span class="close-btn" onclick="closeModal('portionModal')">&times;</span>
        <div class="guide-title">Portion Protocol</div>
        <table class="portion-table">
            <thead><tr><th>MACRO</th><th>JERMAINE (BUILD)</th><th>SOPHIA (SCULPT)</th></tr></thead>
            <tbody>
                <tr><td><strong>PROTEIN</strong></td><td>2 Palms</td><td>1.5 Palms</td></tr>
                <tr><td><strong>VEGGIES</strong></td><td>2+ Fists</td><td>2+ Fists</td></tr>
                <tr><td><strong>CARBS</strong></td><td>2 Cupped Hands</td><td><span style="color:var(--carb-high)">2 Hands (High Day)</span><br><span style="color:var(--carb-low)">1 Hand (Low Day)</span></td></tr>
                <tr><td><strong>FATS</strong></td><td>2 Thumbs</td><td>1 Thumb</td></tr>
                <tr><td style="color:var(--accent-gold)"><strong>JUICE</strong></td><td style="color:var(--accent-gold)">20-24 oz</td><td style="color:var(--accent-gold)">16 oz</td></tr>
            </tbody>
        </table>
    </div>
</div>

<div id="workoutModal" class="modal">
    <div class="modal-content">
        <span class="close-btn" onclick="closeModal('workoutModal')">&times;</span>
        <div class="guide-title">Training & Recovery</div>
        <ul class="workout-list" id="workoutListContainer"></ul>
    </div>
</div>

<div id="profileModal" class="modal">
    <div class="modal-content">
        <span class="close-btn" onclick="closeModal('profileModal')">&times;</span>
        <div class="guide-title">Biometric Data</div>
        <div class="stat-grid">
            <div class="stat-box">
                <div class="stat-name">JERMAINE</div>
                <div class="stat-row"><span>Age / Height</span><strong>42 / 6'4"</strong></div>
                <div class="stat-row"><span>Current Weight</span><strong>210.8 lbs</strong></div>
                <div class="stat-row"><span>Target Weight</span><strong class="stat-target">195.0 lbs</strong></div>
                <div class="stat-row"><span>Muscle Mass</span><strong>99.4 lbs</strong></div>
            </div>
            <div class="stat-box">
                <div class="stat-name">SOPHIA</div>
                <div class="stat-row"><span>Age / Height</span><strong>38 / 5'2"</strong></div>
                <div class="stat-row"><span>Current Weight</span><strong>136.1 lbs</strong></div>
                <div class="stat-row"><span>Target Weight</span><strong class="stat-target">125.0 lbs</strong></div>
                <div class="stat-row"><span>Muscle Mass</span><strong>+ 5.0 lbs</strong></div>
            </div>
        </div>
    </div>
</div>

<script>
    const dayLogic = [
        { day: "MON", work: "LIFT (In-Shape) + Massage", carb: "high", desc: "Heavy Compounds.", rec: "Aqua Massage + Sauna", badge: "tech" },
        { day: "TUE", work: "BOXING (UFC Marcus)", carb: "high", desc: "High Intensity Conditioning.", rec: "Thera Knee Ice + Heat Packs", badge: "cold" },
        { day: "WED", work: "REFORM (Club Studio)", carb: "low", desc: "Deep Core (Abs) + Glute Isolation.", rec: "Normatec Hips (Home)", badge: "tech" },
        { day: "THU", work: "BOXING (UFC Marcus)", carb: "high", desc: "Technique & Sparring drills.", rec: "Thera Cold/Heat Contrast", badge: "cold" },
        { day: "FRI", work: "YOGA + REFORM (Club Studio)", carb: "low", desc: "Mobility & Decompression.", rec: "Club Studio Sauna (20m)", badge: "heat" },
        { day: "SAT", work: "CS4 (HIIT) @ Club Studio", carb: "high", desc: "Empty the Tank. High Intensity.", rec: "Normatec Legs + Sauna", badge: "tech" },
        { day: "SUN", work: "HOME BASE RECOVERY", carb: "low", desc: "Total Rest.", rec: "Normatec Legs (30m)", badge: "tech" }
    ];

    function renderWorkoutList() {
        const list = document.getElementById('workoutListContainer');
        list.innerHTML = dayLogic.map(d => `
            <li>
                <span class="workout-day">${d.day}</span> 
                <strong>${d.work}</strong>
                ${d.desc}<br>
                <span class="recovery-badge ${d.badge}">Recovery: ${d.rec}</span>
            </li>
        `).join('');
    }

    const mealLibrary = {
        breakfasts: [
            { val: "Sea Moss & Triple-Protein Smoothie", p: "45g", ing: "Sea Moss, Pea Protein, Hemp, PB2, Blackberries.", herSwap: "Same for Sophia" },
            { val: "Crab & Spinach Scramble", p: "35g", ing: "Lump crab, 3 eggs, spinach, green onions.", herSwap: "Modified: Well-Done Eggs Only" },
            { val: "Japanese Tamagoyaki Scramble", p: "32g", ing: "3 Eggs, dashi, coconut aminos, spinach, nori.", herSwap: "Modified: Well-Done Eggs Only" },
            { val: "Salmon & Capers Sprouted Toast", p: "32g", ing: "Smoked salmon, capers, sprouted bread, avocado.", herSwap: "Same for Sophia" },
            { val: "Turkey & Apple Hash", p: "35g", ing: "Ground turkey, apple, sage, walnuts.", herSwap: "Modified: Well-Done Eggs Only" },
            { val: "Mediterranean Breakfast Hash", p: "28g", ing: "Chickpeas, kale, tomatoes, olives, 2 eggs.", herSwap: "Modified: Well-Done Eggs Only" },
            { val: "Southwest Bison Scramble", p: "38g", ing: "Bison, 3 Eggs, jalape√±os, black beans.", herSwap: "Modified: Well-Done Eggs Only" }
        ],
        lunches: [
            { val: "Mendo-Style Sophisticated Cobb", p: "42g", type: "white", ing: "Pasture turkey, kale, avocado, pickled onions, beets." },
            { val: "Roasted Purple Yam Power Bowl", p: "35g", type: "white", ing: "Purple yams, quinoa, spinach, pepitas." },
            { val: "Bison Laab (Thai Meat Salad)", p: "40g", type: "red", ing: "Bison, lime, mint, cilantro, daikon." },
            { val: "Pasture-Raised Turkey Burger", p: "40g", type: "white", ing: "Turkey patty, avocado, tomato, lettuce wrap." },
            { val: "Cucumber-Wrapped Naruto Sushi", p: "42g", type: "white", ing: "Ahi tuna, salmon, avocado, cucumber wrap." },
            { val: "Ginger-Turkey Cabbage Potstickers", p: "38g", type: "white", ing: "Turkey, ginger, garlic, cabbage leaves." },
            { val: "Ahi Tuna & Power Greens Bowl", p: "45g", type: "white", ing: "Ahi tuna, edamame, cucumber, radish." }
        ],
        dinners: [
            { val: "SF Style Cioppino", p: "40g", type: "white", ing: "Clams, mussels, shrimp, crab, tomato broth, fennel." },
            { val: "Moules Marini√®res (Steamed Mussels)", p: "32g", type: "white", ing: "Fresh mussels, white wine, garlic, shallots, parsley." },
            { val: "Spicy Thai Basil Mussels", p: "35g", type: "white", ing: "Mussels, chili paste, basil, coconut milk, lime." },
            { val: "Mussels Fra Diavolo", p: "38g", type: "white", ing: "Mussels, spicy marinara, garlic, red pepper flakes." },
            { val: "Mussels w/ Fennel & Saffron", p: "40g", type: "white", ing: "Mussels, fennel bulb, saffron broth, orange zest." },
            { val: "Coconut Turmeric Mussels", p: "35g", type: "white", ing: "Mussels, turmeric, ginger, coconut milk, cilantro." },
            { val: "Duck & Mushroom Ragu", p: "45g", type: "red", ing: "Ground duck, mushrooms, chickpea pasta, herbs." }
        ],
        juices: [
            { name: "The Detox", oz: "16oz", ing: "Celery, Cucumber, Apple, Lemon, Ginger", benefit: "Reduces water retention & bloat" },
            { name: "Red Power", oz: "20oz", ing: "Beets, Carrots, Orange, Ginger", benefit: "Nitric Oxide boost for stamina" },
            { name: "The Alkaline", oz: "16oz", ing: "Kale, Spinach, Pear, Lime", benefit: "Balances pH & lowers inflammation" },
            { name: "Joint Guard", oz: "18oz", ing: "Carrots, Pear, Celery, Turmeric", benefit: "Protects knees/shoulders after boxing" },
            { name: "The Flush", oz: "16oz", ing: "Red Cabbage, Apple, Mint, Lemon", benefit: "Liver support for protein processing" },
            { name: "The Endurance", oz: "24oz", ing: "Watermelon, Lime, Mint", benefit: "Natural electrolytes & hydration" },
            { name: "The Rainbow", oz: "18oz", ing: "Carrots, Beets, Celery, Ginger", benefit: "Broad spectrum micronutrients" }
        ]
    };

    const recipeDatabase = {
        "Mendo-Style Sophisticated Cobb": {
            time: "15 mins",
            ingredients: ["Pasture-Raised Turkey (chopped)", "Mixed Greens & Kale", "Roasted Beets (diced)", "Goat Cheese (crumbled)", "Hazelnuts (toasted)", "Avocado", "Sherry Vinaigrette"],
            steps: ["Chop greens finely and massage with a little dressing.", "Dice turkey, beets, and avocado into uniform cubes.", "Assemble base greens.", "Top with turkey, beets, and cheese.", "Garnish with crushed hazelnuts for crunch."],
            macros: {p: "42g", c: "15g", f: "20g"},
            why: "High volume, nutrient-dense fiber without the inflammatory pork bacon.",
            sophiaMod: "Use the full turkey portion for glute growth, but go light on the avocado/cheese to keep the waist tight."
        },
        "SF Style Cioppino": { 
            time: "45 mins", 
            ingredients: ["1 lb Mussels (scrubbed)", "1 lb Clams", "8oz Shrimp (raw)", "1 Dungeness Crab (cracked)", "1 Fennel Bulb (sliced)", "28oz Crushed Tomatoes", "2 cups Fish Broth", "1 cup Dry White Wine", "3 Garlic Cloves", "Red Pepper Flakes"], 
            steps: ["Saut√© **Fennel** and **Garlic** in **1 tsp Olive Oil** until soft (5 mins).", "Add **White Wine** and reduce by half.", "Add **Tomatoes** and **Broth**. Simmer 20 mins.", "Add the **Clams** and **Mussels** first (cover tightly, cook 5 mins until opened).", "Add the **Shrimp** and **Crab**, cook 3-4 more mins.", "Discard any unopened shells immediately. Serve garnished with **Parsley**."],
            macros: {p: "40g", c: "12g", f: "8g"},
            why: "A multivitamin in a bowl. Zinc and Selenium support thyroid and testosterone.",
            sophiaMod: "This meal is perfect as-is. High protein, high mineral, low fat."
        },
        "Duck & Mushroom Ragu": { 
            time: "60 mins", 
            ingredients: ["1 lb Ground Duck", "8oz Mushrooms (Cremini)", "1 jar Clean Marinara", "1 box Chickpea Pasta", "Fresh Thyme", "1 Onion", "Red Wine Splash"], 
            steps: ["Brown **Ground Duck** in a Dutch oven.", "IMPORTANT: **Drain** almost all the rendered fat from the pot.", "Saut√© chopped **Onions** and **Mushrooms** in the small amount of remaining fat.", "Deglaze pan with a splash of **Red Wine**.", "Add **Marinara** and **Thyme**. Simmer on low for 40 mins.", "Serve over chickpea pasta."],
            macros: {p: "45g", c: "35g", f: "22g"},
            why: "Duck provides Heme Iron for boxing stamina, closer to steak than chicken.",
            sophiaMod: "Eat this on a heavy Leg Day. The extra calories support glute hypertrophy."
        },
        "Mussels Fra Diavolo": { 
            time: "25 mins", 
            ingredients: ["2 lbs Mussels", "28oz Crushed Tomatoes", "4 Garlic Cloves (sliced)", "1 tsp Red Pepper Flakes", "1/2 cup White Wine", "Parsley"], 
            steps: ["Saut√© **Garlic** and **Red Pepper Flakes** in **1 tsp Olive Oil** (do not burn).", "Add **White Wine** and **Tomatoes**. Simmer 10 mins.", "Increase heat to high. Add the **Mussels**.", "Cover tightly. Steam 5-7 mins until shells pop open.", "Discard unopened shells. Top with fresh **Parsley**."],
            macros: {p: "38g", c: "15g", f: "10g"},
            why: "Spicy capsaicin boosts metabolism; mussels provide joint-protecting minerals.",
            sophiaMod: "Skip the bread for dipping. Eat the mussels directly."
        },
        "Braised Venison Shanks": { 
            time: "3 hours", 
            ingredients: ["2 Venison Shanks", "Beef Bone Broth", "Carrots", "Celery", "Onion", "Rosemary", "Red Wine"], 
            steps: ["Season **Venison Shanks** heavily with salt/pepper.", "Sear on all sides in a hot Dutch oven with **Light Oil Spray**.", "Remove meat. Saut√© **Carrots**, **Celery**, and **Onion**.", "Return meat to pot. Add **Red Wine** and **Broth** to cover 3/4 way.", "Cover and bake at 325¬∞F for 2.5 - 3 hours until falling off bone."],
            macros: {p: "45g", c: "10g", f: "12g"},
            why: "Extremely lean red meat. High protein ROI for Sophia's toning goals.",
            sophiaMod: "The perfect post-workout meal. High protein, almost zero fat."
        },
        "Lemon-Rosemary Brick Chicken": {
            time: "45 mins",
            ingredients: ["1 Whole Pasture Chicken (Spatchcocked)", "2 Lemons", "Fresh Rosemary", "4 Garlic Cloves", "Ghee"],
            steps: ["Preheat oven to 400¬∞F.", "Rub **Chicken** with **Ghee**, **Garlic**, and **Rosemary**.", "Place skin-side down in a cold cast iron skillet.", "Place a heavy pot (or foil-wrapped brick) on top to press it flat.", "Cook on medium-high heat for 15 mins (skin gets crispy).", "Flip chicken and roast in oven for 20-25 mins until 165¬∞F."],
            macros: {p: "45g", c: "0g", f: "20g"},
            why: "Pasture-raised fat profile reduces inflammation compared to conventional poultry.",
            sophiaMod: "Remove the skin to save calories for abs, but eat the dark meat for glute-building iron."
        },
        "Coconut Turmeric Mussels": {
            time: "20 mins",
            ingredients: ["2 lbs Mussels", "1 can Light Coconut Milk", "1 tbsp Fresh Turmeric (grated)", "1 tbsp Ginger (grated)", "1 Lime", "Cilantro"],
            steps: ["Saut√© **Ginger** and **Turmeric** in **1 tsp Coconut Oil** until fragrant (1 min).", "Add **Light Coconut Milk** and bring to a simmer.", "Add the **Mussels** and cover the pot.", "Steam 5-7 mins until opened.", "Squeeze **Lime Juice** over top and garnish with **Cilantro**."],
            macros: {p: "35g", c: "8g", f: "18g"},
            why: "Turmeric and ginger are potent anti-inflammatories for recovery days.",
            sophiaMod: "Use 'Light' coconut milk to cut fat by 60%."
        },
        "Ginger-Turkey Cabbage Potstickers": {
            time: "20 mins",
            ingredients: ["Ground Turkey", "Cabbage Leaves", "Ginger (grated)", "Garlic", "Coconut Aminos", "Sesame Oil"],
            steps: ["Saut√© **Ground Turkey** with **Ginger** and **Garlic** until browned.", "Add **Coconut Aminos** and a tiny drizzle of **Sesame Oil** for flavor.", "Wash **Cabbage Leaves** thoroughly and pat dry.", "Spoon turkey mixture into leaves.", "Wrap tightly or eat as open cups."],
            macros: {p: "35g", c: "8g", f: "12g"},
            why: "Low carb, high protein comfort food without the gluten wrapper.",
            sophiaMod: "Use 99% lean turkey breast ground meat to keep it pure protein."
        }
    };

    function generateSmartRecipe(dishName, ingredientString) {
        let ingArray = ingredientString ? ingredientString.split(', ') : ["Protein", "Veggie", "Fat"];
        let mainIngredient = ingArray[0] || "Protein";
        let secondIngredient = ingArray[1] || "Vegetable";
        
        let recipe = { 
            time: "30 mins", 
            ingredients: ingArray, 
            steps: ["Prep ingredients.", "Cook thoroughly.", "Serve."], 
            macros: {p:"30g", c:"20g", f:"15g"}, 
            why: "Clean fuel for consistent energy.",
            sophiaMod: "Reduce added oils and increase veggie portion."
        };
        
        if (dishName.includes("Smoothie")) {
            recipe.time = "5 mins";
            recipe.steps = [`Add **Liquid** to blender first.`, `Add **${mainIngredient}** and powders.`, `Add frozen items last.`, `Blend on high for 45 seconds.`];
            recipe.macros = {p: "40g", c: "25g", f: "10g"};
            recipe.why = "Rapid liquid absorption for immediate post-sleep amino acid delivery.";
            recipe.sophiaMod = "Use water instead of almond milk to save 60 calories.";
        } else if (dishName.includes("Salad") || dishName.includes("Bowl") || dishName.includes("Cobb")) {
            recipe.time = "15 mins";
            recipe.steps = [`Chop **${secondIngredient}** and other veggies.`, `Prepare the dressing.`, `Toss greens with dressing first.`, `Top with **${mainIngredient}**.`];
            recipe.macros = {p: "35g", c: "15g", f: "20g"};
            recipe.why = "High volume, low calorie density. Perfect for Sophia's fat loss target.";
            recipe.sophiaMod = "Use half the dressing and skip cheese toppings if not training legs.";
        } else if (dishName.includes("Soup") || dishName.includes("Chili")) {
            recipe.time = "45 mins";
            recipe.steps = [`Saut√© aromatics in **1 tsp Ghee**.`, `Add **${mainIngredient}** and brown.`, `Add broth and simmer.`, `Add **${secondIngredient}** towards the end to keep texture.`];
            recipe.macros = {p: "35g", c: "20g", f: "10g"};
            recipe.why = "Easily digestible nutrients; hydration plus protein.";
            recipe.sophiaMod = "Ensure the meat used is extra lean (93% or higher).";
        } else if (dishName.includes("Burger")) {
            recipe.time = "20 mins";
            recipe.steps = [`Form **${mainIngredient}** into patties.`, `Sear in cast iron (4 mins/side).`, `Assemble in lettuce wraps with **${secondIngredient}**.`];
            recipe.macros = {p: "40g", c: "5g", f: "20g"};
            recipe.why = "Satisfies red meat cravings while keeping carbs effectively zero.";
            recipe.sophiaMod = "Skip the avocado or mayo topping to reveal abs faster.";
        } else if (dishName.includes("Steak") || dishName.includes("Chop")) {
            recipe.time = "20 mins";
            recipe.steps = [`Heat cast iron pan to high.`, `Sear **${mainIngredient}** hard (3-4 mins/side).`, `Baste with **1 tsp Ghee** and herbs.`, `Rest 10 mins before slicing.`];
            recipe.macros = {p: "45g", c: "0g", f: "25g"};
            recipe.why = "High Creatine and B12 for explosive power in boxing.";
            recipe.sophiaMod = "Skip the ghee baste; season only with salt and pepper.";
        } else if (dishName.includes("Fish") || dishName.includes("Salmon")) {
            recipe.time = "15 mins";
            recipe.steps = [`Pat **${mainIngredient}** completely dry.`, `Sear skin-side down in **1 tsp Ghee** (4 mins).`, `Flip gently and cook 2 mins.`, `Serve with **${secondIngredient}**.`];
            recipe.macros = {p: "35g", c: "0g", f: "15g"};
            recipe.why = "Omega-3s reduce cortisol and inflammation from heavy lifting.";
            recipe.sophiaMod = "Bake the fish instead of pan-searing to use zero oil.";
        } else if (dishName.includes("Scramble") || dishName.includes("Omelet")) {
            recipe.time = "10 mins";
            recipe.steps = [`Whisk eggs with salt.`, `Saut√© **${secondIngredient}** in **1 tsp Ghee**.`, `Add eggs and cook to preference.`, `Fold in **${mainIngredient}** at the end.`];
            recipe.macros = {p: "30g", c: "5g", f: "12g"};
            recipe.why = "High choline content supports focus and brain health.";
            recipe.sophiaMod = "Use 1 whole egg + 3 egg whites to maximize protein vs fat.";
        }
        return recipe;
    }

    let weekOffset = 0;

    // --- SEED LOGIC ---
    function mulberry32(a) {
        return function() {
            var t = a += 0x6D2B79F5;
            t = Math.imul(t ^ t >>> 15, t | 1);
            t ^= t + Math.imul(t ^ t >>> 7, t | 61);
            return ((t ^ t >>> 14) >>> 0) / 4294967296;
        }
    }

    function seededShuffle(array, rng) {
        let newArray = [...array];
        let cur = newArray.length, rand;
        while (cur != 0) {
            rand = Math.floor(rng() * cur);
            cur--;
            [newArray[cur], newArray[rand]] = [newArray[rand], newArray[cur]];
        }
        return newArray;
    }

    function getWrappedSlice(array, start, length) {
        let result = [];
        for (let i = 0; i < length; i++) {
            result.push(array[(start + i) % array.length]);
        }
        return result;
    }

    function getMondayDate(offset) {
        let d = new Date();
        let day = d.getDay();
        let diff = d.getDate() - day + (day == 0 ? -6:1);
        let monday = new Date(d.setDate(diff));
        monday.setDate(monday.getDate() + (offset * 7));
        return monday;
    }

    function changeWeek(direction) {
        weekOffset += direction;
        generateSyncedWeek();
    }

    function resetToCurrent() {
        weekOffset = 0;
        generateSyncedWeek(true);
    }

    function openModal(id) { document.getElementById(id).style.display = 'block'; }
    function closeModal(id) { document.getElementById(id).style.display = 'none'; }
    function openPortionModal() { openModal('portionModal'); }
    function openWorkoutModal() { 
        renderWorkoutList(); 
        openModal('workoutModal'); 
    }
    function openProfileModal() { openModal('profileModal'); }

    function openRecipeModal(dishName, ingredientsString) {
        const modal = document.getElementById('recipeModal');
        const titleEl = document.getElementById('recipeTitle');
        const timeEl = document.getElementById('recipeTime');
        const ingList = document.getElementById('recipeIngredients');
        const stepList = document.getElementById('recipeInstructions');
        const whyEl = document.getElementById('recipeWhy');
        const mP = document.getElementById('macroP');
        const mC = document.getElementById('macroC');
        const mF = document.getElementById('macroF');
        const modContainer = document.getElementById('leanModContainer');
        const modText = document.getElementById('leanModText');

        let recipe = recipeDatabase[dishName];
        if (!recipe) {
            recipe = generateSmartRecipe(dishName, ingredientsString);
        }

        // Color Logic
        let minutes = 0;
        if (recipe.time.includes("hour")) minutes = 60;
        else minutes = parseInt(recipe.time);

        timeEl.className = 'recipe-time-badge'; 
        if (minutes <= 15) {
            timeEl.classList.add('green-badge');
            timeEl.innerText = `‚ö° ${recipe.time}`;
        } else if (minutes > 15 && minutes <= 30) {
            timeEl.classList.add('orange-badge');
             timeEl.innerText = `‚è±Ô∏è ${recipe.time}`;
        } else {
            timeEl.classList.add('red-badge');
             timeEl.innerText = `‚è≥ ${recipe.time}`;
        }

        titleEl.innerText = dishName;
        ingList.innerHTML = recipe.ingredients.map(i => `<li>${i}</li>`).join('');
        stepList.innerHTML = recipe.steps.map(s => `<p>${s.replace(/\*\*(.*?)\*\*/g, '<strong>$1</strong>')}</p>`).join('');
        
        whyEl.innerText = recipe.why;
        mP.innerText = recipe.macros.p;
        mC.innerText = recipe.macros.c;
        mF.innerText = recipe.macros.f;

        if (recipe.sophiaMod) {
            modContainer.style.display = "block";
            modText.innerText = recipe.sophiaMod;
        } else {
            modContainer.style.display = "none";
        }

        openModal('recipeModal');
    }

    function generateSyncedWeek(forceToday = false) {
        const today = new Date();
        const year = today.getFullYear();
        const rng = mulberry32(year); 

        const shuffledB = seededShuffle(mealLibrary.breakfasts, rng);
        const shuffledL = seededShuffle(mealLibrary.lunches, rng);
        const shuffledD = seededShuffle(mealLibrary.dinners, rng);
        const shuffledJ = seededShuffle(mealLibrary.juices, rng);

        const d = new Date();
        d.setUTCDate(d.getUTCDate() + 4 - (d.getUTCDay()||7));
        const weekNo = Math.ceil((((d - new Date(Date.UTC(d.getUTCFullYear(),0,1))) / 86400000) + 1)/7);
        const effectiveWeek = weekNo + weekOffset;
        
        const startB = (Math.abs(effectiveWeek) * 7) % mealLibrary.breakfasts.length;
        const startL = (Math.abs(effectiveWeek) * 7) % mealLibrary.lunches.length;
        const startD = (Math.abs(effectiveWeek) * 7) % mealLibrary.dinners.length;
        const startJ = (Math.abs(effectiveWeek) * 7) % mealLibrary.juices.length;

        const sB = getWrappedSlice(shuffledB, startB, 7);
        const sL = getWrappedSlice(shuffledL, startL, 7);
        const sD = getWrappedSlice(shuffledD, startD, 7);
        const sJ = getWrappedSlice(shuffledJ, startJ, 7);

        let monday = getMondayDate(weekOffset);
        let sunday = new Date(monday);
        sunday.setDate(monday.getDate() + 6);
        const opts = { month: 'short', day: 'numeric' };
        document.getElementById('syncStatus').innerText = `${monday.toLocaleDateString('en-US', opts)} ‚Äî ${sunday.toLocaleDateString('en-US', opts)}`;

        const tabsContainer = document.getElementById('dayTabs');
        tabsContainer.innerHTML = '';
        
        const days = ['mon', 'tue', 'wed', 'thu', 'fri', 'sat', 'sun'];
        
        days.forEach((dayKey, i) => {
            let tabDate = new Date(monday);
            tabDate.setDate(monday.getDate() + i);
            let dateNum = tabDate.getDate();
            
            let btn = document.createElement('button');
            btn.className = 'tab-btn';
            btn.innerHTML = `${dayKey.toUpperCase()}<span>${dateNum}</span>`;
            
            btn.onclick = () => {
                document.querySelectorAll('.tab-btn').forEach(b => b.classList.remove('active'));
                btn.classList.add('active');
                renderDay(i, sB, sL, sD, sJ); 
            };
            tabsContainer.appendChild(btn);
        });

        let activeIdx = 0;
        let todayDay = new Date().getDay();
        let trueTodayIdx = (todayDay + 6) % 7; 

        if (forceToday) {
            activeIdx = trueTodayIdx;
        } else {
            activeIdx = trueTodayIdx;
        }

        const allTabs = document.querySelectorAll('.tab-btn');
        if(allTabs[activeIdx]) {
            allTabs[activeIdx].classList.add('active');
            renderDay(activeIdx, sB, sL, sD, sJ);
        }
    }

    function renderDay(index, sB, sL, sD, sJ) {
        const b = sB[index];
        const l = sL[index];
        const d = sD[index];
        const j = sJ[index];
        const workoutData = dayLogic[index]; 
        
        const redTag = (type) => type === 'red' ? '<span class="red-meat-tag">RED</span>' : '';
        
        let carbBadge = "";
        if (workoutData.carb === "high") {
            carbBadge = '<span class="carb-tag carb-high">üî• HIGH CARB</span>';
        } else {
            carbBadge = '<span class="carb-tag carb-low">üßò LOW CARB</span>';
        }

        document.getElementById('dayContent').innerHTML = `
            <div class="card">
                <div class="workout-tag">${workoutData.work} ${carbBadge}</div>
                <div class="label">üç≥ Breakfast <span class="protein-tag">(${b.p})</span></div>
                <div class="value" onclick="openRecipeModal('${b.val}', '${b.ing}')">üßîüèæ‚Äç‚ôÇÔ∏è J: ${b.val}</div>
                <div class="value" style="color: var(--text-dim); font-size:0.9rem;" onclick="openRecipeModal('${b.val}', '${b.ing}')">üë©üèæ‚Äçü¶± S: ${b.herSwap}</div>
                <div class="ingredients-list">üõí ${b.ing}</div>
                
                <div class="label" style="margin-top:20px;">ü•ó Lunch <span class="protein-tag">(${l.p})</span> ${redTag(l.type)}</div>
                <div class="value" onclick="openRecipeModal('${l.val}', '${l.ing}')">${l.val}</div>
                <div class="ingredients-list">üõí ${l.ing}</div>
                
                <div class="label" style="margin-top:20px;">üçΩÔ∏è Dinner <span class="protein-tag">(${d.p})</span> ${redTag(d.type)}</div>
                <div class="value" onclick="openRecipeModal('${d.val}', '${d.ing}')">${d.val}</div>
                <div class="ingredients-list">üõí ${d.ing}</div>
            </div>
            
            <div class="juice-box">
                <div class="juice-header">üßÉ KUVINGS: ${j.name.toUpperCase()} <span class="oz-tag">${j.oz}</span> - <span style="color:#aaa; font-size:0.8rem;">COLD PRESSED</span></div>
                <div class="label">Ingredients</div><div style="font-size:0.9rem; color:#888;">${j.ing}</div>
                <div class="juice-benefit">‚ö° ${j.benefit}</div>
                <div style="margin-top:15px; border-top:1px solid #222; padding-top:10px;">
                    <div class="label">üóìÔ∏è DAILY PROTOCOL</div>
                    <div style="font-size: 0.8rem; line-height: 1.6; color:#666;">
                        ‚úÖ 2 tbsp Sea Moss Gel <br>‚úÖ 4-8oz Kombucha <br>‚úÖ 7:30 PM Liquid Cut-off <br>‚úÖ Bedtime: 12:00 AM
                    </div>
                </div>
            </div>`;
    }

    window.onclick = function(event) { 
        if (event.target.classList.contains('modal')) event.target.style.display = 'none';
    }

    window.onload = () => generateSyncedWeek(true);
</script>
</body>
</html>