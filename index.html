<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no">
    <title>The Centurion | v223 Chef Edition</title>
    <link href="https://fonts.googleapis.com/css2?family=Inter:wght@300;400;600;700;800&display=swap" rel="stylesheet">
    <style>
        :root {
            --bg-body: #050505; --bg-card: #141414; --text-main: #FFFFFF; --text-muted: #999999;
            --accent-gold: #D4AF37; --glute-pink: #FF4081; --target-green: #00E676;
            --heat-red: #FF3D00; --ice-blue: #00B0FF; --recovery-purple: #D500F9;
            --grad-pro: linear-gradient(90deg, #FF5252, #D50000);
            --grad-carb: linear-gradient(90deg, #FFAB40, #FF6D00);
            --grad-fat: linear-gradient(90deg, #448AFF, #2962FF);
            --grad-cal: linear-gradient(90deg, #B388FF, #6200EA);
            --grad-gold: linear-gradient(90deg, #FDD835, #F57F17);
            --grad-green: linear-gradient(90deg, #69F0AE, #00C853);
        }
        * { box-sizing: border-box; -webkit-tap-highlight-color: transparent; }
        body { font-family: 'Inter', sans-serif; background-color: var(--bg-body); color: var(--text-main); margin: 0; padding: 30px 20px; font-size: 16px; line-height: 1.6; }
        .container { max-width: 600px; margin: 0 auto; width: 100%; position: relative; }
        
        header { text-align: center; margin-bottom: 30px; position: relative; padding-top: 10px; }
        .version-tag { position: absolute; top: 0; right: 0; font-size: 0.65rem; color: #444; letter-spacing: 1.5px; font-weight: 800; }
        h1 { font-weight: 200; letter-spacing: 6px; text-transform: uppercase; margin: 0; font-size: 1.6rem; background: linear-gradient(to bottom, #fff, #888); -webkit-background-clip: text; -webkit-text-fill-color: transparent; }
        .profile-badges { display: flex; justify-content: center; gap: 15px; margin-top: 25px; }
        .badge { background: #000; padding: 14px 28px; border-radius: 40px; border: 1px solid #333; font-size: 0.75rem; color: #666; text-transform: uppercase; cursor: pointer; font-weight: 700; letter-spacing: 1px; transition: 0.3s; }
        .badge.active-user { border-color: var(--accent-gold); color: var(--accent-gold); box-shadow: 0 0 20px rgba(212, 175, 55, 0.1); }
        .badge.active-user.sophia { border-color: var(--glute-pink); color: var(--glute-pink); box-shadow: 0 0 20px rgba(255, 64, 129, 0.1); }

        .status-bar { text-align: center; color: var(--text-muted); font-size: 0.8rem; margin: 25px 0 15px 0; text-transform: uppercase; font-weight: 600; letter-spacing: 2px; }
        .controls { display: flex; justify-content: space-between; gap: 12px; margin-bottom: 30px; }
        .nav-btn { background: var(--bg-card); border: 1px solid #222; color: var(--text-muted); padding: 16px 0; width: 24%; border-radius: 14px; cursor: pointer; font-size: 0.65rem; font-weight: 800; text-transform: uppercase; transition: 0.2s; }
        .nav-btn:active { transform: scale(0.96); background: #222; }
        .grocery-btn { color: var(--target-green); border-color: rgba(0, 230, 118, 0.2); background: rgba(0, 230, 118, 0.05); }

        .tabs { display: flex; justify-content: space-between; background: var(--bg-card); padding: 8px; border-radius: 18px; margin-bottom: 35px; border: 1px solid #222; }
        .tab-btn { background: none; border: none; color: #555; padding: 12px 0; cursor: pointer; flex: 1; font-size: 0.7rem; display: flex; flex-direction: column; align-items: center; min-width: 50px; border-radius: 12px; transition: 0.3s; }
        .tab-btn span { font-size: 0.95rem; margin-top: 5px; font-weight: 600; }
        .tab-btn.active { color: #fff; background: #222; font-weight: 700; box-shadow: 0 4px 15px rgba(0,0,0,0.4); }

        .card, .macro-dashboard, .juice-card { background: var(--bg-card); border-radius: 24px; padding: 32px; margin-bottom: 25px; position: relative; box-shadow: 0 15px 50px -10px rgba(0,0,0,0.6); border: 1px solid rgba(255,255,255,0.03); }
        .card::before { content: ""; position: absolute; top: 35px; bottom: 35px; left: 0; width: 4px; background: var(--accent-gold); border-radius: 0 4px 4px 0; box-shadow: 4px 0 15px rgba(212, 175, 55, 0.2); }
        
        .workout-header { display: flex; justify-content: space-between; align-items: center; margin-bottom: 30px; padding-bottom: 15px; border-bottom: 1px solid #222; }
        .workout-title-btn { font-size: 1.1rem; font-weight: 800; text-transform: uppercase; color: #fff; display: flex; align-items: center; gap: 10px; letter-spacing: 0.5px; }
        .carb-pill { font-size: 0.65rem; font-weight: 900; padding: 6px 14px; border-radius: 6px; color: #fff; text-transform: uppercase; letter-spacing: 1px; }

        .label { color: #666; font-size: 0.65rem; text-transform: uppercase; font-weight: 800; margin-bottom: 8px; letter-spacing: 1.5px; }
        .value { font-size: 1.05rem; margin-bottom: 25px; color: #fff; font-weight: 500; cursor: pointer; display: flex; align-items: center; gap: 8px; letter-spacing: 0.3px; }
        .value:hover { color: var(--accent-gold); }

        /* PROTOCOL ROW */
        .protocol-container { margin-bottom: 30px; padding-bottom: 25px; border-bottom: 1px solid #222; }
        .protocol-header { font-size: 0.7rem; font-weight: 800; color: #666; text-transform: uppercase; margin-bottom: 15px; letter-spacing: 1.5px; }
        .protocol-grid { display: grid; grid-template-columns: 1fr 1fr 1fr; gap: 10px; }
        .proto-btn { 
            background: #111; border: 1px solid #333; color: #888; 
            padding: 12px 5px; border-radius: 12px; font-size: 0.6rem; font-weight: 800; 
            text-transform: uppercase; letter-spacing: 0.5px; cursor: pointer; transition: 0.2s; 
            display: flex; flex-direction: column; align-items: center; justify-content: center; gap: 6px; text-align: center;
        }
        .proto-btn span { font-size: 1.2rem; }
        .proto-btn.active { background: rgba(0, 230, 118, 0.1); border-color: var(--target-green); color: var(--target-green); }

        .snack-slot { background: #0a0a0a; border: 1px dashed #333; padding: 16px; border-radius: 12px; margin-bottom: 12px; cursor: pointer; display: flex; justify-content: space-between; align-items: center; color: #666; font-size: 0.85rem; font-weight: 500; }
        .snack-slot.filled { border-style: solid; border-color: #333; color: #fff; background: #161616; }
        .snack-remove { color: #555; font-size: 1.2rem; padding: 0 10px; }

        .macro-dashboard { cursor: pointer; }
        .view-goals-link { position: absolute; top: 32px; right: 32px; color: var(--text-muted); font-size: 0.65rem; font-weight: 800; letter-spacing: 1px; opacity: 0.6; }
        .macro-header { display: flex; flex-direction: column; margin-bottom: 25px; }
        .macro-header span:first-child { font-size: 0.95rem; font-weight: 800; letter-spacing: 1.5px; text-transform: uppercase; color: #fff; }
        .macro-row { margin-bottom: 22px; }
        .macro-label { display: flex; justify-content: space-between; font-size: 0.7rem; margin-bottom: 8px; font-weight: 700; color: #aaa; text-transform: uppercase; letter-spacing: 0.5px; }
        .macro-bar-bg { height: 8px; background: #222; border-radius: 10px; overflow: hidden; }
        .macro-bar-fill { height: 100%; border-radius: 10px; box-shadow: 0 0 12px rgba(255,255,255,0.08); transition: width 0.8s cubic-bezier(0.22, 1, 0.36, 1); }
        .p-fill { background: var(--grad-pro); } .c-fill { background: var(--grad-carb); } .f-fill { background: var(--grad-fat); } .cal-fill { background: var(--grad-cal); }

        .juice-card { opacity: 0.9; border: 1px solid #2a2a2a; background: radial-gradient(circle at top right, #1a1a1a, #0d0d0d); padding: 30px; margin-bottom: 60px; }
        .juice-badge { float: right; border: 1px solid; padding: 5px 10px; border-radius: 6px; font-size: 0.6rem; font-weight: 900; text-transform: uppercase; letter-spacing: 1px; }
        .juice-name { font-size: 1.5rem; font-weight: 900; letter-spacing: -0.5px; text-transform: uppercase; margin: 15px 0; color: #fff; }
        .juice-benefit { font-size: 0.85rem; color: #bbb; font-style: italic; margin-bottom: 20px; border-left: 3px solid #444; padding-left: 15px; line-height: 1.5; }
        .juice-macro-row { font-size: 0.7rem; font-weight: 800; color: var(--accent-gold); text-transform: uppercase; letter-spacing: 1.5px; padding-top: 15px; border-top: 1px solid #222; }

        .modal { display: none; position: fixed; z-index: 1000; left: 0; top: 0; width: 100%; height: 100%; background: rgba(0,0,0,0.94); backdrop-filter: blur(10px); overflow-y: auto; padding: 20px; }
        .modal-content { background: #0a0a0a; margin: 30px auto; padding: 40px; border: 1px solid #333; width: 100%; max-width: 600px; border-radius: 24px; box-shadow: 0 30px 60px #000; }
        .modal-content h2 { margin-top: 0; font-size: 1.4rem; letter-spacing: 1px; text-transform: uppercase; margin-bottom: 30px; line-height: 1.3; color: #fff; }
        .modal-time-badge { background: #222; color: var(--accent-gold); font-size: 0.7rem; font-weight: 800; padding: 6px 12px; border-radius: 6px; text-transform: uppercase; letter-spacing: 1px; display: inline-block; margin-bottom: 20px; border: 1px solid #333; }

        .chef-steps { counter-reset: step; color: #ccc; font-size: 0.95rem; line-height: 1.8; margin-top: 25px; }
        .chef-steps p { margin-bottom: 25px; position: relative; padding-left: 40px; }
        .chef-steps p strong { color: #fff; font-weight: 700; }
        .chef-steps p::before { counter-increment: step; content: counter(step); position: absolute; left: 0; top: 2px; width: 24px; height: 24px; background: #222; color: var(--accent-gold); font-size: 0.75rem; font-weight: 800; border-radius: 50%; display: flex; align-items: center; justify-content: center; border: 1px solid #333; }
        #modalIng { padding: 0; list-style: none; margin-bottom: 35px; }
        #modalIng li { margin-bottom: 12px; font-size: 0.95rem; color: #ddd; border-bottom: 1px solid #1a1a1a; padding-bottom: 8px; }

        .proto-detail-row { margin-bottom: 25px; padding-bottom: 25px; border-bottom: 1px solid #222; }
        .proto-label { color: var(--accent-gold); font-size: 0.75rem; font-weight: 800; text-transform: uppercase; margin-bottom: 10px; letter-spacing: 1px; }
        .proto-val { color: #fff; font-size: 1.1rem; font-weight: 500; line-height: 1.5; }
        .proto-desc { color: #aaa; font-size: 1rem; line-height: 1.7; }

        .stat-grid { display: grid; grid-template-columns: 1fr 1fr; gap: 20px; margin-bottom: 40px; }
        .stat-box { background: #0a0a0a; padding: 25px; border-radius: 16px; border: 1px solid #222; text-align: center; }
        .stat-val { font-size: 1.6rem; color: #fff; font-weight: 800; letter-spacing: -1px; }
        .stat-lbl { font-size: 0.65rem; color: #666; text-transform: uppercase; margin-top: 8px; font-weight: 700; letter-spacing: 1px; }
        .prog-section { margin-bottom: 40px; }
        .prog-title { display: flex; justify-content: space-between; font-size: 0.75rem; font-weight: 800; color: #fff; text-transform: uppercase; margin-bottom: 15px; letter-spacing: 1px; }
        .prog-bar-row { display: flex; align-items: center; margin-bottom: 15px; }
        .prog-label { width: 55px; font-size: 0.6rem; font-weight: 900; color: #555; text-transform: uppercase; letter-spacing: 1px; }
        .prog-track { flex: 1; height: 8px; background: #1a1a1a; border-radius: 6px; overflow: hidden; margin: 0 15px; }
        .prog-fill { height: 100%; border-radius: 4px; box-shadow: 0 0 10px rgba(255,255,255,0.2); }
        .prog-fill.gold { background: var(--grad-gold); }
        .prog-fill.green { background: var(--grad-green); }
        .prog-val { width: 50px; text-align: right; font-size: 0.75rem; font-weight: 700; color: #fff; }
        .scan-alert { text-align: center; font-size: 0.7rem; font-weight: 800; margin-top: 25px; padding: 15px; border-radius: 8px; text-transform: uppercase; letter-spacing: 1px; display: none; }
        .scan-alert.upcoming { color: var(--heat-red); border: 1px solid var(--heat-red); background: rgba(231, 76, 60, 0.1); }
    </style>
</head>
<body>

<div class="container">
    <header>
        <div class="version-tag">VER 223.0</div>
        <h1>THE CENTURION</h1>
        <div class="profile-badges">
            <div id="badgeJ" class="badge active-user" onclick="switchUser('J')">üßîüèæ‚Äç‚ôÇÔ∏è JERMAINE</div>
            <div id="badgeS" class="badge" onclick="switchUser('S')">üë©üèæ‚Äçü¶± SOPHIA</div>
        </div>
    </header>
    
    <div id="dateRangeDisplay" class="status-bar">...</div>
    
    <div class="controls">
        <button class="nav-btn" onclick="changeWeek(-1)">PREV</button>
        <button class="nav-btn" onclick="resetToCurrent()">TODAY</button>
        <button class="nav-btn" onclick="changeWeek(1)">NEXT</button>
        <button class="nav-btn grocery-btn" onclick="generateGroceryList()">SHOP</button>
    </div>
    
    <div id="dayTabs" class="tabs"></div>
    <div id="dayContent"></div>
</div>

<div id="jermaineModal" class="modal"><div class="modal-content">
    <span onclick="closeModal('jermaineModal')" style="float:right; cursor:pointer; font-size:24px;">&times;</span>
    <h2 style="color:var(--accent-gold);">üßîüèæ‚Äç‚ôÇÔ∏è JERMAINE</h2>
    <div class="stat-grid">
        <div class="stat-box"><div class="stat-val">217.1</div><div class="stat-lbl">Weight</div></div>
        <div class="stat-box"><div class="stat-val">98.8</div><div class="stat-lbl">Muscle</div></div>
        <div class="stat-box"><div class="stat-val">20.7%</div><div class="stat-lbl">Body Fat</div></div>
        <div class="stat-box"><div class="stat-val">1996</div><div class="stat-lbl">BMR</div></div>
    </div>
    <div id="jGoalHeader" style="color:var(--target-green); font-size:0.75rem; font-weight:800; text-transform:uppercase; margin-bottom:25px; text-align:center; letter-spacing:2px;">30-DAY TARGET</div>
    <div class="prog-section">
        <div class="prog-title"><span>Body Fat %</span><span style="color:var(--target-green)">Target: 19.2%</span></div>
        <div class="prog-bar-row"><div class="prog-label">START</div><div class="prog-track"><div class="prog-fill" style="width:17.9%; background:#333"></div></div><div class="prog-val" style="color:#777">17.9%</div></div>
        <div class="prog-bar-row"><div class="prog-label" style="color:#fff">NOW</div><div class="prog-track"><div class="prog-fill gold" style="width:20.7%;"></div></div><div class="prog-val">20.7%</div></div>
        <div class="prog-bar-row"><div class="prog-label" style="color:var(--target-green)">GOAL</div><div class="prog-track"><div class="prog-fill green" style="width:19.2%;"></div></div><div class="prog-val" style="color:var(--target-green)">19.2%</div></div>
    </div>
    <div id="jScanAlert" class="scan-alert"></div>
</div></div>

<div id="sophiaModal" class="modal"><div class="modal-content">
    <span onclick="closeModal('sophiaModal')" style="float:right; cursor:pointer; font-size:24px;">&times;</span>
    <h2 style="color:var(--glute-pink);">üë©üèæ‚Äçü¶± SOPHIA</h2>
    <div class="stat-grid">
        <div class="stat-box"><div class="stat-val">141.5</div><div class="stat-lbl">Weight</div></div>
        <div class="stat-box"><div class="stat-val">49.2</div><div class="stat-lbl">Muscle</div></div>
        <div class="stat-box"><div class="stat-val">36.1%</div><div class="stat-lbl">Body Fat</div></div>
        <div class="stat-box"><div class="stat-val">1332</div><div class="stat-lbl">BMR</div></div>
    </div>
    <div id="sGoalHeader" style="color:var(--target-green); font-size:0.75rem; font-weight:800; text-transform:uppercase; margin-bottom:25px; text-align:center; letter-spacing:2px;">30-DAY TARGET</div>
    <div class="prog-section">
        <div class="prog-title"><span>Body Fat %</span><span style="color:var(--target-green)">Target: 34.6%</span></div>
        <div class="prog-bar-row"><div class="prog-label">START</div><div class="prog-track"><div class="prog-fill" style="width:33.0%; background:#333"></div></div><div class="prog-val" style="color:#777">33.0%</div></div>
        <div class="prog-bar-row"><div class="prog-label" style="color:#fff">NOW</div><div class="prog-track"><div class="prog-fill gold" style="width:36.1%;"></div></div><div class="prog-val">36.1%</div></div>
        <div class="prog-bar-row"><div class="prog-label" style="color:var(--target-green)">GOAL</div><div class="prog-track"><div class="prog-fill green" style="width:34.6%;"></div></div><div class="prog-val" style="color:var(--target-green)">34.6%</div></div>
    </div>
    <div id="sScanAlert" class="scan-alert"></div>
</div></div>

<div id="recipeModal" class="modal"><div class="modal-content">
    <span onclick="closeModal('recipeModal')" style="float:right; cursor:pointer;">&times;</span>
    <h2 id="modalTitle" style="color:#fff; margin-bottom:5px;"></h2>
    <div id="modalTimeBadge" class="modal-time-badge"></div>
    <div style="color:var(--accent-gold); font-size:0.75rem; font-weight:800; margin:15px 0 5px 0;">INGREDIENTS</div>
    <ul id="modalIng"></ul>
    <div style="color:var(--accent-gold); font-size:0.75rem; font-weight:800; margin-bottom:12px;">CHEF PREPARATION</div>
    <div id="modalSteps" class="chef-steps"></div>
    <div id="modBox" style="background:rgba(214, 51, 132, 0.1); border:1px solid var(--glute-pink); padding:15px; border-radius:6px; margin-top:20px;">
        <div style="color:var(--glute-pink); font-size:0.8rem; font-weight:800; text-transform:uppercase;">üçë Sophia's Mod</div>
        <div id="modalMod" style="color:#e5e4e2; font-size:0.85rem;"></div>
    </div>
</div></div>

<div id="juiceModal" class="modal"><div class="modal-content"><span onclick="closeModal('juiceModal')" style="float:right; cursor:pointer;">&times;</span><h2 id="jTitle" style="color:var(--accent-gold);"></h2><div id="jMacros" style="color:#888; font-size:0.8rem; margin-bottom:20px; font-weight:700;"></div><div id="jPrep" class="chef-steps" style="counter-reset: step;"></div></div></div>

<div id="protocolDetailModal" class="modal"><div class="modal-content">
    <span onclick="closeModal('protocolDetailModal')" style="float:right; cursor:pointer; font-size:24px;">&times;</span>
    <h2 id="pdTitle" style="color:var(--target-green); margin-bottom:20px;"></h2>
    <div class="proto-detail-row"><div class="proto-label">Dosage / Amount</div><div id="pdAmount" class="proto-val"></div></div>
    <div class="proto-detail-row"><div class="proto-label">What is it?</div><div id="pdWhat" class="proto-desc"></div></div>
    <div class="proto-detail-row" style="border-bottom:none;"><div class="proto-label">Health Benefits</div><div id="pdBenefits" class="proto-desc"></div></div>
</div></div>

<div id="groceryModal" class="modal"><div class="modal-content"><span onclick="closeModal('groceryModal')" style="float:right; cursor:pointer;">&times;</span><h2 style="color:var(--target-green); margin-bottom:20px;">üõí WEEKLY SHOPPING LIST</h2><div id="groceryList" style="color:#ccc; line-height:1.6; font-size:0.9rem;"></div></div></div>

<div id="snackModal" class="modal"><div class="modal-content"><span onclick="closeModal('snackModal')" style="float:right; cursor:pointer;">&times;</span><h2 style="color:var(--accent-gold); margin-bottom:20px;">SELECT SNACK ITEM</h2><div id="snackOptionsList"></div></div></div>

<script>
    let currentUser = 'J'; 
    let dayState = {}; 
    let selectedDateStr = "";
    
    // --- PROTOCOL DETAIL ---
    const protocolDetails = {
        "sea": { title: "SEA MOSS", amount: "2 Tbsp (Morning)", what: "Wildcrafted Sea Moss Gel.", benefits: "92/102 minerals. Thyroid & Gut support." },
        "kom": { title: "KOMBUCHA", amount: "4-8 oz (Gut Shot)", what: "Fermented Tea.", benefits: "Probiotics for digestion & energy." },
        "water": { title: "HYDRATION", amount: "1 Gallon Target", what: "Filtered Water + Electrolytes.", benefits: "Muscle fullness, cognition, toxin flush." }
    };
    
    // --- RECIPES ---
    const recipeDB = {
        "Bison Steak & Eggs": { 
            time: "üï∞Ô∏è 35 MIN",
            ing: ["6oz Bison Sirloin", "2 Eggs", "Tomato", "Salt/Pepper", "**Asparagus**", "**Bell Peppers**"], 
            steps: ["**Prep:** Remove bison from fridge 30 mins prior to cooking to reach room temp.", "**Sear:** Heat cast-iron to **High**. Sear steak for **3 mins per side**.", "**Rest:** Remove steak and let rest for **8 minutes** before slicing.", "**Eggs:** Fry eggs sunny side up."], 
            mod: "Sophia: 3oz bison.", macros: { J:{p:65,c:5,f:28,k:530}, S:{p:35,c:5,f:18,k:320} } 
        },
        "Crab Scramble": { 
            time: "‚ö° 15 MIN",
            ing: ["4oz Crab", "3 Whites", "Chives", "Ghee", "**Old Bay**", "**Spinach**"], 
            steps: ["Whisk whites with **Old Bay**.", "Saut√© spinach in ghee.", "Add eggs. When soft, fold in crab.", "Finish with chives."], 
            mod: "Sophia: 3oz.", macros: { J:{p:45,c:3,f:5,k:238}, S:{p:30,c:3,f:3,k:158} } 
        },
        "Japanese Tamagoyaki": { 
            time: "üï∞Ô∏è 25 MIN",
            ing: ["4 Eggs", "Dashi", "Aminos", "**Sesame Oil**", "**Zucchini**"], 
            steps: ["Whisk eggs with dashi/aminos.", "Heat rectangular pan with sesame oil.", "Pour thin layer, cook 60s, roll.", "Repeat layers.", "Serve with pickled ginger."], 
            mod: "Sophia: 1.5 palms.", macros: { J:{p:28,c:6,f:20,k:318}, S:{p:18,c:4,f:12,k:196} } 
        },
        "Sea Moss Smoothie": { 
            time: "‚ö° 5 MIN",
            ing: ["2tbsp Sea Moss", "Spinach", "**Blueberries**", "Protein", "**Cinnamon**"], 
            steps: ["Blend greens & water.", "Add frozen fruit & powders.", "Blend until smooth."], 
            mod: "Add collagen.", macros: { J:{p:25,c:15,f:5,k:210}, S:{p:25,c:12,f:5,k:195} } 
        },
        "Southwest Bison Scramble": { 
            time: "üï∞Ô∏è 20 MIN",
            ing: ["4oz Bison", "3 Whites", "Poblanos", "**Cumin**", "**Paprika**"], 
            steps: ["Brown bison with spices.", "Add diced poblanos.", "Pour in whites & scramble.", "Top with salsa."], 
            mod: "Sophia: 3oz.", macros: { J:{p:48,c:8,f:12,k:332}, S:{p:32,c:6,f:8,k:224} } 
        },
        "Avocado Toast (Sprouted)": { 
            time: "‚ö° 10 MIN",
            ing: ["Sprouted Bread", "1/2 Avocado", "2 Eggs", "**Chili Flakes**", "**Lemon**"], 
            steps: ["Toast bread well.", "Mash avocado with lemon & flakes.", "Fry/Poach eggs.", "Assemble."], 
            mod: "Sophia: 1 slice.", macros: { J:{p:22,c:28,f:18,k:380}, S:{p:14,c:15,f:12,k:240} } 
        },
        "Sprouted Breakfast Wrap": { 
            time: "‚ö° 15 MIN",
            ing: ["Sprouted Tortilla", "3 Eggs", "Turkey Bacon", "Spinach", "**Hot Sauce**"], 
            steps: ["Crisp bacon.", "Scramble eggs with spinach.", "Warm tortilla.", "Fill & Roll."], 
            mod: "Sophia: 1/2 tortilla.", macros: { J:{p:35,c:24,f:15,k:390}, S:{p:20,c:12,f:10,k:220} } 
        },
        "Yogurt & Granola Bowl": { 
            time: "‚ö° 5 MIN",
            ing: ["Greek Yogurt", "Granola", "Berries", "**Hemp Hearts**"], 
            steps: ["Add yogurt to bowl.", "Top with crunch & fruit.", "Add seeds."], 
            mod: "Sophia: 1/2 cup.", macros: { J:{p:28,c:25,f:8,k:290}, S:{p:16,c:18,f:5,k:180} } 
        },
        "Sardine Bowl": { 
            time: "‚ö° 5 MIN", 
            ing: ["Sardines", "Avocado", "**Lemon Pepper**", "Radish"], 
            steps: ["Mash avocado.", "Top with sardines/veggies.", "Season."], 
            mod: "Sophia: 1.5 palms.", macros: { J:{p:25,c:8,f:20,k:312}, S:{p:18,c:5,f:15,k:227} } 
        },
        "Bison Laab": { 
            time: "üï∞Ô∏è 25 MIN", 
            ing: ["Bison", "Lime", "Fish Sauce", "**Mint**", "**Chili**"], 
            steps: ["Cook bison.", "Mix sauce (Lime/Fish/Chili).", "Toss meat in sauce.", "Add herbs."], 
            mod: "Sophia: 3oz.", macros: { J:{p:45,c:10,f:12,k:328}, S:{p:22,c:6,f:6,k:166} } 
        },
        "Stealth Liver Sliders": { 
            time: "üï∞Ô∏è 30 MIN", 
            ing: ["Bison/Liver", "**Smoked Paprika**", "Mushrooms"], 
            steps: ["Mix meats & spices.", "Form patties.", "Grill 4m/side.", "Serve on mushroom caps."], 
            mod: "Sophia: 1 slider.", macros: { J:{p:48,c:6,f:15,k:351}, S:{p:24,c:3,f:8,k:180} } 
        },
        "Chicken Satay": { 
            time: "üï∞Ô∏è 30 MIN", 
            ing: ["Chicken", "**Peanut Butter**", "**Soy**", "Snap Peas"], 
            steps: ["Marinate chicken.", "Grill skewers.", "Serve with raw veggies."], 
            mod: "Sophia: 3oz.", macros: { J:{p:50,c:10,f:10,k:330}, S:{p:25,c:6,f:5,k:169} } 
        },
        "Squid Ink Risotto": { 
            time: "‚è≥ 45 MIN",
            ing: ["Squid Rings", "Cauliflower Rice", "Ink", "**Garlic**", "**Saffron**", "**Fish Stock**"], 
            steps: ["**Base:** Saut√© shallots and garlic.", "**Rice:** Add cauliflower rice. Stir to coat.", "**Ink:** Dissolve ink in warm stock. Pour slowly into pan.", "**Finish:** Sear squid rings separately (2 mins)."], 
            mod: "Sophia: 1/2 cup.", macros: { J:{p:35,c:18,f:10,k:302}, S:{p:18,c:12,f:6,k:174} } 
        },
        "Thai Beef Salad": { 
            time: "üï∞Ô∏è 30 MIN",
            ing: ["Steak", "**Lemongrass**", "**Fish Sauce**", "**Lime**", "**Chili**", "**Mint**"], 
            steps: ["**Grill:** Cook steak to medium-rare.", "**Dressing:** Whisk Fish Sauce, Lime, Stevia, and Chilies.", "**Toss:** Combine meat, greens, cucumber, and onion.", "**Serve:** Pour dressing over salad."], 
            mod: "Sophia: 2oz.", macros: { J:{p:30,c:12,f:12,k:276}, S:{p:15,c:7,f:6,k:142} } 
        }
    };
    
    function openRecipe(n) { 
        let r = recipeDB[n] || recipeDB["Bison Steak & Eggs"]; 
        document.getElementById('modalTitle').innerText = n; 
        document.getElementById('modalTimeBadge').innerText = r.time || "üï∞Ô∏è 30 MIN";
        document.getElementById('modalIng').innerHTML = r.ing.map(i => '<li>‚Ä¢ ' + i.replace(/\*\*(.*?)\*\*/g, '<b style="color:var(--target-green)">$1</b>') + '</li>').join('');
        document.getElementById('modalSteps').innerHTML = r.steps.map(s => `<p>${s.replace(/\*\*(.*?)\*\*/g, '<b>$1</b>')}</p>`).join(''); 
        document.getElementById('modalMod').innerText = r.mod; 
        
        // Macro display in recipe modal
        const jM = r.macros.J; const sM = r.macros.S;
        // Logic could go here to show specific macros if needed
        openModal('recipeModal'); 
    }

    const macroTargets = { 'J': { 'HIGH CARB': { p: 160, c: 300, f: 75, k: 2500 }, 'LOW CARB': { p: 160, c: 80, f: 100, k: 1860 } }, 'S': { 'HIGH CARB': { p: 105, c: 180, f: 55, k: 1635 }, 'LOW CARB': { p: 105, c: 50, f: 70, k: 1250 } } };
    const snackDB = { "Pea Protein ISO": { p: 25, c: 2, f: 2, k: 120 }, "Peanut Protein": { p: 8, c: 5, f: 2, k: 70 }, "Centurion Blend": { p: 33, c: 7, f: 4, k: 190 }, "REMOVE": { p: 0, c: 0, f: 0, k: 0 } };
    
    // Schedules
    const weeklySchedule = [
        { w: "REST & RECOVERY", c: "LOW CARB", j: "APOLLO GOLD" }, // Sun
        { w: "CHEST & TRICEPS", c: "HIGH CARB", j: "PUMP JUICE" }, // Mon
        { w: "BACK & BICEPS", c: "HIGH CARB", j: "PLASMA FLUSH" }, // Tue
        { w: "LEGS & GLUTES", c: "HIGH CARB", j: "PUMP JUICE" }, // Wed
        { w: "ACTIVE REST", c: "LOW CARB", j: "APOLLO GOLD" }, // Thu
        { w: "SHOULDERS & ARMS", c: "HIGH CARB", j: "PLASMA FLUSH" }, // Fri
        { w: "GLUTE FOCUS", c: "HIGH CARB", j: "PUMP JUICE" }  // Sat
    ];
    
    // Simple meal rotation
    const meals = [
        {b: "Bison Steak & Eggs", l: "Bison Laab", d: "Squid Ink Risotto"},
        {b: "Crab Scramble", l: "Stealth Liver Sliders", d: "Thai Beef Salad"},
        {b: "Japanese Tamagoyaki", l: "Chicken Satay", d: "Squid Ink Risotto"},
        {b: "Sea Moss Smoothie", l: "Sardine Bowl", d: "Thai Beef Salad"},
        {b: "Southwest Bison Scramble", l: "Bison Laab", d: "Squid Ink Risotto"},
        {b: "Avocado Toast (Sprouted)", l: "Stealth Liver Sliders", d: "Thai Beef Salad"},
        {b: "Sprouted Breakfast Wrap", l: "Chicken Satay", d: "Squid Ink Risotto"}
    ];

    let weekOffset = 0; let selectedDayIndex = 0; let selectedDateObj = new Date();

    function getMonday(offset) { 
        let d = new Date(); 
        let day = d.getDay(), diff = d.getDate() - day + (day == 0 ? -6:1); 
        let mon = new Date(d.setDate(diff)); 
        mon.setDate(mon.getDate() + (offset * 7)); 
        return mon; 
    }

    function switchUser(user) { 
        currentUser = user; 
        document.getElementById('badgeJ').classList.toggle('active-user', user === 'J');
        document.getElementById('badgeS').classList.toggle('active-user', user === 'S');
        showDay(selectedDateObj, selectedDayIndex); 
    }

    function renderTabs() { 
        const tabsContainer = document.getElementById('dayTabs');
        tabsContainer.innerHTML = '';
        const mon = getMonday(weekOffset);
        const days = ['M','T','W','T','F','S','S'];
        
        let start = new Date(mon);
        let end = new Date(mon); end.setDate(end.getDate()+6);
        document.getElementById('dateRangeDisplay').innerText = `${start.toLocaleDateString()} - ${end.toLocaleDateString()}`;

        for(let i=0; i<7; i++) {
            let d = new Date(mon); d.setDate(mon.getDate() + i);
            let btn = document.createElement('button');
            btn.className = 'tab-btn' + (i === selectedDayIndex ? ' active' : '');
            btn.innerHTML = `${d.getDate()}<span>${days[i]}</span>`;
            btn.onclick = () => { 
                selectedDayIndex = i; 
                selectedDateObj = d;
                renderTabs(); 
                showDay(d, i); 
            };
            tabsContainer.appendChild(btn);
        }
    }

    function getDayState(dateKey) { 
        if (!dayState[dateKey]) dayState[dateKey] = { s1: null, s2: null, s3: null, proto: {sea: false, kom: false, water: false}, juice: false }; 
        return dayState[dateKey]; 
    }

    function toggleProtocol(pType) {
        const key = selectedDateObj.toDateString();
        const state = getDayState(key);
        state.proto[pType] = !state.proto[pType];
        showDay(selectedDateObj, selectedDayIndex);
    }

    function calculateMacros(mealPlan, scheduleType, dateKey) { 
        let t = {p:0, c:0, f:0, k:0};
        
        // Sum meals
        ['b','l','d'].forEach(m => {
            let r = recipeDB[mealPlan[m]];
            if(r && r.macros && r.macros[currentUser]) {
                let mac = r.macros[currentUser];
                t.p += mac.p; t.c += mac.c; t.f += mac.f; t.k += mac.k;
            }
        });

        // Sum Snacks
        const state = getDayState(dateKey);
        [state.s1, state.s2, state.s3].forEach(s => {
            if(s && snackDB[s]) {
                t.p += snackDB[s].p; t.c += snackDB[s].c; t.f += snackDB[s].f; t.k += snackDB[s].k;
            }
        });

        return { total: t, goal: macroTargets[currentUser][scheduleType] }; 
    }

    function showDay(dateObj, dayIndex) { 
        // Logic for Sunday (index 6) vs Monday (0) mapping
        // weeklySchedule is 0=Sun, 1=Mon... but loop above is 0=Mon.
        // Let's map loop index 0(Mon) to schedule index 1.
        let schedIndex = (dayIndex + 1) % 7; 
        let sched = weeklySchedule[schedIndex];
        let mealPlan = meals[schedIndex]; // Loop through 7 meal plans
        
        const macros = calculateMacros(mealPlan, sched.c, dateObj.toDateString());
        const state = getDayState(dateObj.toDateString());

        const pct = (val, goal) => Math.min(100, Math.round((val/goal)*100)) + '%';
        const pColor = currentUser === 'J' ? 'var(--accent-gold)' : 'var(--glute-pink)';

        let html = `
            <div class="workout-header">
                <div class="workout-title-btn" style="color:${pColor}">
                    ${sched.w}
                </div>
                <div class="carb-pill" style="background:${sched.c==='HIGH CARB'?'var(--heat-red)':'#444'}">${sched.c}</div>
            </div>

            <div class="protocol-container">
                <div class="protocol-header">DAILY PROTOCOL</div>
                <div class="protocol-grid">
                    <div class="proto-btn ${state.proto.sea ? 'active' : ''}" onclick="toggleProtocol('sea')">
                        <span>ü™∏</span>SEA MOSS
                    </div>
                    <div class="proto-btn ${state.proto.kom ? 'active' : ''}" onclick="toggleProtocol('kom')">
                        <span>ü•É</span>KOMBUCHA
                    </div>
                    <div class="proto-btn ${state.proto.water ? 'active' : ''}" onclick="toggleProtocol('water')">
                        <span>üíß</span>WATER
                    </div>
                </div>
            </div>

            <div class="card macro-dashboard" onclick="openProfileModal()">
                <div class="view-goals-link">VIEW GOALS ‚Üó</div>
                <div class="macro-header">
                    <span>MACRO TARGETS</span>
                    <span style="font-size:0.7rem; color:#666; margin-top:5px;">${Math.round(macros.total.k)} / ${macros.goal.k} KCAL</span>
                </div>
                <div class="macro-row">
                    <div class="macro-label"><span>Protein</span><span>${macros.total.p} / ${macros.goal.p}g</span></div>
                    <div class="macro-bar-bg"><div class="macro-bar-fill p-fill" style="width:${pct(macros.total.p, macros.goal.p)}"></div></div>
                </div>
                <div class="macro-row">
                    <div class="macro-label"><span>Carbs</span><span>${macros.total.c} / ${macros.goal.c}g</span></div>
                    <div class="macro-bar-bg"><div class="macro-bar-fill c-fill" style="width:${pct(macros.total.c, macros.goal.c)}"></div></div>
                </div>
                <div class="macro-row">
                    <div class="macro-label"><span>Fats</span><span>${macros.total.f} / ${macros.goal.f}g</span></div>
                    <div class="macro-bar-bg"><div class="macro-bar-fill f-fill" style="width:${pct(macros.total.f, macros.goal.f)}"></div></div>
                </div>
            </div>

            <div class="card">
                <div class="label">BREAKFAST</div>
                <div class="value" onclick="openRecipe('${mealPlan.b}')">${mealPlan.b}</div>
                <div class="label">LUNCH</div>
                <div class="value" onclick="openRecipe('${mealPlan.l}')">${mealPlan.l}</div>
                <div class="label">DINNER</div>
                <div class="value" onclick="openRecipe('${mealPlan.d}')">${mealPlan.d}</div>
            </div>

            <div class="card">
                <div class="label" style="margin-bottom:15px;">SNACKS / SUPPLEMENTS</div>
                ${renderSnackSlot(1, state.s1)}
                ${renderSnackSlot(2, state.s2)}
                ${renderSnackSlot(3, state.s3)}
            </div>

            <div class="juice-card" onclick="openJuiceModal('${sched.j}')">
                <div class="juice-badge" style="color:var(--accent-gold); border-color:var(--accent-gold)">POST-WORKOUT</div>
                <div class="juice-name">${sched.j}</div>
                <div class="juice-benefit">"Rapid glycogen replenishment & recovery."</div>
            </div>
        `;
        document.getElementById('dayContent').innerHTML = html;
    }

    function renderSnackSlot(num, currentVal) {
        if(currentVal) {
            let s = snackDB[currentVal];
            return `<div class="snack-slot filled">
                <span>${currentVal} <span style="font-size:0.7rem; color:#666">(${s.p}p ${s.c}c)</span></span>
                <span class="snack-remove" onclick="removeSnack(${num})">&times;</span>
            </div>`;
        } else {
            return `<div class="snack-slot" onclick="openSnackSelector(${num})">+ ADD SNACK</div>`;
        }
    }

    function generateGroceryList() { 
        let html = "<ul>";
        // Simple logic to pull unique ingredients from the current week's meals
        html += "<li>6x 8oz Bison Steaks</li>";
        html += "<li>2 Dozen Pasture Eggs</li>";
        html += "<li>1 Bag Spinach</li>";
        html += "<li>1 Bag Cauliflower Rice</li>";
        html += "<li>1 Jar Sea Moss</li>";
        html += "</ul>";
        document.getElementById('groceryList').innerHTML = html;
        openModal('groceryModal');
    }

    let activeSnackSlot = 1;
    function openSnackSelector(slot) { 
        activeSnackSlot = slot;
        let html = '';
        for(let s in snackDB) {
            if(s !== 'REMOVE') {
                let d = snackDB[s];
                html += `<div class="snack-slot" onclick="selectSnack('${s}')">${s} <span style="font-size:0.7rem">(${d.p}p/${d.c}c)</span></div>`;
            }
        }
        document.getElementById('snackOptionsList').innerHTML = html;
        openModal('snackModal'); 
    }
    
    function selectSnack(name) { 
        let state = getDayState(selectedDateObj.toDateString());
        state['s'+activeSnackSlot] = name;
        closeModal('snackModal');
        showDay(selectedDateObj, selectedDayIndex);
    }
    
    function removeSnack(slot) {
        let state = getDayState(selectedDateObj.toDateString());
        state['s'+slot] = null;
        showDay(selectedDateObj, selectedDayIndex);
    }
    
    function openProtocolDetail(type) { 
        const data = protocolDetails[type]; 
        document.getElementById('pdTitle').innerText = data.title; 
        document.getElementById('pdAmount').innerText = data.amount; 
        document.getElementById('pdWhat').innerText = data.what; 
        document.getElementById('pdBenefits').innerText = data.benefits; 
        openModal('protocolDetailModal'); 
    }
    
    function openJuiceModal(jName) { 
        document.getElementById('jTitle').innerText = jName;
        document.getElementById('jMacros').innerText = "CAL: 210 | P: 25g | C: 45g";
        document.getElementById('jPrep').innerHTML = "<p>Combine 1 scoop Centurion Blend with 12oz water.</p><p>Shake vigorously.</p><p>Drink immediately post-lift.</p>";
        openModal('juiceModal');
    }
    
    function openProfileModal() { 
        if(currentUser === 'J') openModal('jermaineModal');
        else openModal('sophiaModal');
    }

    function openModal(id) { document.getElementById(id).style.display = 'block'; }
    function closeModal(id) { document.getElementById(id).style.display = 'none'; }
    function changeWeek(dir) { weekOffset += dir; renderTabs(); }
    function resetToCurrent() { weekOffset = 0; renderTabs(); showDay(new Date(), new Date().getDay() === 0 ? 6 : new Date().getDay() - 1); }

    // Init
    window.onload = function() { 
        // Set default day to today
        let d = new Date();
        let dayIndex = d.getDay() === 0 ? 6 : d.getDay() - 1; // Mon=0
        selectedDateObj = d;
        selectedDayIndex = dayIndex;
        
        renderTabs(); 
        showDay(d, dayIndex); 
    };
</script>
</body>
</html>