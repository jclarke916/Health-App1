<!DOCTYPE html>

<html lang="en">
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width,initial-scale=1.0,maximum-scale=1.0,user-scalable=no">
<title>Centurion v17.2</title>
<style>
*{box-sizing:border-box;margin:0;padding:0}
body{background:#000;color:#fff;font-family:sans-serif;padding-bottom:80px}
.header{background:#111;padding:15px;border-bottom:1px solid #333;position:sticky;top:0;z-index:100}
.user-switch{display:flex;gap:5px;background:#222;padding:3px;border-radius:20px;margin-bottom:10px}
.user-switch button{padding:6px 12px;border:none;background:transparent;color:#666;border-radius:16px;cursor:pointer;font-weight:bold}
.user-switch button.active{background:#fff;color:#000}
.date-nav{display:flex;justify-content:space-between;align-items:center;margin-top:10px}
.nav-btn{background:transparent;border:1px solid #666;color:#FFD60A;padding:8px 20px;border-radius:4px;cursor:pointer;font-weight:bold}
#dateLabel{flex:1;text-align:center;color:#ccff00;font-weight:bold}
.hero{padding:20px 15px;display:flex;gap:15px;align-items:center}
.dual-score{display:flex;gap:12px;align-items:center}
.score-box{border:3px solid #333;border-radius:50%;display:flex;flex-direction:column;align-items:center;justify-content:center;position:relative}
.score-box.small{width:70px;height:70px;border-width:2px}
.score-box.primary{width:90px;height:90px;border-width:3px;background:radial-gradient(circle,rgba(204,255,0,0.05) 0%,transparent 70%)}
.score-val{font-size:1.4rem;font-weight:900;line-height:1}
.score-val.longevity{font-size:2rem;background:linear-gradient(135deg,#ccff00 0%,#00f0ff 100%);-webkit-background-clip:text;-webkit-text-fill-color:transparent;background-clip:text}
.score-label{font-size:0.45rem;color:#666;text-transform:uppercase;margin-top:2px;font-weight:700}
.score-max{font-size:0.5rem;color:#444;font-weight:700;position:absolute;bottom:6px}
.status{flex:1;border-left:3px solid #ccff00;padding-left:15px;font-size:0.7rem;font-weight:bold;line-height:1.3}
.alert{margin:0 15px 20px;padding:12px;border-radius:8px;text-align:center;font-weight:bold;display:none;background:#FFD60A;color:#000}
.alert.show{display:block}
.section-header{padding:10px 15px;font-size:0.55rem;font-weight:900;color:#666;letter-spacing:1px;text-transform:uppercase}
.sleep-grid{display:grid;grid-template-columns:1fr 1fr 1fr;gap:10px;padding:0 15px;margin-bottom:20px}
.sleep-orb{background:#0a0a0a;border:1px solid #333;border-radius:12px;padding:15px 10px;display:flex;flex-direction:column;align-items:center}
.orb-container{width:60px;height:60px;position:relative;display:flex;align-items:center;justify-content:center;margin-bottom:8px}
.orb-svg{transform:rotate(-90deg);width:100%;height:100%}
.orb-bg{fill:none;stroke:#222;stroke-width:4}
.orb-fg{fill:none;stroke-width:4;stroke-dasharray:145;stroke-dashoffset:145;transition:stroke-dashoffset 1s ease;stroke-linecap:round}
.orb-val-box{position:absolute;text-align:center}
.orb-val{font-family:monospace;font-size:0.8rem;font-weight:900;color:#fff}
.orb-label{font-size:0.45rem;font-weight:700;color:#666;text-transform:uppercase;letter-spacing:1px}
.timeline{padding:0 15px;margin-bottom:40px}
.task{display:flex;gap:10px;margin-bottom:15px}
.task-time{width:50px;color:#666;font-size:0.7rem;padding-top:5px;text-align:right}
.task-card{flex:1;background:#0a0a0a;border:1px solid #333;border-radius:12px;padding:12px 50px 12px 12px;position:relative}
.task-card.checked{border-color:#ccff00;background:rgba(204,255,0,0.05)}
.task-title{font-weight:bold;font-size:0.75rem;margin-bottom:3px}
.task-desc{font-size:0.6rem;color:#888}
.check-btn{position:absolute;top:0;right:0;width:50px;height:50px;display:flex;align-items:center;justify-content:center;cursor:pointer}
.check-circle{width:28px;height:28px;border:2px solid #666;border-radius:50%;background:rgba(0,0,0,0.5);display:flex;align-items:center;justify-content:center;font-weight:900;font-size:0.9rem}
.task-card.checked .check-circle{background:#ccff00;border-color:#ccff00;color:#000}
.footer{position:fixed;bottom:0;left:0;width:100%;background:#000;padding:12px 15px;border-top:1px solid #333;display:flex;justify-content:space-between;align-items:center;z-index:100}
.sync-status{font-size:0.6rem;color:#666}
.sync-btn{background:#ccff00;color:#000;border:none;padding:8px 16px;border-radius:6px;cursor:pointer;font-weight:900;font-size:0.7rem}
.debug-btn{position:fixed;bottom:70px;right:10px;z-index:200;background:#ccff00;color:#000;border:none;padding:8px 12px;border-radius:6px;font-weight:900;cursor:pointer}
.debug-console{position:fixed;bottom:60px;left:0;right:0;height:200px;background:rgba(0,0,0,0.95);border-top:2px solid #ccff00;z-index:199;display:none;overflow-y:auto;padding:10px;font-size:0.65rem;color:#0f0;font-family:monospace}
</style>
</head>
<body>
<div class="header">
<div class="user-switch">
<button id="btn-jermaine" class="active" onclick="if(window.app)app.switchUser('jermaine')">JER</button>
<button id="btn-sophia" onclick="if(window.app)app.switchUser('sophia')">SOPH</button>
</div>
<div class="date-nav">
<button class="nav-btn" onclick="if(window.app)app.changeDate(-1)">‚óÄ</button>
<span id="dateLabel">LOADING...</span>
<button class="nav-btn" onclick="if(window.app)app.changeDate(1)">‚ñ∂</button>
</div>
</div>
<div id="alertBanner" class="alert"></div>
<div class="hero">
<div class="dual-score">
<div class="score-box small">
<div class="score-val" id="dayScore">--</div>
<div class="score-label">TODAY</div>
</div>
<div class="score-box primary">
<div class="score-val longevity" id="longevityScore">--</div>
<div class="score-label">LONGEVITY</div>
<div class="score-max">/120</div>
</div>
</div>
<div class="status" id="statusMsg">INITIALIZING...</div>
</div>
<div class="section-header">SLEEP ARCHITECTURE</div>
<div class="sleep-grid">
<div class="sleep-orb">
<div class="orb-container">
<svg class="orb-svg"><circle class="orb-bg" cx="30" cy="30" r="23"></circle><circle class="orb-fg" id="sleepOrb" cx="30" cy="30" r="23" style="stroke:#bf5af2"></circle></svg>
<div class="orb-val-box"><div class="orb-val" id="sleepVal">--</div></div>
</div>
<div class="orb-label">TOTAL</div>
</div>
<div class="sleep-orb">
<div class="orb-container">
<svg class="orb-svg"><circle class="orb-bg" cx="30" cy="30" r="23"></circle><circle class="orb-fg" id="deepOrb" cx="30" cy="30" r="23" style="stroke:#007aff"></circle></svg>
<div class="orb-val-box"><div class="orb-val" id="deepVal">--</div></div>
</div>
<div class="orb-label">DEEP</div>
</div>
<div class="sleep-orb">
<div class="orb-container">
<svg class="orb-svg"><circle class="orb-bg" cx="30" cy="30" r="23"></circle><circle class="orb-fg" id="remOrb" cx="30" cy="30" r="23" style="stroke:#bf5af2"></circle></svg>
<div class="orb-val-box"><div class="orb-val" id="remVal">--</div></div>
</div>
<div class="orb-label">REM</div>
</div>
</div>
<div class="section-header">DAILY PROTOCOL</div>
<div class="timeline" id="timeline"></div>
<div class="footer">
<span class="sync-status" id="syncStatus">INIT</span>
<button class="sync-btn" onclick="if(window.app)app.sync()">üîÑ SYNC</button>
</div>
<button class="debug-btn" onclick="toggleDebug()">üêõ</button>
<div class="debug-console" id="debugConsole"></div>
<script>
const USERS={jermaine:{name:"Jermaine",goals:{water:140,weightTarget:210,heightInches:70},defaultBios:{bmr:'2057',apob:'114',lpa:'178',weight:'217.1',hscrp:'0.4',hba1c:'5.4'}},sophia:{name:"Sophia",goals:{water:100,weightTarget:140,heightInches:64},defaultBios:{bmr:'1450',apob:'70',lpa:'20',weight:'148',hscrp:'0.5',hba1c:'5.2'}}};
const BASE_PROTOCOL=[{id:'sunrise',time:'06:00',title:'Morning Walk',desc:'15min walk + cold shower',macros:{p:0,o:0,cal:0},calBurn:60},{id:'breakfast',time:'07:30',title:'Breakfast üëÜ',desc:'High protein omega-3',macros:{p:54,o:4000,cal:640},clickable:true},{id:'train',time:'09:00',title:'Training üëÜ',desc:'Strength or cardio',macros:{p:0,o:0,cal:0},calBurn:400,clickable:true},{id:'lunch',time:'13:00',title:'Lunch üëÜ',desc:'Balanced protein meal',macros:{p:52,o:3800,cal:680},clickable:true},{id:'dinner',time:'18:30',title:'Dinner üëÜ',desc:'Light evening meal',macros:{p:56,o:3600,cal:720},clickable:true},{id:'evening',time:'21:00',title:'Wind Down',desc:'Chamomile tea + stretch',macros:{p:0,o:0,cal:0},calBurn:0}];
const TOKENS={jermaine:'WLIGFPFJQY73G43BY7CK7H6UJXPQ7N5Y',sophia:'4QSDWYJJUZFHRWRH727NCK7WH4COQJF4'};
const LONGEVITY_MARKERS={apob:{weight:15,optimal:80,threshold:130,direction:'lower'},lpa:{weight:15,optimal:30,threshold:150,direction:'lower'},hscrp:{weight:10,optimal:0.5,threshold:2.0,direction:'lower'},hba1c:{weight:10,optimal:5.4,threshold:6.0,direction:'lower'},bmi:{weight:10,optimal:22,threshold:30,range:[18.5,27],direction:'range'},sleepScore:{weight:10,optimal:85,threshold:60,direction:'higher'},rhr:{weight:10,optimal:50,threshold:75,direction:'lower'}};
class CenturionApp{constructor(){log('üöÄ Init v17.2');this.user=localStorage.getItem('centurion_user')||'jermaine';this.history=[];this.currentIndex=0;this.currentDateStr=new Date().toLocaleDateString('en-CA');this.checked={};this.bios={};this.sleepDebtCritical=false;this.protocol=[];this.loadUserData();this.setPlaceholderData();this.render();this.fetchOuraData()}loadUserData(){log('üì¶ Loading user data');const savedChecked=localStorage.getItem(`c_checked_${this.user}`);this.checked=savedChecked?JSON.parse(savedChecked):{};const savedBios=localStorage.getItem(`c_bios_${this.user}`);this.bios=savedBios?JSON.parse(savedBios):USERS[this.user].defaultBios;log('‚úÖ Loaded '+Object.keys(this.checked).length+' days')}saveUserData(){localStorage.setItem(`c_checked_${this.user}`,JSON.stringify(this.checked));localStorage.setItem(`c_bios_${this.user}`,JSON.stringify(this.bios));log('üíæ Saved')}setPlaceholderData(){this.history=[{date:this.currentDateStr,score:0,totalSec:0,deepSec:0,remSec:0,rhr:'-',cal:0,workouts:[]}];this.currentIndex=0}async fetchOuraData(){log('üîÑ Fetching Oura data');this.setText('syncStatus','SYNCING...');try{const end=new Date();end.setDate(end.getDate()+1);const start=new Date();start.setDate(start.getDate()-10);const startStr=start.toISOString().split('T')[0];const endStr=end.toISOString().split('T')[0];const token=TOKENS[this.user];const url=`https://corsproxy.io/?${encodeURIComponent(`https://api.ouraring.com/v2/usercollection/sleep?start_date=${startStr}&end_date=${endStr}`)}`;const response=await fetch(url,{headers:{'Authorization':`Bearer ${token}`}});if(!response.ok)throw new Error('API failed');const data=await response.json();log('üìä Received '+data.data?.length+' records');this.processSleepData(data.data||[]);this.setText('syncStatus','SYNCED ‚úì');this.render()}catch(error){logerr('‚ùå Sync failed: '+error);this.setText('syncStatus','OFFLINE');this.render()}}processSleepData(sleepData){const sleepMap=new Map();sleepData.forEach(session=>{if(!sleepMap.has(session.day)){sleepMap.set(session.day,{date:session.day,score:session.score||0,totalSec:0,deepSec:0,remSec:0,rhr:session.contributors?.resting_heart_rate||'-',cal:0,workouts:[]})}const day=sleepMap.get(session.day);day.totalSec+=session.total_sleep_duration||0;day.deepSec+=session.deep_sleep_duration||0;day.remSec+=session.rem_sleep_duration||0;if(session.score&&session.score>day.score)day.score=session.score});this.history=Array.from(sleepMap.values()).sort((a,b)=>b.date.localeCompare(a.date));this.currentIndex=this.history.findIndex(h=>h.date===this.currentDateStr);if(this.currentIndex===-1){this.history.unshift({date:this.currentDateStr,score:0,totalSec:0,deepSec:0,remSec:0,rhr:'-',cal:0,workouts:[]});this.currentIndex=0}log('‚úÖ Processed '+this.history.length+' days')}changeDate(direction){const newIndex=this.currentIndex-direction;if(newIndex>=0&&newIndex<this.history.length){this.currentIndex=newIndex;this.currentDateStr=this.history[newIndex].date;log('üìÖ Changed to '+this.currentDateStr);this.render()}}switchUser(newUser){if(newUser===this.user)return;log('üë§ Switching to '+newUser);document.querySelectorAll('.user-switch button').forEach(b=>b.classList.remove('active'));document.getElementById(`btn-${newUser}`).classList.add('active');this.user=newUser;localStorage.setItem('centurion_user',newUser);this.loadUserData();this.setPlaceholderData();this.render();this.fetchOuraData()}toggleTask(taskId){const dateKey=this.history[this.currentIndex].date;if(!this.checked[dateKey])this.checked[dateKey]=[];const index=this.checked[dateKey].indexOf(taskId);if(index===-1){this.checked[dateKey].push(taskId);log('‚úÖ Checked '+taskId)}else{this.checked[dateKey].splice(index,1);log('‚¨ú Unchecked '+taskId)}this.saveUserData();this.render()}calculateLongevityScore(){const day=this.history[this.currentIndex];let totalScore=0;const userData={apob:parseFloat(this.bios.apob)||null,lpa:parseFloat(this.bios.lpa)||null,hscrp:parseFloat(this.bios.hscrp)||null,hba1c:parseFloat(this.bios.hba1c)||null,bmi:this.calculateBMI(),sleepScore:day.score||null,rhr:day.rhr!=='-'?parseInt(day.rhr):null};for(let marker in LONGEVITY_MARKERS){const config=LONGEVITY_MARKERS[marker];const userValue=userData[marker];if(userValue===null||userValue===undefined)continue;let score=0;if(marker==='lpa'&&userValue>config.threshold&&userData.apob&&userData.apob<80){score=config.weight*0.5}else if(config.direction==='lower'){if(userValue<=config.optimal)score=config.weight;else if(userValue>=config.threshold)score=0;else{const range=config.threshold-config.optimal;const diff=userValue-config.optimal;score=config.weight*(1-(diff/range))}}else if(config.direction==='higher'){if(userValue>=config.optimal)score=config.weight;else if(userValue<=config.threshold)score=0;else{const range=config.optimal-config.threshold;const diff=config.optimal-userValue;score=config.weight*(1-(diff/range))}}else if(config.direction==='range'){if(userValue>=config.range[0]&&userValue<=config.range[1])score=config.weight;else score=0}totalScore+=Math.max(0,Math.min(config.weight,score))}return Math.round(totalScore)}calculateBMI(){const weight=parseFloat(this.bios.weight);const heightInches=USERS[this.user].goals.heightInches||70;if(!weight||!heightInches)return null;return(weight/(heightInches*heightInches))*703}render(){log('üîÑ Rendering');this.protocol=JSON.parse(JSON.stringify(BASE_PROTOCOL));const sleepDebt=this.calculateSleepDebt();log('üí§ Sleep debt: '+sleepDebt.toFixed(1)+'h');if(sleepDebt>7){this.sleepDebtCritical=true;const trainTask=this.protocol.find(t=>t.id==='train');if(trainTask){trainTask.title='üõèÔ∏è FORCED REST';trainTask.desc=`Sleep debt: ${sleepDebt.toFixed(1)}h - No training`;trainTask.calBurn=0}}else{this.sleepDebtCritical=false}const supplements=[{id:'fish-oil',time:'07:30',title:'Fish Oil 2g',desc:'Omega-3',macros:{p:0,o:2000,cal:20}},{id:'vitamin-d',time:'07:30',title:'Vitamin D3',desc:'5000 IU',macros:{p:0,o:0,cal:0}},{id:'magnesium',time:'21:00',title:'Magnesium',desc:'400mg',macros:{p:0,o:0,cal:0}}];supplements.forEach(supp=>{if(!this.protocol.find(t=>t.id===supp.id)){this.protocol.push(supp)}});this.protocol.sort((a,b)=>a.time.localeCompare(b.time));this.renderScores();this.renderSleepMetrics();this.renderStatus();this.renderTimeline();log('‚úÖ Render complete')}calculateSleepDebt(){const today=new Date().toLocaleDateString('en-CA');const last7=this.history.filter(day=>day.date!==today&&day.totalSec>0).slice(0,7);if(last7.length===0)return 0;let totalDebt=0;last7.forEach(day=>{const actual=day.totalSec/3600;const deficit=8-actual;if(deficit>0)totalDebt+=deficit});return totalDebt}renderScores(){const day=this.history[this.currentIndex];const sleepHours=(day.totalSec||0)/3600;const dayScore=Math.min(100,Math.round(sleepHours/8*100));this.setText('dayScore',dayScore);this.setText('dateLabel',day.date);const scoreEl=document.getElementById('dayScore');if(scoreEl){scoreEl.style.color=dayScore>=80?'#ccff00':dayScore>=60?'#FFD60A':'#ff453a'}const longevityScore=this.calculateLongevityScore();this.setText('longevityScore',longevityScore);const primaryBox=document.querySelector('.score-box.primary');if(primaryBox){const color=longevityScore>=100?'#00ff00':longevityScore>=80?'#ccff00':longevityScore>=60?'#00f0ff':'#ff453a';primaryBox.style.borderColor=color}log('üéØ Day: '+dayScore+' | Longevity: '+longevityScore+'/120')}renderSleepMetrics(){const day=this.history[this.currentIndex];const totalHours=Math.floor(day.totalSec/3600);const totalMins=Math.round((day.totalSec%3600)/60);const deepMins=Math.round((day.deepSec||0)/60);const remMins=Math.round((day.remSec||0)/60);this.setText('sleepVal',totalHours+'h'+totalMins+'m');this.setText('deepVal',deepMins+'m');this.setText('remVal',remMins+'m');const updateOrb=(id,val,goal)=>{const el=document.getElementById(id);if(el){const offset=145-(Math.min(val/goal,1)*145);el.style.strokeDashoffset=offset}};updateOrb('sleepOrb',day.totalSec/3600,9);updateOrb('deepOrb',(day.deepSec||0)/3600,2);updateOrb('remOrb',(day.remSec||0)/3600,2)}renderStatus(){const day=this.history[this.currentIndex];const sleepHours=(day.totalSec||0)/3600;let status='';if(this.sleepDebtCritical){status='‚ö†Ô∏è SLEEP DEBT CRITICAL - Recovery Mode'}else if(sleepHours>=7.5){status='‚úÖ OPTIMAL - Ready for training'}else if(sleepHours>=6){status='‚ö†Ô∏è MODERATE - Light training only'}else if(sleepHours>0){status='üõèÔ∏è POOR SLEEP - Rest day'}else{status='üìä Waiting for data...'}this.setText('statusMsg',status);const banner=document.getElementById('alertBanner');if(this.sleepDebtCritical){banner.className='alert show';banner.innerText='‚ö†Ô∏è SLEEP DEBT OVER 7 HOURS - FORCED RECOVERY'}else{banner.className='alert'}}renderTimeline(){const dateKey=this.history[this.currentIndex].date;const checked=this.checked[dateKey]||[];let html='';this.protocol.forEach(task=>{const isChecked=checked.includes(task.id);html+=`<div class="task"><div class="task-time">${task.time}</div><div class="task-card ${isChecked?'checked':''}"><div class="task-title">${task.title}</div><div class="task-desc">${task.desc}</div><div class="check-btn" onclick="app.toggleTask('${task.id}')"><div class="check-circle">${isChecked?'‚úì':''}</div></div></div></div>`});document.getElementById('timeline').innerHTML=html;log('üìã Rendered '+this.protocol.length+' tasks')}setText(id,text){const el=document.getElementById(id);if(el)el.innerText=text}sync(){this.fetchOuraData()}}
const debugLogs=[];function log(msg){console.log(msg);debugLogs.push({t:new Date().toLocaleTimeString(),type:'LOG',msg:msg,color:'#0f0'});if(debugLogs.length>50)debugLogs.shift();renderDebug()}function logerr(msg){console.error(msg);debugLogs.push({t:new Date().toLocaleTimeString(),type:'ERROR',msg:msg,color:'#ff453a'});if(debugLogs.length>50)debugLogs.shift();renderDebug()}function renderDebug(){const el=document.getElementById('debugConsole');if(!el)return;el.innerHTML=debugLogs.map(l=>`<div style="color:${l.color};margin-bottom:4px"><span style="color:#666">[${l.t}]</span> <span style="color:#00f0ff">${l.type}</span>: ${l.msg}</div>`).join('');el.scrollTop=el.scrollHeight}function toggleDebug(){const el=document.getElementById('debugConsole');el.style.display=el.style.display==='none'?'block':'none'}
let app;if(document.readyState==='loading'){document.addEventListener('DOMContentLoaded',initApp)}else{initApp()}function initApp(){log('‚ö° DOM Ready');try{app=new CenturionApp();window.app=app;log('üéâ App initialized')}catch(error){logerr('üí• INIT ERROR: '+error)}}window.addEventListener('error',e=>logerr('üí• ERROR: '+e.error?.message));log('‚úÖ Script loaded');
</script>
</body>
</html>