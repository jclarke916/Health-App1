<!DOCTYPE html>

<html lang="en">
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width,initial-scale=1.0,maximum-scale=1.0,user-scalable=no">
<title>Centurion v17.66 OPTIMIZED</title>
<style>
:root{--bg:#050505;--panel:#121212;--border:#222;--acid:#ccff00;--cyan:#00f0ff;--purple:#bf5af2;--alert:#ff453a;--text:#fff}
*{box-sizing:border-box;margin:0;padding:0}
body{background:var(--bg);color:var(--text);font-family:-apple-system,BlinkMacSystemFont,"Segoe UI",Roboto,sans-serif;padding-bottom:120px;-webkit-tap-highlight-color:transparent}
.header{background:rgba(10,10,10,0.95);padding:15px;border-bottom:1px solid #333;position:sticky;top:0;z-index:100;backdrop-filter:blur(10px)}
.user-switch{display:flex;gap:8px;background:#1a1a1a;padding:4px;border-radius:24px;margin-bottom:10px;border:1px solid #333}
.user-switch button{flex:1;padding:10px;border:none;background:transparent;color:#666;border-radius:20px;cursor:pointer;font-weight:800;font-size:0.75rem;transition:all 0.3s;letter-spacing:1px}
.user-switch button.active{background:var(--acid);color:#000;box-shadow:0 0 15px rgba(204,255,0,0.4)}
.date-nav{display:flex;justify-content:space-between;align-items:center;margin-top:10px;background:#000;border:1px solid #333;border-radius:10px;padding:6px}
.nav-btn{background:transparent;border:none;color:var(--cyan);padding:5px 20px;font-size:1.2rem;cursor:pointer;text-shadow:0 0 8px rgba(0,240,255,0.6)}
#dateLabel{flex:1;text-align:center;color:#fff;font-weight:700;font-size:0.9rem;font-family:monospace;letter-spacing:1px}
.bio-btn{position:absolute;right:15px;top:15px;background:rgba(255,255,255,0.05);color:var(--acid);border:1px solid var(--acid);padding:6px 12px;border-radius:6px;font-size:0.6rem;font-weight:900;cursor:pointer;box-shadow:0 0 5px rgba(204,255,0,0.2)}
.hero{padding:25px 15px;display:flex;gap:15px;align-items:center}
.dual-score{display:flex;gap:15px;align-items:center}
.score-box{border:2px solid #333;border-radius:50%;display:flex;flex-direction:column;align-items:center;justify-content:center;position:relative;background:#000}
.score-box.small{width:70px;height:70px}
.score-box.primary{width:90px;height:90px;border-width:3px;background:radial-gradient(circle,rgba(204,255,0,0.08) 0%,transparent 70%);border-color:var(--acid);box-shadow:0 0 25px rgba(204,255,0,0.2)}
.score-val{font-size:1.4rem;font-weight:900;line-height:1;color:#fff}
.score-val.longevity{font-size:2.2rem;background:linear-gradient(135deg,var(--acid) 0%,var(--cyan) 100%);-webkit-background-clip:text;-webkit-text-fill-color:transparent;filter:drop-shadow(0 0 8px rgba(204,255,0,0.6))}
.score-label{font-size:0.45rem;color:#666;text-transform:uppercase;margin-top:4px;font-weight:800;letter-spacing:1px}
.score-avg-badge{position:absolute;bottom:-12px;background:#111;border:1px solid #333;padding:2px 6px;border-radius:8px;font-size:0.4rem;color:var(--cyan);font-weight:900;letter-spacing:0.5px}
.section-header{padding:15px;font-size:0.65rem;font-weight:900;color:#888;letter-spacing:1.5px;text-transform:uppercase;margin-top:10px;display:flex;align-items:center;gap:10px}
.section-header::after{content:'';height:1px;background:#333;flex:1}
.grid-3{display:grid;grid-template-columns:1fr 1fr 1fr;gap:10px;padding:0 15px;margin-bottom:20px}
.grid-4{display:grid;grid-template-columns:1fr 1fr 1fr 1fr;gap:8px;padding:0 15px;margin-bottom:20px}
.orb-card{background:linear-gradient(145deg,#111 0%,#080808 100%);border:1px solid #222;border-radius:14px;padding:15px 5px;display:flex;flex-direction:column;align-items:center;transition:transform 0.1s}
.orb-card:active{transform:scale(0.96)}
.orb-container{width:55px;height:55px;position:relative;margin-bottom:8px;margin-left:auto;margin-right:auto}
.orb-svg{transform:rotate(-90deg);width:100%;height:100%;position:absolute;top:0;left:0;z-index:1}
.orb-bg{fill:none;stroke:#1a1a1a;stroke-width:5}
.orb-fg{fill:none;stroke-width:5;stroke-dasharray:145;stroke-dashoffset:145;transition:stroke-dashoffset 1s cubic-bezier(0.4,0,0.2,1);stroke-linecap:round;filter:drop-shadow(0 0 4px currentColor)}
.orb-val-box{position:absolute;top:50%;left:50%;transform:translate(-50%,-50%);width:100%;text-align:center;z-index:10;pointer-events:none}
.orb-val{font-family:'Courier New',monospace;font-size:0.7rem;font-weight:900;color:#fff;text-shadow:0 0 4px #000;letter-spacing:-0.5px;line-height:1;margin-top:2px}
.orb-label{font-size:0.45rem;font-weight:800;color:#666;text-transform:uppercase;letter-spacing:0.5px}
.heart-svg{width:100%;height:100%;overflow:visible;z-index:1;position:absolute;top:0;left:0}
.heart-bg{fill:none;stroke:#1a1a1a;stroke-width:2.5}
.heart-fg{fill:none;stroke-width:2.5;stroke-dasharray:100;stroke-dashoffset:100;transition:stroke-dashoffset 1s ease;filter:drop-shadow(0 0 3px currentColor)}
.beating{animation:heartbeat 1.5s infinite;transform-origin:center}
@keyframes heartbeat{0%{transform:scale(1)}15%{transform:scale(1.1)}30%{transform:scale(1)}45%{transform:scale(1.1)}60%{transform:scale(1)}}
.rainbow-container{padding:0 15px;margin-bottom:20px}
.rainbow-header{display:flex;justify-content:space-between;align-items:center;margin-bottom:10px}
.rainbow-title{font-size:0.65rem;font-weight:900;color:#ccc;letter-spacing:1px}
.rainbow-score{font-size:0.9rem;font-weight:900;color:var(--acid);font-family:monospace;text-shadow:0 0 10px rgba(204,255,0,0.3)}
.rainbow-track{height:10px;background:#111;border-radius:5px;display:flex;overflow:hidden;border:1px solid #333}
.rainbow-seg{height:100%;width:0%;transition:width 0.5s ease;box-shadow:inset 0 0 5px rgba(0,0,0,0.5)}
.timeline{padding:0 15px;margin-bottom:40px}
.task{display:flex;gap:12px;margin-bottom:15px;min-height:60px}
.task-time{width:45px;color:#666;font-size:0.7rem;padding-top:15px;text-align:right;font-family:monospace;font-weight:bold}
.task-card{flex:1;background:linear-gradient(180deg,#111 0%,#0d0d0d 100%);border:1px solid #333;border-radius:12px;padding:15px;position:relative;transition:all 0.2s;display:flex;justify-content:space-between;align-items:center}
.task-card:active{transform:scale(0.98);background:#1a1a1a}
.task-card.checked{border-color:var(--acid);background:rgba(204,255,0,0.03);box-shadow:0 0 15px rgba(204,255,0,0.05)}
.task-card.auto-detected{border-color:var(--cyan);background:rgba(0,240,255,0.03)}
.task-card.recovery{border-color:var(--purple);background:rgba(191,90,242,0.03)}
.task-card.facial{border-color:var(--cyan);background:rgba(0,240,255,0.05)}
.task-info{flex:1}
.task-title{font-weight:900;font-size:0.85rem;margin-bottom:5px;color:#fff}
.task-desc{font-size:0.7rem;color:#888;line-height:1.4}
.chevron{font-size:1.5rem;color:#333;margin-left:15px;font-weight:900;transition:color 0.2s}
.task-card:active .chevron{color:var(--acid)}
.check-btn{width:40px;height:40px;display:flex;align-items:center;justify-content:center;cursor:pointer;margin-left:5px}
.check-circle{width:26px;height:26px;border:2px solid #555;border-radius:50%;background:rgba(0,0,0,0.5);display:flex;align-items:center;justify-content:center;font-weight:900;font-size:1rem;color:transparent;transition:all 0.2s}
.task-card.checked .check-circle{background:var(--acid);border-color:var(--acid);color:#000;box-shadow:0 0 10px var(--acid)}
.modal-overlay{position:fixed;top:0;left:0;width:100%;height:100%;background:rgba(0,0,0,0.95);z-index:500;display:none;overflow-y:auto;backdrop-filter:blur(8px)}
.modal-overlay.show{display:block}
.modal-content{width:100%;min-height:100vh;background:#050505;padding-bottom:150px}
.modal-header{padding:20px;border-bottom:1px solid #222;display:flex;justify-content:space-between;align-items:center;position:sticky;top:0;background:rgba(5,5,5,0.95);z-index:10}
.modal-title{font-size:1rem;font-weight:900;color:var(--acid);text-transform:uppercase;letter-spacing:1px;max-width:85%}
.modal-close{background:transparent;border:none;color:#fff;font-size:2rem;cursor:pointer;line-height:1}
.modal-body{padding:20px 20px 180px 20px}
.menu-item{padding:20px;border-bottom:1px solid #222;cursor:pointer;display:flex;justify-content:space-between;align-items:center;transition:background 0.2s;background:linear-gradient(90deg,#111 0%,#0d0d0d 100%);margin-bottom:1px}
.menu-item:active{background:#1a1a1a}
.menu-left{flex:1}
.menu-name{font-size:1rem;font-weight:800;color:#fff;margin-bottom:6px;letter-spacing:0.5px}
.menu-meta{font-size:0.7rem;color:#888;font-family:monospace}
.menu-arrow{color:#333;font-size:1.5rem;font-weight:900;margin-left:10px}
.footer{position:fixed;bottom:0;left:0;width:100%;background:#000;padding:12px 15px;border-top:1px solid #333;display:flex;justify-content:space-between;align-items:center;z-index:90}
.sync-status{font-size:0.6rem;color:#666;font-family:monospace}
.sync-btn{background:var(--acid);color:#000;border:none;padding:8px 16px;border-radius:6px;cursor:pointer;font-weight:900;font-size:0.7rem}

.debug-console{position:fixed;bottom:60px;left:0;right:0;max-height:300px;background:rgba(0,0,0,0.98);border-top:2px solid var(‚Äìacid);z-index:199;overflow-y:auto;padding:10px;font-size:0.65rem;color:#0f0;font-family:monospace;display:none}
.debug-console.show{display:block}
.debug-btn{position:fixed;bottom:70px;right:10px;z-index:200;background:var(‚Äìacid);color:#000;border:none;padding:8px 12px;border-radius:6px;font-weight:900;cursor:pointer;font-size:0.7rem}
.debug-log{margin-bottom:4px;border-bottom:1px solid #222;padding-bottom:4px}
.debug-time{color:#666;margin-right:8px}
.debug-type{color:var(‚Äìcyan);margin-right:8px;font-weight:900}
</style>

</head>
<body>

<div class="header">
    <div class="user-switch">
        <button id="btn-jermaine" class="active" onclick="if(window.app)app.switchUser('jermaine')">JERMAINE</button>
        <button id="btn-sophia" onclick="if(window.app)app.switchUser('sophia')">SOPHIA</button>
    </div>
    <div class="date-nav">
        <button class="nav-btn" onclick="if(window.app)app.changeDate(-1)">‚óÄ</button>
        <span id="dateLabel">LOADING...</span>
        <button class="nav-btn" onclick="if(window.app)app.changeDate(1)">‚ñ∂</button>
    </div>
    <button class="bio-btn" onclick="if(window.app)app.openBio()">BIO</button>
</div>

<div class="hero">
    <div class="dual-score">
        <div class="score-box small">
            <div class="score-val" id="dayGrade">--</div>
            <div class="score-label">TODAY</div>
        </div>
        <div class="score-box primary">
            <div class="score-val longevity" id="longevityScore">85</div>
            <div class="score-label">LONGEVITY</div>
            <div class="score-avg-badge">7-DAY AVG</div>
        </div>
    </div>
    <div class="status" id="statusMsg">INITIALIZING...</div>
</div>

<div class="section-header">SLEEP ARCHITECTURE</div>
<div class="grid-3">
    <div class="orb-card"><div class="orb-container"><svg class="orb-svg" viewBox="0 0 50 50"><circle class="orb-bg" cx="25" cy="25" r="21"></circle><circle class="orb-fg" id="sleepOrb" cx="25" cy="25" r="21" style="stroke:#bf5af2"></circle></svg><div class="orb-val-box"><div class="orb-val" id="sleepVal">--</div></div></div><div class="orb-label" style="color:#bf5af2">TOTAL</div></div>
    <div class="orb-card"><div class="orb-container"><svg class="orb-svg" viewBox="0 0 50 50"><circle class="orb-bg" cx="25" cy="25" r="21"></circle><circle class="orb-fg" id="deepOrb" cx="25" cy="25" r="21" style="stroke:#007aff"></circle></svg><div class="orb-val-box"><div class="orb-val" id="deepVal">--</div></div></div><div class="orb-label" style="color:#007aff">DEEP</div></div>
    <div class="orb-card"><div class="orb-container"><svg class="orb-svg" viewBox="0 0 50 50"><circle class="orb-bg" cx="25" cy="25" r="21"></circle><circle class="orb-fg" id="remOrb" cx="25" cy="25" r="21" style="stroke:#bf5af2"></circle></svg><div class="orb-val-box"><div class="orb-val" id="remVal">--</div></div></div><div class="orb-label" style="color:#bf5af2">REM</div></div>
</div>

<div class="section-header">FUEL (NUTRITION)</div>
<div class="grid-4">
    <div class="orb-card"><div class="orb-container"><svg class="orb-svg" viewBox="0 0 50 50"><circle class="orb-bg" cx="25" cy="25" r="21"></circle><circle class="orb-fg" id="proteinOrb" cx="25" cy="25" r="21" style="stroke:#fff"></circle></svg><div class="orb-val-box"><div class="orb-val" id="proteinVal">0</div></div></div><div class="orb-label" style="color:#fff">PROTEIN</div></div>
    <div class="orb-card"><div class="orb-container"><svg class="orb-svg" viewBox="0 0 50 50"><circle class="orb-bg" cx="25" cy="25" r="21"></circle><circle class="orb-fg" id="omega3Orb" cx="25" cy="25" r="21" style="stroke:#00d4ff"></circle></svg><div class="orb-val-box"><div class="orb-val" id="omega3Val">0</div></div></div><div class="orb-label" style="color:#00d4ff">OMEGA-3</div></div>
    <div class="orb-card"><div class="orb-container"><svg class="orb-svg" viewBox="0 0 50 50"><circle class="orb-bg" cx="25" cy="25" r="21"></circle><circle class="orb-fg" id="fiberOrb" cx="25" cy="25" r="21" style="stroke:#30d158"></circle></svg><div class="orb-val-box"><div class="orb-val" id="fiberVal">0</div></div></div><div class="orb-label" style="color:#30d158">FIBER</div></div>
    <div class="orb-card"><div class="orb-container"><svg class="orb-svg" viewBox="0 0 50 50"><circle class="orb-bg" cx="25" cy="25" r="21"></circle><circle class="orb-fg" id="calorieOrb" cx="25" cy="25" r="21" style="stroke:#FFD60A"></circle></svg><div class="orb-val-box"><div class="orb-val" id="calorieVal">0</div></div></div><div class="orb-label" style="color:#FFD60A">CALORIES</div></div>
</div>

<div class="section-header">ENGINE (CARDIO)</div>
<div class="grid-4">
    <div class="orb-card">
        <div class="orb-container"><svg class="heart-svg beating" viewBox="0 0 24 24"><path class="heart-bg" d="M12 21.35l-1.45-1.32C5.4 15.36 2 12.28 2 8.5 2 5.42 4.42 3 7.5 3c1.74 0 3.41.81 4.5 2.09C13.09 3.81 14.76 3 16.5 3 19.58 3 22 5.42 22 8.5c0 3.78-3.4 6.86-8.55 11.54L12 21.35z"></path><path class="heart-fg" d="M12 21.35l-1.45-1.32C5.4 15.36 2 12.28 2 8.5 2 5.42 4.42 3 7.5 3c1.74 0 3.41.81 4.5 2.09C13.09 3.81 14.76 3 16.5 3 19.58 3 22 5.42 22 8.5c0 3.78-3.4 6.86-8.55 11.54L12 21.35z" style="fill:none;stroke:#ff453a;stroke-width:2.5;"></path></svg><div class="orb-val-box"><div class="orb-val" id="rhrVal">--</div></div></div>
        <div class="orb-label" style="color:#ff453a">RHR</div>
    </div>
    <div class="orb-card">
        <div class="orb-container"><svg class="heart-svg" viewBox="0 0 24 24"><path class="heart-bg" d="M12 21.35l-1.45-1.32C5.4 15.36 2 12.28 2 8.5 2 5.42 4.42 3 7.5 3c1.74 0 3.41.81 4.5 2.09C13.09 3.81 14.76 3 16.5 3 19.58 3 22 5.42 22 8.5c0 3.78-3.4 6.86-8.55 11.54L12 21.35z"></path><path class="heart-fg" id="z2Heart" pathLength="100" d="M12 21.35l-1.45-1.32C5.4 15.36 2 12.28 2 8.5 2 5.42 4.42 3 7.5 3c1.74 0 3.41.81 4.5 2.09C13.09 3.81 14.76 3 16.5 3 19.58 3 22 5.42 22 8.5c0 3.78-3.4 6.86-8.55 11.54L12 21.35z" style="stroke:#00f0ff"></path></svg><div class="orb-val-box"><div class="orb-val" id="z2Val">0</div></div></div>
        <div class="orb-label" style="color:#00f0ff">ZONE 2</div>
    </div>
    <div class="orb-card">
        <div class="orb-container"><svg class="heart-svg" viewBox="0 0 24 24"><path class="heart-bg" d="M12 21.35l-1.45-1.32C5.4 15.36 2 12.28 2 8.5 2 5.42 4.42 3 7.5 3c1.74 0 3.41.81 4.5 2.09C13.09 3.81 14.76 3 16.5 3 19.58 3 22 5.42 22 8.5c0 3.78-3.4 6.86-8.55 11.54L12 21.35z"></path><path class="heart-fg" id="z5Heart" pathLength="100" d="M12 21.35l-1.45-1.32C5.4 15.36 2 12.28 2 8.5 2 5.42 4.42 3 7.5 3c1.74 0 3.41.81 4.5 2.09C13.09 3.81 14.76 3 16.5 3 19.58 3 22 5.42 22 8.5c0 3.78-3.4 6.86-8.55 11.54L12 21.35z" style="stroke:#ff453a"></path></svg><div class="orb-val-box"><div class="orb-val" id="z5Val">0</div></div></div>
        <div class="orb-label" style="color:#ff453a">ZONE 5</div>
    </div>
    <div class="orb-card">
        <div class="orb-container"><svg class="heart-svg" viewBox="0 0 24 24"><path class="heart-bg" d="M12 21.35l-1.45-1.32C5.4 15.36 2 12.28 2 8.5 2 5.42 4.42 3 7.5 3c1.74 0 3.41.81 4.5 2.09C13.09 3.81 14.76 3 16.5 3 19.58 3 22 5.42 22 8.5c0 3.78-3.4 6.86-8.55 11.54L12 21.35z"></path><path class="heart-fg" id="calHeart" pathLength="100" d="M12 21.35l-1.45-1.32C5.4 15.36 2 12.28 2 8.5 2 5.42 4.42 3 7.5 3c1.74 0 3.41.81 4.5 2.09C13.09 3.81 14.76 3 16.5 3 19.58 3 22 5.42 22 8.5c0 3.78-3.4 6.86-8.55 11.54L12 21.35z" style="stroke:#FFD60A"></path></svg><div class="orb-val-box"><div class="orb-val" id="calVal">0</div></div></div>
        <div class="orb-label" style="color:#FFD60A">BURN</div>
    </div>
</div>

<div class="section-header">PHYTONUTRIENT DIVERSITY üåà</div>
<div class="rainbow-container">
    <div class="rainbow-header"><div class="rainbow-title">RAINBOW SCORE</div><div class="rainbow-score" id="rainbowScore">0%</div></div>
    <div class="rainbow-track" id="rainbowTrack"></div>
</div>

<div class="section-header">SYNERGY PROTOCOL üîÑ AUTO-DETECT</div>
<div class="timeline" id="timeline"></div>

<div class="modal-overlay" id="mainModal">
    <div class="modal-content">
        <div class="modal-header">
            <div class="modal-title" id="modalTitle">TITLE</div>
            <button class="modal-close" onclick="app.closeModal()">√ó</button>
        </div>
        <div class="modal-body" id="modalBody"></div>
    </div>
</div>

<div class="footer">
    <span class="sync-status" id="syncStatus">INIT</span>
    <button class="sync-btn" onclick="if(window.app)app.sync()">üîÑ SYNC</button>
</div>

<button class="debug-btn" onclick="toggleDebug()">üêõ DEBUG</button>

<div class="debug-console" id="debugConsole"></div>

<script>
const debugLogs=[];
function log(msg,type='LOG'){
const t=new Date().toLocaleTimeString();
debugLogs.push({t:t,type:type,msg:msg});
if(debugLogs.length>50)debugLogs.shift();
console.log(msg);
renderDebug();
}
function logerr(msg){log(msg,'ERROR')}
function renderDebug(){
const el=document.getElementById('debugConsole');
if(!el)return;
let html='';
debugLogs.forEach(l=>{
const color=l.type==='ERROR'?'#ff453a':'#0f0';
html+=`<div class="debug-log"><span class="debug-time">[${l.t}]</span><span class="debug-type" style="color:${color}">${l.type}</span><span style="color:#ccc">${l.msg}</span></div>`;
});
el.innerHTML=html;
el.scrollTop=el.scrollHeight;
}
function toggleDebug(){
const el=document.getElementById('debugConsole');
if(el.classList.contains('show')){el.classList.remove('show')}else{el.classList.add('show')}
}

const USERS={jermaine:{name:"Jermaine",goals:{protein:175,omega3:4000,fiber:50,heightInches:76.5},defaultBios:{bmr:'2028',weight:'215.7'}},sophia:{name:"Sophia",goals:{protein:130,omega3:4000,fiber:35,heightInches:64},defaultBios:{bmr:'1450',weight:'148'}}};
const MEALS={breakfast:[{title:"Omega Breakfast",macros:{p:58,o:3500,f:12,cal:680},colors:['orange','purple','green']}],lunch:[{title:"Salmon Bowl",macros:{p:48,o:3000,f:14,cal:780},colors:['orange','brown','green']}],dinner:[{title:"Grass-Fed Steak",macros:{p:60,o:1200,f:14,cal:720},colors:['red','green','orange']}]};
const BASE=[{id:'breakfast',time:'07:30',title:'Breakfast',desc:'Tap to select',macros:{p:0,o:0,f:0,cal:0},colors:[],clickable:true,mealSlot:'breakfast'},{id:'lunch',time:'13:00',title:'Lunch',desc:'Tap to select',macros:{p:0,o:0,f:0,cal:0},colors:[],clickable:true,mealSlot:'lunch'},{id:'dinner',time:'18:30',title:'Dinner',desc:'Tap to select',macros:{p:0,o:0,f:0,cal:0},colors:[],clickable:true,mealSlot:'dinner'}];
const TOKENS={jermaine:'WLIGFPFJQY73G43BY7CK7H6UJXPQ7N5Y',sophia:'4QSDWYJJUZFHRWRH727NCK7WH4COQJF4'};
const COLORS={red:{hex:'#ff453a'},orange:{hex:'#ff9f0a'},yellow:{hex:'#ffd60a'},green:{hex:'#30d158'},purple:{hex:'#bf5af2'},white:{hex:'#fff'},brown:{hex:'#A0522D'}};
const PROTOCOLS={
microcurrent:{title:"‚ö° MICROCURRENT",steps:["1. CLEANSE: Oil-free","2. GEL: Thick layer","3. FOREHEAD: Upward 3min","4. CHEEKS: Nose to ear 4min each","5. JAWLINE: Jaw to ear 3min","6. NECK: Upward only 2min","7. SLOW movements"]},
microneedling:{title:"üìç MICRONEEDLING",steps:["1. SANITIZE device","2. CLEANSE 2x","3. SERUM: Apply HA","4. NEEDLE: Cross-hatch","5. WAIT 10min","6. NO actives 24hrs","7. SPF mandatory next day"]},
massage:{title:"üíÜ MASSAGE",steps:["1. OIL: Apply facial oil","2. JAW: Chin to ear","3. CHEEKS: Lift to temples","4. EYES: Gentle circles","5. FOREHEAD: Horizontal","6. DRAIN: Down to collarbone"]},
cupping:{title:"üîµ CUPPING",steps:["1. OIL back","2. STATIC 3-5min on knots","3. SLIDING along spine","4. AVOID direct spine","5. MARKS = stagnation","6. HEAT: Hyperice 15min after"]},
normatec:{title:"ü¶µ NORMATEC",steps:["1. SETUP Legs/Hips","2. LEVEL 7 flush","3. TIME 30-45min","4. ZONE boost if sore","5. HYDRATE 16oz after","6. Can do 2x daily"]},
inshape:{title:"üèä INSHAPE",steps:["1. STEAM 15min","2. SAUNA 20min","3. POOL 20min light","4. AQUA BED 30min","5. SHOWER cold finish","6. NORMATEC 45min home"]},
clubstudio:{title:"üè¢ CLUB STUDIO",steps:["OPTION A: Full Recovery (45min)","1. CRYO Chamber 3min (full body cold)","2. WAIT 5min (let body warm)","3. SAUNA 20min (contrast therapy)","4. LOCAL CRYO areas as needed","5. MASSAGE BED 20min","6. HYPERICE suite if available","","OPTION B: Quick Session (20min)","1. CRYO 3min OR Sauna 20min","2. MASSAGE BED 15min","","OPTION C: Home Instead","Use Theragun + Normatec + Hyperice"]}
};

class CenturionApp{
constructor(){
console.log('üöÄ v17.66 OPTIMIZED');
const V='17.66.0';
if(localStorage.getItem('centurion_version')!==V){localStorage.clear();localStorage.setItem('centurion_version',V)}
this.user=localStorage.getItem('centurion_user')||'jermaine';
this.history=[];this.currentIndex=0;this.currentDateStr=new Date().toLocaleDateString('en-CA');
this.checked={};this.meals={};this.bios={};this.protocol=[];
this.loadUserData();this.setPlaceholderData();this.render();this.fetchOuraData();}

loadUserData(){
try{
const c=localStorage.getItem(`c_checked_${this.user}`);this.checked=c?JSON.parse(c):{};
const m=localStorage.getItem(`c_meals_${this.user}`);this.meals=m?JSON.parse(m):{};
const b=localStorage.getItem(`c_bios_${this.user}`);this.bios=b?JSON.parse(b):USERS[this.user].defaultBios;
}catch(e){this.checked={};this.meals={}}}

saveUserData(){
localStorage.setItem(`c_checked_${this.user}`,JSON.stringify(this.checked));
localStorage.setItem(`c_meals_${this.user}`,JSON.stringify(this.meals));
localStorage.setItem(`c_bios_${this.user}`,JSON.stringify(this.bios))}

setPlaceholderData(){this.history=[{date:this.currentDateStr,score:0,totalSec:0,deepSec:0,remSec:0,rhr:'-',cal:0,high:0,med:0,workouts:[]}];this.currentIndex=0}

getLunchRecovery(d){
if(this.user==='jermaine'&&(d===1||d===3||d===5))return{title:'üßò Hip Flexor',desc:'5min stretch'};
if(this.user==='jermaine'&&(d===2||d===4))return{title:'ü¶æ Shoulder',desc:'5min mobility'};
return null}

getEveningRecovery(d,w,t){
if(this.user==='jermaine'){
if(d===0)return{time:'14:00',title:'üèä InShape',desc:'Full ritual',type:'inshape'};
if((d===2||d===4)&&w)return{time:'19:30',title:'ü•ä Post-Boxing',desc:'Club Studio: Cryo 3min + Sauna 20min OR Home: Theragun + Normatec',type:'clubstudio'};
if(d===2||d===4)return{time:'18:30',title:'üîµ Cupping',desc:'Both 15min each + Hyperice after',type:'cupping'};
if(d===1&&w)return{time:'19:00',title:'üí™ Post-Lift',desc:'Club Studio: Cryo + Sauna OR Home: Full stack',type:'clubstudio'};
if(d===3)return{time:'18:30',title:'üßò Mid-Week Recovery',desc:'Club Studio: Sauna 20min + Local Cryo + Massage Bed OR Home: Normatec + Hyperice',type:'clubstudio'};
return{time:'18:30',title:'‚ú® Light Recovery',desc:'Club Studio: Massage bed 20min OR Home: Normatec 30min',type:'clubstudio'}}
if(this.user==='sophia'){
if(d===0)return{time:'14:00',title:'üèä InShape',desc:'Together',type:'inshape'};
if((d===3||d===5)&&w)return{time:'19:00',title:'üèÉ Post-Rebound',desc:'Club Studio: Cryo + Sauna OR Home: Theragun + Normatec',type:'clubstudio'};
if(d===2||d===4)return{time:'18:30',title:'üîµ Cupping',desc:'Both 15min + Hyperice',type:'cupping'};
if(d===1)return{time:'18:30',title:'üí™ Recovery Day',desc:'Club Studio: Massage bed + Sauna OR Home: Normatec',type:'clubstudio'};
return{time:'18:30',title:'‚ú® Light Recovery',desc:'Club Studio or Home - Optional',type:'clubstudio'}}
return null}

getEndOfDayFacial(d,f){
if(this.user==='jermaine'){
if(d===0&&f)return{title:'üìç Sophia Needle',desc:'45min - SPF 24hrs',type:'microneedling'};
if(d===1||d===3||d===5||d===0)return{title:'‚ö° Sophia Micro',desc:'Lift + Tone',type:'microcurrent'};
if(d===2||d===4)return{title:'üíÜ Sophia Massage',desc:'Hand + Wands',type:'massage'};
return{title:'‚ú® Sophia Maint',desc:'Optional',type:'massage'}}
if(this.user==='sophia'){
if(d===1||d===3||d===5||d===0)return{title:'‚ö° Jermaine Micro',desc:'Jawline focus',type:'microcurrent'};
if(d===2||d===4)return{title:'üí™ Jermaine Recovery',desc:'Cold + Jaw massage',type:'massage'};
return{title:'‚ú® Jermaine Maint',desc:'Optional',type:'massage'}}
return null}

showProtocolDetails(t){
const d=PROTOCOLS[t]||{title:"ROUTINE",steps:["Follow standard."]};
let h=`<div style="text-align:center;margin:30px 0"><div style="font-size:1.8rem;font-weight:900;color:#fff;text-shadow:0 0 10px var(--cyan)">${d.title}</div></div><div style="background:#111;border-radius:12px;border:1px solid #333;overflow:hidden">${d.steps.map(s=>`<div style="padding:18px 20px;border-bottom:1px solid #222;font-size:0.95rem;color:#ddd;line-height:1.6">${s}</div>`).join('')}</div>`;
this.setText('modalTitle','PROTOCOL');
document.getElementById('modalBody').innerHTML=h;
document.getElementById('mainModal').classList.add('show')}

async fetchOuraData(){
this.setText('syncStatus','SYNCING...');
try{
const end=new Date();end.setDate(end.getDate()+1);
const start=new Date();start.setDate(start.getDate()-10);
const startStr=start.toISOString().split('T')[0];
const endStr=end.toISOString().split('T')[0];
const token=TOKENS[this.user];
const sleepUrl=`https://corsproxy.io/?${encodeURIComponent(`https://api.ouraring.com/v2/usercollection/sleep?start_date=${startStr}&end_date=${endStr}`)}`;
const workoutUrl=`https://corsproxy.io/?${encodeURIComponent(`https://api.ouraring.com/v2/usercollection/workout?start_date=${startStr}&end_date=${endStr}`)}`;
const activityUrl=`https://corsproxy.io/?${encodeURIComponent(`https://api.ouraring.com/v2/usercollection/daily_activity?start_date=${startStr}&end_date=${endStr}`)}`;
const readinessUrl=`https://corsproxy.io/?${encodeURIComponent(`https://api.ouraring.com/v2/usercollection/daily_readiness?start_date=${startStr}&end_date=${endStr}`)}`;
const[sleepRes,workoutRes,activityRes,readinessRes]=await Promise.all([
fetch(sleepUrl,{headers:{'Authorization':`Bearer ${token}`}}),
fetch(workoutUrl,{headers:{'Authorization':`Bearer ${token}`}}),
fetch(activityUrl,{headers:{'Authorization':`Bearer ${token}`}}),
fetch(readinessUrl,{headers:{'Authorization':`Bearer ${token}`}})]);
if(!sleepRes.ok||!workoutRes.ok)throw new Error('API failed');
const sleepData=await sleepRes.json();
const workoutData=await workoutRes.json();
const activityData=await activityRes.json();
const readinessData=await readinessRes.json();
log('üîç OURA DATA RECEIVED:');
log('Sleep records: '+(sleepData.data?.length || 0));
log('Workout records: '+(workoutData.data?.length || 0));
log('Activity records: '+(activityData.data?.length || 0));
log('Readiness records: '+(readinessData.data?.length || 0));
if(sleepData.data?.length > 0) log('Sample sleep: '+JSON.stringify(sleepData.data[0]));
this.processData(sleepData.data||[],workoutData.data||[],activityData.data||[],readinessData.data||[]);
this.setText('syncStatus','SYNCED ‚úì');
this.render()}
catch(error){
logerr('‚ùå Sync failed: '+error);
this.setText('syncStatus','OFFLINE');
this.render()}}

processData(sleepData,workoutData,activityData,readinessData){
log('üìä PROCESSING DATA:');
log('Sleep entries to process: '+sleepData.length);
log('Workout entries to process: '+workoutData.length);
const m=new Map();
const g=(d)=>{if(!m.has(d))m.set(d,{date:d,score:0,totalSec:0,deepSec:0,remSec:0,rhr:'-',cal:0,high:0,med:0,workouts:[]});return m.get(d)};
sleepData.forEach(s=>{
log(`Sleep for ${s.day}: total=${s.total_sleep_duration}s, deep=${s.deep_sleep_duration}s, rem=${s.rem_sleep_duration}s, score=${s.score}`);
const d=g(s.day);d.totalSec+=s.total_sleep_duration||0;d.deepSec+=s.deep_sleep_duration||0;d.remSec+=s.rem_sleep_duration||0;if(s.score&&s.score>d.score)d.score=s.score});
readinessData.forEach(r=>{const d=g(r.day);if(r.contributors?.resting_heart_rate)d.rhr=r.contributors.resting_heart_rate});
workoutData.forEach(w=>{const d=g(w.day);const dt=new Date(w.start_datetime);const t=dt.toLocaleTimeString('en-US',{hour:'numeric',minute:'2-digit',hour12:false});d.workouts.push({type:w.activity||'other',intensity:w.intensity||'moderate',calories:w.calories||300,time:t,start:w.start_datetime})});
activityData.forEach(a=>{const d=g(a.day);d.cal=a.active_calories||0;d.high=(a.high_activity_time||0)/60;d.med=(a.medium_activity_time||0)/60});
this.history=Array.from(m.values()).sort((a,b)=>b.date.localeCompare(a.date));
log('‚úÖ Processed history: '+this.history.length+' days');
this.currentIndex=this.history.findIndex(h=>h.date===this.currentDateStr);
if(this.currentIndex===-1){this.history.unshift({date:this.currentDateStr,score:0,totalSec:0,deepSec:0,remSec:0,rhr:'-',cal:0,high:0,med:0,workouts:[]});this.currentIndex=0}}

changeDate(dir){
const n=this.currentIndex-dir;
if(n>=0&&n<this.history.length){this.currentIndex=n;this.currentDateStr=this.history[n].date;this.render()}}

switchUser(u){
if(u===this.user)return;
this.setText('statusMsg','SWITCHING...');
document.querySelectorAll('.user-switch button').forEach(b=>b.classList.remove('active'));
document.getElementById(`btn-${u}`).classList.add('active');
this.user=u;localStorage.setItem('centurion_user',u);
this.history=[];this.loadUserData();this.setPlaceholderData();this.render();this.fetchOuraData()}

toggleTask(id){
const dk=this.history[this.currentIndex].date;
if(!this.checked[dk])this.checked[dk]=[];
const i=this.checked[dk].indexOf(id);
if(i===-1)this.checked[dk].push(id);else this.checked[dk].splice(i,1);
this.saveUserData();this.render()}

openBio(){
const mb=document.getElementById('modalBody');
this.setText('modalTitle','BIOMETRICS');
const w=this.bios.weight;const bmr=this.bios.bmr;
const h=USERS[this.user].goals.heightInches||70;
const bmi=w&&h?((w/(h*h))*703).toFixed(1):'--';
mb.innerHTML=`<div style="padding:20px"><div style="background:#111;padding:15px;border-radius:10px;margin-bottom:20px;border:1px solid #333"><div style="color:#888;font-size:0.7rem;margin-bottom:5px">CURRENT WEIGHT</div><div style="font-size:2rem;font-weight:900">${w} lbs</div><div style="color:var(--acid);font-size:0.8rem">BMI: ${bmi} | BMR: ${bmr}</div></div><div style="display:grid;grid-template-columns:1fr 1fr;gap:10px"><div><label style="font-size:0.6rem;color:#666">WEIGHT</label><input id="bio-weight" type="number" value="${w}" style="width:100%;padding:10px;background:#111;border:1px solid #333;color:#fff;border-radius:6px"></div><div><label style="font-size:0.6rem;color:#666">BMR</label><input id="bio-bmr" type="number" value="${bmr}" style="width:100%;padding:10px;background:#111;border:1px solid #333;color:#fff;border-radius:6px"></div></div><button onclick="app.saveBio()" style="width:100%;background:var(--acid);color:#000;padding:15px;margin-top:20px;border:none;border-radius:10px;font-weight:900">SAVE</button></div>`;
document.getElementById('mainModal').classList.add('show')}

saveBio(){
const w=document.getElementById('bio-weight').value;
const b=document.getElementById('bio-bmr').value;
if(w)this.bios.weight=w;
if(b)this.bios.bmr=b;
this.saveUserData();this.closeModal();this.render()}

openMealPicker(slot){
const mb=document.getElementById('modalBody');
this.setText('modalTitle',slot.toUpperCase());
const all=MEALS[slot]||[];
let h='';
all.forEach((m,i)=>{h+=`<div class="menu-item" onclick="app.selectMeal('${slot}',${i})"><div class="menu-left"><div class="menu-name">${m.title}</div><div class="menu-meta">P:${m.macros.p}</div></div><div class="menu-arrow">‚Ä∫</div></div>`});
mb.innerHTML=h;
document.getElementById('mainModal').classList.add('show')}

closeModal(){document.getElementById('mainModal').classList.remove('show')}

selectMeal(slot,idx){
const d=this.history[this.currentIndex].date;
if(!this.meals[d])this.meals[d]={};
this.meals[d][slot]=idx;
this.saveUserData();this.closeModal();this.render()}

calculateMacros(){
const d=this.history[this.currentIndex].date;
const c=this.checked[d]||[];
let t={protein:0,omega3:0,fiber:0,calories:0};
this.protocol.forEach(tk=>{if(c.includes(tk.id)){t.protein+=tk.macros.p||0;t.omega3+=tk.macros.o||0;t.fiber+=tk.macros.f||0;t.calories+=tk.macros.cal||0}});
return t}

calculateRainbow(){
const d=this.history[this.currentIndex].date;
const c=this.checked[d]||[];
let s=new Set();
this.protocol.forEach(t=>{if(c.includes(t.id)&&t.colors)t.colors.forEach(col=>s.add(col))});
return s}

render(){
if(!this.history.length)return;
this.protocol=JSON.parse(JSON.stringify(BASE));
const day=this.history[this.currentIndex];
const date=day.date;
const sel=this.meals[date]||{};
const dow=new Date(date).getDay();
const isFS=new Date(date).getDate()<=7;
const hadW=day.workouts&&day.workouts.length>0;
const wType=hadW?day.workouts[0].type:null;

const lr=this.getLunchRecovery(dow);
if(lr)this.protocol.push({id:'lunch_recovery',time:'11:30',title:lr.title,desc:lr.desc,macros:{p:0,o:0,f:0,cal:0},colors:[],clickable:false});

day.workouts.forEach((w,i)=>{this.protocol.push({id:`workout_${i}`,time:w.time,title:`${w.type.toUpperCase()} Detected`,desc:`${w.calories} cal | ${w.intensity}`,macros:{p:0,o:0,f:0,cal:0},colors:[],clickable:false,autoDetected:true})});

const er=this.getEveningRecovery(dow,hadW,wType);
if(er)this.protocol.push({id:'evening_recovery',time:er.time,title:er.title,desc:er.desc+' - Tap for protocol',macros:{p:0,o:0,f:0,cal:0},colors:[],clickable:true,type:er.type,cssClass:'recovery'});

const fac=this.getEndOfDayFacial(dow,isFS);
if(fac)this.protocol.push({id:'facial',time:'21:00',title:fac.title,desc:fac.desc+' - Tap for protocol',macros:{p:0,o:0,f:0,cal:0},colors:[],clickable:true,type:fac.type,cssClass:'facial'});

this.protocol.forEach(t=>{if(t.mealSlot&&sel[t.mealSlot]!==undefined){const all=MEALS[t.mealSlot]||[];if(all[sel[t.mealSlot]]){const m=all[sel[t.mealSlot]];t.title=m.title;t.desc=`P:${m.macros.p} C:${m.macros.cal}`;t.macros=m.macros;t.colors=m.colors}}});

this.protocol.sort((a,b)=>a.time.localeCompare(b.time));

this.setText('dateLabel',date);
const mac=this.calculateMacros();
const sc=Math.min(100,Math.round(((day.totalSec||0)/3600/8)*100));
this.setText('dayGrade',sc>=85?'A':sc>=70?'B':'C');

const upd=(id,val,max,col)=>{const el=document.getElementById(id);if(el){el.style.strokeDashoffset=145-(Math.min(val/max,1)*145);el.style.stroke=col}const txt=document.getElementById(id.replace('Orb','Val'));if(txt)txt.innerText=Math.round(val)};
upd('sleepOrb',(day.totalSec||0)/3600,8,'#bf5af2');
upd('proteinOrb',mac.protein,USERS[this.user].goals.protein,'#fff');
upd('omega3Orb',mac.omega3,4000,'#00d4ff');
upd('fiberOrb',mac.fiber,50,'#30d158');
upd('calorieOrb',mac.calories,2500,'#FFD60A');

const cols=this.calculateRainbow();
this.setText('rainbowScore',Math.round((cols.size/6)*100)+'%');
let rh='';
['red','orange','yellow','green','purple','white'].forEach(c=>{rh+=`<div class="rainbow-seg" style="background:${cols.has(c)?COLORS[c].hex:'#333'};width:${cols.has(c)?16.6:0}%"></div>`});
document.getElementById('rainbowTrack').innerHTML=rh;

const chk=this.checked[date]||[];
let th='';
this.protocol.forEach(t=>{
const isC=chk.includes(t.id);
let ca='';let cc=`task-card ${isC?'checked':''} ${t.autoDetected?'auto-detected':''} ${t.cssClass||''}`;
if(t.clickable){if(t.type&&(t.type in PROTOCOLS))ca=`onclick="app.showProtocolDetails('${t.type}')"`;else if(t.mealSlot)ca=`onclick="app.openMealPicker('${t.mealSlot}')"`}
th+=`<div class="task"><div class="task-time">${t.time}</div><div class="${cc}" ${ca}><div class="task-info"><div class="task-title">${t.title}</div><div class="task-desc">${t.desc}</div></div>${t.clickable?'<div class="chevron">‚Ä∫</div>':''}${!t.autoDetected&&!t.type?`<div class="check-btn" onclick="event.stopPropagation();app.toggleTask('${t.id}')"><div class="check-circle">${isC?'‚úì':''}</div></div>`:''}</div></div>`});
document.getElementById('timeline').innerHTML=th}

setText(id,txt){const el=document.getElementById(id);if(el)el.innerText=txt}
sync(){this.fetchOuraData()}}

let app;
window.onload=()=>{app=new CenturionApp();window.app=app};
</script>

</body>
</html>