<!DOCTYPE html>
<html lang="en">
<head>
<meta charset="UTF-8" />
<meta name="viewport" content="width=device-width, initial-scale=1.0"/>
<title>v400 Feed</title>

<style>
body {
  margin:0;
  font-family: Inter, system-ui, -apple-system;
  background:#000;
  color:#fff;
}
.feed {
  max-width:420px;
  margin:0 auto;
  padding:12px;
}
.card {
  background:#111;
  border-radius:16px;
  padding:14px;
  margin-bottom:16px;
  cursor:pointer;
}
.card h3 {
  margin:0 0 6px;
  font-size:1rem;
}
.card p {
  margin:0;
  font-size:0.8rem;
  color:#aaa;
}
.img-wrap {
  margin-top:10px;
  border-radius:12px;
  overflow:hidden;
  background:#0a0a0a;
  min-height:180px;
  display:flex;
  align-items:center;
  justify-content:center;
}
.img-wrap.loading::after {
  content:"Loading imageâ€¦";
  font-size:0.7rem;
  color:#555;
}
.img-wrap img {
  width:100%;
  display:none;
}
.img-wrap.loaded img {
  display:block;
}
.modal {
  position:fixed;
  inset:0;
  background:rgba(0,0,0,0.85);
  display:none;
  align-items:center;
  justify-content:center;
}
.modal-content {
  background:#111;
  padding:20px;
  border-radius:16px;
  max-width:90%;
}
.close {
  margin-top:12px;
  color:#888;
  font-size:0.8rem;
  text-align:center;
}
</style>
</head>

<body>

<div class="feed" id="feed"></div>

<div class="modal" id="modal" onclick="closeModal()">
  <div class="modal-content" onclick="event.stopPropagation()">
    <div id="modalBody"></div>
    <div class="close">Tap anywhere to close</div>
  </div>
</div>

<script>
/* ---------- DATA (REPLACE WITH YOUR 312 FEED) ---------- */
const FEED = [
  {
    title: "Grilled Salmon Bowl",
    desc: "Omega-3 rich longevity meal",
    prompt: "grilled salmon bowl michelin plated"
  },
  {
    title: "Mediterranean Chicken",
    desc: "Lean protein + polyphenols",
    prompt: "mediterranean chicken olive oil herbs"
  },
  {
    title: "Plant Power Lentils",
    desc: "Fiber + longevity carbs",
    prompt: "lentil vegetable bowl fine dining"
  }
];

/* ---------- IMAGE LOADER (NO TIMEOUTS) ---------- */
function loadImage(container, prompt) {
  const seed = Math.floor(Math.random()*99999);
  const url =
    `https://image.pollinations.ai/prompt/${encodeURIComponent(prompt)}`
    + `?width=800&height=600&seed=${seed}&enhance=false&nologo=true`;

  const img = new Image();
  img.decoding = "async";
  img.loading = "eager";
  img.src = url;

  img.onload = () => {
    container.classList.remove("loading");
    container.classList.add("loaded");
    container.appendChild(img);
  };
}

/* ---------- FEED RENDER ---------- */
const feedEl = document.getElementById("feed");

FEED.forEach(item => {
  const card = document.createElement("div");
  card.className = "card";
  card.innerHTML = `
    <h3>${item.title}</h3>
    <p>${item.desc}</p>
    <div class="img-wrap loading"></div>
  `;
  const imgWrap = card.querySelector(".img-wrap");

  // defer image load until AFTER paint
  requestAnimationFrame(() => loadImage(imgWrap, item.prompt));

  card.onclick = () => openModal(item);
  feedEl.appendChild(card);
});

/* ---------- MODAL ---------- */
function openModal(item) {
  document.getElementById("modalBody").innerHTML = `
    <h3>${item.title}</h3>
    <p style="color:#aaa;font-size:0.85rem">${item.desc}</p>
  `;
  document.getElementById("modal").style.display = "flex";
}
function closeModal() {
  document.getElementById("modal").style.display = "none";
}
</script>

</body>
</html>