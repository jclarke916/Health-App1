<!DOCTYPE html>
<html lang="en">
<head>
<meta charset="UTF-8" />
<meta name="viewport" content="width=device-width, initial-scale=1.0" />
<title>Meal Image Loader v400</title>

<style>
:root {
    --bg:#0b0b0f;
    --fg:#ffffff;
    --muted:#888;
    --accent:#c9a24d;
}
body {
    margin:0;
    font-family: Inter, system-ui, -apple-system, BlinkMacSystemFont;
    background:var(--bg);
    color:var(--fg);
}
button {
    padding:14px 18px;
    background:var(--accent);
    border:none;
    font-weight:800;
    cursor:pointer;
}
.modal {
    position:fixed;
    inset:0;
    background:rgba(0,0,0,.7);
    display:none;
    align-items:center;
    justify-content:center;
}
.modal-inner {
    width:90%;
    max-width:600px;
    background:#111;
    padding:20px;
    border-radius:12px;
}
.loader {
    height:300px;
    display:flex;
    align-items:center;
    justify-content:center;
    color:var(--muted);
    font-size:0.9rem;
}
.meal-img {
    width:100%;
    border-radius:10px;
}
</style>
</head>

<body>

<div style="padding:40px">
    <button onclick="openMeal('Grilled Salmon with Quinoa')">
        OPEN MEAL
    </button>
</div>

<div id="modal" class="modal" onclick="closeModal(event)">
    <div class="modal-inner">
        <h2 id="title"></h2>
        <div id="body"></div>
    </div>
</div>

<script>
/* ============================
   UTILITIES
============================ */

// stable hash → cache-friendly seed
function hashSeed(str) {
    let h = 2166136261;
    for (let i = 0; i < str.length; i++) {
        h ^= str.charCodeAt(i);
        h += (h << 1) + (h << 4) + (h << 7) + (h << 8) + (h << 24);
    }
    return Math.abs(h % 99999);
}

// build Pollinations URL
function buildImageURL(prompt) {
    const seed = hashSeed(prompt);
    return `https://image.pollinations.ai/prompt/${encodeURIComponent(prompt)}
        ?width=900&height=600&nologo=true&seed=${seed}&enhance=false`;
}

/* ============================
   CORE LOADER (v400)
============================ */

function openMeal(name) {
    const modal = document.getElementById('modal');
    const body = document.getElementById('body');
    document.getElementById('title').innerText = name;

    modal.style.display = 'flex';
    body.innerHTML = `<div class="loader">Generating image… this may take up to 30 seconds on first load.</div>`;

    const prompt = `${name}, professional food photography, michelin plating, natural light`;

    const img = new Image();
    img.className = 'meal-img';
    img.loading = 'eager';
    img.decoding = 'async';

    img.onload = () => {
        body.innerHTML = '';
        body.appendChild(img);
    };

    img.onerror = () => {
        body.innerHTML = `<div class="loader">Image generation failed. Try again.</div>`;
    };

    img.src = buildImageURL(prompt);
}

function closeModal(e) {
    if (e.target.id === 'modal') {
        e.currentTarget.style.display = 'none';
    }
}
</script>

</body>
</html>