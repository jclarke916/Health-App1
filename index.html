<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>The Centurion | v59 Master OS</title>
    <link href="https://fonts.googleapis.com/css2?family=Inter:wght@300;400;600;700&display=swap" rel="stylesheet">
    <style>
        :root {
            --bg-dark: #000000; 
            --card-bg: #111111; 
            --text-main: #E5E4E2; 
            --text-dim: #888888;
            --accent-gold: #D4AF37;
            --accent-silver: #C0C0C0;
            --badge-green: #00c853;
            --badge-orange: #ffab00;
            --alert-red: #ff3d00;
            --glute-pink: #d63384;
            --carb-high: #ff9100;
            --carb-low: #00b0ff;
            --superfood: #9c27b0;
        }
        
        body { font-family: 'Inter', sans-serif; background-color: var(--bg-dark); color: var(--text-main); margin: 0; display: flex; flex-direction: column; align-items: center; padding: 20px; }
        .container { max-width: 1000px; width: 100%; position: relative; }
        
        header { text-align: center; margin-bottom: 25px; border-bottom: 1px solid #333; padding-bottom: 20px; }
        h1 { font-weight: 300; letter-spacing: 2px; text-transform: uppercase; background: linear-gradient(to right, #E5E4E2, #888888); -webkit-background-clip: text; -webkit-text-fill-color: transparent; margin: 0; }
        
        .profile-badges { display: flex; justify-content: center; gap: 10px; margin-top: 20px; flex-wrap: wrap; }
        .badge { background: #1a1a1a; padding: 8px 16px; border-radius: 4px; border: 1px solid #333; font-size: 0.75rem; display: flex; align-items: center; gap: 8px; letter-spacing: 0.5px; text-transform: uppercase; color: var(--accent-silver); }
        .badge-interactive { cursor: pointer; transition: all 0.3s ease; border: 1px solid var(--accent-gold); color: var(--accent-gold); }
        .badge-interactive:hover { background: rgba(212, 175, 55, 0.1); box-shadow: 0 0 15px rgba(212, 175, 55, 0.1); }

        .status-bar { text-align: center; color: var(--text-dim); font-size: 0.85rem; margin-bottom: 20px; text-transform: uppercase; letter-spacing: 1.5px; }
        
        .controls { display: flex; justify-content: space-between; gap: 10px; margin-bottom: 25px; width: 100%; flex-wrap: wrap;}
        .nav-btn { flex: 1; padding: 14px; background: var(--card-bg); border: 1px solid #333; color: var(--text-main); border-radius: 6px; cursor: pointer; font-weight: 600; transition: 0.2s; font-size: 0.8rem; min-width: 100px; text-transform: uppercase; letter-spacing: 1px; }
        .nav-btn:hover { border-color: var(--accent-silver); background: #1a1a1a; }
        .action-btn { border-color: var(--accent-gold); color: var(--accent-gold); }
        .action-btn:hover { background: rgba(212, 175, 55, 0.1); }

        .tabs { display: flex; justify-content: space-between; background: var(--card-bg); padding: 5px; border-radius: 8px; margin-bottom: 25px; overflow-x: auto; border: 1px solid #222; }
        .tab-btn { background: none; border: none; color: #555; padding: 10px 8px; cursor: pointer; font-weight: 600; flex: 1; min-width: 60px; font-size: 0.8rem; text-align: center; transition: 0.3s; }
        .tab-btn span { display: block; font-size: 0.65rem; opacity: 0.7; margin-top: 4px; }
        .tab-btn.active { color: var(--accent-gold); background: rgba(255,255,255,0.03); border-radius: 4px; }
        
        /* CARD STYLES */
        .card { background: var(--card-bg); border-radius: 12px; padding: 30px; border: 1px solid #222; position: relative; overflow: hidden; margin-bottom: 20px; }
        .card::before { content: ""; position: absolute; top: 0; left: 0; width: 4px; height: 100%; background: var(--accent-gold); }
        
        .label { color: var(--accent-silver); font-size: 0.65rem; text-transform: uppercase; letter-spacing: 2px; font-weight: 700; margin-bottom: 5px; opacity: 0.8; }
        .value { font-size: 1.1rem; margin-bottom: 8px; font-weight: 500; color: #fff; cursor: pointer; transition: 0.2s; border-bottom: 1px solid transparent; display: inline-block;}
        .value:hover { color: var(--accent-gold); border-bottom: 1px solid var(--accent-gold); }
        
        /* WORKOUT TAG - FLEXBOX FIX */
        .workout-tag { 
            display: flex; 
            justify-content: space-between; 
            align-items: center; 
            gap: 15px;
            font-size: 0.9rem; 
            color: var(--accent-gold); 
            border-bottom: 1px solid #333; 
            padding-bottom: 15px; 
            margin-bottom: 20px; 
            font-weight: 700; 
            text-transform: uppercase; 
            letter-spacing: 1px; 
        }
        .workout-title { flex: 1; }
        
        /* CARB CYCLING TAGS */
        .carb-tag { 
            font-size: 0.7rem; 
            padding: 4px 8px; 
            border-radius: 4px; 
            text-transform: uppercase; 
            font-weight: 800; 
            letter-spacing: 0.5px; 
            white-space: nowrap;
            flex-shrink: 0;
        }
        .carb-high { background: rgba(255, 145, 0, 0.15); color: var(--carb-high); border: 1px solid var(--carb-high); }
        .carb-low { background: rgba(0, 176, 255, 0.15); color: var(--carb-low); border: 1px solid var(--carb-low); }

        .protein-tag { color: var(--accent-gold); font-size: 0.75rem; font-weight: 700; margin-left: 8px; }
        .red-meat-tag { color: #ff6b6b; font-size: 0.6rem; border: 1px solid #ff6b6b; padding: 1px 4px; border-radius: 2px; margin-left: 6px; vertical-align: middle; text-transform: uppercase; }
        .ingredients-list { font-size: 0.85rem; color: var(--text-dim); margin-bottom: 15px; font-style: italic; }
        
        .juice-box { background: #0a0a0a; border-radius: 12px; padding: 30px; border: 1px solid #222; display: flex; flex-direction: column; gap: 15px; }
        .juice-header { font-weight: 700; color: var(--accent-gold); font-size: 1rem; letter-spacing: 1px; text-transform: uppercase; }
        .oz-tag { background: var(--accent-gold); color: #000; padding: 2px 6px; border-radius: 2px; font-size: 0.7rem; font-weight: 800; float: right; }
        .juice-benefit { color: var(--accent-silver); font-style: italic; font-size: 0.85rem; margin-top: 5px; border-left: 2px solid var(--accent-gold); padding-left: 10px; margin-bottom: 15px;}

        /* MODALS */
        .modal { display: none; position: fixed; z-index: 100; left: 0; top: 0; width: 100%; height: 100%; overflow: auto; background-color: rgba(0,0,0,0.9); backdrop-filter: blur(8px); }
        .modal-content { background-color: #050505; margin: 5% auto; padding: 30px; border: 1px solid #333; width: 90%; max-width: 650px; border-radius: 12px; box-shadow: 0 0 50px rgba(0,0,0,0.8); position: relative; }
        .close-btn { color: #555; float: right; font-size: 28px; font-weight: bold; cursor: pointer; }
        .close-btn:hover { color: var(--accent-gold); }
        
        /* RECIPE MODAL SPECIFIC */
        #recipeTitle { margin-bottom: 15px; border-bottom: none; padding-bottom: 0; font-size: 1.5rem; color: #fff;}
        .recipe-badge-container { margin-bottom: 25px; padding-bottom: 15px; border-bottom: 1px solid #333; display: flex; gap: 10px; flex-wrap: wrap;}
        .recipe-time-badge { display: inline-block; padding: 8px 16px; border-radius: 4px; font-size: 0.9rem; font-weight: 800; letter-spacing: 1px; color: #000; text-transform: uppercase; }
        .green-badge { background-color: var(--badge-green) !important; color: #000 !important;}
        .orange-badge { background-color: var(--badge-orange) !important; color: #000 !important;}
        .red-badge { background-color: var(--alert-red) !important; color: #fff !important;}

        .macro-grid { display: grid; grid-template-columns: 1fr 1fr 1fr; gap: 10px; margin-bottom: 20px; background: #111; padding: 15px; border-radius: 8px; border: 1px solid #333; }
        .macro-item { text-align: center; }
        .macro-label { font-size: 0.7rem; color: #888; text-transform: uppercase; letter-spacing: 1px; margin-bottom: 5px; }
        .macro-val { font-size: 1.1rem; color: #fff; font-weight: 700; }
        
        .lifestyle-box { background: rgba(212, 175, 55, 0.05); border: 1px solid rgba(212, 175, 55, 0.3); padding: 15px; border-radius: 8px; margin-bottom: 20px; }
        .lifestyle-text { font-size: 0.9rem; color: #ddd; font-style: italic; line-height: 1.5; }
        
        .sophia-mod-box { background: rgba(214, 51, 132, 0.1); border: 1px solid var(--glute-pink); padding: 15px; border-radius: 6px; margin-top: 20px; }
        .sophia-mod-title { color: var(--glute-pink); font-size: 0.85rem; font-weight: 800; text-transform: uppercase; letter-spacing: 1px; margin-bottom: 8px; }
        .sophia-mod-text { color: #e0e0e0; font-size: 0.9rem; line-height: 1.5; }

        .superfood-highlight { color: var(--superfood); font-weight: 700; }

        .recipe-section-title { color: var(--accent-gold); font-size: 0.9rem; text-transform: uppercase; letter-spacing: 1px; margin-top: 20px; margin-bottom: 10px; font-weight: 700; }
        .recipe-list { list-style: none; padding: 0; margin: 0; }
        .recipe-list li { margin-bottom: 8px; color: #ccc; font-size: 0.9rem; line-height: 1.5; padding-left: 15px; position: relative; }
        .recipe-list li::before { content: "‚Ä¢"; color: var(--accent-gold); position: absolute; left: 0; }
        .recipe-steps { counter-reset: step; }
        .recipe-steps p { margin-bottom: 15px; color: #ccc; font-size: 0.95rem; line-height: 1.6; position: relative; padding-left: 25px; }
        .recipe-steps p::before { counter-increment: step; content: counter(step); position: absolute; left: 0; top: 0; background: var(--accent-gold); color: #000; width: 18px; height: 18px; border-radius: 50%; font-size: 0.7rem; display: flex; align-items: center; justify-content: center; font-weight: bold; }
        .recipe-steps strong { color: var(--accent-gold); font-weight: 700; }

        .portion-table { width: 100%; border-collapse: collapse; margin-top: 10px; }
        .portion-table th { text-align: left; border-bottom: 1px solid #333; padding: 12px 5px; color: var(--accent-silver); font-size: 0.7rem; text-transform: uppercase; letter-spacing: 1px; }
        .portion-table td { padding: 15px 5px; border-bottom: 1px solid #222; font-size: 0.9rem; color: #ccc; }
        
        .stat-grid { display: grid; grid-template-columns: 1fr 1fr; gap: 20px; margin-top: 20px; }
        .stat-box { background: #0f0f0f; padding: 20px; border-radius: 8px; border: 1px solid #222; }
        .stat-name { font-weight: 700; font-size: 1rem; margin-bottom: 15px; color: var(--accent-gold); text-transform: uppercase; letter-spacing: 1px; }
        .stat-row { display: flex; justify-content: space-between; align-items: center; font-size: 0.85rem; margin-bottom: 8px; color: #666; border-bottom: 1px solid #1a1a1a; padding-bottom: 5px; }
        .stat-row:last-child { border-bottom: none; }
        .stat-row strong { color: #eee; }
        .stat-target { color: var(--accent-gold) !important; font-weight: 800; }

        .workout-list { list-style: none; padding: 0; margin: 0; }
        .workout-list li { margin-bottom: 15px; border-bottom: 1px solid #222; padding-bottom: 10px; color: #aaa; font-size: 0.85rem; }
        .workout-list li strong { color: #E5E4E2; display: block; margin-bottom: 4px; font-size: 0.95rem; }
        .workout-day { color: var(--accent-gold); font-size: 0.75rem; text-transform: uppercase; letter-spacing: 1px; font-weight: 700; margin-right: 10px; }
        .recovery-badge { display: inline-block; background: #333; color: #fff; padding: 2px 6px; border-radius: 3px; font-size: 0.65rem; margin-top: 5px; text-transform: uppercase; }
        .recovery-badge.heat { background: #5a2a2a; color: #ffcccc; }
        .recovery-badge.cold { background: #2a3a5a; color: #ccccff; }
        .recovery-badge.tech { background: #2a5a4a; color: #ccffcc; }
        
        @media (max-width: 768px) { .main-layout { grid-template-columns: 1fr; } }
    </style>
</head>
<body>

<div class="container">
    <header>
        <h1>THE CENTURION</h1>
        <div class="profile-badges">
            <div class="badge badge-interactive" onclick="openProfileModal()">üßîüèæ‚Äç‚ôÇÔ∏è JERMAINE</div>
            <div class="badge badge-interactive" onclick="openProfileModal()">üë©üèæ‚Äçü¶± SOPHIA</div>
            <div class="badge">üåø SEA MOSS: 2 TBSP</div>
            <div class="badge">üõ°Ô∏è PROCESSED FREE</div>
        </div>
    </header>

    <div class="status-bar" id="syncStatus">initializing...</div>

    <div class="controls">
        <button class="nav-btn" onclick="changeWeek(-1)">PREV</button>
        <button class="nav-btn" onclick="resetToCurrent()">TODAY</button>
        <button class="nav-btn" onclick="changeWeek(1)">NEXT</button>
        <button class="nav-btn action-btn" onclick="openWorkoutModal()">üèãÔ∏è WORKOUTS</button>
        <button class="nav-btn action-btn" onclick="openPortionModal()">üìè PORTIONS</button>
    </div>

    <div class="tabs" id="dayTabs"></div>
    <div id="dayContent" class="main-layout"></div>
</div>

<div id="recipeModal" class="modal">
    <div class="modal-content">
        <span class="close-btn" onclick="closeModal('recipeModal')">&times;</span>
        <div class="guide-title" id="recipeTitle">Dish Title</div>
        
        <div class="recipe-badge-container">
             <span class="recipe-time-badge" id="recipeTime">30 mins</span>
        </div>

        <div class="lifestyle-box">
            <div class="recipe-section-title" style="margin-top:0;">Mission Critical</div>
            <div class="lifestyle-text" id="recipeWhy">Calculated for maximum nutrient density.</div>
        </div>

        <div class="macro-grid">
            <div class="macro-item">
                <div class="macro-label">Protein</div>
                <div class="macro-val" id="macroP">40g</div>
            </div>
            <div class="macro-item">
                <div class="macro-label">Carbs</div>
                <div class="macro-val" id="macroC">25g</div>
            </div>
            <div class="macro-item">
                <div class="macro-label">Fats</div>
                <div class="macro-val" id="macroF">15g</div>
            </div>
        </div>
        
        <div class="recipe-section-title">Ingredients Checklist</div>
        <ul class="recipe-list" id="recipeIngredients"></ul>
        <div class="recipe-section-title">Chef's Preparation</div>
        <div class="recipe-steps" id="recipeInstructions"></div>
        
        <div class="sophia-mod-box" id="leanModContainer" style="display:none;">
            <div class="sophia-mod-title">üçë Sophia's Glute & Ab Protocol</div>
            <div class="sophia-mod-text" id="leanModText"></div>
        </div>
    </div>
</div>

<div id="portionModal" class="modal">
    <div class="modal-content">
        <span class="close-btn" onclick="closeModal('portionModal')">&times;</span>
        <div class="guide-title">Portion Protocol</div>
        <table class="portion-table">
            <thead><tr><th>MACRO</th><th>JERMAINE (BUILD)</th><th>SOPHIA (SCULPT)</th></tr></thead>
            <tbody>
                <tr><td><strong>PROTEIN</strong></td><td>2 Palms</td><td>1.5 Palms</td></tr>
                <tr><td><strong>VEGGIES</strong></td><td>2+ Fists</td><td>2+ Fists</td></tr>
                <tr><td><strong>CARBS</strong></td><td>2 Cupped Hands</td><td><span style="color:var(--carb-high)">2 Hands (High Day)</span><br><span style="color:var(--carb-low)">1 Hand (Low Day)</span></td></tr>
                <tr><td><strong>FATS</strong></td><td>2 Thumbs</td><td>1 Thumb</td></tr>
                <tr><td style="color:var(--accent-gold)"><strong>JUICE</strong></td><td style="color:var(--accent-gold)">20-24 oz</td><td style="color:var(--accent-gold)">16 oz</td></tr>
            </tbody>
        </table>
    </div>
</div>

<div id="workoutModal" class="modal">
    <div class="modal-content">
        <span class="close-btn" onclick="closeModal('workoutModal')">&times;</span>
        <div class="guide-title">Training & Recovery</div>
        <ul class="workout-list" id="workoutListContainer"></ul>
    </div>
</div>

<div id="profileModal" class="modal">
    <div class="modal-content">
        <span class="close-btn" onclick="closeModal('profileModal')">&times;</span>
        <div class="guide-title">Biometric Data</div>
        <div class="stat-grid">
            <div class="stat-box">
                <div class="stat-name">JERMAINE</div>
                <div class="stat-row"><span>Age / Height</span><strong>42 / 6'4"</strong></div>
                <div class="stat-row"><span>Current Weight</span><strong>210.8 lbs</strong></div>
                <div class="stat-row"><span>Target Weight</span><strong class="stat-target">195.0 lbs</strong></div>
                <div class="stat-row"><span>Muscle Mass</span><strong>99.4 lbs</strong></div>
            </div>
            <div class="stat-box">
                <div class="stat-name">SOPHIA</div>
                <div class="stat-row"><span>Age / Height</span><strong>38 / 5'2"</strong></div>
                <div class="stat-row"><span>Current Weight</span><strong>136.1 lbs</strong></div>
                <div class="stat-row"><span>Target Weight</span><strong class="stat-target">125.0 lbs</strong></div>
                <div class="stat-row"><span>Muscle Mass</span><strong>+ 5.0 lbs</strong></div>
            </div>
        </div>
    </div>
</div>

<script>
    const dayLogic = [
        { day: "MON", work: "LIFT (In-Shape) + Massage", carb: "high", desc: "Heavy Compounds.", rec: "Aqua Massage + Sauna", badge: "tech", hydration: "1 Gallon + Electrolytes" },
        { day: "TUE", work: "BOXING (UFC Marcus)", carb: "high", desc: "High Intensity Conditioning.", rec: "Thera Knee Ice + Heat Packs", badge: "cold", hydration: "1.2 Gallons + Electrolytes" },
        { day: "WED", work: "REFORM (Club Studio)", carb: "low", desc: "Deep Core (Abs) + Glute Isolation.", rec: "Normatec Hips (Home)", badge: "tech", hydration: "3 Liters" },
        { day: "THU", work: "BOXING (UFC Marcus)", carb: "high", desc: "Technique & Sparring drills.", rec: "Thera Cold/Heat Contrast", badge: "cold", hydration: "1.2 Gallons + Electrolytes" },
        { day: "FRI", work: "YOGA + REFORM (Club Studio)", carb: "low", desc: "Mobility & Decompression.", rec: "Club Studio Sauna (20m)", badge: "heat", hydration: "3.5 Liters" },
        { day: "SAT", work: "CS4 (HIIT) @ Club Studio", carb: "high", desc: "Empty the Tank. High Intensity.", rec: "Normatec Legs + Sauna", badge: "tech", hydration: "1 Gallon + Electrolytes" },
        { day: "SUN", work: "HOME BASE RECOVERY", carb: "low", desc: "Total Rest.", rec: "Normatec Legs (30m)", badge: "tech", hydration: "3 Liters" }
    ];

    function renderWorkoutList() {
        const list = document.getElementById('workoutListContainer');
        list.innerHTML = dayLogic.map(d => `
            <li>
                <span class="workout-day">${d.day}</span> 
                <strong>${d.work}</strong>
                ${d.desc}<br>
                <span class="recovery-badge ${d.badge}">Recovery: ${d.rec}</span>
            </li>
        `).join('');
    }

    // MEAL DATA (Abridged for code length, logic handles the rest)
    const mealLibrary = {
        breakfasts: [
            { val: "Tofu & Brussels Scramble", p: "35g", ing: "1 Whole Egg + 3 Whites, Tofu, Brussels, Peppers, Jalape√±os", herSwap: "Same for Sophia" },
            { val: "Sea Moss & Triple-Protein Smoothie", p: "45g", ing: "Sea Moss, Pea Protein, Hemp, PB2, Blackberries, Camu Camu.", herSwap: "Same for Sophia" },
            { val: "Crab & Spinach Scramble", p: "35g", ing: "Lump crab, 1 Whole Egg + 3 Egg Whites, spinach, green onions.", herSwap: "Modified: Well-Done Eggs Only" },
            { val: "Japanese Tamagoyaki Scramble", p: "32g", ing: "1 Whole Egg + 3 Egg Whites, dashi, coconut aminos, spinach, nori.", herSwap: "Modified: Well-Done Eggs Only" },
            { val: "Salmon & Capers Sprouted Toast", p: "32g", ing: "Smoked salmon, capers, sprouted bread, avocado, Broccoli Sprouts.", herSwap: "Same for Sophia" },
            { val: "Turkey & Apple Hash", p: "35g", ing: "Ground turkey, apple, sage, walnuts.", herSwap: "Modified: Well-Done Eggs Only" },
            { val: "Mediterranean Breakfast Hash", p: "28g", ing: "Chickpeas, kale, tomatoes, olives, 1 Whole Egg + 3 Egg Whites.", herSwap: "Modified: Well-Done Eggs Only" },
            { val: "Southwest Bison Scramble", p: "41g", ing: "Bison, 1 Whole Egg + 3 Egg Whites, Red Bell Pepper, jalape√±os, black beans, Greek Yogurt.", herSwap: "Modified: Well-Done Eggs Only" },
            { val: "Fisherman's Sardine Toast", p: "35g", ing: "Sardines, Sprouted Bread, Avocado, Lemon, Chili Flakes", herSwap: "Same for Sophia" },
            { val: "Bison Steak & Eggs", p: "50g", ing: "4oz Bison Steak, 2 Eggs, Grilled Tomato", herSwap: "2oz Steak + 1 Egg + Whites" },
            { val: "Savory Bone Broth Oats", p: "30g", ing: "Oats cooked in Beef Bone Broth, Poached Egg, Scallions", herSwap: "Same for Sophia" },
            { val: "Smoked Trout & Dill Scramble", p: "38g", ing: "Smoked Trout, Eggs, Dill, Greek Yogurt", herSwap: "Same" },
            { val: "Overnight Hemp & Chia Proats", p: "35g", ing: "Oats, Chia, Hemp, Protein Powder, Almond Milk", herSwap: "Water base" },
            { val: "Turkey Sausage & Kale Frittata", p: "40g", ing: "Turkey Sausage, Kale, Eggs, Goat Cheese", herSwap: "Same" },
            { val: "Venison Sausage Skillet", p: "45g", ing: "Venison Sausage, Peppers, Onions, 2 Eggs", herSwap: "1 Egg + Whites" },
            { val: "Shakshuka w/ Ground Bison", p: "42g", ing: "Bison, Tomato Sauce, Cumin, Eggs poached in sauce", herSwap: "Use 1 Egg + Whites" },
            { val: "Greek Yogurt Protein Parfait", p: "35g", ing: "Fage 0%, Hemp Seeds, Chia, Berries, Cinnamon", herSwap: "Same" },
            { val: "Cottage Cheese & Peach Bowl", p: "30g", ing: "Low Fat Cottage Cheese, Sliced Peaches, Walnuts", herSwap: "Same" },
            { val: "Pesto Scrambled Eggs", p: "32g", ing: "1 Whole Egg + 3 Whites, Basil Pesto (Olive Oil base), Tomato", herSwap: "Light Pesto" },
            { val: "Sweet Potato & Beef Hash", p: "40g", ing: "Lean Grass-Fed Beef, Sweet Potato Cubes, Paprika", herSwap: "Same" }
        ],
        lunches: [
            { val: "Classic Peruvian Ceviche", p: "40g", type: "white", ing: "White Fish, Leche de Tigre, Red Onion, Sweet Potato" },
            { val: "Sriracha Yogurt Bison Tacos", p: "42g", type: "red", ing: "Bison, Siete Tortilla, Greek Yogurt Sriracha Sauce, Cilantro" },
            { val: "Mendo-Style Sophisticated Cobb", p: "42g", type: "white", ing: "Pasture turkey, kale, Broccoli Sprouts, avocado, pickled onions, beets." },
            { val: "Roasted Purple Yam Power Bowl", p: "35g", type: "white", ing: "Purple yams, quinoa, spinach, pepitas." },
            { val: "Bison Laab (Thai Meat Salad)", p: "40g", type: "red", ing: "Bison, lime, mint, cilantro, daikon." },
            { val: "Pasture-Raised Turkey Burger", p: "40g", type: "white", ing: "Turkey patty, avocado, tomato, lettuce wrap." },
            { val: "Cucumber-Wrapped Naruto Sushi", p: "42g", type: "white", ing: "Ahi tuna, salmon, avocado, cucumber wrap." },
            { val: "Ginger-Turkey Cabbage Potstickers", p: "38g", type: "white", ing: "Turkey, ginger, garlic, cabbage leaves." },
            { val: "Ahi Tuna & Power Greens Bowl", p: "45g", type: "white", ing: "Ahi tuna, edamame, cucumber, radish." },
            { val: "Chimichurri Flank Steak Salad", p: "45g", type: "red", ing: "Grilled Flank Steak, Chimichurri (Olive Oil), Mixed Greens, Radish" },
            { val: "Vietnamese Turkey Meatball Bowl", p: "40g", type: "white", ing: "Turkey Meatballs, Vermicelli (Konjac), Nuoc Cham, Herbs" },
            { val: "Lemon-Caper Cod w/ Asparagus", p: "38g", type: "white", ing: "Cod Fillet, Capers, Lemon, Ghee, Asparagus" },
            { val: "Sesame Crusted Seared Tuna", p: "45g", type: "white", ing: "Ahi Tuna, Sesame Seeds, Bok Choy, Coconut Aminos" },
            { val: "Mediterranean Lamb Meatball Bowl", p: "42g", type: "red", ing: "Lamb/Beef Mix, Cucumber, Tomato, Tzatziki (0% Yogurt), Greens" },
            { val: "Thai Green Curry Chicken", p: "40g", type: "white", ing: "Chicken Breast, Green Curry, Bamboo Shoots, Light Coconut Milk" },
            { val: "Chicken Liver P√¢t√© Cucumber Boats", p: "35g", type: "white", ing: "Chicken Liver P√¢t√©, Cucumber, Pickled Onions, Mustard" },
            { val: "Grilled Chicken Greek Salad", p: "40g", type: "white", ing: "Chicken Breast, Olives, Cucumber, Tomato, Goat Feta" },
            { val: "Shrimp & Avocado Salad", p: "35g", type: "white", ing: "Shrimp, Avocado, Lime, Cilantro, Mixed Greens" },
            { val: "Tuna Ni√ßoise Salad (No Potato)", p: "40g", type: "white", ing: "Skipjack Tuna, Green Beans, Egg, Olives, Greens" },
            { val: "Turkey & Hummus Collard Wrap", p: "38g", type: "white", ing: "Sliced Turkey, Hummus, Peppers, Collard Leaf" }
        ],
        dinners: [
            { val: "Pan-Seared Sea Bass w/ Fennel", p: "40g", type: "white", ing: "Chilean Sea Bass, Fennel Bulb, Citrus Segments, Dill" },
            { val: "Centurion Bone Broth Beef Stew", p: "45g", type: "red", ing: "Grass-Fed Beef, Bone Broth, Turnips, Carrots, Celery" },
            { val: "Lean Beef Pho (Konjac Noodles)", p: "42g", type: "red", ing: "Beef Bone Broth, Eye of Round, Konjac Noodles, Basil/Mint" },
            { val: "Centurion Stealth Chili", p: "42g", type: "red", ing: "Bison, Liver (hidden), Kidney Beans, Tomatoes, Chili Powder." },
            { val: "Spartan Bolognese", p: "40g", type: "red", ing: "Bison, Liver (hidden), Marinara, Italian Herbs, Zoodles/Chickpea Pasta." },
            { val: "The Predator (Bison & Liver) Sliders", p: "45g", type: "red", ing: "Ground Bison, Beef Liver (hidden), Cumin, Paprika, Sweet Potato." },
            { val: "SF Style Cioppino", p: "40g", type: "white", ing: "Clams, mussels, shrimp, crab, tomato broth, fennel." },
            { val: "Pan-Seared Jumbo Scallops", p: "35g", type: "white", ing: "Jumbo Scallops, Truffle Oil, Cauliflower Mash, Chives." },
            { val: "Grilled Lobster Tails w/ Ghee", p: "40g", type: "white", ing: "Lobster Tails, Garlic Ghee, Lemon, Roasted Asparagus." },
            { val: "Dungeness Crab & Avocado Tower", p: "35g", type: "white", ing: "Lump Crab Meat, Avocado, Mango Salsa, Microgreens." },
            { val: "Macadamia Nut Crusted Cod", p: "40g", type: "white", ing: "Cod Fillet, Crushed Macadamia Nuts, Coconut Oil, Green Beans." },
            { val: "Duck & Mushroom Ragu", p: "45g", type: "red", ing: "Ground duck, mushrooms, chickpea pasta, herbs." },
            { val: "Venison Au Poivre", p: "50g", type: "red", ing: "Venison Medallions, Peppercorns, Cognac reduction." },
            { val: "Slow Cooker Bison Ropa Vieja", p: "48g", type: "red", ing: "Bison Chuck, Peppers, Onions, Tomato Paste, Cumin" },
            { val: "Halibut w/ Broccoli Sprouts", p: "40g", type: "white", ing: "Halibut, Lemon, Garlic, Heap of Sprouts" },
            { val: "Grilled Swordfish Skewers", p: "45g", type: "white", ing: "Swordfish, Bell Peppers, Onions, Oregano, Lemon" },
            { val: "Peruvian Roast Chicken (Pollo a la Brasa)", p: "45g", type: "white", ing: "Chicken, Soy, Lime, Cumin, Paprika, Green Sauce (Aji)" },
            { val: "Bison Meatballs in Mushroom Gravy", p: "42g", type: "red", ing: "Bison, Mushrooms, Beef Broth, Thyme, Coconut Cream" },
            { val: "Blackened Catfish & Greens", p: "38g", type: "white", ing: "Catfish, Cajun Spice, Collard Greens, Vinegar" },
            { val: "Lamb Chops w/ Mint Chimichurri", p: "45g", type: "red", ing: "Lamb Chops, Mint, Parsley, Vinegar, Garlic" }
        ],
        juices: [
            { name: "The Detox", oz: "16oz", ing: "Celery, Cucumber, Apple, Lemon, Ginger", benefit: "Reduces water retention & bloat" },
            { name: "Red Power", oz: "20oz", ing: "Beets, Carrots, Orange, Ginger", benefit: "Nitric Oxide boost for stamina" },
            { name: "The Alkaline", oz: "16oz", ing: "Kale, Spinach, Pear, Lime", benefit: "Balances pH & lowers inflammation" },
            { name: "Joint Guard", oz: "18oz", ing: "Carrots, Pear, Celery, Turmeric", benefit: "Protects knees/shoulders after boxing" },
            { name: "The Flush", oz: "16oz", ing: "Red Cabbage, Apple, Mint, Lemon", benefit: "Liver support for protein processing" },
            { name: "The Endurance", oz: "24oz", ing: "Watermelon, Lime, Mint", benefit: "Natural electrolytes & hydration" },
            { name: "The Rainbow", oz: "18oz", ing: "Carrots, Beets, Celery, Ginger", benefit: "Broad spectrum micronutrients" }
        ]
    };

    // --- FULLY POPULATED RECIPE DATABASE ---
    const recipeDatabase = {
        // NEW FAVORITES
        "Pan-Seared Sea Bass w/ Fennel": { 
            time: "25 mins", 
            ingredients: ["Chilean Sea Bass Fillet", "1 Fennel Bulb (shaved)", "Orange/Grapefruit Segments", "Fresh Dill", "Ghee"], 
            steps: ["**Score the skin** of the bass to prevent curling.", "Salt fish and let sit 10 mins, then pat perfectly dry.", "Sear skin-side down in hot ghee for 5 mins (don't touch!).", "Flip and cook 3 mins.", "Serve over raw shaved fennel and citrus salad."], 
            macros: {p: "40g", c: "12g", f: "18g"}, 
            why: "Sea Bass is high in Omega-3s. Fennel aids digestion.", 
            sophiaMod: "Add extra citrus for Vitamin C." 
        },
        "Tofu & Brussels Scramble": { time: "15 mins", ingredients: ["1 Whole Egg + 3 Whites", "1/4 Block Firm Tofu (crumbled)", "Shaved Brussels Sprouts", "Red Bell Pepper", "Jalape√±o", "Turmeric"], steps: ["Saut√© Brussels and Peppers in 1 tsp olive oil until charred edges appear.", "Crumble tofu into pan, season heavily with Turmeric and Black Pepper.", "Pour in whisked eggs and scramble until set.", "Finish with fresh sliced Jalape√±os."], macros: {p: "35g", c: "12g", f: "10g"}, why: "High volume, high fiber, anti-inflammatory.", sophiaMod: "Use extra egg whites if needed." },
        "Sriracha Yogurt Bison Tacos": { time: "20 mins", ingredients: ["Lean Ground Bison", "Siete Almond Tortillas (or Lettuce)", "0% Greek Yogurt", "Sriracha", "Lime", "Cilantro"], steps: ["**Saut√© Bison** on high heat to get crispy edges.", "Whisk **Yogurt, Sriracha, and Lime Juice** in a small bowl until smooth.", "Warm tortillas in dry pan.", "Assemble: Meat, Sauce, lots of Cilantro."], macros: {p: "42g", c: "15g", f: "12g"}, why: "Probiotic cream sauce replaces fatty sour cream.", sophiaMod: "Use lettuce cups instead of tortillas." },
        "Classic Peruvian Ceviche": { time: "20 mins", ingredients: ["White Fish (Snapper/Bass)", "1 cup Lime Juice", "Red Onion (thinly sliced)", "Cilantro", "Rocoto or Jalape√±o", "Sweet Potato (boiled)"], steps: ["Dice fish into uniform 1/2 inch cubes.", "Cover in lime juice and **chill for 15-20 mins** to 'cook' (turns opaque).", "Rinse sliced onions in cold water to remove bite.", "Toss fish with onions, chili, and cilantro.", "Serve immediately."], macros: {p: "40g", c: "15g", f: "2g"}, why: "Zero cooking oil. Pure protein and enzymes.", sophiaMod: "Limit sweet potato portion." },
        "Centurion Bone Broth Beef Stew": { time: "3 hours", ingredients: ["Grass-Fed Beef Chuck", "4 cups Bone Broth", "Turnips (cubed)", "Carrots", "Celery", "Thyme"], steps: ["Sear beef chunks in batches until deep brown.", "Remove beef, saut√© aromatics in the fat.", "Return beef, add **Bone Broth** and fresh herbs.", "Simmer on low for 2.5 - 3 hours.", "Add turnips in the last 45 mins to avoid mushiness."], macros: {p: "45g", c: "15g", f: "15g"}, why: "Bone broth heals the gut lining.", sophiaMod: "Turnips replace white potatoes for lower GI." },
        "Lean Beef Pho (Konjac Noodles)": { time: "30 mins", ingredients: ["Beef Bone Broth", "Star Anise & Cinnamon", "Thinly Sliced Eye of Round", "Konjac Noodles", "Basil", "Bean Sprouts", "Hoisin (tiny amount)"], steps: ["**Toast spices** (anise, cinnamon) in dry pot until fragrant, then add broth.", "Simmer broth 20 mins.", "Rinse Konjac noodles thoroughly under hot water.", "Place raw beef slices over noodles.", "Pour boiling broth over beef to cook instantly."], macros: {p: "42g", c: "5g", f: "8g"}, why: "Collagen rich broth with zero carb noodles.", sophiaMod: "Konjac is pure fiber." },
        "Pan-Seared Jumbo Scallops": { time: "25 mins", ingredients: ["4 Jumbo Scallops", "Cauliflower (steamed)", "Truffle Oil", "Chives", "Ghee"], steps: ["**Pat scallops completely dry** with paper towel (crucial for crust).", "Heat ghee in pan until smoking.", "Sear scallops 2 mins undisturbed to form crust.", "Flip and sear 1 min.", "Serve over Truffle Cauliflower Mash."], macros: {p: "35g", c: "10g", f: "12g"}, why: "Scallops are high in magnesium.", sophiaMod: "Truffle oil adds luxury without carbs." },
        "Venison Au Poivre": { time: "20 mins", ingredients: ["Venison Medallions", "Whole Black Peppercorns (crushed)", "Beef Broth", "Splash Cognac (optional)", "Ghee"], steps: ["Coarsely crush peppercorns with a pan or mortar.", "Press meat firmly into pepper to coat.", "Sear in hot ghee (3 mins/side).", "Remove meat. Deglaze pan with broth/cognac.", "Simmer sauce until thick."], macros: {p: "50g", c: "2g", f: "8g"}, why: "Venison is the leanest red meat available.", sophiaMod: "Perfect high protein dinner." },
        "Mussels Fra Diavolo": { time: "25 mins", ingredients: ["2 lbs Mussels", "28oz Crushed Tomatoes", "4 Garlic Cloves", "Red Pepper Flakes", "White Wine"], steps: ["**De-beard** and scrub mussels.", "Saut√© garlic and red pepper flakes.", "Add wine and reduce by half.", "Add tomatoes and simmer.", "Add mussels, cover tightly, steam 5-7 mins.", "Discard unopened shells."], macros: {p: "38g", c: "15g", f: "10g"}, why: "Spicy capsaicin boosts metabolism.", sophiaMod: "Skip the bread." },
        
        // STANDARD RECIPES
        "Sea Moss & Triple-Protein Smoothie": { time: "5 mins", ingredients: ["2 tbsp Sea Moss Gel", "1 Scoop Pea Protein", "1 tbsp Hemp Seeds", "1 tbsp PB2", "1 tsp Camu Camu Powder", "1/2 cup Blackberries", "Water/Ice"], steps: ["Add liquid and sea moss to blender first.", "Add protein powder, Camu Camu, and seeds.", "Add frozen berries.", "Blend on high until smooth."], macros: {p: "45g", c: "25g", f: "10g"}, why: "Sea Moss provides 92 minerals; Hemp seeds add Omega-3s.", sophiaMod: "Use water instead of nut milk to keep calories low." },
        "Crab & Spinach Scramble": { time: "10 mins", ingredients: ["4oz Lump Crab Meat", "1 Whole Egg + 3 Whites", "1 cup Spinach", "Green Onions", "1 tsp Ghee"], steps: ["Saut√© spinach in ghee until wilted.", "Pour in whisked egg mixture.", "Scramble until 80% done.", "Fold in crab meat gently to warm through (do not overcook crab)."], macros: {p: "35g", c: "2g", f: "8g"}, why: "Crab is extremely lean protein. High satiety.", sophiaMod: "Ensure eggs are cooked Well-Done as preferred." },
        "Southwest Bison Scramble": { time: "12 mins", ingredients: ["4oz Ground Bison", "1 Whole Egg + 3 Whites", "1/2 Red Bell Pepper (diced)", "Jalape√±os", "2 tbsp Black Beans", "Cumin", "2 tbsp Non-Fat Greek Yogurt"], steps: ["Brown the bison with cumin and **Red Peppers** (Vit C boosts Iron absorption).", "Add jalape√±os and black beans.", "Pour eggs over mixture.", "Scramble until eggs are fully cooked.", "Top with cold Greek Yogurt."], macros: {p: "41g", c: "11g", f: "10g"}, why: "Red Peppers + Bison = Max Iron Absorption. Yogurt = Gut Health.", sophiaMod: "Cook eggs well-done. Enjoy the yogurt for extra calcium." },
        "Centurion Stealth Chili": { time: "45 mins", ingredients: ["1 lb Ground Bison", "4 oz Ground Beef Liver", "1 can Kidney Beans", "1 can Diced Tomatoes", "2 tbsp Chili Powder", "1 tbsp Cumin", "1 tbsp Smoked Paprika", "1 Onion", "2 Garlic Cloves", "1 cup Bone Broth"], steps: ["Saut√© onions and garlic until soft.", "Add Bison and **finely minced Liver**, browning well.", "Add all spices and toast for 1 min.", "Add tomatoes, beans, and broth.", "Simmer for 30 minutes to meld flavors."], macros: {p: "42g", c: "25g", f: "12g"}, why: "Spices completely mask the mineral taste. High fiber.", sophiaMod: "Skip the cheese topping, use Greek Yogurt instead." },
        "The Predator (Bison & Liver) Sliders": { time: "20 mins", ingredients: ["80% Ground Bison", "20% Beef Liver (ground)", "1 tsp Cumin", "1 tsp Smoked Paprika", "Garlic Powder", "Lettuce Wrap"], steps: ["Mix Bison and Liver thoroughly with spices (masks the flavor).", "Form into small sliders.", "Sear in a hot skillet for 3 mins per side.", "Serve in lettuce wraps."], macros: {p: "45g", c: "0g", f: "15g"}, why: "Nature's Multivitamin. Highest bioavailable Vitamin A & B12.", sophiaMod: "Eat with a side of citrus (orange slice) to boost iron absorption." },
        "SF Style Cioppino": { time: "45 mins", ingredients: ["1 lb Mussels", "1 lb Clams", "8oz Shrimp", "1 Crab", "Fennel", "Crushed Tomatoes", "Fish Broth", "White Wine"], steps: ["Saut√© **Fennel** and **Garlic**.", "Add **Wine**, **Tomatoes**, **Broth**. Simmer 20m.", "Add **Clams/Mussels** (cover 5m).", "Add **Shrimp/Crab** (3m).", "Serve with parsley."], macros: {p: "40g", c: "12g", f: "8g"}, why: "Zinc and Selenium support thyroid.", sophiaMod: "High protein, low fat." },
        "Dungeness Crab & Avocado Tower": { time: "15 mins", ingredients: ["6oz Lump Crab Meat", "1/2 Avocado", "Mango (diced small)", "Cilantro", "Lime", "Microgreens"], steps: ["Mix crab with lime/cilantro.", "Dice avocado and mango.", "Layer in a ring mold: Avocado base, Mango middle, Crab top.", "Remove mold."], macros: {p: "35g", c: "15g", f: "12g"}, why: "No cooking required. High in potassium.", sophiaMod: "Mango adds natural sweetness for pre-workout energy." },
        "Macadamia Nut Crusted Cod": { time: "25 mins", ingredients: ["Cod Fillet", "Macadamia Nuts (crushed)", "Coconut Oil", "Green Beans"], steps: ["Press crushed nuts onto fish.", "Sear in coconut oil until crust is golden.", "Transfer to oven (350F) for 8 mins.", "Serve with steamed beans."], macros: {p: "40g", c: "5g", f: "20g"}, why: "Healthy monounsaturated fats.", sophiaMod: "Perfect pairing of lean fish + healthy fat." }
    };

    function generateSmartRecipe(dishName, ingredientsString) {
        let ingArray = ingredientsString ? ingredientsString.split(', ') : ["Protein", "Veg"];
        let mainProtein = ingArray[0] || "Protein";
        let mainVeg = ingArray[1] || "Veg";
        
        let generatedWhy = "Nutrient dense meal.";
        let generatedMod = "Watch portion size.";
        let generatedSteps = [`Prep **${mainProtein}** and **${mainVeg}**.`, "Cook protein thoroughly in skillet or oven.", "Add veggies and season.", "Serve hot."];
        
        if (dishName.includes("Salmon") || dishName.includes("Fish") || dishName.includes("Cod") || dishName.includes("Halibut")) {
            generatedWhy = "Rich in Omega-3 fatty acids for cognitive health.";
            generatedMod = "Bake or steam instead of frying.";
            generatedSteps = [`Pat **${mainProtein}** dry.`, "Sear skin-side down for crispy skin.", "Flip and finish cooking.", "Serve with **${mainVeg}**."];
        } else if (dishName.includes("Bison") || dishName.includes("Steak") || dishName.includes("Beef") || dishName.includes("Venison")) {
            generatedWhy = "High Heme Iron for energy and recovery.";
            generatedMod = "Trim visible fat.";
            generatedSteps = [`Heat pan to high.`, `Sear **${mainProtein}** to form crust.`, "Lower heat to finish internal temp.", "Rest meat for 5 mins."];
        } else if (dishName.includes("Chicken") || dishName.includes("Turkey")) {
            generatedWhy = "Lean protein source.";
            generatedMod = "Ensure skinless cut.";
        } else if (dishName.includes("Shrimp") || dishName.includes("Crab") || dishName.includes("Lobster")) {
            generatedWhy = "Pure lean protein with minimal fat.";
            generatedMod = "Avoid butter dipping; use ghee or lemon.";
        }

        return { 
            time: "30 mins", 
            ingredients: ingArray, 
            steps: generatedSteps, 
            macros: {p:"35g", c:"20g", f:"15g"}, 
            why: generatedWhy,
            sophiaMod: generatedMod
        };
    }

    let weekOffset = 0;

    // --- SEED LOGIC ---
    function mulberry32(a) {
        return function() {
            var t = a += 0x6D2B79F5;
            t = Math.imul(t ^ t >>> 15, t | 1);
            t ^= t + Math.imul(t ^ t >>> 7, t | 61);
            return ((t ^ t >>> 14) >>> 0) / 4294967296;
        }
    }

    function seededShuffle(array, rng) {
        let newArray = [...array];
        let cur = newArray.length, rand;
        while (cur != 0) {
            rand = Math.floor(rng() * cur);
            cur--;
            [newArray[cur], newArray[rand]] = [newArray[rand], newArray[cur]];
        }
        return newArray;
    }

    function getWrappedSlice(array, start, length) {
        let result = [];
        for (let i = 0; i < length; i++) {
            result.push(array[(start + i) % array.length]);
        }
        return result;
    }

    function getMondayDate(offset) {
        let d = new Date();
        let day = d.getDay();
        let diff = d.getDate() - day + (day == 0 ? -6:1);
        let monday = new Date(d.setDate(diff));
        monday.setDate(monday.getDate() + (offset * 7));
        return monday;
    }

    function changeWeek(direction) {
        weekOffset += direction;
        generateSyncedWeek();
    }

    function resetToCurrent() {
        weekOffset = 0;
        generateSyncedWeek(true);
    }

    function openModal(id) { document.getElementById(id).style.display = 'block'; }
    function closeModal(id) { document.getElementById(id).style.display = 'none'; }
    function openPortionModal() { openModal('portionModal'); }
    function openWorkoutModal() { 
        renderWorkoutList(); 
        openModal('workoutModal'); 
    }
    function openProfileModal() { openModal('profileModal'); }

    function openRecipeModal(dishName, ingredientsString) {
        const modal = document.getElementById('recipeModal');
        const titleEl = document.getElementById('recipeTitle');
        const timeEl = document.getElementById('recipeTime');
        const ingList = document.getElementById('recipeIngredients');
        const stepList = document.getElementById('recipeInstructions');
        const whyEl = document.getElementById('recipeWhy');
        const mP = document.getElementById('macroP');
        const mC = document.getElementById('macroC');
        const mF = document.getElementById('macroF');
        const modContainer = document.getElementById('leanModContainer');
        const modText = document.getElementById('leanModText');

        let recipe = recipeDatabase[dishName];
        if (!recipe) {
            // Check if it's one of the abridged standard meals not explicitly in recipeDatabase map
            // and use the smart generator
            recipe = generateSmartRecipe(dishName, ingredientsString);
        }

        // Color Logic
        let minutes = 0;
        if (recipe.time.includes("hour")) minutes = 60;
        else minutes = parseInt(recipe.time);

        timeEl.className = 'recipe-time-badge'; 
        if (minutes <= 15) {
            timeEl.classList.add('green-badge');
            timeEl.innerText = `‚ö° ${recipe.time}`;
        } else if (minutes > 15 && minutes <= 30) {
            timeEl.classList.add('orange-badge');
             timeEl.innerText = `‚è±Ô∏è ${recipe.time}`;
        } else {
            timeEl.classList.add('red-badge');
             timeEl.innerText = `‚è≥ ${recipe.time}`;
        }

        titleEl.innerText = dishName;
        
        // Highlight Superfoods in Ingredients List
        const superfoods = ["Sea Moss", "Hemp Seeds", "Broccoli Sprouts", "Liver", "Camu Camu", "Sardines", "Truffle Oil"];
        ingList.innerHTML = recipe.ingredients.map(i => {
            let isSuper = superfoods.some(s => i.includes(s));
            return isSuper ? `<li class="superfood-highlight">üåü ${i}</li>` : `<li>${i}</li>`;
        }).join('');

        stepList.innerHTML = recipe.steps.map(s => `<p>${s.replace(/\*\*(.*?)\*\*/g, '<strong>$1</strong>')}</p>`).join('');
        
        whyEl.innerText = recipe.why;
        mP.innerText = recipe.macros.p;
        mC.innerText = recipe.macros.c;
        mF.innerText = recipe.macros.f;

        if (recipe.sophiaMod) {
            modContainer.style.display = "block";
            modText.innerText = recipe.sophiaMod;
        } else {
            modContainer.style.display = "none";
        }

        openModal('recipeModal');
    }

    function generateSyncedWeek(forceToday = false) {
        const today = new Date();
        const year = today.getFullYear();
        const rng = mulberry32(year); 

        const shuffledB = seededShuffle(mealLibrary.breakfasts, rng);
        const shuffledL = seededShuffle(mealLibrary.lunches, rng);
        const shuffledD = seededShuffle(mealLibrary.dinners, rng);
        const shuffledJ = seededShuffle(mealLibrary.juices, rng);

        const d = new Date();
        d.setUTCDate(d.getUTCDate() + 4 - (d.getUTCDay()||7));
        const weekNo = Math.ceil((((d - new Date(Date.UTC(d.getUTCFullYear(),0,1))) / 86400000) + 1)/7);
        const effectiveWeek = weekNo + weekOffset;
        
        // NO REPEATS LOGIC: Uses full array length to cycle
        const startB = (Math.abs(effectiveWeek) * 7) % mealLibrary.breakfasts.length;
        const startL = (Math.abs(effectiveWeek) * 7) % mealLibrary.lunches.length;
        const startD = (Math.abs(effectiveWeek) * 7) % mealLibrary.dinners.length;
        const startJ = (Math.abs(effectiveWeek) * 7) % mealLibrary.juices.length;

        const sB = getWrappedSlice(shuffledB, startB, 7);
        const sL = getWrappedSlice(shuffledL, startL, 7);
        const sD = getWrappedSlice(shuffledD, startD, 7);
        const sJ = getWrappedSlice(shuffledJ, startJ, 7);

        let monday = getMondayDate(weekOffset);
        let sunday = new Date(monday);
        sunday.setDate(monday.getDate() + 6);
        const opts = { month: 'short', day: 'numeric' };
        document.getElementById('syncStatus').innerText = `${monday.toLocaleDateString('en-US', opts)} ‚Äî ${sunday.toLocaleDateString('en-US', opts)}`;

        const tabsContainer = document.getElementById('dayTabs');
        tabsContainer.innerHTML = '';
        
        const days = ['mon', 'tue', 'wed', 'thu', 'fri', 'sat', 'sun'];
        
        days.forEach((dayKey, i) => {
            let tabDate = new Date(monday);
            tabDate.setDate(monday.getDate() + i);
            let dateNum = tabDate.getDate();
            
            let btn = document.createElement('button');
            btn.className = 'tab-btn';
            btn.innerHTML = `${dayKey.toUpperCase()}<span>${dateNum}</span>`;
            
            btn.onclick = () => {
                document.querySelectorAll('.tab-btn').forEach(b => b.classList.remove('active'));
                btn.classList.add('active');
                renderDay(i, sB, sL, sD, sJ); 
            };
            tabsContainer.appendChild(btn);
        });

        let activeIdx = 0;
        let todayDay = new Date().getDay();
        let trueTodayIdx = (todayDay + 6) % 7; 

        if (forceToday) {
            activeIdx = trueTodayIdx;
        } else {
            activeIdx = trueTodayIdx;
        }

        const allTabs = document.querySelectorAll('.tab-btn');
        if(allTabs[activeIdx]) {
            allTabs[activeIdx].classList.add('active');
            renderDay(activeIdx, sB, sL, sD, sJ);
        }
    }

    function renderDay(index, sB, sL, sD, sJ) {
        const b = sB[index];
        const l = sL[index];
        const d = sD[index];
        const j = sJ[index];
        const workoutData = dayLogic[index]; 
        
        const redTag = (type) => type === 'red' ? '<span class="red-meat-tag">RED</span>' : '';
        
        let carbBadge = "";
        if (workoutData.carb === "high") {
            carbBadge = '<span class="carb-tag carb-high">üî• HIGH CARB</span>';
        } else {
            carbBadge = '<span class="carb-tag carb-low">üßò LOW CARB</span>';
        }

        // DYNAMICALLY GET SOPHIA'S MOD FOR LUNCH/DINNER
        let rL = recipeDatabase[l.val];
        let modL = rL ? rL.sophiaMod : "Check portions";
        
        let rD = recipeDatabase[d.val];
        let modD = rD ? rD.sophiaMod : "Check portions";

        document.getElementById('dayContent').innerHTML = `
            <div class="card">
                <div class="workout-tag">
                    <span class="workout-title">${workoutData.work}</span>
                    ${carbBadge}
                </div>
                <div class="label">üç≥ Breakfast <span class="protein-tag">(${b.p})</span></div>
                <div class="value" onclick="openRecipeModal('${b.val}', '${b.ing}')">üßîüèæ‚Äç‚ôÇÔ∏è J: ${b.val}</div>
                <div class="value" style="color: var(--text-dim); font-size:0.9rem;" onclick="openRecipeModal('${b.val}', '${b.ing}')">üë©üèæ‚Äçü¶± S: ${b.herSwap}</div>
                <div class="ingredients-list">üõí ${b.ing}</div>
                
                <div class="label" style="margin-top:20px;">ü•ó Lunch <span class="protein-tag">(${l.p})</span> ${redTag(l.type)}</div>
                <div class="value" onclick="openRecipeModal('${l.val}', '${l.ing}')">üßîüèæ‚Äç‚ôÇÔ∏è J: ${l.val}</div>
                <div class="value" style="color: var(--text-dim); font-size:0.9rem;" onclick="openRecipeModal('${l.val}', '${l.ing}')">üë©üèæ‚Äçü¶± S: ${modL}</div>
                <div class="ingredients-list">üõí ${l.ing}</div>
                
                <div class="label" style="margin-top:20px;">üçΩÔ∏è Dinner <span class="protein-tag">(${d.p})</span> ${redTag(d.type)}</div>
                <div class="value" onclick="openRecipeModal('${d.val}', '${d.ing}')">üßîüèæ‚Äç‚ôÇÔ∏è J: ${d.val}</div>
                <div class="value" style="color: var(--text-dim); font-size:0.9rem;" onclick="openRecipeModal('${d.val}', '${d.ing}')">üë©üèæ‚Äçü¶± S: ${modD}</div>
                <div class="ingredients-list">üõí ${d.ing}</div>
            </div>
            
            <div class="juice-box">
                <div class="juice-header">üßÉ KUVINGS: ${j.name.toUpperCase()} <span class="oz-tag">${j.oz}</span> - <span style="color:#aaa; font-size:0.8rem;">COLD PRESSED</span></div>
                <div class="label">Ingredients</div><div style="font-size:0.9rem; color:#888;">${j.ing}</div>
                <div class="juice-benefit">‚ö° ${j.benefit}</div>
                <div style="margin-top:15px; border-top:1px solid #222; padding-top:10px;">
                    <div class="label">üóìÔ∏è DAILY PROTOCOL</div>
                    <div style="font-size: 0.8rem; line-height: 1.6; color:#666;">
                        ‚úÖ 2 tbsp Sea Moss Gel <br>‚úÖ 4-8oz Kombucha <br>‚úÖ 7:30 PM Liquid Cut-off <br>‚úÖ Bedtime: 10:30 PM (8h Sleep)<br>‚úÖ Hydration: ${workoutData.hydration}
                    </div>
                </div>
            </div>`;
    }

    window.onclick = function(event) { 
        if (event.target.classList.contains('modal')) event.target.style.display = 'none';
    }

    window.onload = () => generateSyncedWeek(true);
</script>
</body>
</html>