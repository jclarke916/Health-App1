<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no">
    <title>The Centurion | v6000.0 SKINWALKER</title>
    <link href="https://fonts.googleapis.com/css2?family=JetBrains+Mono:wght@400;700&family=Inter:wght@300;400;600;800;900&display=swap" rel="stylesheet">
    <style>
        :root {
            --bg-deep: #000000;
            --bg-panel: #0a0a0a;
            --border: #222;
            --acid: #ccff00;
            --cyan: #00f0ff;
            --gold: #FFD60A;
            --alert: #ff453a;
            --purple: #bf5af2;
            --text-main: #ffffff;
            --text-muted: #666;
            --font-ui: 'Inter', sans-serif;
            --font-data: 'JetBrains Mono', monospace;
        }

        * { box-sizing: border-box; -webkit-tap-highlight-color: transparent; }
        body { margin: 0; padding: 0 0 100px 0; background: var(--bg-deep); color: var(--text-main); font-family: var(--font-ui); min-height: 100vh; background-image: radial-gradient(circle at top right, #111 0%, #000 70%); }

        /* HEADER */
        .hud-header { padding: 15px 16px; background: rgba(0,0,0,0.9); backdrop-filter: blur(10px); position: sticky; top: 0; z-index: 100; border-bottom: 1px solid var(--border); }
        .top-bar { display: flex; justify-content: space-between; align-items: center; margin-bottom: 10px; }
        .app-name { font-size: 0.6rem; font-weight: 900; letter-spacing: 2px; color: var(--text-muted); }
        .user-switch { display: flex; gap: 4px; background: #222; padding: 2px; border-radius: 20px; }
        
        .u-badge { padding: 6px 14px; border-radius: 16px; font-size: 0.6rem; font-weight: 700; color: #666; background: transparent; border: none; cursor: pointer; transition: all 0.2s; }
        .u-badge.active { background: var(--text-main); color: #000; }

        /* HERO */
        .hero-section { padding: 25px 16px 10px; display: flex; align-items: center; justify-content: space-between; }
        .ring-container { width: 110px; height: 110px; position: relative; display: flex; align-items: center; justify-content: center; }
        .ring-svg { transform: rotate(-90deg); width: 100%; height: 100%; }
        .ring-bg { fill: none; stroke: var(--border); stroke-width: 6; }
        .ring-fg { fill: none; stroke: var(--acid); stroke-width: 6; stroke-dasharray: 283; stroke-dashoffset: 283; transition: stroke-dashoffset 1s ease; stroke-linecap: round; }
        .ring-data { position: absolute; text-align: center; }
        .ring-val { font-family: var(--font-data); font-size: 1.8rem; font-weight: 700; color: #fff; line-height: 1; }
        .ring-label { font-size: 0.5rem; font-weight: 700; color: var(--text-muted); margin-top: 2px; }

        .tactical-box { flex: 1; margin-left: 20px; background: linear-gradient(90deg, rgba(255,255,255,0.03) 0%, transparent 100%); border-left: 3px solid var(--acid); padding: 12px; border-radius: 0 12px 12px 0; border: 1px solid var(--border); border-left-width: 3px; }
        .tac-label { font-size: 0.55rem; color: var(--acid); font-weight: 900; letter-spacing: 1px; margin-bottom: 4px; text-transform: uppercase; }
        .tac-cmd { font-size: 0.8rem; font-weight: 700; color: #fff; line-height: 1.3; }
        .tac-meta { font-family: var(--font-data); font-size: 0.55rem; color: var(--text-muted); margin-top: 4px; }

        /* GRIDS */
        .section-label { font-size: 0.55rem; font-weight: 900; color: var(--text-muted); letter-spacing: 1px; margin: 20px 16px 10px; text-transform: uppercase; }
        .telemetry-grid { display: grid; grid-template-columns: 1fr 1fr 1fr 1fr; gap: 8px; padding: 0 16px; margin-bottom: 10px; }
        .macro-grid { display: grid; grid-template-columns: 1fr 1fr 1fr; gap: 8px; padding: 0 16px; margin-bottom: 30px; }
        
        .orb-card { background: var(--bg-panel); border: 1px solid var(--border); border-radius: 12px; padding: 10px 5px; display: flex; flex-direction: column; align-items: center; justify-content: center; position: relative; }
        .orb-container { width: 60px; height: 60px; position: relative; display: flex; align-items: center; justify-content: center; margin-bottom: 5px; }
        .orb-svg { transform: rotate(-90deg); width: 100%; height: 100%; }
        .orb-bg { fill: none; stroke: #222; stroke-width: 5; }
        .orb-fg { fill: none; stroke: var(--cyan); stroke-width: 5; stroke-dasharray: 158; stroke-dashoffset: 158; transition: stroke-dashoffset 1s ease; stroke-linecap: round; }
        
        .orb-val-box { position: absolute; text-align: center; }
        .orb-val { font-family: var(--font-data); font-size: 0.75rem; font-weight: 700; color: #fff; line-height: 1; }
        .orb-unit { font-size: 0.4rem; color: var(--text-muted); display: block; margin-top: 2px; }
        .orb-label { font-size: 0.5rem; font-weight: 700; color: var(--text-muted); letter-spacing: 1px; text-transform: uppercase; }

        .live-dot { width: 5px; height: 5px; background: var(--alert); border-radius: 50%; position: absolute; top: 8px; right: 8px; box-shadow: 0 0 5px var(--alert); animation: pulse-fast 1s infinite; display: none; }
        .orb-card.live .live-dot { display: block; }
        @keyframes pulse-fast { 0% { opacity: 1; } 50% { opacity: 0.3; } 100% { opacity: 1; } }

        /* TIMELINE */
        .timeline-container { padding: 0 16px; }
        .section-header { font-size: 0.6rem; font-weight: 900; color: var(--text-muted); letter-spacing: 1px; margin-bottom: 20px; display: flex; justify-content: space-between; align-items: center; border-bottom: 1px solid var(--border); padding-bottom: 10px; }
        
        .time-slot { display: flex; gap: 12px; margin-bottom: 20px; position: relative; transition: opacity 0.3s; }
        .time-slot.past { opacity: 0.4; }
        .time-slot::before { content: ''; position: absolute; left: 22px; top: 25px; bottom: -25px; width: 1px; background: var(--border); z-index: 0; }
        .time-slot:last-child::before { display: none; }

        .ts-time { width: 45px; font-family: var(--font-data); font-size: 0.75rem; color: var(--text-muted); text-align: right; padding-top: 5px; z-index: 1; }
        .ts-card { flex: 1; background: var(--bg-panel); border: 1px solid var(--border); border-radius: 12px; padding: 15px; position: relative; z-index: 1; overflow: hidden; transition: all 0.3s; }
        
        .ts-title { font-size: 0.85rem; font-weight: 700; color: #fff; margin-bottom: 4px; }
        .ts-desc { font-size: 0.75rem; color: #aaa; line-height: 1.4; margin-bottom: 8px; }
        .ts-mech { font-family: var(--font-data); font-size: 0.55rem; color: var(--text-muted); padding-top: 8px; border-top: 1px solid rgba(255,255,255,0.05); display: flex; align-items: center; gap: 5px; }
        .ts-mech::before { content: 'ðŸ”¬'; font-size: 0.6rem; }

        .ts-badge { font-size: 0.5rem; padding: 2px 6px; border-radius: 4px; font-weight: 800; text-transform: uppercase; letter-spacing: 0.5px; border: 1px solid transparent; display: inline-block; margin-bottom:5px; margin-right: 5px;}
        .b-bio { background: rgba(255,255,255,0.1); color: var(--text-muted); border-color: var(--border); }
        .b-syn { background: rgba(0, 240, 255, 0.1); color: var(--cyan); border-color: rgba(0, 240, 255, 0.3); }

        .check-btn { position: absolute; top: 15px; right: 15px; width: 22px; height: 22px; border-radius: 50%; border: 1px solid var(--border); background: transparent; cursor: pointer; display: flex; align-items: center; justify-content: center; color: transparent; transition: all 0.2s; color: #000; font-weight: 800; font-size: 0.7rem; }
        .time-slot.past .check-btn { background: var(--acid); border-color: var(--acid); color: #000; }

        .controls { display: flex; gap: 8px; padding: 0 16px 20px 16px; }
        .nav-btn { background: #111; border: 1px solid var(--border); color: var(--text-muted); padding: 12px; flex: 1; border-radius: 8px; font-size: 0.6rem; font-weight: 700; cursor: pointer; font-family: var(--font-data); }

        .sync-footer { position: fixed; bottom: 0; left: 0; width: 100%; background: #000; padding: 12px 16px; border-top: 1px solid var(--border); display: flex; justify-content: space-between; align-items: center; font-family: var(--font-data); font-size: 0.6rem; color: #555; z-index: 200; }
    </style>
</head>
<body>

    <svg style="width:0; height:0; position:absolute;" aria-hidden="true" focusable="false">
      <defs>
        <linearGradient id="grad-zone2" x1="0%" y1="0%" x2="100%" y2="0%">
          <stop offset="0%" style="stop-color:#00f0ff;stop-opacity:1" />
          <stop offset="100%" style="stop-color:#0080ff;stop-opacity:1" />
        </linearGradient>
        <linearGradient id="grad-zone5" x1="0%" y1="0%" x2="100%" y2="0%">
          <stop offset="0%" style="stop-color:#ff453a;stop-opacity:1" />
          <stop offset="100%" style="stop-color:#ff9f0a;stop-opacity:1" />
        </linearGradient>
      </defs>
    </svg>

    <div class="hud-header">
        <div class="app-name">CENTURION v6000</div>
        <div class="user-switch">
            <div id="bJ" class="u-badge active" onclick="switchU('J')">JER</div>
            <div id="bS" class="u-badge" onclick="switchU('S')">SOPH</div>
        </div>
    </div>

    <div id="main-interface"></div>

    <div class="controls">
        <button class="nav-btn" onclick="changeW(-1)">â—€ PREV</button>
        <button class="nav-btn" onclick="resetD()">TODAY</button>
        <button class="nav-btn" onclick="changeW(1)">NEXT â–¶</button>
    </div>

    <div class="sync-footer">
        <div id="ouraBar" onclick="fetchOuraData()">STATUS: IDLE</div>
        <div id="sync-time">--:--</div>
    </div>

<script>
// ==========================================
// LOGIC ENGINE: v1300 (EXACT COPY)
// ==========================================

let user = localStorage.getItem('centurion_active_user') || 'J';
let offset = 0;
let selDate = getCaDate(); 

const TOKENS = { 'J': 'WLIGFPFJQY73G43BY7CK7H6UJXPQ7N5Y', 'S': '4QSDWYJJUZFHRWRH727NCK7WH4COQJF4' };

const uH = {
    'J': { now: {bf:19.0, m:99.0, vf:10}, goal: {bf:15.0, m:105.0, vf:7}, labs: { apob: {val:95, goal:60}, hba1c: {val:5.4, goal:5.0} }, tests: { vo2: {val:45, goal:55} } },
    'S': { now: {bf:36.1, m:49.2, vf:9}, goal: {bf:22.0, m:60.0, vf:4}, labs: { ana: {val:320, goal:40}, hba1c: {val:5.6, goal:5.0}, ferr: {val:75, goal:70}, glucose: {val:84, goal:85} }, tests: { vo2: {val:32, goal:45} } }
};

const unifiedSchedule = {
    1: { focus: "HEAVY LIFT", tasks: "5x5 Compounds", zT: {h:15, m:30} },
    2: { focus: "BOXING", tasks: "45m Intervals", zT: {h:30, m:15} },
    3: { focus: "REFORM", tasks: "Pilates Flow", zT: {h:5, m:40} },
    4: { focus: "BOXING", tasks: "Technique", zT: {h:25, m:20} },
    5: { focus: "REFORM", tasks: "Core & Recovery", zT: {h:0, m:30} },
    6: { focus: "CS4 / VO2", tasks: "Max Effort", zT: {h:25, m:20} },
    0: { focus: "REST", tasks: "Active Recovery", zT: {h:0, m:0} }
};

const mealDB = {
    b: [{ name: "Ancestral Beef", pro: 25, carb: 5, fat: 18 }, { name: "Avo Egg Toast", pro: 20, carb: 35, fat: 12 }, { name: "Greek Yogurt", pro: 30, carb: 25, fat: 8 }],
    l: [{ name: "Super Mince", pro: 50, carb: 35, fat: 15 }, { name: "Salmon Salad", pro: 40, carb: 20, fat: 25 }, { name: "Turkey Rice", pro: 45, carb: 50, fat: 10 }],
    d: [{ name: "Bison Portobello", pro: 45, carb: 12, fat: 18 }, { name: "Ribeye & Sweet Potato", pro: 50, carb: 40, fat: 25 }, { name: "Halibut Beans", pro: 42, carb: 30, fat: 12 }]
};

function getCaDate() { let d = new Date(); d.setHours(12, 0, 0, 0); return d; }
function getDateKey(d) { return d.toISOString().split('T')[0]; }
function getMon(o) { let d = getCaDate(); d.setHours(0,0,0,0); let day = d.getDay(); let diff = d.getDate() - day + (day === 0 ? -6 : 1); d.setDate(diff + (o * 7)); return d; }

// --- RENDER ENGINE: COCKPIT SKIN ---
function render() {
    // 1. Determine Day & Data
    const dk = getDateKey(selDate);
    const dayIdx = selDate.getDay();
    const basePlan = unifiedSchedule[dayIdx] || unifiedSchedule[1];
    const cached = JSON.parse(localStorage.getItem(`centurion_oura_cache_${user}`)) || { history: [] };
    const rawOura = cached.history.find(d => d.date === dk) || { score: "-", cal: "-", high: 0, med: 0, rhr: "-" };
    
    // 2. Logic (Burnout/Recovery)
    // Simplified for Cockpit view
    let readiness = parseInt(rawOura.score) || 0;
    let rColor = readiness >= 80 ? 'var(--acid)' : readiness >= 60 ? 'var(--gold)' : 'var(--alert)';
    
    // 3. Macros
    const macros = { p: user==='J'?180:120, c: user==='J'?200:150, f: user==='J'?80:60 }; // Simple defaults
    
    // 4. Build HTML String (Cockpit Style)
    let html = `
    <div class="hero-section">
        <div class="ring-container">
            <svg class="ring-svg"><circle class="ring-bg" cx="55" cy="55" r="45"></circle><circle class="ring-fg" cx="55" cy="55" r="45" style="stroke:${rColor}; stroke-dashoffset:${283 - (Math.min(readiness,100)/100)*283}"></circle></svg>
            <div class="ring-data"><div class="ring-val">${rawOura.score}</div><div class="ring-label">READY</div></div>
        </div>
        <div class="tactical-box" style="border-left-color:${rColor}">
            <div class="tac-label" style="color:${rColor}">STATUS</div>
            <div class="tac-cmd">${readiness >= 80 ? "SYSTEMS NOMINAL" : "RECOVERY REQUIRED"}</div>
            <div class="tac-meta">${selDate.toDateString()}</div>
        </div>
    </div>

    <div class="section-label">CARDIO-METABOLIC STATUS</div>
    <div class="telemetry-grid">
        <div class="orb-card live"><div class="live-dot"></div>
            <div class="orb-container"><svg class="orb-svg"><circle class="orb-bg" cx="30" cy="30" r="25"></circle><circle class="orb-fg" cx="30" cy="30" r="25" style="stroke:var(--cyan); stroke-dashoffset:${158 - (Math.min(parseInt(rawOura.cal)||0, 1000)/1000)*158}"></circle></svg><div class="orb-val-box"><div class="orb-val">${rawOura.cal}</div><span class="orb-unit">CAL</span></div></div>
            <div class="orb-label">ACTIVE</div>
        </div>
        <div class="orb-card">
            <div class="orb-container"><svg class="orb-svg"><circle class="orb-bg" cx="30" cy="30" r="25"></circle><circle class="orb-fg" cx="30" cy="30" r="25" style="stroke:url(#grad-zone2); stroke-dashoffset:${158 - (Math.min(rawOura.med, 60)/60)*158}"></circle></svg><div class="orb-val-box"><div class="orb-val">${rawOura.med}</div><span class="orb-unit">Z2 MIN</span></div></div>
            <div class="orb-label">BASE</div>
        </div>
        <div class="orb-card">
            <div class="orb-container"><svg class="orb-svg"><circle class="orb-bg" cx="30" cy="30" r="25"></circle><circle class="orb-fg" cx="30" cy="30" r="25" style="stroke:url(#grad-zone5); stroke-dashoffset:${158 - (Math.min(rawOura.high, 30)/30)*158}"></circle></svg><div class="orb-val-box"><div class="orb-val">${rawOura.high}</div><span class="orb-unit">Z5 MIN</span></div></div>
            <div class="orb-label">PEAK</div>
        </div>
        <div class="orb-card">
            <div class="orb-container"><svg class="orb-svg"><circle class="orb-bg" cx="30" cy="30" r="25"></circle><circle class="orb-fg" cx="30" cy="30" r="25" style="stroke:var(--acid)"></circle></svg><div class="orb-val-box"><div class="orb-val">${rawOura.rhr}</div><span class="orb-unit">BPM</span></div></div>
            <div class="orb-label">RHR</div>
        </div>
    </div>

    <div class="section-label">MACRO ADHERENCE</div>
    <div class="macro-grid">
        <div class="orb-card">
            <div class="orb-container"><svg class="orb-svg"><circle class="orb-bg" cx="30" cy="30" r="25"></circle><circle class="orb-fg" cx="30" cy="30" r="25" style="stroke:var(--acid)"></circle></svg><div class="orb-val-box"><div class="orb-val">${macros.p}</div><span class="orb-unit">PRO</span></div></div>
            <div class="orb-label">PROTEIN</div>
        </div>
        <div class="orb-card">
            <div class="orb-container"><svg class="orb-svg"><circle class="orb-bg" cx="30" cy="30" r="25"></circle><circle class="orb-fg" cx="30" cy="30" r="25" style="stroke:var(--cyan)"></circle></svg><div class="orb-val-box"><div class="orb-val">${macros.c}</div><span class="orb-unit">CARB</span></div></div>
            <div class="orb-label">CARBS</div>
        </div>
        <div class="orb-card">
            <div class="orb-container"><svg class="orb-svg"><circle class="orb-bg" cx="30" cy="30" r="25"></circle><circle class="orb-fg" cx="30" cy="30" r="25" style="stroke:var(--cyan)"></circle></svg><div class="orb-val-box"><div class="orb-val">${macros.f}</div><span class="orb-unit">FAT</span></div></div>
            <div class="orb-label">FATS</div>
        </div>
    </div>

    <div class="timeline-container">
        <div class="section-header"><span>CHRONO-PROTOCOL</span></div>
        <div class="time-slot">
            <div class="ts-time">7 AM</div>
            <div class="ts-card">
                <div class="badge-row"><span class="ts-badge b-bio">PRIME</span></div>
                <div class="ts-title">Hydration</div>
                <div class="ts-desc">Sea Moss Gel (2 tbsp)</div>
                <button class="check-btn">â—‹</button>
            </div>
        </div>
        <div class="time-slot">
            <div class="ts-time">9 AM</div>
            <div class="ts-card">
                <div class="badge-row"><span class="ts-badge b-syn">BIO-ACTIVE</span></div>
                <div class="ts-title">Juice Protocol</div>
                <div class="ts-desc">${user==='J'?"Beet Vitality":"Orange Immune"}</div>
                <button class="check-btn">â—‹</button>
            </div>
        </div>
        <div class="time-slot">
            <div class="ts-time">5 PM</div>
            <div class="ts-card">
                <div class="badge-row"><span class="ts-badge b-bio">TRAIN</span></div>
                <div class="ts-title">${basePlan.focus}</div>
                <div class="ts-desc">${basePlan.tasks}</div>
                <button class="check-btn">â—‹</button>
            </div>
        </div>
    </div>
    `;

    document.getElementById('main-interface').innerHTML = html;
}

// ==========================================
// API LOGIC (EXACT V1300)
// ==========================================

function switchU(uID) {
    user = uID;
    localStorage.setItem('centurion_active_user', uID);
    
    // 1. WIPE CACHE (Your exact requirement)
    localStorage.removeItem(`centurion_oura_cache_${uID}`);
    
    // 2. UPDATE UI
    document.querySelectorAll('.u-badge').forEach(b => b.classList.toggle('active', b.id === 'b' + uID));
    document.getElementById('ouraBar').innerHTML = "ðŸ’ SWITCHING & WIPING CACHE...";
    render(); // Will render empty/loading state initially
    
    // 3. FETCH FRESH
    fetchOuraData();
}

async function fetchOuraData() {
    const fetchID = user; const token = TOKENS[fetchID];
    const range = `start_date=${getDateKey(new Date(Date.now()-864e5*14))}&end_date=${getDateKey(new Date())}`;
    
    document.getElementById('ouraBar').innerHTML = "ðŸ’ HANDSHAKE...";
    
    try {
        const [rRes, aRes] = await Promise.all([
            fetch(`https://corsproxy.io/?${encodeURIComponent(`https://api.ouraring.com/v2/usercollection/daily_readiness?${range}`)}`, { headers: { 'Authorization': `Bearer ${token}` } }),
            fetch(`https://corsproxy.io/?${encodeURIComponent(`https://api.ouraring.com/v2/usercollection/daily_activity?${range}`)}`, { headers: { 'Authorization': `Bearer ${token}` } })
        ]);
        
        const rData = await rRes.json();
        const aData = await aRes.json();
        
        if(user !== fetchID) return;
        
        if(rData.data) {
            const hist = rData.data.map(day => {
                const act = aData.data ? aData.data.find(ac => ac.day === day.day) : null;
                return { 
                    date: day.day, 
                    score: day.score || "-", 
                    cal: act ? act.active_calories : "-", 
                    high: act ? Math.round(act.high_activity_time/60) : 0, 
                    med: act ? Math.round(act.medium_activity_time/60) : 0,
                    rhr: day.contributors?.resting_heart_rate || "-"
                };
            }).reverse();
            
            localStorage.setItem(`centurion_oura_cache_${fetchID}`, JSON.stringify({history: hist, lastFetch: Date.now()}));
            document.getElementById('ouraBar').innerHTML = `ðŸ’ SYNCED: ${new Date().toLocaleTimeString()}`;
            render();
        }
    } catch(e) { 
        document.getElementById('ouraBar').innerHTML = "ðŸ’ SYNC TIMEOUT"; 
        render();
    }
}

function changeW(d) { offset += d; render(); }
function resetD() { offset = 0; selDate = getCaDate(); render(); }
window.onload = () => { switchU(user); }; // Initial load behaves like a switch
</script>
</body>
</html>