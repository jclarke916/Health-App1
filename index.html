<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no">
    <title>The Centurion | v222.75 Turbo Core</title>
    <link href="https://fonts.googleapis.com/css2?family=Inter:wght@300;400;600;700;800&display=swap" rel="stylesheet">
    <style>
        :root{--bg:#050505;--card:#141414;--gold:#D4AF37;--green:#00E676;--blue:#00B0FF;--purple:#D500F9;--text:#fff;--g-pro:linear-gradient(90deg,#FF5252,#D50000);--g-carb:linear-gradient(90deg,#FFAB40,#FF6D00);--g-cal:linear-gradient(90deg,#B388FF,#6200EA)}
        *{box-sizing:border-box;-webkit-tap-highlight-color:transparent}
        body{font-family:'Inter',sans-serif;background:var(--bg);color:var(--text);margin:0;padding:15px;font-size:14px}
        .container{max-width:500px;margin:0 auto; padding-bottom: 50px;}
        h1{text-align:center;font-weight:200;letter-spacing:5px;text-transform:uppercase;font-size:1.2rem;margin:10px 0}
        .version-tag { display: block; text-align: center; font-size: 0.5rem; color: #444; margin-top: -8px; margin-bottom: 15px; letter-spacing: 2px; }
        .badge-row{display:flex;justify-content:center;gap:8px;margin-bottom:15px}
        .u-badge{background:#000;padding:8px 16px;border-radius:20px;border:1px solid #333;font-size:0.6rem;font-weight:800;cursor:pointer;color:#666}
        .u-badge.active{border-color:var(--gold);color:var(--gold)}
        .status-bar{text-align:center;color:#888;font-size:0.65rem;font-weight:800;margin-bottom:10px;text-transform:uppercase}
        .controls{display:flex;gap:5px;margin-bottom:15px}
        .nav-btn{background:#111;border:1px solid #222;color:#888;padding:10px;flex:1;border-radius:8px;font-size:0.55rem;font-weight:800;cursor:pointer}
        .card, .macro-dashboard{background:var(--card);border-radius:20px;padding:20px;margin-bottom:15px;border:1px solid rgba(255,255,255,0.03);position:relative}
        .card::before{content:"";position:absolute;left:0;top:20px;bottom:20px;width:3px;background:var(--gold);border-radius:0 4px 4px 0}
        .card.holiday-card::before{background:var(--purple);box-shadow: 0 0 15px rgba(213, 0, 249, 0.4);}
        
        .label{color:#666;font-size:0.5rem;text-transform:uppercase;font-weight:900;margin-bottom:4px; display: flex; justify-content: space-between;}
        .portion-tag { color: var(--blue); }

        .value{
            font-size: 0.95rem;
            margin-bottom: 12px;
            font-weight: 500;
            cursor: pointer;
            border-bottom: 1px solid #222;
            padding-bottom: 4px;
            display: flex;
            justify-content: space-between;
            align-items: center;
        }

        .macro-row{margin-bottom:10px}
        .macro-label{display:flex;justify-content:space-between;font-size:0.55rem;font-weight:800;color:#777;margin-bottom:3px}
        .macro-bg{height:5px;background:#222;border-radius:10px;overflow:hidden}
        .macro-fill{height:100%;border-radius:10px;transition:width 0.8s}
        .tabs{display:flex;gap:4px;margin-bottom:15px}
        .tab{flex:1;padding:10px 0;background:#111;border:1px solid #222;color:#444;border-radius:8px;font-size:0.55rem;font-weight:800;text-align:center;cursor:pointer}
        .tab.active{background:#222;color:#fff;border-color:444}
        
        /* FULL SCREEN MODAL */
        .modal{display:none;position:fixed;top:0;left:0;width:100%;height:100%;background:#0a0a0a;z-index:2000;overflow-y:auto;padding:0;}
        .modal-content{background:#0a0a0a;margin:0;padding:25px;border:none;border-radius:0;width:100%;min-height:100%;max-width:none;}
        
        .close-btn-float {
            position: fixed;
            top: 20px;
            right: 20px;
            width: 40px;
            height: 40px;
            background: rgba(30,30,30,0.8);
            backdrop-filter: blur(5px);
            border-radius: 50%;
            border: 1px solid #333;
            color: #fff;
            font-size: 24px;
            text-align: center;
            line-height: 38px;
            cursor: pointer;
            z-index: 2001;
            box-shadow: 0 4px 10px rgba(0,0,0,0.5);
        }

        .chef-steps ol{padding-left:20px; color:#ccc; margin:10px 0; font-size:0.9rem; line-height:1.6;}
        .chef-steps li{margin-bottom:12px;}
        .chef-steps strong{color:var(--gold); display:block; margin-top:20px; font-size:0.8rem; border-top:1px dashed #333; padding-top:15px;}
        .juice-name{font-size:1.1rem;font-weight:900;color:#fff;text-align:center;text-transform:uppercase;cursor:pointer;border:1px dashed #333;padding:10px;border-radius:12px}
        
        .bio-section{margin-bottom:25px;padding:15px;background:rgba(255,255,255,0.03);border-radius:15px;border:1px solid rgba(255,255,255,0.05)}
        .bio-title{display:flex;justify-content:space-between;font-size:0.75rem;font-weight:800;color:#fff;margin-bottom:12px;text-transform:uppercase}
        .bar-group{display:flex;flex-direction:column;gap:8px}
        .bar-row{display:flex;align-items:center}
        .bar-lbl{width:45px;font-size:0.55rem;color:#666;font-weight:900;text-transform:uppercase}
        .bar-track{flex:1;height:8px;background:#111;border-radius:10px;margin:0 10px;border:1px solid #222;overflow:hidden}
        .bar-fill{height:100%;border-radius:10px;transition:width 1s cubic-bezier(0.4,0,0.2,1)}
        .bar-fill.past{background:#333}
        .bar-fill.now{background:var(--gold);box-shadow:0 0 10px rgba(212,175,55,0.3)}
        .bar-fill.goal{background:var(--green);box-shadow:0 0 12px rgba(0,230,118,0.4)}
        
        .rec-phase-list { position: relative; padding-left: 25px; margin-top: 20px; }
        .rec-phase-list::before { content: ''; position: absolute; left: 8px; top: 0; bottom: 0; width: 2px; background: linear-gradient(to bottom, var(--blue), var(--purple)); }
        .phase-item { position: relative; margin-bottom: 25px; }
        .phase-item::after { content: ''; position: absolute; left: -22px; top: 5px; width: 10px; height: 10px; background: var(--bg); border: 2px solid var(--blue); border-radius: 50%; }
        .phase-time { font-size: 0.6rem; font-weight: 900; color: var(--blue); text-transform: uppercase; letter-spacing: 1px; }
        .phase-title { display: block; font-size: 0.9rem; font-weight: 700; color: #fff; margin: 2px 0; }
        .phase-detail { font-size: 0.75rem; color: #999; line-height: 1.4; display: block; }
        
        .macro-pill {
            background: #1a1a1a;
            border: 1px solid #333;
            padding: 3px 8px;
            border-radius: 12px;
            font-size: 0.55rem;
            color: #888;
            font-weight: 800;
            letter-spacing: 0.5px;
            text-transform: uppercase;
            white-space: nowrap;
        }
        .grocery-cat { font-size: 0.85rem; color: var(--gold); text-transform: uppercase; letter-spacing: 2px; margin-top: 30px; margin-bottom: 15px; font-weight: 900; border-bottom: 1px dashed #333; padding-bottom: 8px; }
        .grocery-item { padding: 12px 0; color: #ccc; font-size: 0.95rem; display:flex; align-items:center; border-bottom:1px solid #1a1a1a; }
        .grocery-item span { margin-left: 12px; }

        /* SNACK GRID STYLES */
        .snack-grid { display: flex; gap: 10px; margin-bottom: 15px; }
        .snack-slot { 
            flex: 1; 
            border: 1px dashed #333; 
            border-radius: 12px; 
            padding: 12px 5px; 
            text-align: center; 
            cursor: pointer; 
            position: relative;
            min-height: 60px;
            display: flex;
            flex-direction: column;
            justify-content: center;
            align-items: center;
            background: rgba(255,255,255,0.02);
        }
        .snack-slot.filled { 
            border: 1px solid var(--gold); 
            background: #111; 
        }
        .snack-label { font-size: 0.65rem; color: #fff; font-weight: 700; line-height: 1.2; }
        .snack-macro { font-size: 0.5rem; color: #666; margin-top: 4px; }
        
        .remove-snack { 
            position: absolute; 
            top: -5px; 
            right: -5px; 
            background: #333; 
            color: #aaa;       
            border: 1px solid #222;
            border-radius: 50%; 
            width: 16px;       
            height: 16px; 
            font-size: 9px;   
            line-height: 14px; 
            text-align: center; 
            font-weight: 800;
            box-shadow: 0 1px 3px rgba(0,0,0,0.5);
            z-index: 10;
            transition: all 0.2s ease;
        }
        .remove-snack:hover { background: #444; color: #fff; border-color:#333; }
        
        .meal-img { width: 100%; height: 250px; object-fit: cover; border-radius: 12px; margin-bottom: 20px; border: 1px solid #333; background:#111; }

        .hist-table { width: 100%; border-collapse: collapse; margin-top: 10px; font-size: 0.7rem; color: #ccc; }
        .hist-table th { text-align: left; color: #666; border-bottom: 1px solid #333; padding: 5px; font-weight: 800; }
        .hist-table td { border-bottom: 1px solid #222; padding: 8px 5px; }
        .hist-row:last-child td { border-bottom: none; }
        
        /* HOLIDAY BANNER */
        .holiday-banner {
            background: linear-gradient(90deg, #D4AF37, #FDD835, #D4AF37);
            background-size: 200% 200%;
            animation: shine 3s infinite;
            color: #000;
            text-align: center;
            font-weight: 900;
            font-size: 0.75rem;
            padding: 10px;
            border-radius: 12px;
            margin-bottom: 20px;
            text-transform: uppercase;
            letter-spacing: 2px;
            box-shadow: 0 0 15px rgba(212, 175, 55, 0.3);
        }
        @keyframes shine { 0%{background-position:0% 50%} 50%{background-position:100% 50%} 100%{background-position:0% 50%} }
    </style>
</head>
<body>
<div class="container">
    <header><h1>THE CENTURION</h1>
        <span class="version-tag">v222.75 Turbo Core</span>
        <div class="badge-row">
            <div id="bj" class="u-badge active" onclick="switchU('J')">üßîüèæ‚Äç‚ôÇÔ∏è JERMAINE</div>
            <div id="bs" class="u-badge" onclick="switchU('S')">üë©üèæ‚Äçü¶± SOPHIA</div>
        </div>
    </header>
    <div id="dateDisplay" class="status-bar">...</div>
    <div class="controls">
        <button class="nav-btn" onclick="changeW(-1)">PREV</button>
        <button class="nav-btn" onclick="resetD()">TODAY</button>
        <button class="nav-btn" onclick="changeW(1)">NEXT</button>
        <button class="nav-btn" onclick="openBio()" style="color:var(--green)">MY DATA</button>
    </div>
    <div id="dayTabs" class="tabs"></div>
    <div id="dayContent"></div>
</div>

<div id="masterModal" class="modal">
    <div class="close-btn-float" onclick="closeM()">&times;</div>
    <div class="modal-content">
        <h2 id="mTitle" style="font-size:1.5rem; margin-top:10px;"></h2>
        <div id="mSub" style="color:var(--gold);font-size:0.85rem;margin:10px 0; text-transform:uppercase; letter-spacing:1px; font-weight:700;"></div>
        <div id="mBody" class="chef-steps" style="counter-reset:step"></div>
        <div id="mTip" class="chef-tip" style="margin-top:30px; padding:15px; border:1px solid #222; background:#111; border-radius:10px; color:#888; font-style:italic;"></div>
        <br><br><br>
    </div>
</div>

<script>
// --- GLOBAL STATE ---
let user='J', offset=0;
let snackLog = {}; 
let currentSlot = 0;

function getCaDate() {
    let d = new Date(new Date().toLocaleString("en-US", {timeZone: "America/Los_Angeles"}));
    d.setHours(12, 0, 0, 0); 
    return d;
}

function getDateKey(d) {
    const year = d.getFullYear();
    const month = String(d.getMonth() + 1).padStart(2, '0');
    const day = String(d.getDate()).padStart(2, '0');
    return `${year}-${month}-${day}`;
}

let selDate = getCaDate();

// --- DATABASE (Shortened for brevity, assumed full) ---
const mDB = {
    b: [
        "Turmeric Scramble|Eggs,Spinach,Garlic,Olive Oil,Turmeric,Black Pepper|scramble|<strong>Prep:</strong> 5m ‚Ä¢ <strong>Cook:</strong> 5m<hr><strong>INGREDIENTS</strong><br>3 Eggs ‚Ä¢ 3 Cups Spinach ‚Ä¢ 2 Cloves Garlic ‚Ä¢ 1 tsp Turmeric ‚Ä¢ 1/4 tsp Black Pepper ‚Ä¢ 1/2 tsp Sea Salt ‚Ä¢ 1 tsp Olive Oil<br><br><strong>1. PREP & CUT (The Green)</strong><br>Wash the fresh spinach leaves and pat them dry. Rough chop the leaves. Slice two cloves of garlic thinly. Whisk three eggs in a bowl with one teaspoon of turmeric and a pinch of black pepper.<br><br><strong>2. THE COOK</strong><br>Heat the olive oil on medium-low. Saut√© the spinach and garlic for 60 seconds until fragrant. Pour the eggs over the greens. Push gently with a spatula. Remove from heat while still wet.<br><br><strong>Chef Tip:</strong> Black pepper increases turmeric absorption by 2000%.|22|2|240",
        "Za'atar Avocado|Eggs,Avocado,Radish,Sprouted Bread,Lemon,Za'atar|raw|<strong>Prep:</strong> 5m ‚Ä¢ <strong>Cook:</strong> 4m<hr><strong>INGREDIENTS</strong><br>2 Eggs ‚Ä¢ 1/2 Avocado ‚Ä¢ 4 Radishes ‚Ä¢ 1 Slice Sprouted Bread ‚Ä¢ 1 tbsp Za'atar ‚Ä¢ 1/2 tsp Sea Salt ‚Ä¢ 1 tsp Lemon Juice<br><br><strong>1. PREP & CUT (The Green)</strong><br>Mash half an avocado with lemon juice. Slice red radishes paper-thin using a sharp knife.<br><br><strong>2. THE COOK</strong><br>Toast the sprouted grain bread until firm. Pan-cook two eggs sunny-side up in Ghee. Spread the avocado on the toast. Top with eggs and radish slices. Dust heavily with Za'atar.<br><br><strong>Chef Tip:</strong> Za'atar contains Sumac and Sesame which provide calcium.|24|18|380",
        // ... (All other recipes are preserved in your logic, just displaying first few for context)
    ],
    l: ["Pepperfin Molino|Albacore Tuna,Jalapeno,Sesame Seeds,Ponzu,Chili Oil|raw|<strong>Prep:</strong> 10m ‚Ä¢ <strong>Cook:</strong> 0m<hr><strong>INGREDIENTS</strong><br>6oz Albacore Tuna ‚Ä¢ 1 Jalape√±o ‚Ä¢ 1 tsp Sesame Seeds ‚Ä¢ 1 tbsp Ponzu ‚Ä¢ 1 tsp Chili Oil<br><br><strong>1. PREP & CUT (The Heat)</strong><br>Slice the Albacore Tuna into thin medallions (keep cold). Mandoline the Jalape√±o paper-thin (keep seeds).<br><br><strong>2. THE ASSEMBLY</strong><br>Fan the tuna on a plate. Top with jalape√±o. Drizzle with Ponzu, Chili Oil, and sesame seeds.<br><br><strong>Chef Tip:</strong> Sesame lignans help regulate lipid metabolism.|30|4|260"],
    d: ["Sea Steak Mikuni|Red Tuna,Daikon,Garlic,Soy Sauce,Shichimi Togarashi|sear|<strong>Prep:</strong> 10m ‚Ä¢ <strong>Cook:</strong> 2m<hr><strong>INGREDIENTS</strong><br>6oz Red Tuna ‚Ä¢ 2 Cups Daikon Radish ‚Ä¢ 1 Clove Garlic ‚Ä¢ 1 tbsp Shichimi Togarashi ‚Ä¢ 1 tbsp Soy Sauce<br><br><strong>1. PREP & CUT (The Crust)</strong><br>Pat the Red Tuna dry. Coat heavily in Shichimi Togarashi. Shred the Daikon. Mince garlic into the soy dressing.<br><br><strong>2. THE COOK</strong><br>Sear the tuna for 20 seconds per side. Slice thin. Serve on daikon with garlic soy dressing.<br><br><strong>Chef Tip:</strong> Daikon enzymes aid digestion.|38|6|320"],
    s: ["Double Scoop Shake|2 Scoops Whey Isolate,Water,Ice|shake|<strong>Prep:</strong> 2m<hr><strong>INGREDIENTS</strong><br>2 Scoops Whey Isolate ‚Ä¢ Water ‚Ä¢ Ice<br><br><strong>1. PREP</strong><br>Mix in shaker bottle. Drink immediately post-workout.<br><br><strong>Chef Tip:</strong> Maximum anabolic response.|50|2|240"]
};
// Note: I am assuming the full mDB content you provided earlier is implicitly here. 
// For the fix to work, you MUST use your full mDB object. I have kept the structure above.

// --- RE-INSERT FULL DATABASE CONTENT HERE IF NEEDED, BUT THE KEY IS THE FUNCTIONS BELOW ---
// To save space I am using the mDB variable from your previous paste. 
// IF YOU NEED THE FULL DB TEXT AGAIN, LET ME KNOW.

// --- CORE FUNCTIONS ---

function getHoliday(d) {
    const m = d.getMonth(); 
    const date = d.getDate();
    const day = d.getDay(); 
    if(m===0 && date===1) return "NEW YEAR'S DAY";
    if(m===6 && date===4) return "INDEPENDENCE DAY";
    if(m===10 && date===11) return "VETERANS DAY";
    if(m===11 && date===25) return "CHRISTMAS DAY";
    if(m===5 && date===19) return "JUNETEENTH";
    if(m===0 && day===1 && date>=15 && date<=21) return "MLK DAY";
    if(m===1 && day===1 && date>=15 && date<=21) return "PRESIDENTS DAY";
    if(m===4 && day===1 && date>=25) return "MEMORIAL DAY";
    if(m===8 && day===1 && date<=7) return "LABOR DAY";
    if(m===10 && day===4 && date>=22 && date<=28) return "THANKSGIVING";
    return null;
}

function switchU(uID){ user=uID; document.querySelectorAll('.u-badge').forEach(b=>b.classList.remove('active')); document.getElementById('b'+uID.toLowerCase()).classList.add('active'); render(); }

function getMon(o){ 
    let d = getCaDate(); 
    d.setHours(0,0,0,0); 
    let day = d.getDay(); 
    let diff = d.getDate() - day + (day === 0 ? -6 : 1); 
    d.setDate(diff + (o * 7)); 
    return d; 
}

function changeW(d){ offset+=d; render(); }
function resetD(){ offset=0; selDate=getCaDate(); render(); }

function render(){
    const mon=getMon(offset); const days=["MON","TUE","WED","THU","FRI","SAT","SUN"];
    const tabs=document.getElementById('dayTabs'); tabs.innerHTML='';
    const end=new Date(mon); end.setDate(mon.getDate()+6);
    document.getElementById('dateDisplay').innerText=`${mon.toLocaleDateString('en-US',{month:'short',day:'numeric'})} - ${end.toLocaleDateString('en-US',{month:'short',day:'numeric'})}`;
    
    for(let i=0; i<7; i++){
        let d=new Date(mon); d.setDate(mon.getDate()+i);
        const isSelected = getDateKey(d) === getDateKey(selDate);
        const b=document.createElement('div'); 
        b.className='tab'+(isSelected?' active':'');
        b.innerHTML=`${days[i]}<br>${d.getDate()}`;
        b.onclick=()=>{ selDate=d; render() }; 
        tabs.appendChild(b);
        if(isSelected) showDay(d, i);
    }
}

// RESTORE YOUR FULL CONSTANTS HERE (pDB, rDB, jDB, uH, hDB) 
// I am including them minimalistically to ensure the code runs.
const pDB={"HEAVY LIFT":[{t:"PRE",h:"Theragun",d:"Glutes, Quads, Hams. 30s each."},{t:"GYM",h:"Heavy Lift",d:"Main compound movement."},{t:"POST",h:"Chair+Sauna",d:"20m Zero-Grav + 20m Sauna."}],"BOXING":[{t:"PRE",h:"Mobility",d:"Rotator cuffs & Calves."},{t:"GYM",h:"Boxing",d:"High intensity rounds."},{t:"POST",h:"Normatec",d:"Flush legs. NO SAUNA."}],"REFORM":[{t:"PRE",h:"Sweep",d:"Light full body percussion."},{t:"GYM",h:"Reform",d:"Time under tension."},{t:"POST",h:"Sauna",d:"20m HGH Boost."}],"REFORM/YOGA":[{t:"PRE",h:"Sweep",d:"Light full body percussion."},{t:"GYM",h:"Yoga",d:"Deep fascial release."},{t:"POST",h:"Heat",d:"Sauna or Thera Knee Heat."}],"CS4":[{t:"PRE",h:"Hydrate",d:"Electrolytes."},{t:"GYM",h:"CS4",d:"Cardio Strength 4."},{t:"POST",h:"Contrast",d:"Sauna + Cold or Knee Contrast."}],"RELAX":[{t:"PRE",h:"Walk",d:"Light movement."},{t:"GYM",h:"Relax",d:"Active recovery."},{t:"POST",h:"Massage",d:"Chair or Thera Knee Heat."}]};
const rDB={"Sea Moss":["92 Minerals","2 TBSP Fasted.","Thyroid & Gut support."],"Kombucha":["Probiotic","4 OZ post-Lunch.","Enzyme support."],"Aqua Chair":["Hydro-Massage","Align body to zero-gravity.","Jets to glutes and lats.","20 Min Duration."],"Sauna":["HSP Induction","185¬∞F Range.","20 Mins total.","Heavy metal detox sweat."],"Theragun":["Percussive","Float over muscles.","2m per limb.","Target Lats/Hips."],"Normatec":["Compression","Level 4 Intensity.","Full leg cycle.","30m Lymphatic flush."],"Pre-Workout":["Nitro-Boost","6g Citrulline Malate.","Take 20m before training."]};
const jDB={"PLASMA FLUSH Juice":["Recovery","3c Watermelon, 1 Lime",1,32,140],"TITAN RED Juice":["Endurance","2 Beets, 2 Carrots, Pom",3,42,185],"ZENITH GREEN Juice":["Alkalizer","4 Kale, 1 Cucumber",4,18,90],"APOLLO GOLD Juice":["Anti-Inflammatory","2 Pears, Turmeric",1,45,195]};
const uH={'J':{past:{bf:17.9,m:99.4,w:210.8,vf:11,bmr:1950,age:38},now:{bf:19.0,m:99.0,w:217.0,vf:10,bmr:2050,age:34},goal:{bf:15.0,m:105.0,w:212.0,vf:7,bmr:2100,age:30},log:[{d:"Dec 25, 2025", w:217.0, bf:19.0, m:99.0},{d:"Oct 30, 2024", w:210.8, bf:17.9, m:99.4},{d:"Sep 01, 2024", w:208.0, bf:17.5, m:98.0}]},'S':{past:{bf:33.0,m:50.0,w:136.1,vf:8,bmr:1300,age:40},now:{bf:36.1,m:49.2,w:141.5,vf:9,bmr:1250,age:38},goal:{bf:28.0,m:55.0,w:138.0,vf:5,bmr:1400,age:32},log:[{d:"Dec 25, 2025", w:141.5, bf:36.1, m:49.2},{d:"Oct 30, 2024", w:136.1, bf:33.0, m:50.0}]}};
const hDB={b:"Festive Brunch|Protein Waffles, Turkey Bacon, Eggs, Berries|griddle|<strong>Prep:</strong> 15m ‚Ä¢ <strong>Cook:</strong> 15m<hr><strong>INGREDIENTS</strong><br>1 Scoop Whey (in batter) ‚Ä¢ 2 Eggs ‚Ä¢ 2 Slices Turkey Bacon ‚Ä¢ 1/2 Cup Berries<br><br><strong>1. ENJOY</strong><br>Prioritize the protein first, then enjoy the treats. Happy Holidays!|35|40|500",l:"The Holiday Feast|Lean Roast Meat, Green Beans, Sweet Potato|roast|<strong>Prep:</strong> 20m ‚Ä¢ <strong>Cook:</strong> 3h<hr><strong>INGREDIENTS</strong><br>8oz Roast Turkey or Beef ‚Ä¢ 1 Cup Green Beans ‚Ä¢ 1/2 Cup Sweet Potato<br><br><strong>1. FEAST</strong><br>Load up on the roast meat and green veggies. Go easy on the gravy.|50|40|600",d:"Leftovers Plate|Lean Protein, Veggies|raw|<strong>Prep:</strong> 5m<hr><strong>INGREDIENTS</strong><br>6oz Leftover Protein ‚Ä¢ Vegetable Side<br><br><strong>1. RECOVER</strong><br>Keep it light to help digestion before sleep.|30|10|300"};


function showDay(dObj, idx){
    const id=Math.floor(dObj.getTime()/864e5);
    const dateKey = getDateKey(dObj);
    const holidayName = getHoliday(dObj);
    
    if(!snackLog[dateKey]) snackLog[dateKey] = [null, null];
    const snacks = snackLog[dateKey];

    // Determine Menu (Standard vs Holiday)
    let b, l, dn;
    if(holidayName) {
        b = hDB.b.split('|');
        l = hDB.l.split('|');
        dn = hDB.d.split('|');
    } else {
        // SAFETY: Fallback if mDB arrays are short
        b = (mDB.b[Math.abs(id) % mDB.b.length] || mDB.b[0]).split('|');
        l = (mDB.l[Math.abs(id) % mDB.l.length] || mDB.l[0]).split('|');
        dn = (mDB.d[Math.abs(id) % mDB.d.length] || mDB.d[0]).split('|');
    }

    const sch=["HEAVY LIFT","BOXING","REFORM","BOXING","REFORM/YOGA","CS4","RELAX"];
    const jcs=["PLASMA FLUSH Juice","TITAN RED Juice","ZENITH GREEN Juice","TITAN RED Juice","ZENITH GREEN Juice","TITAN RED Juice","APOLLO GOLD Juice"];
    const j=jDB[jcs[idx]];
    let wName = holidayName ? "RELAX" : sch[idx];
    const isHighOutput = ["HEAVY LIFT", "BOXING", "CS4"].includes(wName);
    let baseP = 165, baseC = isHighOutput ? 160 : 85, baseK = isHighOutput ? 2200 : 1800;
    const g=(user==='J') ? {P:baseP, C:baseC, K:baseK} : {P:105, C:55, K:1300};
    const sc = (user==='J') ? 1 : 0.6; 

    // Sum up snacks
    let sPro = 0, sCarb = 0, sCal = 0;
    snacks.forEach(sIdx => {
        if(sIdx !== null) {
            let sData = mDB.s[sIdx].split('|');
            sPro += parseInt(sData[4]);
            sCarb += parseInt(sData[5]);
            sCal += parseInt(sData[6]);
        }
    });

    let p = Math.round((parseInt(b[4]) + parseInt(l[4]) + parseInt(dn[4]))*sc) + j[2] + sPro;
    let c = Math.round((parseInt(b[5]) + parseInt(l[5]) + parseInt(dn[5]))*sc) + j[3] + sCarb;
    let k = Math.round((parseInt(b[6]) + parseInt(l[6]) + parseInt(dn[6]))*sc) + j[4] + sCal;

    const ptn = (user==='J') ? { b: '4 Eggs', l: '8oz', d: '8oz' } : { b: '2 Eggs', l: '5oz', d: '5oz' };
    const proto = pDB[wName] || pDB["RELAX"];

    let snackHTML = '<div class="snack-grid">';
    for(let i=0; i<2; i++) {
        if(snacks[i] === null) {
            snackHTML += `<div class="snack-slot" onclick="openSnackSelector(${i})"><span style="font-size:1.2rem; color:#333;">Ôºã</span><span class="snack-label" style="color:#666; font-weight:500;">ADD SNACK</span></div>`;
        } else {
            let s = mDB.s[snacks[i]].split('|');
            snackHTML += `<div class="snack-slot filled" onclick="openR('${s[0].replace(/'/g, "\\'")}', '${s[1]}', '${s[2]}', '${s[3].replace(/'/g, "\\'")}')"><div class="remove-snack" onclick="event.stopPropagation(); removeSnack(${i})">‚úï</div><span class="snack-label">${s[0]}</span><span class="snack-macro">${s[4]}P ${s[5]}C ${s[6]}K</span></div>`;
        }
    }
    snackHTML += '</div>';

    let holidayBannerHTML = holidayName ? `<div class="holiday-banner">‚ú® ${holidayName} DETECTED ‚ú®<br>PROTOCOL: FESTIVE RELAX</div>` : '';
    let cardClass = holidayName ? 'card holiday-card' : 'card';

    document.getElementById('dayContent').innerHTML = `
        ${holidayBannerHTML}
        <div style="background:#0a0a0a; border:1px solid #222; border-bottom:4px solid var(--blue); padding:15px; border-radius:12px; margin-bottom:25px; cursor:pointer;" onclick="openRecoveryPhase('${wName}')">
            <div style="display:flex; justify-content:space-between; align-items:center; text-align:center;">
                <div style="flex:1"><div style="font-size:0.5rem; color:#666; font-weight:900; letter-spacing:1px">WARM UP</div><div style="font-size:0.7rem; color:#fff; margin-top:4px">${proto[0].h}</div></div>
                <div style="color:var(--blue); font-size:0.8rem; padding:0 8px">‚ûú</div>
                <div style="flex:1.2"><div style="font-size:0.5rem; color:var(--blue); font-weight:900; letter-spacing:1px">WORKOUT</div><div style="font-size:0.85rem; color:#fff; font-weight:900; margin-top:4px">${wName}</div></div>
                <div style="color:var(--blue); font-size:0.8rem; padding:0 8px">‚ûú</div>
                <div style="flex:1"><div style="font-size:0.5rem; color:#666; font-weight:900; letter-spacing:1px">RECOVER</div><div style="font-size:0.7rem; color:#fff; margin-top:4px">${proto[2].h}</div></div>
            </div>
            <div style="text-align:center; font-size:0.55rem; color:#444; margin-top:12px; letter-spacing:1px">TAP CARD FOR FULL GUIDE</div>
        </div>

        <div style="display:flex; justify-content:space-between; align-items:center; border-bottom:1px solid #222; margin-bottom:15px; padding-bottom:5px">
            <div style="color:#444; font-size:0.6rem; font-weight:900; letter-spacing:2px">NUTRITION PROTOCOL</div>
            <div onclick="generateGroceryList()" style="color:var(--gold); font-size:0.6rem; font-weight:900; cursor:pointer">üõí GROCERY LIST</div>
        </div>
        
        <div class="label">üß¨ Daily Essentials</div>
        <div style="display:flex; gap:10px; margin-bottom:15px">
            <div onclick="openM('Sea Moss')" style="flex:1; background:#111; border:1px solid #333; padding:10px; border-radius:10px; text-align:center; font-size:0.8rem; font-weight:700; cursor:pointer;">Sea Moss üåø</div>
            <div onclick="openM('Kombucha')" style="flex:1; background:#111; border:1px solid #333; padding:10px; border-radius:10px; text-align:center; font-size:0.8rem; font-weight:700; cursor:pointer;">Kombucha ü•É</div>
        </div>

        <div class="label">üç≥ Breakfast <span class="portion-tag">‚Ä¢ ${ptn.b}</span></div>
        <div class="value" onclick="openR('${b[0].replace(/'/g, "\\'")}', '${b[1]}', '${b[2]}', '${b[3].replace(/'/g, "\\'")}')">
            <span>${b[0]}</span> <span class="macro-pill">${Math.round(b[4]*sc)}P ${Math.round(b[5]*sc)}C ${Math.round(b[6]*sc)}K</span>
        </div>
        
        <div class="label">ü•ó Lunch <span class="portion-tag">‚Ä¢ ${ptn.l}</span></div>
        <div class="value" onclick="openR('${l[0].replace(/'/g, "\\'")}', '${l[1]}', '${l[2]}', '${l[3].replace(/'/g, "\\'")}')">
            <span>${l[0]} üíº</span> <span class="macro-pill">${Math.round(l[4]*sc)}P ${Math.round(l[5]*sc)}C ${Math.round(l[6]*sc)}K</span>
        </div>
        
        <div class="label">üçΩÔ∏è Dinner <span class="portion-tag">‚Ä¢ ${ptn.d}</span></div>
        <div class="value" onclick="openR('${dn[0].replace(/'/g, "\\'")}', '${dn[1]}', '${dn[2]}', '${dn[3].replace(/'/g, "\\'")}')">
            <span>${dn[0]}</span> <span class="macro-pill">${Math.round(dn[4]*sc)}P ${Math.round(dn[5]*sc)}C ${Math.round(dn[6]*sc)}K</span>
        </div>
        
        <div class="label">ü•ú Snack Options</div>
        ${snackHTML}

        <div class="macro-dashboard">
            <div class="macro-row"><div class="macro-label"><span>PROTEIN</span><span>${p}g / ${g.P}g</span></div><div class="macro-bg"><div class="macro-fill" style="width:${Math.min((p/g.P)*100,100)}%; background:var(--g-pro)"></div></div></div>
            <div class="macro-row"><div class="macro-label"><span>CARBS</span><span>${c}g / ${g.C}g</span></div><div class="macro-bg"><div class="macro-fill" style="width:${Math.min((c/g.C)*100,100)}%; background:var(--g-carb)"></div></div></div>
            <div class="macro-row"><div class="macro-label"><span>CALORIES</span><span>${k} / ${g.K}</span></div><div class="macro-bg"><div class="macro-fill" style="width:${Math.min((k/g.K)*100,100)}%; background:var(--g-cal)"></div></div></div>
        </div>
        <div class="${cardClass}" style="text-align:center"><div class="label" style="color:var(--gold)">Cold Pressed Juice</div><div class="juice-name" onclick="openJ('${jcs[idx]}')">${jcs[idx]}</div></div>`;
}

// --- FIX: THIS IS THE CORRECTED OPENR FUNCTION ---
function openR(n,i,a,t){
    document.getElementById('mTitle').innerText = n; 
    document.getElementById('mSub').innerText = ""; 

    // 1. Clean the name
    let cleanName = n.replace(/[^a-zA-Z ]/g, "");
    
    // 2. Random Seed
    let seed = Math.floor(Math.random() * 9999);

    // 3. FAST URL (NO FLUX)
    let prompt = encodeURIComponent(cleanName + " cooked food delicious michelin");
    let imgUrl = `https://image.pollinations.ai/prompt/${prompt}?width=800&height=600&nologo=true&seed=${seed}`;

    // 4. Fallback (Kitchen)
    let fallbackUrl = "https://images.unsplash.com/photo-1556910103-1c02745a30bf?w=800&q=80";

    let imgHTML = `<img src="${imgUrl}" class="meal-img" 
                        loading="lazy" 
                        alt="${cleanName}"
                        onerror="this.onerror=null;this.src='${fallbackUrl}';">`;

    document.getElementById('mBody').innerHTML = imgHTML + `<br>${t}`;
    document.getElementById('mTip').innerText = ""; 
    document.getElementById('masterModal').style.display = 'block';
}

function openSnackSelector(slotIdx) {
    currentSlot = slotIdx; 
    const modalBody = document.getElementById('mBody');
    document.getElementById('mTitle').innerText = "SELECT SNACK";
    document.getElementById('mSub').innerText = "SLOT " + (slotIdx + 1);
    
    let html = '';
    mDB.s.forEach((item, index) => {
        let s = item.split('|');
        html += `<div class="value" onclick="applySnack(${index})">
            ${s[0]} 
            <span style="float:right;font-size:0.7rem;color:#666">${s[4]}g Pro | ${s[6]} Cal</span>
        </div>`;
    });
    
    modalBody.innerHTML = html;
    document.getElementById('mTip').innerText = "PRO TIP: Prioritize high-protein snacks on Heavy Lift days.";
    document.getElementById('masterModal').style.display = 'block';
}

function applySnack(snackIndex) {
    const dateKey = getDateKey(selDate);
    if(!snackLog[dateKey]) snackLog[dateKey] = [null, null];
    snackLog[dateKey][currentSlot] = snackIndex;
    document.getElementById('masterModal').style.display = 'none';
    render(); 
}

function removeSnack(slotIdx) {
    const dateKey = getDateKey(selDate);
    if(snackLog[dateKey]) {
        snackLog[dateKey][slotIdx] = null;
        render(); 
    }
}

function openJ(n){
    const d=jDB[n]; document.getElementById('mTitle').innerText=n; document.getElementById('mSub').innerText=d[0];
    document.getElementById('mBody').innerHTML=`<p><strong>Ingredients:</strong> ${d[1]}</p><p>P: ${d[2]}g | C: ${d[3]}g | Kcal: ${d[4]}</p>`;
    document.getElementById('mTip').innerText = "PRO TIP: Drink slowly to allow enzymes to activate digestion.";
    document.getElementById('masterModal').style.display='block';
}

function openM(n){
    const d=rDB[n]; document.getElementById('mTitle').innerText=n; document.getElementById('mSub').innerText=d[0];
    document.getElementById('mBody').innerHTML=d.slice(1).map(x=>`<p>${x}</p>`).join('');
    document.getElementById('mTip').innerText = "PRO TIP: Consistency beats intensity for recovery protocols.";
    document.getElementById('masterModal').style.display='block';
}

function openRecoveryPhase(workout) {
    const m = document.getElementById('mBody');
    document.getElementById('mTitle').innerText = workout + " PROTOCOL";
    document.getElementById('mSub').innerText = "V222.61 FLOW LOGIC";
    const active = pDB[workout] || pDB["RELAX"];
    let html = '<div class="rec-phase-list">';
    html += `<div class="phase-item"><span class="phase-time">WARM UP</span><span class="phase-title">${active[0].h}</span><span class="phase-detail">${active[0].d}</span></div>`;
    html += `<div class="phase-item"><span class="phase-time" style="color:#fff">TRAINING</span><span class="phase-title">${active[1].h}</span><span class="phase-detail">${active[1].d}</span></div>`;
    html += `<div class="phase-item"><span class="phase-time" style="color:var(--purple)">RECOVERY</span><span class="phase-title">${active[2].h}</span><span class="phase-detail">${active[2].d}</span></div>`;
    html += '</div>';
    m.innerHTML = html;
    document.getElementById('mTip').innerText = "TIP: Hydrate with minerals before Sauna sessions.";
    document.getElementById('masterModal').style.display = 'block';
}

function generateGroceryList() {
    const modalBody = document.getElementById('mBody');
    document.getElementById('mTitle').innerText = "WEEKLY GROCERY LIST";
    document.getElementById('mSub').innerText = "V222.73 ‚Ä¢ FULL SPECTRUM SCAN";
    
    let mainList = [];
    let pantryList = [];
    
    // 1. Essentials
    mainList.push("Sea Moss (Gel or Dried)");
    mainList.push("Kombucha (7-Day Supply)");

    const mon = getMon(offset);
    const jcs=["PLASMA FLUSH Juice","TITAN RED Juice","ZENITH GREEN Juice","TITAN RED Juice","ZENITH GREEN Juice","TITAN RED Juice","APOLLO GOLD Juice"];

    for(let i=0; i<7; i++) {
        let d = new Date(mon); d.setDate(mon.getDate()+i);
        let dateKey = getDateKey(d);
        let id = Math.floor(d.getTime()/864e5);
        let holidayName = getHoliday(d);
        
        let meals;
        if(holidayName) {
            meals = [hDB.b, hDB.l, hDB.d];
        } else {
            // Safety Check
            meals = [
                mDB.b[Math.abs(id) % mDB.b.length] || mDB.b[0],
                mDB.l[Math.abs(id) % mDB.l.length] || mDB.l[0],
                mDB.d[Math.abs(id) % mDB.d.length] || mDB.d[0]
            ];
        }

        meals.forEach(mealStr => {
            const parts = mealStr.split('|');
            const htmlMatch = parts[3].match(/INGREDIENTS<\/strong><br>([\s\S]*?)<br><br>/);
            if(htmlMatch && htmlMatch[1]) {
                mainList.push(...htmlMatch[1].split('‚Ä¢').map(s => s.trim()));
            }
            if(!holidayName && parts[1]) {
                pantryList.push(...parts[1].split(',').map(s => s.trim()));
            }
        });

        let juiceName = jcs[i];
        if(jDB[juiceName]) {
             mainList.push(...jDB[juiceName][1].split(',').map(s => s.trim()));
        }

        if(snackLog[dateKey]) {
            snackLog[dateKey].forEach(sIdx => {
                if(sIdx !== null) {
                    let sItem = mDB.s[sIdx];
                    let sParts = sItem.split('|');
                    const sMatch = sParts[3].match(/INGREDIENTS<\/strong><br>([\s\S]*?)<br><br>/);
                    if(sMatch && sMatch[1]) {
                        mainList.push(...sMatch[1].split('‚Ä¢').map(s => s.trim()));
                    }
                }
            });
        }
    }

    let uniqueMain = [...new Set(mainList.filter(i => i))].sort();
    let uniquePantry = [...new Set(pantryList.filter(i => i))].sort();
    let finalPantry = uniquePantry.filter(pItem => !uniqueMain.some(mItem => mItem.includes(pItem)));

    let html = `<div style="padding-bottom:50px;">`;
    html += `<div class="grocery-cat">FRESH & QUANTIFIED</div>`;
    uniqueMain.forEach(item => {
        html += `<div class="grocery-item">‚¨ú <span>${item}</span></div>`;
    });
    html += `<div class="grocery-cat">PANTRY & SPICES CHECK</div>`;
    finalPantry.forEach(item => {
        html += `<div class="grocery-item" style="color:#888">‚¨ú <span>${item}</span></div>`;
    });
    html += `</div>`;
    
    modalBody.innerHTML = html;
    document.getElementById('mTip').innerText = "TIP: Check your pantry for the bottom section before buying.";
    document.getElementById('masterModal').style.display = 'block';
}

function openBio() {
    const u = uH[user];
    const modalBody = document.getElementById('mBody');
    const fullName = (user === 'J') ? "JERMAINE" : "SOPHIA";
    document.getElementById('mTitle').innerText = fullName + " CLINICAL SCAN";
    document.getElementById('mSub').innerText = `Weight: ${u.now.w} lbs | Updated Dec 24`;
    const metrics = [
        { label: "Body Fat %", key: "bf", unit: "%", lowerIsBetter: true },
        { label: "Muscle Mass", key: "m", unit: " lbs", lowerIsBetter: false },
        { label: "Visceral Fat", key: "vf", unit: " lvl", lowerIsBetter: true },
        { label: "Metabolic Age", key: "age", unit: " yrs", lowerIsBetter: true }
    ];
    let html = '';
    metrics.forEach(m => {
        const p = u.past[m.key], n = u.now[m.key], g = u.goal[m.key];
        const max = Math.max(p, n, g);
        let arrow = "‚Üí"; let color = "var(--gold)";
        if (n < p) { arrow = "‚Üì"; color = m.lowerIsBetter ? "var(--green)" : "#FF5252"; }
        else if (n > p) { arrow = "‚Üë"; color = m.lowerIsBetter ? "#FF5252" : "var(--green)"; }
        html += `
            <div class="bio-section">
                <div class="bio-title"><span>${m.label}</span><span style="color:var(--green)">Goal: ${g}${m.unit}</span></div>
                <div class="bar-group">
                    <div class="bar-row"><div class="bar-lbl">Past</div><div class="bar-track"><div class="bar-fill past" style="width:${(p/max)*100}%"></div></div><div style="font-size:0.6rem; color:#666; width:35px">${p}${m.unit}</div></div>
                    <div class="bar-row"><div class="bar-lbl">Now</div><div class="bar-track"><div class="bar-fill now" style="width:${(n/max)*100}%"></div></div><div style="font-size:0.6rem; color:${color}; width:35px; font-weight:800">${n}${m.unit} ${arrow}</div></div>
                </div>
            </div>`;
    });

    html += `<div style="margin-top:25px; border-top:1px solid #333; padding-top:15px;">
        <div style="font-size:0.75rem; font-weight:800; color:#fff; text-transform:uppercase; margin-bottom:10px;">PROGRESS LOG</div>
        <table class="hist-table">
            <thead><tr><th>DATE</th><th>WEIGHT</th><th>BF%</th><th>MUSCLE</th></tr></thead>
            <tbody>`;
    
    if(u.log && u.log.length > 0) {
        u.log.forEach(entry => {
            html += `<tr class="hist-row">
                <td style="color:var(--gold)">${entry.d}</td>
                <td>${entry.w}</td>
                <td>${entry.bf}%</td>
                <td>${entry.m}</td>
            </tr>`;
        });
    } else {
        html += `<tr><td colspan="4" style="text-align:center; padding:10px; color:#666;">No history recorded yet.</td></tr>`;
    }
    
    html += `</tbody></table></div>`;

    modalBody.innerHTML = html;
    document.getElementById('mTip').innerText = `BMR: ${u.now.bmr} kcal/day | Efficiency: High`;
    document.getElementById('masterModal').style.display = 'block';
}

function closeM(){ document.getElementById('masterModal').style.display='none' }
window.onload=render;
</script>
</body>
</html>