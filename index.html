<!DOCTYPE html>
<html lang="en">
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width,initial-scale=1.0,maximum-scale=1.0,user-scalable=no">
<title>Centurion v17.69</title>
<style>
:root{--bg:#050505;--panel:#121212;--border:#222;--acid:#ccff00;--cyan:#00f0ff;--purple:#bf5af2;--alert:#ff453a;--text:#fff}
*{box-sizing:border-box;margin:0;padding:0}
body{background:var(--bg);color:var(--text);font-family:-apple-system,BlinkMacSystemFont,"Segoe UI",Roboto,sans-serif;padding-bottom:120px;-webkit-tap-highlight-color:transparent}
.header{background:rgba(10,10,10,0.95);padding:15px;border-bottom:1px solid #333;position:sticky;top:0;z-index:100;backdrop-filter:blur(10px)}
.user-switch{display:flex;gap:8px;background:#1a1a1a;padding:4px;border-radius:24px;margin-bottom:10px;border:1px solid #333;width:100%}
.user-switch button{flex:1;padding:10px;border:none;background:transparent;color:#666;border-radius:20px;cursor:pointer;font-weight:800;font-size:0.75rem;transition:all 0.2s}
.user-switch button.active{background:var(--acid);color:#000;box-shadow:0 0 15px rgba(204,255,0,0.3)}
.date-nav{display:flex;justify-content:space-between;align-items:center;margin-top:10px;background:#000;border:1px solid #333;border-radius:10px;padding:6px}
.nav-btn{background:transparent;border:none;color:var(--cyan);padding:5px 20px;font-size:1.2rem;cursor:pointer}
#dateLabel{color:#fff;font-weight:700;font-size:0.9rem;font-family:monospace}
.bio-btn{position:absolute;right:15px;top:15px;background:rgba(255,255,255,0.1);color:var(--acid);border:1px solid var(--acid);padding:6px 12px;border-radius:6px;font-size:0.6rem;font-weight:900;cursor:pointer}
.hero{padding:25px 15px;display:flex;gap:15px;align-items:center}
.dual-score{display:flex;gap:15px}
.score-box{border:2px solid #333;border-radius:50%;display:flex;flex-direction:column;align-items:center;justify-content:center;background:#000;width:90px;height:90px}
.score-box.small{width:70px;height:70px}
.score-val{font-size:2.2rem;font-weight:900;color:var(--acid);line-height:1}
.score-box.small .score-val{font-size:1.4rem;color:#fff}
.score-label{font-size:0.45rem;color:#666;text-transform:uppercase;margin-top:4px;font-weight:800}
.section-header{padding:15px;font-size:0.65rem;font-weight:900;color:#888;letter-spacing:1.5px;text-transform:uppercase;margin-top:10px;border-bottom:1px solid #222}
.grid-3{display:grid;grid-template-columns:1fr 1fr 1fr;gap:10px;padding:0 15px;margin-bottom:20px}
.grid-4{display:grid;grid-template-columns:1fr 1fr 1fr 1fr;gap:8px;padding:0 15px;margin-bottom:20px}
.orb-card{background:#111;border:1px solid #222;border-radius:14px;padding:15px 5px;display:flex;flex-direction:column;align-items:center}
.orb-container{width:55px;height:55px;position:relative;margin-bottom:8px}
.orb-svg{transform:rotate(-90deg);width:100%;height:100%;position:absolute;top:0;left:0}
.orb-bg{fill:none;stroke:#222;stroke-width:5}
.orb-fg{fill:none;stroke-width:5;stroke-dasharray:145;stroke-dashoffset:145;transition:stroke-dashoffset 1s ease}
.orb-val-box{position:absolute;top:50%;left:50%;transform:translate(-50%,-50%);text-align:center;width:100%}
.orb-val{font-family:monospace;font-size:0.7rem;font-weight:900;color:#fff}
.orb-label{font-size:0.45rem;font-weight:800;color:#666}
.task{display:flex;gap:12px;margin-bottom:15px;padding:0 15px}
.task-time{width:45px;color:#666;font-size:0.7rem;padding-top:15px;text-align:right;font-family:monospace}
.task-card{flex:1;background:#111;border:1px solid #333;border-radius:12px;padding:15px;position:relative;display:flex;justify-content:space-between;align-items:center;transition:all 0.2s}
.task-card.checked{border-color:var(--acid);background:rgba(204,255,0,0.05)}
.task-card.recovery{border-color:var(--cyan);background:rgba(0,240,255,0.05)}
.task-card:active{transform:scale(0.98)}
.task-title{font-weight:900;font-size:0.85rem;color:#fff;margin-bottom:4px}
.task-desc{font-size:0.7rem;color:#888}
.check-btn{width:30px;height:30px;border:2px solid #444;border-radius:50%;display:flex;align-items:center;justify-content:center}
.task-card.checked .check-btn{background:var(--acid);border-color:var(--acid);color:#000;font-weight:900}
.modal-overlay{position:fixed;top:0;left:0;width:100%;height:100%;background:rgba(0,0,0,0.95);z-index:500;display:none;backdrop-filter:blur(5px)}
.modal-overlay.show{display:block}
.modal-content{padding:20px;padding-bottom:100px;overflow-y:auto;height:100vh}
.menu-item{padding:15px;border-bottom:1px solid #222;display:flex;justify-content:space-between;align-items:center}
.menu-name{font-weight:900;color:#fff;margin-bottom:5px}
.menu-meta{font-size:0.7rem;color:#888;font-family:monospace}
.footer{position:fixed;bottom:0;left:0;width:100%;background:#000;padding:15px;border-top:1px solid #333;display:flex;justify-content:space-between;align-items:center;z-index:90}
.sync-btn{background:var(--acid);color:#000;border:none;padding:8px 16px;border-radius:6px;font-weight:900;font-size:0.7rem}
</style>
</head>
<body>

<div class="header">
    <div class="user-switch">
        <button id="btn-jermaine" class="active" onclick="app.switchUser('jermaine')">JERMAINE</button>
        <button id="btn-sophia" onclick="app.switchUser('sophia')">SOPHIA</button>
    </div>
    <div class="date-nav">
        <button class="nav-btn" onclick="app.changeDate(-1)">â—€</button>
        <span id="dateLabel">LOADING</span>
        <button class="nav-btn" onclick="app.changeDate(1)">â–¶</button>
    </div>
    <button class="bio-btn" onclick="app.openBio()">BIO</button>
</div>

<div class="hero">
    <div class="dual-score">
        <div class="score-box small"><div class="score-val" id="dayGrade" style="font-size:1.4rem;color:#fff">--</div><div class="score-label">TODAY</div></div>
        <div class="score-box primary"><div class="score-val" id="longevityScore">--</div><div class="score-label">LONGEVITY</div></div>
    </div>
    <div style="font-size:0.7rem;color:#666;font-weight:900;margin-left:auto" id="statusMsg">READY</div>
</div>

<div class="section-header">METRICS</div>
<div class="grid-4">
    <div class="orb-card"><div class="orb-container"><svg class="orb-svg" viewBox="0 0 50 50"><circle class="orb-bg" cx="25" cy="25" r="21"></circle><circle class="orb-fg" id="sleepOrb" cx="25" cy="25" r="21" style="stroke:#bf5af2"></circle></svg><div class="orb-val-box"><div class="orb-val" id="sleepVal">0</div></div></div><div class="orb-label">SLEEP</div></div>
    <div class="orb-card"><div class="orb-container"><svg class="orb-svg" viewBox="0 0 50 50"><circle class="orb-bg" cx="25" cy="25" r="21"></circle><circle class="orb-fg" id="proteinOrb" cx="25" cy="25" r="21" style="stroke:#fff"></circle></svg><div class="orb-val-box"><div class="orb-val" id="proteinVal">0</div></div></div><div class="orb-label">PROTEIN</div></div>
    <div class="orb-card"><div class="orb-container"><svg class="orb-svg" viewBox="0 0 50 50"><circle class="orb-bg" cx="25" cy="25" r="21"></circle><circle class="orb-fg" id="rhrOrb" cx="25" cy="25" r="21" style="stroke:#ff453a"></circle></svg><div class="orb-val-box"><div class="orb-val" id="rhrVal">0</div></div></div><div class="orb-label">RHR</div></div>
    <div class="orb-card"><div class="orb-container"><svg class="orb-svg" viewBox="0 0 50 50"><circle class="orb-bg" cx="25" cy="25" r="21"></circle><circle class="orb-fg" id="calOrb" cx="25" cy="25" r="21" style="stroke:#FFD60A"></circle></svg><div class="orb-val-box"><div class="orb-val" id="calVal">0</div></div></div><div class="orb-label">BURN</div></div>
</div>

<div class="section-header">PROTOCOL TIMELINE</div>
<div class="timeline" id="timeline"></div>

<div class="modal-overlay" id="mainModal">
    <div class="modal-content">
        <div style="display:flex;justify-content:space-between;align-items:center;margin-bottom:20px;border-bottom:1px solid #333;padding-bottom:15px">
            <div class="modal-title" id="modalTitle" style="font-weight:900;font-size:1.2rem;color:#fff">TITLE</div>
            <button onclick="app.closeModal()" style="background:none;border:none;color:#fff;font-size:2rem">Ã—</button>
        </div>
        <div id="modalBody"></div>
    </div>
</div>

<div class="footer">
    <span class="sync-status" id="syncStatus">v17.69</span>
    <button class="sync-btn" onclick="app.sync()">ðŸ”„ SYNC OURA</button>
</div>

<script>
const DB={
    breakfast:[
        {title:"Greek Yogurt & Berries",macros:{p:20,o:0,f:4,cal:250},why:"Probiotics + Antioxidants"},
        {title:"Smoked Salmon Toast",macros:{p:28,o:2500,f:8,cal:450},why:"Omega-3 Stack"},
        {title:"Omega Breakfast",macros:{p:58,o:3500,f:12,cal:680},why:"High Protein Start"},
        {title:"Sea Moss Oatmeal",macros:{p:48,o:8200,f:18,cal:580},why:"Thyroid Support"},
        {title:"Mackerel Scramble",macros:{p:56,o:4800,f:10,cal:660},why:"Max Omega-3"},
        {title:"Protein Pancakes",macros:{p:52,o:6400,f:14,cal:620},why:"Anabolic Breakfast"}
    ],
    lunch:[
        {title:"Salmon & Quinoa Bowl",macros:{p:48,o:3000,f:14,cal:780},why:"Fiber + Omega-3 Powerhouse"},
        {title:"Bison Burger",macros:{p:42,o:400,f:8,cal:550},why:"Heme Iron + Lower Inflammation"},
        {title:"Turkey Club Wrap",macros:{p:38,o:400,f:6,cal:540},why:"Lean Protein Standard"},
        {title:"Salmon Poke Bowl",macros:{p:45,o:2800,f:8,cal:580},why:"Raw Enzymes"},
        {title:"Shrimp Tacos",macros:{p:35,o:400,f:6,cal:420},why:"Astaxanthin Source"},
        {title:"Smoked Mackerel Salad",macros:{p:35,o:4500,f:8,cal:520},why:"Highest Omega-3 Lunch"},
        {title:"Chipotle Bowl (Bison)",macros:{p:58,o:2800,f:20,cal:740},why:"Massive Fiber Load"},
        {title:"Bean & Cheese Burrito",macros:{p:22,o:200,f:14,cal:580},why:"Gut Health Fiber"},
        {title:"Leftover Chicken Salad",macros:{p:40,o:600,f:8,cal:520},why:"Quick & Bioavailable"}
    ],
    dinner:[
        {title:"Bone Broth Pho",macros:{p:40,o:600,f:4,cal:450},why:"Collagen & Gut Repair"},
        {title:"Grass-Fed Steak",macros:{p:60,o:1200,f:14,cal:720},why:"CLA & Creatine"},
        {title:"Whole Branzino",macros:{p:52,o:2800,f:12,cal:580},why:"Glycine from Skin/Bones"},
        {title:"Turkey Chili",macros:{p:35,o:400,f:15,cal:500},why:"High Fiber Comfort"},
        {title:"Beef Bolognese",macros:{p:40,o:500,f:10,cal:550},why:"Iron Rich"},
        {title:"Seared Tuna",macros:{p:50,o:1500,f:2,cal:400},why:"Selenium Boost"},
        {title:"Lamb Kofta",macros:{p:40,o:900,f:10,cal:680},why:"Zinc for Testosterone"},
        {title:"Healthy Beef Stew",macros:{p:38,o:400,f:8,cal:520},why:"Nutrient Density"},
        {title:"Herb Crusted Cod",macros:{p:52,o:2800,f:10,cal:580},why:"Leanest Protein"}
    ],
    snack:[
        {title:"Hard Boiled Eggs",macros:{p:12,cal:140},why:"Choline"},
        {title:"Bone Broth Cup",macros:{p:10,cal:45},why:"Collagen"},
        {title:"Beef Jerky",macros:{p:12,cal:80},why:"Protein"},
        {title:"Protein Balls",macros:{p:12,cal:220},why:"Energy"}
    ],
    juices:[
        {title:"Red Pipe Clearer",why:"Beets = Nitric Oxide"},
        {title:"Green Soother",why:"Turmeric = Anti-Inflammatory"},
        {title:"Gold Elixir",why:"Sea Moss = Minerals"}
    ]
};

const PROTOCOLS = {
    microcurrent: {title:"âš¡ MICROCURRENT", steps:["1. CLEANSE oil-free","2. GEL thick layer","3. GLIDE jaw to ear","4. LIFT cheek to temple","5. HOLD brows up","6. 3-5 mins per side"]},
    microneedling: {title:"ðŸ“ MICRONEEDLING", steps:["1. SANITIZE device","2. DOUBLE CLEANSE","3. SERUM (HA Only)","4. CROSS HATCH pattern","5. 0.5mm forehead / 1.0mm cheek","6. NO actives 24hrs"]},
    cupping: {title:"ðŸ”µ BACK CUPPING", steps:["1. OIL back","2. PLACE cups on traps","3. SLIDE along spine muscles","4. STATIC on knots (3m max)","5. AVOID spine bone","6. DRINK water"]},
    normatec: {title:"ðŸ¦µ NORMATEC", steps:["1. LEGS attachment","2. LEVEL 7 (Flush) or 5 (Relax)","3. 30-45 Minutes","4. ZONE BOOST quads if sore"]},
    inshape: {title:"ðŸŠ INSHAPE RITUAL", steps:["1. STEAM 15m","2. SAUNA 20m","3. POOL 20m","4. AQUA BED 30m","5. COLD SHOWER"]},
    massage: {title:"ðŸ’† LYMPHATIC", steps:["1. OIL face","2. PUMP collarbone","3. SWEEP neck down","4. GLIDE chin to ear","5. DRAIN down neck"]}
};

const USERS={jermaine:{name:"Jermaine",goals:{protein:175},token:'WLIGFPFJQY73G43BY7CK7H6UJXPQ7N5Y'},sophia:{name:"Sophia",goals:{protein:130},token:'4QSDWYJJUZFHRWRH727NCK7WH4COQJF4'}};

class CenturionApp {
    constructor(){
        this.user = localStorage.getItem('c_user') || 'jermaine';
        this.data = JSON.parse(localStorage.getItem(`c_data_${this.user}`)) || {};
        this.today = new Date().toISOString().split('T')[0];
        if(!this.data[this.today]) this.data[this.today] = {checked:[], meals:{}};
        this.render();
        setTimeout(()=>this.sync(), 500);
    }
    
    switchUser(u){
        document.getElementById(`btn-${this.user}`).classList.remove('active');
        this.user = u;
        localStorage.setItem('c_user', u);
        document.getElementById(`btn-${this.user}`).classList.add('active');
        this.data = JSON.parse(localStorage.getItem(`c_data_${this.user}`)) || {};
        if(!this.data[this.today]) this.data[this.today] = {checked:[], meals:{}};
        this.render();
        this.sync();
    }

    changeDate(d){
        const curr = new Date(this.today);
        curr.setDate(curr.getDate() + d);
        this.today = curr.toISOString().split('T')[0];
        if(!this.data[this.today]) this.data[this.today] = {checked:[], meals:{}};
        this.render();
    }

    save(){
        localStorage.setItem(`c_data_${this.user}`, JSON.stringify(this.data));
        this.render();
    }

    toggle(id){
        const list = this.data[this.today].checked;
        const idx = list.indexOf(id);
        if(idx>-1) list.splice(idx,1); else list.push(id);
        this.save();
    }

    openMeal(slot){
        const mb = document.getElementById('modalBody');
        let html = '';
        MEAL_DATABASE[slot].forEach((m,i) => {
            html += `<div class="menu-item" onclick="app.setMeal('${slot}',${i})">
                <div><div class="menu-name">${m.title}</div><div class="menu-meta">P:${m.macros.p}g â€¢ ${m.why}</div></div>
                <div class="menu-arrow">â€º</div>
            </div>`;
        });
        mb.innerHTML = html;
        document.getElementById('modalTitle').innerText = slot.toUpperCase();
        document.getElementById('mainModal').classList.add('show');
    }

    setMeal(slot, idx){
        this.data[this.today].meals[slot] = idx;
        this.closeModal();
        this.save();
    }

    openProtocol(key){
        const p = PROTOCOLS[key];
        document.getElementById('modalTitle').innerText = p.title;
        document.getElementById('modalBody').innerHTML = p.steps.map(s=>`<div style="padding:15px;border-bottom:1px solid #333;color:#ccc">${s}</div>`).join('');
        document.getElementById('mainModal').classList.add('show');
    }

    closeModal(){ document.getElementById('mainModal').classList.remove('show'); }

    getFacial(){
        const d = new Date(this.today).getDay();
        const date = new Date(this.today).getDate();
        if(this.user === 'jermaine'){
            if(d===0 && date<=7) return {key:'microneedling', title:'Microneedling'};
            if(d===1||d===3||d===5) return {key:'microcurrent', title:'Microcurrent'};
            return {key:'massage', title:'Massage & Sculpt'};
        } else {
            if(d===2||d===4) return {key:'massage', title:'Recovery Facial'};
            return {key:'massage', title:'Maint. Facial'};
        }
    }

    getRecovery(){
        const d = new Date(this.today).getDay();
        if(d===0) return {key:'inshape', title:'InShape Ritual'};
        if(d===2||d===4) return {key:'cupping', title:'Back Cupping'};
        return {key:'normatec', title:'Normatec'};
    }

    async sync(){
        document.getElementById('syncStatus').innerText = 'SYNCING...';
        const token = USERS[this.user].token;
        const start = new Date(); start.setDate(start.getDate()-7);
        const sStr = start.toISOString().split('T')[0];
        const eStr = new Date().toISOString().split('T')[0];
        
        try {
            const res = await fetch(`https://corsproxy.io/?https://api.ouraring.com/v2/usercollection/sleep?start_date=${sStr}&end_date=${eStr}`, {
                headers: {'Authorization': `Bearer ${token}`}
            });
            const json = await res.json();
            if(json.data && json.data.length > 0){
                const last = json.data[json.data.length-1];
                this.updateMetrics(last);
                document.getElementById('syncStatus').innerText = 'ONLINE';
            } else {
                document.getElementById('syncStatus').innerText = 'NO DATA';
            }
        } catch(e) {
            document.getElementById('syncStatus').innerText = 'ERR';
            console.log(e);
        }
    }

    updateMetrics(d){
        const hrs = (d.total_sleep_duration/3600).toFixed(1);
        const deep = Math.round(d.deep_sleep_duration/60);
        const rem = Math.round(d.rem_sleep_duration/60);
        const score = d.score;
        
        document.getElementById('sleepVal').innerText = hrs + 'h';
        document.getElementById('sleepOrb').style.strokeDashoffset = 145 - ((d.total_sleep_duration/28800)*145);
        document.getElementById('deepVal').innerText = deep + 'm';
        document.getElementById('deepOrb').style.strokeDashoffset = 145 - ((deep/90)*145);
        document.getElementById('remVal').innerText = rem + 'm';
        document.getElementById('longevityScore').innerText = score;
    }

    render(){
        document.getElementById('dateLabel').innerText = this.today;
        const checked = this.data[this.today].checked;
        const meals = this.data[this.today].meals;
        
        // BUILD TIMELINE
        const tasks = [
            {id:'t1', time:'07:30', title:'Breakfast', slot:'breakfast'},
            {id:'t2', time:'09:00', title:'Training', auto:true},
            {id:'t3', time:'13:00', title:'Lunch', slot:'lunch'},
            {id:'t4', time:'15:30', title:'Snack', slot:'snack'},
            {id:'t5', time:'18:30', title:'Dinner', slot:'dinner'},
            {id:'t6', time:'20:00', title:this.getRecovery().title, proto:this.getRecovery().key, type:'recovery'},
            {id:'t7', time:'21:15', title:this.getFacial().title, proto:this.getFacial().key, type:'facial'}
        ];

        let html = '';
        let totalP = 0; let totalCal = 0;

        tasks.forEach(t => {
            const isDone = checked.includes(t.id);
            let subtext = t.auto ? 'Auto-Detect' : 'Tap to set';
            let click = '';
            let classes = `task-card ${isDone?'checked':''} ${t.type||''}`;

            if(t.slot && meals[t.slot] !== undefined){
                const m = MEAL_DATABASE[t.slot][meals[t.slot]];
                subtext = `${m.title} (P:${m.macros.p})`;
                totalP += m.macros.p; totalCal += m.macros.cal;
            }

            if(t.slot) click = `onclick="app.openMeal( '${t.slot}' )"`;
            if(t.proto) click = `onclick="app.openProtocol( '${t.proto}' )"`;

            html += `<div class="task">
                <div class="task-time">${t.time}</div>
                <div class="${classes}" ${click}>
                    <div class="task-info"><div class="task-title">${t.title}</div><div class="task-desc">${subtext}</div></div>
                    ${!t.auto ? `<div class="check-btn" onclick="event.stopPropagation(); app.toggle('${t.id}')">${isDone?'âœ“':''}</div>` : ''}
                </div>
            </div>`;
        });
        document.getElementById('timeline').innerHTML = html;
        document.getElementById('proteinVal').innerText = totalP;
        document.getElementById('calVal').innerText = totalCal;
    }
}

window.onload = () => { window.app = new CenturionApp(); };
</script>
</body>
</html>