<!DOCTYPE html>

<html lang="en">
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width,initial-scale=1.0,maximum-scale=1.0,user-scalable=no">
<title>Centurion v23 - Complete Oura Synergy</title>
<style>
:root{--bg:#0a0a0c;--panel:#141418;--panel-elevated:#1a1a20;--border:rgba(255,255,255,0.08);--acid:#c8ff00;--cyan:#00d4ff;--purple:#a855f7;--alert:#ff4757;--orange:#ff9500;--success:#34d399;--text:#fff;--text-secondary:rgba(255,255,255,0.6);--text-tertiary:rgba(255,255,255,0.4)}
*{box-sizing:border-box;margin:0;padding:0}
body{background:var(--bg);color:var(--text);font-family:-apple-system,BlinkMacSystemFont,sans-serif;padding-bottom:140px;min-height:100vh;-webkit-tap-highlight-color:transparent;background-image:radial-gradient(ellipse at 20% 0%,rgba(200,255,0,0.03) 0%,transparent 50%),radial-gradient(ellipse at 80% 100%,rgba(0,212,255,0.03) 0%,transparent 50%)}
.header{background:rgba(10,10,12,0.95);padding:16px 20px;border-bottom:1px solid var(--border);position:sticky;top:0;z-index:100;backdrop-filter:blur(20px)}
.user-switch{display:flex;gap:8px;background:var(--panel);padding:4px;border-radius:16px;margin-bottom:12px;border:1px solid var(--border)}
.user-switch button{flex:1;padding:10px;border:none;background:transparent;color:var(--text-tertiary);border-radius:12px;cursor:pointer;font-weight:700;font-size:0.7rem;letter-spacing:1px;transition:all 0.3s}
.user-switch button.active{background:linear-gradient(135deg,#c8ff00,#00d4ff);color:#000;box-shadow:0 4px 20px rgba(200,255,0,0.3)}
.date-nav{display:flex;justify-content:space-between;align-items:center;background:var(--panel);border:1px solid var(--border);border-radius:14px;padding:8px 12px}
.nav-btn{background:transparent;border:none;color:var(--cyan);padding:8px 16px;font-size:1.1rem;cursor:pointer}
#dateLabel{flex:1;text-align:center;font-weight:600;font-size:0.85rem}
.bio-btn{background:linear-gradient(135deg,#c8ff00,#00d4ff);color:#000;border:none;padding:10px 16px;border-radius:10px;font-size:0.65rem;font-weight:800;cursor:pointer}
.section-header{padding:20px 20px 12px;font-size:0.65rem;font-weight:700;color:var(--text-tertiary);letter-spacing:2px;text-transform:uppercase;display:flex;align-items:center;gap:12px}
.section-header::after{content:'';height:1px;background:var(--border);flex:1}
.recovery-battery{background:var(--panel);border:1px solid var(--border);border-radius:20px;padding:20px;margin:20px;position:relative;overflow:hidden}
.recovery-battery::before{content:'';position:absolute;top:0;left:0;right:0;height:3px;background:linear-gradient(90deg,#4facfe,#00f2fe)}
.battery-header{display:flex;justify-content:space-between;align-items:center;margin-bottom:16px}
.battery-title{font-size:0.7rem;font-weight:700;color:var(--text-secondary);letter-spacing:1.5px}
.battery-score{font-size:2.5rem;font-weight:800;background:linear-gradient(135deg,#4facfe,#00f2fe);-webkit-background-clip:text;-webkit-text-fill-color:transparent}
.battery-bar{height:12px;background:var(--panel-elevated);border-radius:6px;overflow:hidden;margin-bottom:12px}
.battery-fill{height:100%;background:linear-gradient(90deg,#4facfe,#00f2fe);border-radius:6px;transition:width 1s;box-shadow:0 0 20px rgba(79,172,254,0.4)}
.battery-components{display:grid;grid-template-columns:repeat(4,1fr);gap:8px}
.battery-component{text-align:center;padding:8px;background:var(--panel-elevated);border-radius:8px}
.bc-value{font-size:0.9rem;font-weight:700}
.bc-label{font-size:0.5rem;color:var(--text-tertiary);text-transform:uppercase;margin-top:2px}
.bc-trend{font-size:0.55rem;margin-top:2px}
.trend-up{color:var(--success)}
.trend-down{color:var(--alert)}
.grid-4{display:grid;grid-template-columns:repeat(4,1fr);gap:10px;padding:0 20px;margin-bottom:20px}
.grid-3{display:grid;grid-template-columns:repeat(3,1fr);gap:12px;padding:0 20px;margin-bottom:20px}
.orb-card{background:var(--panel);border:1px solid var(--border);border-radius:16px;padding:16px 8px 12px;display:flex;flex-direction:column;align-items:center;transition:transform 0.2s}
.orb-card:active{transform:scale(0.97)}
.orb-card.alert{border-color:var(--alert);background:rgba(255,71,87,0.1)}
.orb-card.warning{border-color:var(--orange);background:rgba(255,149,0,0.1)}
.orb-card.optimal{border-color:var(--success);background:rgba(52,211,153,0.1)}
.orb-container{width:52px;height:52px;position:relative;margin-bottom:8px}
.orb-svg{transform:rotate(-90deg);width:100%;height:100%;position:absolute}
.orb-bg{fill:none;stroke:var(--panel-elevated);stroke-width:5}
.orb-fg{fill:none;stroke-width:5;stroke-dasharray:138;stroke-dashoffset:138;transition:stroke-dashoffset 1s;stroke-linecap:round;filter:drop-shadow(0 0 6px currentColor)}
.orb-val-box{position:absolute;top:50%;left:50%;transform:translate(-50%,-50%);text-align:center}
.orb-val{font-size:0.75rem;font-weight:800;line-height:1}
.orb-label{font-size:0.5rem;font-weight:700;color:var(--text-secondary);text-transform:uppercase}
.hrv-card{background:linear-gradient(135deg,var(--panel) 0%,rgba(168,85,247,0.1) 100%);border-color:var(--purple)}
.hrv-wave{width:100%;height:28px;margin-bottom:8px}
.hrv-wave-path{fill:none;stroke:var(--purple);stroke-width:2;stroke-linecap:round;filter:drop-shadow(0 0 4px var(--purple))}
.temp-indicator{width:40px;height:40px;border-radius:50%;display:flex;align-items:center;justify-content:center;margin-bottom:8px;font-size:1.2rem}
.temp-normal{background:rgba(52,211,153,0.15);border:2px solid var(--success)}
.temp-elevated{background:rgba(255,149,0,0.15);border:2px solid var(--orange)}
.temp-high{background:rgba(255,71,87,0.15);border:2px solid var(--alert)}
.sleep-debt-card{background:var(--panel);border:1px solid var(--border);border-radius:14px;padding:16px;margin:0 20px 20px;display:flex;align-items:center;gap:16px}
.sleep-debt-visual{width:60px;height:60px;border-radius:50%;display:flex;align-items:center;justify-content:center;font-size:1.5rem}
.debt-positive{background:rgba(255,71,87,0.15);border:2px solid var(--alert)}
.debt-negative{background:rgba(52,211,153,0.15);border:2px solid var(--success)}
.debt-neutral{background:var(--panel-elevated);border:2px solid var(--border)}
.sleep-debt-info{flex:1}
.sleep-debt-value{font-size:1.5rem;font-weight:800}
.sleep-debt-label{font-size:0.7rem;color:var(--text-tertiary)}
.score-row{display:flex;gap:12px;justify-content:center;padding:20px}
.score-orb{flex:0 0 90px;height:90px;position:relative;display:flex;flex-direction:column;align-items:center;justify-content:center;cursor:pointer}
.score-orb svg{position:absolute;width:100%;height:100%;transform:rotate(-90deg)}
.score-orb-bg{fill:none;stroke:var(--panel-elevated);stroke-width:6}
.score-orb-fg{fill:none;stroke-width:6;stroke-linecap:round;stroke-dasharray:251;stroke-dashoffset:251;transition:stroke-dashoffset 1.5s;filter:drop-shadow(0 0 8px currentColor)}
.score-orb-value{font-size:1.6rem;font-weight:800;z-index:1}
.score-orb-label{font-size:0.45rem;color:var(--text-tertiary);text-transform:uppercase;z-index:1}
.score-orb.primary{flex:0 0 110px;height:110px}
.score-orb.primary .score-orb-value{font-size:2.2rem;background:linear-gradient(135deg,#c8ff00,#00d4ff);-webkit-background-clip:text;-webkit-text-fill-color:transparent}
.score-orb-badge{position:absolute;bottom:-6px;background:var(--panel);border:1px solid var(--border);padding:2px 6px;border-radius:8px;font-size:0.4rem;color:var(--cyan);font-weight:700}
.status-container{margin:0 20px 20px;padding:16px;background:var(--panel);border:1px solid var(--border);border-radius:14px;border-left:3px solid var(--acid)}
.status-label{font-size:0.6rem;color:var(--text-tertiary);text-transform:uppercase;letter-spacing:1px;margin-bottom:4px}
.status-msg{font-size:0.85rem;font-weight:600;line-height:1.4}
.insight-card{background:var(--panel);border:1px solid var(--border);border-radius:14px;padding:16px;margin:0 20px 16px}
.insight-card.warning{border-left:3px solid var(--orange)}
.insight-card.alert{border-left:3px solid var(--alert)}
.insight-header{display:flex;align-items:center;gap:10px;margin-bottom:8px}
.insight-icon{font-size:1.2rem}
.insight-title{font-size:0.8rem;font-weight:700}
.insight-body{font-size:0.75rem;color:var(--text-secondary);line-height:1.5}
.insight-action{margin-top:10px;padding:10px;background:rgba(200,255,0,0.1);border-radius:8px;font-size:0.7rem;color:var(--acid);font-weight:600}
.heart-container{width:52px;height:52px;position:relative;margin-bottom:8px}
.heart-svg{width:100%;height:100%}
.heart-bg{fill:none;stroke:var(--panel-elevated);stroke-width:2}
.heart-fg{fill:none;stroke-width:2.5;stroke-dasharray:100;stroke-dashoffset:100;transition:stroke-dashoffset 1s;filter:drop-shadow(0 0 4px currentColor)}
.beating{animation:heartbeat 1.5s infinite}
@keyframes heartbeat{0%,100%{transform:scale(1)}15%{transform:scale(1.08)}30%{transform:scale(1)}45%{transform:scale(1.08)}}
.water-container,.rainbow-container{padding:0 20px;margin-bottom:20px}
.water-header,.rainbow-header{display:flex;justify-content:space-between;align-items:center;margin-bottom:10px}
.water-title,.rainbow-title{font-size:0.7rem;font-weight:700;color:var(--text-secondary)}
.water-score{font-size:1rem;font-weight:800;color:var(--cyan)}
.rainbow-score{font-size:1rem;font-weight:800;color:var(--acid)}
.water-track{height:12px;background:var(--panel);border-radius:6px;overflow:hidden;border:1px solid var(--border);cursor:pointer}
.water-fill{height:100%;background:linear-gradient(90deg,#00d4ff,#0088ff);border-radius:6px;transition:width 0.3s}
.rainbow-track{height:12px;background:var(--panel);border-radius:6px;display:flex;overflow:hidden;border:1px solid var(--border)}
.rainbow-seg{height:100%;transition:width 0.5s}
.timeline{padding:0 20px 40px}
.task{display:flex;gap:12px;margin-bottom:14px}
.task-time{width:50px;color:var(--text-tertiary);font-size:0.7rem;padding-top:16px;text-align:right;font-weight:600}
.task-card{flex:1;background:var(--panel);border:1px solid var(--border);border-radius:14px;padding:16px;display:flex;justify-content:space-between;align-items:center;transition:all 0.2s}
.task-card:active{transform:scale(0.98)}
.task-card.checked{border-color:var(--acid);background:rgba(200,255,0,0.05)}
.task-card.auto-detected{border-color:var(--cyan);background:rgba(0,212,255,0.05)}
.task-card.hrv-adjusted{border-color:var(--orange);background:rgba(255,149,0,0.05)}
.task-card.recovery{border-color:var(--purple);background:rgba(168,85,247,0.05)}
.task-card.facial{border-color:var(--cyan);background:rgba(0,212,255,0.08)}
.task-card.optional{border-style:dashed;border-color:#444;opacity:0.7}
.task-info{flex:1}
.task-title{font-weight:700;font-size:0.85rem;margin-bottom:4px}
.task-desc{font-size:0.7rem;color:var(--text-secondary)}
.chevron{font-size:1.3rem;color:var(--text-tertiary);margin-left:12px}
.check-btn{width:40px;height:40px;display:flex;align-items:center;justify-content:center;cursor:pointer}
.check-circle{width:28px;height:28px;border:2px solid var(--border);border-radius:50%;background:var(--panel-elevated);display:flex;align-items:center;justify-content:center;font-weight:800;color:transparent;transition:all 0.2s}
.task-card.checked .check-circle{background:var(--acid);border-color:var(--acid);color:#000;box-shadow:0 0 15px var(--acid)}
.modal-overlay{position:fixed;top:0;left:0;width:100%;height:100%;background:rgba(0,0,0,0.95);z-index:500;display:none;overflow-y:auto;backdrop-filter:blur(10px)}
.modal-overlay.show{display:block}
.modal-content{width:100%;min-height:100vh;background:var(--bg);padding-bottom:100px}
.modal-header{padding:20px;border-bottom:1px solid var(--border);display:flex;justify-content:space-between;align-items:center;position:sticky;top:0;background:rgba(10,10,12,0.95);backdrop-filter:blur(20px);z-index:10}
.modal-title{font-size:1rem;font-weight:800;color:var(--acid);text-transform:uppercase;letter-spacing:1px}
.modal-close{background:transparent;border:none;color:var(--text);font-size:2rem;cursor:pointer;padding:8px}
.modal-body{padding:20px}
.menu-item{padding:18px;background:var(--panel);border:1px solid var(--border);border-radius:12px;margin-bottom:8px;cursor:pointer;display:flex;justify-content:space-between;align-items:center}
.menu-item:active{background:var(--panel-elevated)}
.menu-name{font-size:0.95rem;font-weight:700;margin-bottom:4px}
.menu-meta{font-size:0.7rem;color:var(--text-secondary)}
.menu-arrow{color:var(--text-tertiary);font-size:1.3rem}
.recipe-hero{margin-bottom:25px;text-align:center}
.recipe-title{font-size:1.6rem;font-weight:900;line-height:1.2;margin-bottom:8px}
.recipe-stats{font-size:0.85rem;color:var(--text-secondary);font-weight:700}
.macro-grid{display:grid;grid-template-columns:repeat(4,1fr);gap:10px;margin-bottom:25px}
.macro-stat{background:var(--panel);border:1px solid var(--border);padding:12px 5px;border-radius:10px;text-align:center}
.m-val{font-size:1.1rem;font-weight:900;line-height:1}
.m-lbl{font-size:0.5rem;color:var(--acid);text-transform:uppercase;margin-top:6px;font-weight:900}
.synergy-box{background:linear-gradient(135deg,rgba(0,212,255,0.08) 0%,rgba(0,0,0,0) 100%);border:1px solid rgba(0,212,255,0.3);padding:20px;border-radius:12px;margin-bottom:25px}
.syn-title{color:var(--cyan);font-weight:900;font-size:0.75rem;text-transform:uppercase;margin-bottom:10px}
.syn-text{color:#ccc;font-size:0.95rem;font-style:italic;line-height:1.6}
.ing-item{color:#ccc;font-size:0.9rem;border-bottom:1px solid var(--border);padding:12px 0;display:flex;align-items:center}
.ing-item::before{content:'‚Ä¢';color:var(--acid);font-weight:bold;margin-right:12px;font-size:1.3rem}
.step-item{display:flex;gap:15px;font-size:0.9rem;color:#ddd;line-height:1.6;margin-bottom:15px;background:var(--panel);padding:15px;border-radius:10px;border:1px solid var(--border)}
.footer{position:fixed;bottom:0;left:0;width:100%;background:rgba(10,10,12,0.95);backdrop-filter:blur(20px);padding:14px 20px;border-top:1px solid var(--border);display:flex;justify-content:space-between;align-items:center;z-index:90}
.sync-status{font-size:0.65rem;color:var(--text-tertiary)}
.sync-btn{background:linear-gradient(135deg,#c8ff00,#00d4ff);color:#000;border:none;padding:10px 20px;border-radius:10px;font-weight:700;font-size:0.75rem;cursor:pointer}
</style>
</head>
<body>

<div class="header">
<div class="user-switch">
<button id="btn-jermaine" onclick="app.switchUser('jermaine')">JERMAINE</button>
<button id="btn-sophia" onclick="app.switchUser('sophia')">SOPHIA</button>
</div>
<div class="date-nav">
<button class="nav-btn" onclick="app.changeDate(-1)">‚óÄ</button>
<span id="dateLabel">LOADING...</span>
<button class="nav-btn" onclick="app.changeDate(1)">‚ñ∂</button>
<button class="bio-btn" onclick="app.openBio()">BIO</button>
</div>
</div>

<!-- v22 RECOVERY BATTERY -->

<div class="recovery-battery">
<div class="battery-header">
<div class="battery-title">‚ö° RECOVERY BATTERY</div>
<div class="battery-score" id="batteryScore">--</div>
</div>
<div class="battery-bar"><div class="battery-fill" id="batteryFill" style="width:0%"></div></div>
<div class="battery-components">
<div class="battery-component"><div class="bc-value" id="bcHrv">--</div><div class="bc-label">HRV</div><div class="bc-trend" id="bcHrvTrend"></div></div>
<div class="battery-component"><div class="bc-value" id="bcSleep">--</div><div class="bc-label">SLEEP</div><div class="bc-trend" id="bcSleepTrend"></div></div>
<div class="battery-component"><div class="bc-value" id="bcReadiness">--</div><div class="bc-label">READY</div><div class="bc-trend" id="bcReadinessTrend"></div></div>
<div class="battery-component"><div class="bc-value" id="bcStrain">--</div><div class="bc-label">STRAIN</div><div class="bc-trend" id="bcStrainTrend"></div></div>
</div>
</div>

<div class="score-row">
<div class="score-orb" onclick="app.showWeeklySummary()">
<svg viewBox="0 0 100 100"><circle class="score-orb-bg" cx="50" cy="50" r="40"/><circle class="score-orb-fg" id="dayScoreOrb" cx="50" cy="50" r="40" style="stroke:var(--cyan)"/></svg>
<div class="score-orb-value" id="dayGrade">--</div>
<div class="score-orb-label">TODAY</div>
</div>
<div class="score-orb primary" onclick="app.showWeeklySummary()">
<svg viewBox="0 0 100 100"><circle class="score-orb-bg" cx="50" cy="50" r="40"/><circle class="score-orb-fg" id="longevityOrb" cx="50" cy="50" r="40" style="stroke:var(--acid)"/></svg>
<div class="score-orb-value" id="longevityScore">--</div>
<div class="score-orb-label">LONGEVITY</div>
<div class="score-orb-badge">7-DAY AVG</div>
</div>
<div class="score-orb">
<svg viewBox="0 0 100 100"><circle class="score-orb-bg" cx="50" cy="50" r="40"/><circle class="score-orb-fg" id="streakOrb" cx="50" cy="50" r="40" style="stroke:var(--acid)"/></svg>
<div class="score-orb-value" id="streakCount" style="color:var(--acid)">0</div>
<div class="score-orb-label">STREAK</div>
</div>
</div>

<div class="status-container">
<div class="status-label">üß† AI PROTOCOL ADVISOR</div>
<div class="status-msg" id="statusMsg">ANALYZING...</div>
</div>

<div id="insightContainer"></div>

<!-- v22 RECOVERY METRICS -->

<div class="section-header">RECOVERY METRICS</div>
<div class="grid-4">
<div class="orb-card hrv-card" id="hrvCard">
<svg class="hrv-wave" viewBox="0 0 100 28"><path class="hrv-wave-path" d="M0,14 Q12,4 25,14 T50,14 T75,14 T100,14"/></svg>
<div class="orb-val" id="hrvVal" style="font-size:1.1rem;color:var(--purple)">--</div>
<div class="orb-label" style="color:var(--purple)">HRV (ms)</div>
</div>
<div class="orb-card" id="tempCard">
<div class="temp-indicator temp-normal" id="tempIndicator">üå°Ô∏è</div>
<div class="orb-val" id="tempVal" style="font-size:0.9rem">+0.0¬∞</div>
<div class="orb-label">TEMP DEV</div>
</div>
<div class="orb-card">
<svg class="hrv-wave" viewBox="0 0 100 28" style="opacity:0.6"><path style="fill:none;stroke:var(--cyan);stroke-width:2" d="M0,14 Q25,0 50,14 T100,14"/></svg>
<div class="orb-val" id="respVal" style="font-size:1.1rem;color:var(--cyan)">--</div>
<div class="orb-label" style="color:var(--cyan)">RESP/MIN</div>
</div>
<div class="orb-card">
<div class="orb-container">
<svg class="orb-svg" viewBox="0 0 50 50"><circle class="orb-bg" cx="25" cy="25" r="22"/><circle class="orb-fg" id="readinessOrb" cx="25" cy="25" r="22" style="stroke:var(--success)"/></svg>
<div class="orb-val-box"><div class="orb-val" id="readinessVal">--</div></div>
</div>
<div class="orb-label" style="color:var(--success)">READINESS</div>
</div>
</div>

<!-- v22 SLEEP DEBT -->

<div class="section-header">SLEEP BANK</div>
<div class="sleep-debt-card">
<div class="sleep-debt-visual debt-neutral" id="sleepDebtVisual">üí§</div>
<div class="sleep-debt-info">
<div class="sleep-debt-value" id="sleepDebtValue">0h</div>
<div class="sleep-debt-label">7-DAY SLEEP BALANCE</div>
</div>
</div>

<div class="section-header">SLEEP ARCHITECTURE</div>
<div class="grid-3">
<div class="orb-card"><div class="orb-container"><svg class="orb-svg" viewBox="0 0 50 50"><circle class="orb-bg" cx="25" cy="25" r="22"/><circle class="orb-fg" id="sleepOrb" cx="25" cy="25" r="22" style="stroke:var(--purple)"/></svg><div class="orb-val-box"><div class="orb-val" id="sleepVal">--</div></div></div><div class="orb-label" style="color:var(--purple)">TOTAL</div></div>
<div class="orb-card"><div class="orb-container"><svg class="orb-svg" viewBox="0 0 50 50"><circle class="orb-bg" cx="25" cy="25" r="22"/><circle class="orb-fg" id="deepOrb" cx="25" cy="25" r="22" style="stroke:#667eea"/></svg><div class="orb-val-box"><div class="orb-val" id="deepVal">--</div></div></div><div class="orb-label" style="color:#667eea">DEEP</div></div>
<div class="orb-card"><div class="orb-container"><svg class="orb-svg" viewBox="0 0 50 50"><circle class="orb-bg" cx="25" cy="25" r="22"/><circle class="orb-fg" id="remOrb" cx="25" cy="25" r="22" style="stroke:#f093fb"/></svg><div class="orb-val-box"><div class="orb-val" id="remVal">--</div></div></div><div class="orb-label" style="color:#f093fb">REM</div></div>
</div>

<div class="section-header">FUEL (NUTRITION)</div>
<div class="grid-4">
<div class="orb-card"><div class="orb-container"><svg class="orb-svg" viewBox="0 0 50 50"><circle class="orb-bg" cx="25" cy="25" r="22"/><circle class="orb-fg" id="proteinOrb" cx="25" cy="25" r="22" style="stroke:#fff"/></svg><div class="orb-val-box"><div class="orb-val" id="proteinVal">0</div></div></div><div class="orb-label">PROTEIN</div></div>
<div class="orb-card"><div class="orb-container"><svg class="orb-svg" viewBox="0 0 50 50"><circle class="orb-bg" cx="25" cy="25" r="22"/><circle class="orb-fg" id="omega3Orb" cx="25" cy="25" r="22" style="stroke:var(--cyan)"/></svg><div class="orb-val-box"><div class="orb-val" id="omega3Val">0</div></div></div><div class="orb-label" style="color:var(--cyan)">OMEGA-3</div></div>
<div class="orb-card"><div class="orb-container"><svg class="orb-svg" viewBox="0 0 50 50"><circle class="orb-bg" cx="25" cy="25" r="22"/><circle class="orb-fg" id="fiberOrb" cx="25" cy="25" r="22" style="stroke:var(--success)"/></svg><div class="orb-val-box"><div class="orb-val" id="fiberVal">0</div></div></div><div class="orb-label" style="color:var(--success)">FIBER</div></div>
<div class="orb-card"><div class="orb-container"><svg class="orb-svg" viewBox="0 0 50 50"><circle class="orb-bg" cx="25" cy="25" r="22"/><circle class="orb-fg" id="polyphenolOrb" cx="25" cy="25" r="22" style="stroke:var(--purple)"/></svg><div class="orb-val-box"><div class="orb-val" id="polyphenolVal">0</div></div></div><div class="orb-label" style="color:var(--purple)">POLYPHENOL</div></div>
</div>

<!-- v21 METABOLISM -->

<div class="section-header">METABOLISM (BALANCE)</div>
<div class="grid-4">
<div class="orb-card"><div class="orb-container"><svg class="orb-svg" viewBox="0 0 50 50"><circle class="orb-bg" cx="25" cy="25" r="22"/><circle class="orb-fg" id="balanceOrb" cx="25" cy="25" r="22" style="stroke:var(--success)"/></svg><div class="orb-val-box"><div class="orb-val" id="balanceVal">--</div></div></div><div class="orb-label" style="color:var(--success)" id="balanceLabel">BALANCE</div></div>
<div class="orb-card"><div style="text-align:center"><div style="font-size:0.5rem;color:var(--text-tertiary);margin-bottom:4px">EATEN</div><div style="font-size:1.2rem;font-weight:900;color:var(--success)" id="eatenVal">0</div></div><div class="orb-label" style="color:var(--success)">CALORIES</div></div>
<div class="orb-card"><div style="text-align:center"><div style="font-size:0.5rem;color:var(--text-tertiary);margin-bottom:4px">BURNED</div><div style="font-size:1.2rem;font-weight:900;color:var(--alert)" id="burnedVal">0</div></div><div class="orb-label" style="color:var(--alert)">TOTAL</div></div>
<div class="orb-card"><div style="text-align:center"><div style="font-size:0.5rem;color:var(--text-tertiary);margin-bottom:4px">BMR</div><div style="font-size:1.2rem;font-weight:900;color:var(--orange)" id="bmrVal">2000</div></div><div class="orb-label" style="color:var(--orange)">BASE</div></div>
</div>

<!-- v21 VASCULAR -->

<div class="section-header">VASCULAR (AGING)</div>
<div class="grid-4">
<div class="orb-card"><div style="text-align:center"><div style="font-size:0.5rem;color:var(--text-tertiary);margin-bottom:4px">VASCULAR</div><div style="font-size:1.4rem;font-weight:900;color:var(--alert)" id="vascularAge">--</div></div><div class="orb-label" style="color:var(--alert)">AGE</div></div>
<div class="orb-card"><div style="text-align:center"><div style="font-size:0.5rem;color:var(--text-tertiary);margin-bottom:4px">ACTUAL</div><div style="font-size:1.4rem;font-weight:900;color:var(--cyan)" id="actualAge">43</div></div><div class="orb-label" style="color:var(--cyan)">AGE</div></div>
<div class="orb-card"><div style="text-align:center"><div style="font-size:0.5rem;color:var(--text-tertiary);margin-bottom:4px">DIFFERENCE</div><div style="font-size:1.4rem;font-weight:900;color:var(--success)" id="ageDiff">--</div></div><div class="orb-label" style="color:var(--success)" id="ageDiffLabel">YOUNGER</div></div>
<div class="orb-card"><div style="text-align:center"><div style="font-size:0.5rem;color:var(--text-tertiary);margin-bottom:4px">TREND</div><div style="font-size:1.4rem;font-weight:900;color:var(--orange)" id="vascularTrend">--</div></div><div class="orb-label" style="color:var(--orange)">7-DAY</div></div>
</div>

<div class="section-header">ENGINE (CARDIO)</div>
<div class="grid-4">
<div class="orb-card"><div class="heart-container"><svg class="heart-svg beating" viewBox="0 0 24 24"><path class="heart-bg" d="M12 21.35l-1.45-1.32C5.4 15.36 2 12.28 2 8.5 2 5.42 4.42 3 7.5 3c1.74 0 3.41.81 4.5 2.09C13.09 3.81 14.76 3 16.5 3 19.58 3 22 5.42 22 8.5c0 3.78-3.4 6.86-8.55 11.54L12 21.35z"/><path class="heart-fg" style="stroke:var(--alert);stroke-dasharray:none;stroke-dashoffset:0" d="M12 21.35l-1.45-1.32C5.4 15.36 2 12.28 2 8.5 2 5.42 4.42 3 7.5 3c1.74 0 3.41.81 4.5 2.09C13.09 3.81 14.76 3 16.5 3 19.58 3 22 5.42 22 8.5c0 3.78-3.4 6.86-8.55 11.54L12 21.35z"/></svg><div class="orb-val-box"><div class="orb-val" id="rhrVal" style="color:var(--alert)">--</div></div></div><div class="orb-label" style="color:var(--alert)">RHR</div></div>
<div class="orb-card"><div class="heart-container"><svg class="heart-svg" viewBox="0 0 24 24"><path class="heart-bg" d="M12 21.35l-1.45-1.32C5.4 15.36 2 12.28 2 8.5 2 5.42 4.42 3 7.5 3c1.74 0 3.41.81 4.5 2.09C13.09 3.81 14.76 3 16.5 3 19.58 3 22 5.42 22 8.5c0 3.78-3.4 6.86-8.55 11.54L12 21.35z"/><path class="heart-fg" id="z2Heart" pathLength="100" style="stroke:var(--cyan)" d="M12 21.35l-1.45-1.32C5.4 15.36 2 12.28 2 8.5 2 5.42 4.42 3 7.5 3c1.74 0 3.41.81 4.5 2.09C13.09 3.81 14.76 3 16.5 3 19.58 3 22 5.42 22 8.5c0 3.78-3.4 6.86-8.55 11.54L12 21.35z"/></svg><div class="orb-val-box"><div class="orb-val" id="z2Val" style="color:var(--cyan)">0</div></div></div><div class="orb-label" style="color:var(--cyan)">ZONE 2</div></div>
<div class="orb-card" id="z5Card"><div class="heart-container"><svg class="heart-svg" viewBox="0 0 24 24"><path class="heart-bg" d="M12 21.35l-1.45-1.32C5.4 15.36 2 12.28 2 8.5 2 5.42 4.42 3 7.5 3c1.74 0 3.41.81 4.5 2.09C13.09 3.81 14.76 3 16.5 3 19.58 3 22 5.42 22 8.5c0 3.78-3.4 6.86-8.55 11.54L12 21.35z"/><path class="heart-fg" id="z5Heart" pathLength="100" style="stroke:var(--alert)" d="M12 21.35l-1.45-1.32C5.4 15.36 2 12.28 2 8.5 2 5.42 4.42 3 7.5 3c1.74 0 3.41.81 4.5 2.09C13.09 3.81 14.76 3 16.5 3 19.58 3 22 5.42 22 8.5c0 3.78-3.4 6.86-8.55 11.54L12 21.35z"/></svg><div class="orb-val-box"><div class="orb-val" id="z5Val" style="color:var(--alert)">0</div></div></div><div class="orb-label" style="color:var(--alert)" id="z5Label">ZONE 5</div></div>
<div class="orb-card"><div class="heart-container"><svg class="heart-svg" viewBox="0 0 24 24"><path class="heart-bg" d="M12 21.35l-1.45-1.32C5.4 15.36 2 12.28 2 8.5 2 5.42 4.42 3 7.5 3c1.74 0 3.41.81 4.5 2.09C13.09 3.81 14.76 3 16.5 3 19.58 3 22 5.42 22 8.5c0 3.78-3.4 6.86-8.55 11.54L12 21.35z"/><path class="heart-fg" id="calHeart" pathLength="100" style="stroke:var(--orange)" d="M12 21.35l-1.45-1.32C5.4 15.36 2 12.28 2 8.5 2 5.42 4.42 3 7.5 3c1.74 0 3.41.81 4.5 2.09C13.09 3.81 14.76 3 16.5 3 19.58 3 22 5.42 22 8.5c0 3.78-3.4 6.86-8.55 11.54L12 21.35z"/></svg><div class="orb-val-box"><div class="orb-val" id="calVal" style="color:var(--orange)">0</div></div></div><div class="orb-label" style="color:var(--orange)">BURN</div></div>
</div>

<div class="section-header">HYDRATION üíß</div>
<div class="water-container">
<div class="water-header"><div class="water-title">WATER INTAKE</div><div class="water-score" id="waterScore">0 / 140 oz</div></div>
<div class="water-track" onclick="app.addWater()"><div class="water-fill" id="waterFill"></div></div>
<div style="text-align:center;margin-top:8px;font-size:0.65rem;color:var(--text-tertiary)">Tap bar to add 8oz glass</div>
</div>

<div class="section-header">PHYTONUTRIENT üåà</div>
<div class="rainbow-container">
<div class="rainbow-header"><div class="rainbow-title">RAINBOW SCORE</div><div class="rainbow-score" id="rainbowScore">0%</div></div>
<div class="rainbow-track" id="rainbowTrack"></div>
</div>

<div class="section-header">SYNERGY PROTOCOL</div>
<div class="timeline" id="timeline"></div>

<div class="modal-overlay" id="mainModal">
<div class="modal-content">
<div class="modal-header"><div class="modal-title" id="modalTitle">MENU</div><button class="modal-close" onclick="app.closeModal()">√ó</button></div>
<div class="modal-body" id="modalBody"></div>
</div>
</div>

<div class="footer">
<span class="sync-status" id="syncStatus">INIT</span>
<button class="sync-btn" onclick="app.sync()">üîÑ SYNC</button>
</div>

<script>

// ============================================================================
// ============================================================================
// MEAL DATABASE - START
// Replace this entire section (lines until "MEAL DATABASE - END") with the
// 50-meal database from the separate text file when ready to expand
// ============================================================================
const MEALS={
breakfast:[
{title:"Greek Yogurt & Berries",time:"5min",servings:1,macros:{p:20,o:0,f:4,cal:250,poly:250},ingredients:["1 cup Greek Yogurt","1/2 cup Mixed Berries","1 tbsp Honey","1 tbsp Walnuts"],steps:["Scoop yogurt into bowl","Top with berries and walnuts","Drizzle with honey"],why:"Probiotics + Antioxidants. Quick high protein start.",colors:['white','purple','brown'],suggestedBeverage:"Green Tea (Sencha)"},
{title:"Omega Breakfast",time:"15min",servings:1,macros:{p:58,o:3500,f:12,cal:680,poly:450},ingredients:["8oz Wild Salmon","2 Eggs","2 cups Kale","1 cup Blueberries","1 tsp EVOO"],steps:["Heat EVOO in pan","Season salmon with salt/pepper","Sear salmon 4min per side","Scramble eggs separately","Massage kale for 2min","Plate kale as base","Top with salmon, eggs, and berries"],why:"Salmon + Eggs = Choline/Omega-3 synergy for brain health.",colors:['orange','purple','green'],suggestedBeverage:"Lemon Ginger Water"},
{title:"Sophia's Sea Moss Oatmeal",time:"10min",servings:1,macros:{p:48,o:8200,f:18,cal:580,poly:300},ingredients:["1 cup Oats","1 tbsp Sea Moss","3 tbsp Flaxseed","Pea Protein","Berries"],steps:["Cook oats in water or oat milk","Stir in Sea Moss gel and protein","Top with ground flax and berries"],why:"Sea Moss minerals support thyroid. Flax lowers Lp(a).",colors:['purple','white']},
{title:"PB Sea Moss Power Shake",time:"5min",servings:1,macros:{p:55,o:7200,f:18,cal:780,poly:150},ingredients:["Pea Protein","Sea Moss","Flaxseed","PB","1 Banana","Spinach","Oat Milk"],steps:["Add all ingredients to blender","Blend with Oat Milk until smooth"],why:"Sea Moss supports mucus membranes. Pea protein = 54g complete. Banana = potassium + natural sweetness + prebiotic fiber.",colors:['green','white','yellow']},
{title:"Smoked Trout Hash",time:"18min",servings:1,macros:{p:54,o:3200,f:16,cal:640,poly:100},ingredients:["6oz Trout","2 Eggs","1 Sweet Potato","Brussels Sprouts","Garlic"],steps:["Dice sweet potato and saute","Add sprouts and garlic","Crack eggs into wells","Cover until eggs set","Top with flaked trout"],why:"Trout is lower mercury than tuna. Sprouts = Sulforaphane.",colors:['orange','green']},
{title:"Savory Turmeric Oats",time:"12min",servings:1,macros:{p:20,o:1200,f:12,cal:450,poly:250},ingredients:["1 cup Oats","Turmeric","Black Pepper","Spinach","Poached Egg"],steps:["Cook oats with turmeric/pepper","Stir in spinach","Top with egg"],why:"Turmeric + Pepper = 2000% absorption boost.",colors:['yellow','green']},
{title:"Mackerel Scramble",time:"12min",servings:1,macros:{p:56,o:4800,f:10,cal:660,poly:250},ingredients:["mackerel","eggs","arugula","turmeric"],steps:["Whisk eggs with turmeric","Scramble with mackerel","Serve over wilted arugula"],why:"Mackerel is highest Omega-3 fish. Turmeric reduces inflammation.",colors:['yellow','green']},
{title:"Smoked Salmon Avocado Toast",time:"12min",servings:1,macros:{p:54,o:3400,f:14,cal:680},ingredients:["smoked salmon","sprouted grain bread","avocado","eggs"],steps:["Toast bread","Mash avocado","Top with salmon and poached egg"],why:"Sprouted grains easier to digest. Salmon + Avocado = healthy fats.",colors:['orange','green']},
{title:"Flax Protein Parfait",time:"5min",servings:1,macros:{p:48,o:8600,f:18,cal:580},ingredients:["pea protein","flaxseed","greek yogurt","berries"],steps:["Mix yogurt and protein","Layer with flax and berries"],why:"Flax is highest plant source of ALA. Yogurt = probiotics.",colors:['white','purple']},
{title:"Tofu Scramble Supreme",time:"12min",servings:1,macros:{p:44,o:2800,f:10,cal:580},ingredients:["tofu","spinach","mushrooms","turmeric"],steps:["Crumble tofu","Saut√© with veggies and spices"],why:"Soy protein lowers cholesterol. Turmeric/Pepper combo.",colors:['yellow','green','white']},
{title:"Protein Pancakes",time:"15min",servings:1,macros:{p:52,o:6400,f:14,cal:620},ingredients:["pea protein","flaxseed","oats","berries"],steps:["Blend batter ingredients","Cook on griddle","Top with berries"],why:"High protein start to day. Oats = soluble fiber.",colors:['purple','white']},
{title:"Eggs & Oatmeal Combo",time:"12min",servings:1,macros:{p:52,o:7800,f:16,cal:640},ingredients:["¬Ω cup steel-cut oats","2 tbsp ground flaxseed","1 tbsp Sea Moss Gel","3 eggs","1 cup spinach","¬Ω avocado","Berries"],steps:["Cook oats with Sea Moss","Scramble eggs with spinach","Plate oatmeal with flax, berries","Serve eggs on side with avocado"],why:"Best of both worlds. Flax omega-3 + egg choline. Sea Moss minerals.",colors:['green','white']},
{title:"Power Berry Smoothie",time:"5min",servings:1,macros:{p:58,o:8400,f:18,cal:680,poly:400},ingredients:["1 scoop Pea Protein","2 tbsp Ground Flaxseed","2 tbsp Hemp Seeds","1 cup Greek Yogurt","2 tbsp Peanut Butter","1 cup Mixed Berries","1 cup Oat Milk","1 tsp Vanilla Extract"],steps:["Add all ingredients to blender","Blend on high for 60 seconds","Pour into glass","Optional: top with extra berries"],why:"Triple protein stack (pea + yogurt + peanut). Flax + Hemp = massive omega-3 hit. Berries = antioxidants.",colors:['purple','brown','white']},
{title:"Sea Moss Berry Smoothie",time:"5min",servings:1,macros:{p:32,o:4200,f:14,cal:480,poly:350},ingredients:["1 cup Mixed Berries","1 tbsp Sea Moss Gel","2 tbsp Ground Flaxseed","1 scoop Pea Protein","1 cup Almond Milk","1/2 Banana","Handful Spinach"],steps:["Add all ingredients to blender","Blend until smooth","Pour into glass"],why:"Sea Moss = 92 minerals for thyroid. Berries = polyphenols. Flax = omega-3 ALA. Protein + fiber for sustained energy.",colors:['purple','green']},
{title:"Pressed Juice Power Bowl",time:"10min",servings:1,macros:{p:45,o:2800,f:18,cal:620,poly:300},ingredients:["1 Pressed Juice Acai Base","1 scoop Pea Protein","2 tbsp Ground Flaxseed","2 tbsp Hemp Hearts","1/2 cup Granola","1/2 cup Mixed Berries","1/2 Banana","1 tbsp Almond Butter"],steps:["Blend acai base with protein and flaxseed","Pour into bowl","Top with granola, berries, banana","Drizzle with almond butter","Sprinkle hemp hearts"],why:"Acai = antioxidant powerhouse. Protein keeps you full. Flax + Hemp = omega-3 stack. Perfect post-workout recovery.",colors:['purple','brown']},
{title:"Simple Avocado Toast",time:"5min",servings:1,macros:{p:8,o:200,f:10,cal:280},ingredients:["1 slice Sprouted Grain Bread","1/2 Avocado","Sea Salt","Black Pepper","Red Pepper Flakes"],steps:["Toast bread until golden","Mash avocado with fork","Spread on toast","Season with salt, pepper, red pepper flakes"],why:"Monounsaturated fats + potassium from avocado. Sprouted bread easier to digest. Quick anti-inflammatory breakfast.",colors:['green','brown'],suggestedBeverage:"Golden Milk (Hot)"},
{title:"Loaded Salmon Avocado Toast",time:"6min",servings:1,macros:{p:32,o:3800,f:14,cal:480,poly:100},ingredients:["1 slice Sprouted Grain Bread","1/2 Avocado","3oz Smoked Salmon","1 tbsp Hemp Hearts","1 tbsp Ground Flaxseed","Lemon","Everything Bagel Seasoning"],steps:["Toast bread until golden","Mash avocado, spread on toast","Layer smoked salmon on top","Sprinkle hemp hearts and flaxseed","Squeeze lemon, add seasoning"],why:"Triple omega-3 stack: salmon DHA/EPA + hemp ALA + flax ALA. Avocado monounsaturated fats boost absorption. Complete protein from salmon.",colors:['pink','green','brown'],suggestedBeverage:"Golden Milk (Hot)"},
{title:"Egg White Zucchini Scramble",time:"10min",servings:1,macros:{p:24,o:0,f:7,cal:220,poly:70},ingredients:["6 Egg Whites","1 cup Diced Zucchini","1/2 cup Diced Bell Peppers","1 tsp Olive Oil","Garlic Powder","Salt","Pepper"],steps:["Heat olive oil in pan","Saut√© diced zucchini and bell peppers until tender","Whisk egg whites with seasonings","Pour egg whites over veggies","Scramble until cooked through"],why:"Pure lean protein from egg whites. Zucchini + bell peppers add fiber + vitamin C. Low calorie, high volume breakfast.",colors:['white','green','red']},
{title:"Spinach Tofu Scramble",time:"12min",servings:1,macros:{p:22,o:800,f:9,cal:300,poly:140},ingredients:["8oz Firm Tofu","2 cups Spinach","1/2 cup Diced Bell Peppers","1/2 Onion","Turmeric","Nutritional Yeast","Garlic","Olive Oil"],steps:["Crumble tofu into chunks","Saut√© onion, garlic, and bell peppers","Add crumbled tofu with turmeric","Fold in fresh spinach","Season with nutritional yeast"],why:"Complete plant protein from tofu. Turmeric = anti-inflammatory. Bell peppers = vitamin C. Nutritional yeast = B vitamins. Spinach = iron + folate.",colors:['yellow','green','red']},
{title:"Chicken & Veggie Breakfast Bowl",time:"15min",servings:1,macros:{p:54,o:600,f:16,cal:520,poly:110},ingredients:["6oz Grilled Chicken Breast","1/2 cup Black Beans","1 cup Broccoli","1 cup Bell Peppers","2 Eggs","Sweet Potato","Avocado"],steps:["Dice and roast sweet potato","Steam broccoli and peppers","Warm black beans","Slice pre-cooked chicken","Scramble eggs","Combine all in bowl","Top with sliced avocado"],why:"Savory breakfast with complete protein. Black beans add 8g fiber + resistant starch. Sweet potato = complex carbs for sustained energy. Veggies = fiber + phytonutrients.",colors:['brown','green','orange','yellow','black']}
],
lunch:[
{title:"Double Chicken Culture Bowl",time:"15min",servings:1,macros:{p:68,o:800,f:12,cal:720,poly:200},ingredients:["8oz Grilled Chicken","Brown Rice","Black Beans","Pico de Gallo","Shredded Lettuce","Chipotle Sauce","Lime"],steps:["Grill seasoned chicken breast","Warm brown rice and black beans","Build bowl with rice base","Add beans, grilled chicken","Top with pico, lettuce, sauce","Squeeze lime over top"],why:"Maximum protein + fiber combo. Black beans = resistant starch for gut health. Chipotle peppers = capsaicin metabolism boost.",colors:['brown','black','green','red']},
{title:"Classic Bison Burger",time:"20min",servings:1,macros:{p:42,o:400,f:8,cal:550},ingredients:["6oz Ground Bison","1 Whole Wheat Bun","Lettuce/Tomato/Onion","1 tsp Mustard","Side Green Salad"],steps:["Form bison patty (don't overwork)","Grill or pan sear 3-4 mins/side (Medium Rare)","Toast bun lightly","Assemble with fresh veggies","Serve with side salad"],why:"Bison = Lower TMAO & inflammation than beef. High Heme Iron.",colors:['brown','green','red']},
{title:"Ahi Poke Bowl",time:"15min",servings:1,macros:{p:53,o:1600,f:16,cal:620,poly:150},ingredients:["6oz Ahi Tuna","Brown Rice","1 cup Edamame","Cucumber","Mango","Seaweed","Sesame Oil"],steps:["Cube raw tuna","Toss in sesame oil and soy","Cook edamame for 3 mins","Plate over brown rice","Add edamame","Top with tuna, sliced veg and mango"],why:"Raw fish preserves delicate Omega-3s. Seaweed = Iodine. Edamame adds 8g fiber + plant protein + isoflavones.",colors:['red','green','yellow']},
{title:"Turkey Club Wrap",time:"10min",servings:1,macros:{p:38,o:400,f:6,cal:540},ingredients:["1 large tortilla","4oz turkey breast","2 slices turkey bacon","Lettuce","Tomato","Mayo (light)"],steps:["Cook bacon until crisp","Spread mayo on wrap","Layer turkey, bacon, veg","Roll tightly and slice"],why:"High protein lunch standard.",colors:['white','green','red']},
{title:"Bean & Cheese Burrito",time:"10min",servings:1,macros:{p:22,o:200,f:14,cal:580},ingredients:["1 large whole wheat tortilla","1/2 cup refried beans (vegetarian)","1/4 cup cheddar","Salsa","Spinach","Greek yogurt"],steps:["Spread beans on tortilla","Add cheese and salsa","Add spinach","Roll and heat in pan","Dip in yogurt"],why:"Beans = fiber/protein combo. Whole wheat = sustained energy.",colors:['brown','green','white']},
{title:"Zoodles & Shrimp",time:"15min",servings:1,macros:{p:35,o:600,f:5,cal:400},ingredients:["Zucchini","Shrimp","Garlic","Lemon","Olive Oil"],steps:["Spiralize zucchini","Saute shrimp with garlic","Toss zoodles in pan for 1 min"],why:"Low carb, high nutrient density.",colors:['green','pink']},
{title:"Cottage Cheese Bowl",time:"5min",servings:1,macros:{p:30,o:200,f:4,cal:350},ingredients:["Cottage Cheese","Pineapple","Walnuts","Chia Seeds"],steps:["Scoop cheese into bowl","Top with fruit and nuts"],why:"Casein protein creates slow release amino acids.",colors:['white','yellow']},
{title:"Salmon Pesto Pasta",time:"20min",servings:1,macros:{p:56,o:4200,f:12,cal:740},ingredients:["6oz Salmon","Chickpea Pasta","Pesto","Tomatoes","Arugula"],steps:["Boil chickpea pasta","Sear salmon separately","Toss pasta with pesto","Combine salmon and pasta","Top with tomatoes"],why:"Chickpea pasta = high fiber/protein. Pesto = polyphenols.",colors:['pink','green','red']},
{title:"Chipotle Bowl (Bison)",time:"18min",servings:1,macros:{p:58,o:2800,f:20,cal:740},ingredients:["6oz Bison","Brown Rice","Black Beans","Peppers","Guacamole"],steps:["Brown bison in pan","Warm black beans","Build bowl with rice base","Top with meat, beans, peppers","Add guacamole"],why:"Bison = nutrient dense red meat. Beans = soluble fiber.",colors:['brown','black','green','red']},
{title:"Chipotle Bowl (Tofu)",time:"20min",servings:1,macros:{p:46,o:3200,f:22,cal:680},ingredients:["tofu","brown rice","black beans","peppers"],steps:["Season and bake tofu","Assemble bowl with beans and rice"],why:"Plant-based complete protein. High fiber.",colors:['white','black','green']},
{title:"Mediterranean Quinoa Salad",time:"15min",servings:1,macros:{p:22,o:1200,f:14,cal:580},ingredients:["quinoa","cucumber","tomatoes","olives","feta"],steps:["Mix cooked quinoa with chopped veg","Add olives and feta","Drizzle with olive oil"],why:"Mediterranean diet gold standard. Olives = healthy fats.",colors:['white','green','red','black']},
{title:"Lentil Soup with Kale",time:"30min",servings:2,macros:{p:24,o:800,f:18,cal:450},ingredients:["lentils","kale","carrots","celery"],steps:["Simmer lentils with veg","Add kale at end to wilt"],why:"High fiber lowers cholesterol. Kale = nutrient density.",colors:['brown','green','orange']},
{title:"Turkey Burger & Sweet Potato",time:"20min",servings:1,macros:{p:38,o:300,f:8,cal:580},ingredients:["turkey","sweet potato","lettuce","tomato"],steps:["Grill turkey burger","Roast sweet potato wedges","Serve with salad"],why:"Lean protein. Sweet potato = Vitamin A.",colors:['white','orange','green']},
{title:"Chickpea Curry (Quick)",time:"20min",servings:2,macros:{p:18,o:400,f:14,cal:480},ingredients:["1 can chickpeas","1 cup coconut milk (light)","1 tbsp red curry paste","1 cup spinach","1/2 cup bell pepper","1/2 onion","Basmati rice"],steps:["Saut√© onion and peppers","Add curry paste, cook 1 min","Add coconut milk and chickpeas","Simmer 10 mins","Stir in spinach","Serve over rice"],why:"Chickpeas = fiber/protein. Turmeric in paste = anti-inflammatory.",colors:['yellow','green','white']},
{title:"Bison Taco Salad",time:"15min",servings:1,macros:{p:45,o:800,f:12,cal:620},ingredients:["5oz ground bison","2 cups romaine","1/2 cup black beans","1/4 cup salsa","1/4 avocado","1 tbsp greek yogurt","Cumin, chili powder"],steps:["Brown bison with spices","Drain fat","Assemble lettuce base","Top with meat, beans, salsa","Add avocado and yogurt dollop"],why:"Bison = nutrient dense red meat. Beans = soluble fiber.",colors:['brown','black','green','red']},
{title:"Edamame & Quinoa Bowl",time:"15min",servings:1,macros:{p:24,o:1800,f:12,cal:540},ingredients:["1 cup cooked quinoa","1 cup shelled edamame","1/2 cup shredded purple cabbage","1 carrot (shredded)","Ginger soy dressing","Sesame seeds"],steps:["Warm quinoa and edamame","Toss with cabbage and carrot","Drizzle dressing","Top with sesame seeds"],why:"Edamame = soy protein. Purple cabbage = antioxidants.",colors:['green','purple','orange']},
{title:"Smoked Salmon Bagel (Open)",time:"5min",servings:1,macros:{p:32,o:2800,f:6,cal:480},ingredients:["1 whole grain bagel","4oz smoked salmon","2 tbsp cream cheese","Capers","Red onion","Dill","Cucumber slices"],steps:["Toast bagel","Spread cream cheese","Layer salmon","Top with capers, onion, dill","Serve cucumber on side"],why:"Salmon = omega-3. Whole grain = fiber.",colors:['orange','white','green']},
{title:"Leftover Roast Chicken Salad",time:"10min",servings:1,macros:{p:40,o:600,f:8,cal:520},ingredients:["5oz roast chicken (cold)","2 cups arugula","1/2 apple (diced)","1/4 cup walnuts","Celery","Yogurt dressing"],steps:["Chop chicken and celery","Toss with arugula and apple","Add walnuts","Mix with yogurt dressing"],why:"Chicken = protein. Walnuts = ALA omega-3. Apple = quercetin.",colors:['white','green','brown']},
{title:"Tempeh Reuben Bowl",time:"15min",servings:1,macros:{p:28,o:1200,f:16,cal:560},ingredients:["6oz tempeh strips","1/2 cup sauerkraut","1 slice swiss cheese","Rye croutons","Thousand island dressing (light)","Mixed greens"],steps:["Pan fry tempeh strips","Melt cheese on tempeh","Place over greens","Add kraut and croutons","Drizzle dressing"],why:"Tempeh/Kraut = gut health powerhouse.",colors:['brown','green']},
{title:"Shrimp & Asparagus Stir Fry",time:"15min",servings:1,macros:{p:40,o:1200,f:16,cal:520,poly:150},ingredients:["6oz shrimp","1 bunch asparagus","1 cup edamame","Garlic","Ginger","Soy sauce","Sesame oil","Cauliflower rice"],steps:["Saut√© garlic/ginger in oil","Add asparagus and edamame, stir fry 3min","Add shrimp, cook until pink","Add soy sauce","Serve over cauli rice"],why:"Shrimp = astaxanthin. Asparagus = prebiotic. Edamame adds plant protein + 8g fiber boost.",colors:['pink','green','white']},
{title:"Turkey Club (Sourdough)",time:"10min",servings:1,macros:{p:40,o:500,f:6,cal:550},ingredients:["Sliced Turkey","Sourdough Bread","Avocado","Tomato","Lettuce"],steps:["Toast sourdough","Layer turkey and veg","Add mashed avocado"],why:"Sourdough is fermented/low glycemic. Turkey = lean protein.",colors:['white','red','green']},
{title:"Costco Cauliflower Pizza",time:"25min",servings:2,macros:{p:36,o:200,f:8,cal:580},ingredients:["1 Costco Cauliflower Pizza Crust","1 cup Marinara Sauce","2 cups Mozzarella","Toppings: Peppers, Mushrooms, Onions","Italian Herbs","Side Salad"],steps:["Preheat oven to 425¬∞F","Spread marinara on cauliflower crust","Add mozzarella and toppings","Sprinkle with herbs","Bake 18-20 mins until cheese bubbles","Serve with side salad"],why:"Cauliflower crust = lower carb, higher fiber. Costco convenience meets nutrition.",colors:['white','red','green']},
{title:"Bone Broth Pho",time:"15min",servings:1,macros:{p:50,o:1000,f:16,cal:520,poly:100},ingredients:["3 cups Bone Broth (beef or chicken)","6oz Sliced Beef or Chicken","Rice Noodles","1 cup Edamame","Bean Sprouts","Fresh Basil","Cilantro","Lime","Jalape√±o","Hoisin","Sriracha"],steps:["Heat bone broth to boiling","Cook rice noodles according to package","Add edamame to broth for 3 mins","Add sliced meat to hot broth (cooks in 2min)","Drain noodles, add to bowl","Pour hot broth, meat, and edamame over noodles","Top with sprouts, herbs, lime, jalape√±o","Add hoisin and sriracha to taste"],why:"Bone broth = collagen, glycine, minerals for gut/joint health. Edamame adds 8g fiber + plant protein boost. High protein, anti-inflammatory.",colors:['brown','white','green']},
{title:"Belgian Mussels & Frites",time:"20min",servings:1,macros:{p:44,o:1400,f:14,cal:620,poly:80},ingredients:["2lbs Mussels (cleaned)","1 cup White Wine","1/2 cup White Beans","3 cloves Garlic","Shallots","Fresh Thyme","Butter","Parsley","Lemon","Sweet Potato Fries","Side Salad"],steps:["Saut√© shallots and garlic in butter","Add white wine, white beans and thyme, bring to boil","Add mussels, cover and steam 5-7 mins until open","Discard any unopened mussels","Finish with parsley and lemon","Serve with baked sweet potato fries and salad"],why:"Mussels = zinc, iron, B12, omega-3. White beans add 8g fiber. Sweet potato = vitamin A. High protein, low calorie.",colors:['black','orange','green','white']},
{title:"Chicken Caesar Salad",time:"15min",servings:1,macros:{p:45,o:400,f:6,cal:480,poly:80},ingredients:["6oz Grilled Chicken Breast","2 cups Romaine Lettuce","2 tbsp Caesar Dressing","2 tbsp Parmesan Cheese","Whole Grain Croutons","Lemon Wedge"],steps:["Chop romaine lettuce","Grill or slice pre-cooked chicken","Toss lettuce with Caesar dressing","Top with chicken, parmesan, croutons","Squeeze lemon over top"],why:"Classic high-protein option. Romaine = vitamin K for bone health. Grilled chicken = lean complete protein.",colors:['green','white','brown']},
{title:"Fish Taco",time:"20min",servings:1,macros:{p:38,o:2200,f:10,cal:520,poly:100},ingredients:["6oz White Fish (cod/mahi)","2 Corn Tortillas","1/2 cup Shredded Cabbage","1/4 cup Pico de Gallo","1/4 Avocado","Lime","Cilantro","Chipotle Crema"],steps:["Season fish with cumin, chili powder","Grill or pan sear fish 3-4 mins per side","Warm corn tortillas","Flake fish into tortillas","Top with cabbage, pico, avocado","Drizzle with crema and lime","Garnish with cilantro"],why:"White fish = lean omega-3 protein. Corn tortillas = whole grain. Cabbage = cruciferous fiber. Perfect balance.",colors:['white','green','red','yellow']},
{title:"Salmon Quinoa Power Bowl",time:"20min",servings:1,macros:{p:58,o:4200,f:20,cal:720,poly:200},ingredients:["6oz Wild Salmon","1/2 cup Quinoa","1/2 cup Brown Rice","1 cup Edamame","1/2 Avocado","Lemon","Olive Oil","Sea Salt"],steps:["Cook quinoa and brown rice","Boil edamame 3 mins","Season salmon with salt, pepper","Pan sear salmon 4 mins per side","Plate grains and edamame","Top with salmon and sliced avocado","Drizzle with olive oil and lemon"],why:"Salmon = omega-3 DHA/EPA. Quinoa = complete protein with all 9 amino acids. Edamame adds 8g fiber + plant protein. Brown rice = sustained energy. Avocado = healthy fats for nutrient absorption.",colors:['pink','brown','green']}
],
dinner:[
{title:"Whole Branzino w/ Seafood Medley",time:"40min",servings:2,macros:{p:58,o:3000,f:20,cal:680,poly:100},ingredients:["2 Whole Branzino (cleaned)","1/2lb Shrimp","1/2lb Mussels","1 cup White Beans (cannellini)","Cherry Tomatoes","1/2 cup White Wine","Garlic & Parsley","Lemon Slices"],steps:["Score fish, stuff with lemon/herbs","Place in roasting pan","Surround with shrimp, mussels, white beans, tomatoes","Pour wine and garlic over everything","Bake at 400¬∞F for 25 mins"],why:"Whole Fish = Collagen/Glycine from skin/bones. Shellfish = Zinc stack. White beans add 8g fiber + plant protein.",colors:['white','pink','red']},
{title:"Turkey Chili",time:"35min",servings:2,macros:{p:35,o:400,f:15,cal:500},ingredients:["1lb ground turkey","1 can kidney beans","1 can diced tomatoes","1 onion","1 bell pepper","Chili powder","Cumin","Garlic"],steps:["Brown turkey with onion/garlic","Add peppers and spices","Add tomatoes and beans","Simmer 30 mins"],why:"Turkey = lean protein. Beans = fiber. Tomatoes = lycopene.",colors:['brown','red']},
{title:"Beef Bolognese (Zoodles)",time:"40min",servings:2,macros:{p:40,o:500,f:10,cal:550},ingredients:["1lb ground beef","1 jar marinara (no sugar)","1 onion","2 carrots","Celery","Zucchini noodles"],steps:["Brown beef","Add chopped veg, cook 5 min","Add sauce, simmer 20 min","Serve over raw or lightly saut√©ed zoodles"],why:"Beef = iron. Tomato sauce = lycopene.",colors:['red','green']},
{title:"Stuffed Peppers",time:"50min",servings:4,macros:{p:30,o:400,f:10,cal:450},ingredients:["Bell Peppers","Ground Bison","Brown Rice","Spinach","Tomato Sauce"],steps:["Hollow peppers","Mix meat/rice/veg","Stuff peppers","Bake at 375F for 40m"],why:"Vitamin C from peppers boosts iron absorption from bison.",colors:['red','green','brown']},
{title:"Sesame Seared Tuna",time:"15min",servings:2,macros:{p:50,o:1500,f:2,cal:400},ingredients:["Ahi Tuna Steaks","Sesame Seeds","Soy Sauce","Ginger","Asparagus"],steps:["Coat tuna in seeds","Sear 1 min/side","Serve with steamed asparagus"],why:"High selenium content in tuna. Ginger aids digestion.",colors:['red','white','green']},
{title:"Seafood Cioppino",time:"40min",servings:2,macros:{p:48,o:2000,f:16,cal:580,poly:120},ingredients:["White Fish","Mussels/Shrimp","1 cup White Beans","Tomato Broth","Fennel","Garlic"],steps:["Saute fennel and garlic","Add broth, white beans and simmer","Poach fish gently in broth"],why:"Tomato (cooked) = high Lycopene. White beans add 8g fiber. Low calorie, high mineral.",colors:['white','red','green']},
{title:"Herb Crusted Cod",time:"20min",servings:1,macros:{p:52,o:2800,f:10,cal:580},ingredients:["8oz wild cod","¬Ω cup almond flour","1 egg","Parsley","Dill","Lemon zest","Asparagus","1 tbsp EVOO"],steps:["Mix almond flour, herbs, zest","Dip cod in egg, then flour","Pan fry 4min per side in EVOO","Steam asparagus","Plate with lemon wedges"],why:"Cod = lean protein. Almonds = Vitamin E. Asparagus = prebiotic fiber.",colors:['white','green']},
{title:"Grass-Fed Steak & Sprouts",time:"25min",servings:1,macros:{p:60,o:1200,f:14,cal:720},ingredients:["8oz grass-fed sirloin","2 cups Brussels sprouts","¬Ω sweet potato","Garlic","Rosemary","Balsamic vinegar","1 tbsp EVOO"],steps:["Halve sprouts, toss in balsamic","Roast sprouts and potato 20min at 400¬∞F","Sear steak 3min per side","Rest steak 5min","Slice against grain"],why:"Grass-fed beef = CLA and Omega-3. Brussels = sulforaphane. Sweet potato = potassium.",colors:['red','green','orange']},
{title:"Mediterranean Chicken",time:"25min",servings:1,macros:{p:55,o:800,f:12,cal:640},ingredients:["8oz chicken breast","1 cup quinoa","Cucumber","Cherry tomatoes","Kalamata olives","Feta cheese","Oregano","Olive oil"],steps:["Cook quinoa","Grill chicken with oregano","Chop veg","Mix quinoa, veg, olives","Top with sliced chicken and feta","Drizzle olive oil"],why:"Chicken = lean complete protein. Olives = hydroxytyrosol (potent antioxidant). Quinoa = complete plant protein.",colors:['white','black','red']},
{title:"Tempeh Stir Fry (Plant)",time:"15min",servings:1,macros:{p:50,o:2600,f:26,cal:680,poly:200},ingredients:["8oz tempeh","1 cup edamame","Broccoli","Bell peppers","Snap peas","Ginger","Garlic","Tamari","Sesame oil","Brown rice"],steps:["Steam tempeh 5min (removes bitterness)","Cube and saut√© in sesame oil","Add edamame, veggies, ginger, garlic","Add splash of water to steam veg","Finish with tamari","Serve over rice"],why:"Tempeh = fermented soy (gut health). Edamame adds 8g fiber. Ginger = anti-inflammatory. Broccoli = sulforaphane.",colors:['brown','green','red']},
{title:"Sheet Pan Salmon & Veggies",time:"20min",servings:1,macros:{p:45,o:3200,f:10,cal:620},ingredients:["6oz salmon fillet","1 cup broccoli florets","1 cup bell peppers","1 tbsp olive oil","Lemon slices","Dill","Garlic powder"],steps:["Preheat oven to 400¬∞F","Toss veggies in oil and spices","Place salmon and veggies on pan","Top salmon with lemon/dill","Roast 15-18 mins"],why:"Salmon = omega-3. One pan meal. Broccoli = detox support.",colors:['orange','green','red']},
{title:"Shrimp Scampi with Zoodles",time:"15min",servings:1,macros:{p:30,o:600,f:6,cal:420},ingredients:["6oz shrimp","2 zucchini (spiralized)","2 tbsp butter/ghee","3 cloves garlic","Lemon juice","Parsley","Red pepper flakes"],steps:["Saut√© garlic in butter","Add shrimp, cook pink","Add lemon and flakes","Toss in zoodles for 1 min","Garnish parsley"],why:"Shrimp = iodine/selenium. Zucchini = low cal volume.",colors:['pink','green','white']},
{title:"Lamb Kofta Bowl",time:"25min",servings:1,macros:{p:46,o:1100,f:18,cal:780,poly:110},ingredients:["6oz ground lamb","1 tsp cumin/coriander","1/2 cup Black Beans","Cucumber yogurt sauce","Tomatoes","Onion","Mixed greens","Pita"],steps:["Mix lamb with spices","Form small oblong patties","Grill or pan fry 8 mins","Warm black beans","Assemble bowl with greens and beans","Top with kofta and sauce"],why:"Lamb = zinc/iron. Fermented yogurt = gut health. Black beans add 8g fiber + resistant starch.",colors:['brown','green','white','red','black']},
{title:"Pesto Chicken Zoodles",time:"15min",servings:1,macros:{p:45,o:500,f:8,cal:550},ingredients:["6oz chicken breast","2 zucchini","1/4 cup basil pesto","Cherry tomatoes","Parmesan"],steps:["Cook chicken pieces","Spiralize zucchini","Toss chicken and zoodles with pesto","Add halved tomatoes","Warm through"],why:"Basil = anti-bacterial. Chicken = protein base.",colors:['green','white','red']},
{title:"Seared Scallops & Risotto",time:"30min",servings:1,macros:{p:35,o:700,f:4,cal:580},ingredients:["6oz sea scallops","1/2 cup arborio rice","2 cups broth","White wine (splash)","Parmesan","Peas","Butter"],steps:["Cook risotto (ladle broth slowly)","Stir in peas/parm","Sear scallops in hot butter (2 min/side)","Serve scallops atop risotto"],why:"Scallops = B12/magnesium. Peas = plant protein.",colors:['white','green']},
{title:"Chicken Stir Fry",time:"15min",servings:1,macros:{p:48,o:700,f:16,cal:620,poly:120},ingredients:["6oz chicken breast","1 cup edamame","Broccoli","Snap peas","Carrots","Soy sauce","Ginger/Garlic","Sesame oil"],steps:["Slice chicken thin","Stir fry chicken","Remove, stir fry edamame and veg","Combine with sauce","Simmer 1 min"],why:"Lean protein + fiber rich veg. Edamame adds 8g fiber + plant protein.",colors:['white','green','orange']},
{title:"Baked Cod with Salsa",time:"20min",servings:1,macros:{p:45,o:2000,f:8,cal:480},ingredients:["8oz cod fillet","1/2 cup salsa","1/4 avocado","Cilantro","Lime","Asparagus side"],steps:["Place cod in baking dish","Top with salsa","Bake 400¬∞F for 15 min","Top with avocado/cilantro","Serve with steamed asparagus"],why:"Cod = low calorie protein source.",colors:['white','red','green']},
{title:"Egg Roll in a Bowl",time:"15min",servings:1,macros:{p:35,o:600,f:10,cal:480},ingredients:["1/2lb ground pork/turkey","1 bag coleslaw mix","Ginger","Garlic","Soy sauce","Sriracha","Green onions"],steps:["Brown meat","Add slaw mix, ginger, garlic","Saut√© until wilted","Stir in soy/sriracha","Top with green onions"],why:"Cabbage = cruciferous benefits. High volume meal.",colors:['white','green']},
{title:"Lemon Garlic Shrimp",time:"15min",servings:1,macros:{p:30,o:500,f:4,cal:380},ingredients:["8oz shrimp","2 tbsp butter","3 cloves garlic","Lemon juice","Parsley","Green beans"],steps:["Steam green beans","Saut√© garlic in butter","Cook shrimp","Finish with lemon/parsley","Plate together"],why:"Shrimp = high protein low fat.",colors:['pink','green','white']},
{title:"Meatballs & Marinara",time:"30min",servings:2,macros:{p:32,o:400,f:8,cal:550},ingredients:["1lb ground beef","1 egg","1/4 cup almond flour","Italian herbs","Marinara sauce","Spinach side"],steps:["Mix meat, egg, flour, herbs","Roll balls","Bake 400¬∞F 20 min","Simmer in sauce 5 min","Serve with wilted spinach"],why:"Beef = B12/Zinc. Spinach = folate.",colors:['red','green']},
{title:"Curry Chicken Salad",time:"10min",servings:1,macros:{p:40,o:800,f:8,cal:560},ingredients:["5oz cooked chicken","Greek yogurt","Curry powder","Grapes/Raisins","Cashews","Celery"],steps:["Chop chicken","Mix yogurt and curry powder","Combine all","Serve in lettuce cups"],why:"Curry = turmeric anti-inflammatory. Yogurt = probiotics.",colors:['yellow','green']},
{title:"Chicken Breast Power Bowl",time:"25min",servings:1,macros:{p:58,o:600,f:22,cal:720,poly:120},ingredients:["8oz chicken breast","1/2 cup quinoa","1/2 cup brown rice","1/2 cup black beans","2 cups broccoli","Garlic","Olive oil","Lemon"],steps:["Cook quinoa and brown rice together","Season chicken with salt, pepper, garlic","Grill or bake chicken 20 min at 375¬∞F","Steam broccoli for 5 min","Warm black beans","Plate rice/quinoa base with beans","Top with sliced chicken and broccoli","Drizzle with olive oil and lemon"],why:"Complete protein + complex carbs + fiber. Quinoa = all 9 amino acids. Black beans add 8g fiber. Broccoli = sulforaphane.",colors:['white','brown','green','black']},
{title:"Mediterranean Mussels Pasta",time:"25min",servings:1,macros:{p:44,o:1800,f:10,cal:580},ingredients:["2lbs Mussels (cleaned)","Chickpea Pasta","Cherry Tomatoes","Kalamata Olives","Garlic","White Wine","Fresh Basil","Olive Oil","Red Pepper Flakes","Parmesan"],steps:["Cook chickpea pasta al dente","Saut√© garlic in olive oil","Add tomatoes, cook until blistered","Add white wine, bring to boil","Add mussels, cover 5-7 mins until open","Discard unopened mussels","Toss pasta with mussel broth","Top with olives, basil, red pepper","Finish with parmesan"],why:"Mussels = zinc, iron, B12, omega-3 stack. Chickpea pasta = protein + fiber. Mediterranean diet gold.",colors:['black','red','green']},
{title:"Mixed Fajitas with Black Beans",time:"20min",servings:1,macros:{p:62,o:1400,f:16,cal:620,poly:150},ingredients:["4oz Chicken Breast","6oz Shrimp","1/2 cup Black Beans","Bell Peppers (red, yellow, green)","Onion","Fajita Seasoning","Lime","Cilantro","Pico de Gallo","Avocado"],steps:["Slice chicken into strips","Season chicken and shrimp with fajita spices","Slice peppers and onions","Heat cast iron skillet","Sear chicken strips 4-5 mins","Add shrimp, cook 2-3 mins until pink","Remove proteins, saut√© peppers and onions","Warm black beans","Plate veggies and beans","Top with chicken and shrimp","Add pico, avocado, cilantro, lime"],why:"Shrimp + chicken = lean protein stack. Shrimp = astaxanthin + selenium. Bell peppers = vitamin C. Black beans add 8g fiber + resistant starch. No tortillas = lower carb, higher protein.",colors:['pink','white','red','yellow','green','black']}
],
juices:[
{title:"The Red Pipe Clearer",macros:{p:2,o:0,f:1,cal:110,poly:200},ingredients:["Beets","Carrots","Ginger","Lemon"],steps:["Wash produce","Juice beets first","Drink immediately"],why:"Beets increase Nitric Oxide, dilating blood vessels.",colors:['red','orange']},
{title:"The ANA Green Soother",macros:{p:2,o:0,f:1,cal:90,poly:300},ingredients:["Celery","Cucumber","Turmeric","Ginger"],steps:["Juice turmeric/ginger","Follow with watery veg","Add black pepper"],why:"Turmeric/Ginger is the ultimate anti-inflammatory stack.",colors:['green','yellow']},
{title:"The Citrus Alkalizer",macros:{p:2,o:0,f:2,cal:120,poly:150},ingredients:["2 Apples","2 Oranges","2 cups Spinach","4 Celery Stalks","1 Lemon"],steps:["Wash all produce thoroughly","Juice spinach and celery first","Follow with apples and oranges","Finish with lemon","Stir and drink immediately"],why:"Apple + Celery = potassium flush. Spinach = alkalizing minerals. Citrus = Vitamin C boost.",colors:['green','orange']},
{title:"Longevity Gold Elixir",macros:{p:1,o:0,f:0,cal:60,poly:200},ingredients:["oranges","sea moss","turmeric"],steps:["Juice oranges","Stir in sea moss gel and turmeric"],why:"Vitamin C + Minerals. Immune booster.",colors:['orange','yellow']},
{title:"Homemade Kombucha Flight",macros:{p:0,o:0,f:0,cal:35},ingredients:["16oz Homemade Kombucha","Ice","Lemon slice","Mint sprig"],steps:["Pour chilled kombucha over ice","Garnish with fresh mint and lemon"],why:"Potent probiotics for gut microbiome diversity.",colors:['yellow']},
{title:"Golden Milk (Hot)",macros:{p:2,o:0,f:0,cal:95,poly:250},ingredients:["1 cup Coconut Milk","1 tsp Turmeric","1/4 tsp Black Pepper","1 tbsp Sea Moss Gel","1 tsp Coconut Oil","1/2 tsp Cinnamon","Pinch Ginger"],steps:["Heat coconut milk in saucepan","Whisk in turmeric, pepper, sea moss","Add coconut oil and spices","Simmer 5 minutes","Strain and serve hot"],why:"Turmeric needs fat + heat + black pepper for 2000% better absorption. Sea moss adds 92 minerals. Perfect anti-inflammatory nightcap.",colors:['yellow','white']},
{title:"Ceremonial Matcha Latte",macros:{p:3,o:0,f:0,cal:80,poly:400},ingredients:["1 tsp Ceremonial Grade Matcha","4oz Hot Water (175F)","8oz Oat Milk","Optional: 1 tsp Honey"],steps:["Sift matcha into bowl","Add hot water (not boiling)","Whisk vigorously until frothy","Heat oat milk, froth if desired","Combine matcha and milk"],why:"L-theanine + caffeine = calm focus without jitters. EGCG antioxidants fight cellular aging. Ceremonial grade is highest quality.",colors:['green','white']},
{title:"Green Tea (Sencha)",macros:{p:0,o:0,f:0,cal:5,poly:300},ingredients:["2 tsp Sencha Green Tea","8oz Water (175F)"],steps:["Heat water to 175F (not boiling)","Steep tea 2-3 minutes","Remove leaves, drink plain"],why:"EGCG catechins activate autophagy (cellular cleanup). 175F preserves delicate compounds. L-theanine calms without drowsiness.",colors:['green']},
{title:"Ginger Turmeric Tea",macros:{p:0,o:0,f:0,cal:15,poly:350},ingredients:["1 inch Fresh Ginger","1 inch Fresh Turmeric","1 Lemon","1/4 tsp Black Pepper","1 tsp Honey"],steps:["Slice ginger and turmeric thinly","Boil in 2 cups water for 10 min","Add lemon juice and pepper","Strain, add honey"],why:"Fresh ginger aids digestion. Turmeric fights inflammation. Black pepper activates curcumin. Lemon vitamin C.",colors:['yellow','orange']},
{title:"Tart Cherry Recovery",macros:{p:1,o:0,f:0,cal:120,poly:500},ingredients:["8oz Tart Cherry Juice (unsweetened)","4oz Water","Ice"],steps:["Mix cherry juice with water","Pour over ice","Drink post-workout"],why:"Anthocyanins reduce muscle soreness + inflammation. Natural melatonin precursors aid sleep. Best post-workout recovery drink.",colors:['red']},
{title:"Bone Broth Elixir",macros:{p:10,o:0,f:0,cal:45},ingredients:["8oz Bone Broth","1/4 tsp Sea Salt","1/4 tsp Black Pepper","Pinch Turmeric"],steps:["Heat bone broth","Add spices","Sip slowly"],why:"Collagen + glycine heal gut lining. Bioavailable minerals. Pairs with savory meals. Fasting-friendly protein hit.",colors:['brown']},
{title:"Adaptogen Cacao",macros:{p:4,o:0,f:0,cal:85,poly:350},ingredients:["1 tbsp Raw Cacao Powder","1/2 tsp Ashwagandha","1/4 tsp Reishi Powder","8oz Oat Milk","1 tsp Honey"],steps:["Heat oat milk","Whisk in cacao and adaptogens","Add honey","Blend until frothy"],why:"Raw cacao = flavonoids for heart. Ashwagandha regulates cortisol. Reishi supports immune system.",colors:['brown','white']},
{title:"Lemon Ginger Water",macros:{p:0,o:0,f:0,cal:10},ingredients:["1/2 Lemon (juiced)","1 inch Fresh Ginger (grated)","16oz Water","Ice"],steps:["Grate ginger into water","Add lemon juice","Stir and serve over ice"],why:"Stimulates digestive enzymes. Vitamin C boost. Perfect meal companion for fat digestion.",colors:['yellow']},
{title:"ACV Digestive Tonic",macros:{p:0,o:0,f:0,cal:15},ingredients:["1 tbsp Apple Cider Vinegar (with mother)","1 tsp Honey","1/4 tsp Cinnamon","8oz Warm Water"],steps:["Mix ACV and honey in warm water","Add cinnamon","Stir well","Drink 15 min before meals"],why:"Increases stomach acid for protein digestion. Regulates blood sugar. The mother = probiotics. Drink before meals.",colors:['brown','yellow']},
{title:"Chamomile Magnesium Night",macros:{p:0,o:0,f:0,cal:5},ingredients:["1 Chamomile Tea Bag","8oz Hot Water","200mg Magnesium Glycinate Powder"],steps:["Steep chamomile 5 minutes","Remove tea bag","Stir in magnesium powder","Drink 30 min before bed"],why:"Chamomile activates GABA for sleep. Magnesium glycinate relaxes muscles. Perfect evening wind-down ritual.",colors:['yellow']},
{title:"Coconut Water Electrolyte",macros:{p:1,o:0,f:0,cal:45},ingredients:["8oz Coconut Water","Pinch Sea Salt","Squeeze Lime"],steps:["Pour coconut water over ice","Add sea salt and lime","Stir"],why:"Natural electrolytes (potassium). Low sugar. Perfect post-workout hydration.",colors:['white']},
{title:"Dutch Bros Large Golden Eagle (Protein)",macros:{p:16,o:0,f:0,cal:240,poly:0},ingredients:["Large Golden Eagle","Protein Shot"],steps:["Order Large Golden Eagle","Add protein shot","Enjoy"],why:"Caffeine boost + 16g protein. Vanilla + caramel flavor. Convenient protein on the go.",colors:['brown','yellow']}
],
alcohol:[
{title:"Bogle Old Vine Zinfandel",macros:{p:0,o:0,f:0,cal:125,poly:350},ingredients:["5oz Red Wine"],steps:["Pour into wine glass","Let breathe 5 minutes","Enjoy with dinner"],why:"Red wine = resveratrol (activates sirtuins for longevity). Old vine = concentrated polyphenols. Moderate consumption linked to cardiovascular benefits.",colors:['red']},
{title:"Sake (Junmai)",macros:{p:0,o:0,f:0,cal:105,poly:50},ingredients:["4oz Sake"],steps:["Serve chilled or warm","Pour into sake cup","Sip slowly with meal"],why:"Lower alcohol than wine. Amino acids from rice fermentation. Traditional pairing with omega-3 rich fish.",colors:['white']},
{title:"Sapporo Premium Beer",macros:{p:1,o:0,f:0,cal:140,poly:30},ingredients:["12oz Sapporo"],steps:["Serve cold","Pour into glass","Enjoy"],why:"Japanese lager. Lower bitterness. Moderate alcohol content. Pairs well with sushi and Asian cuisine.",colors:['yellow']}
],
snack1:[
{title:"Mikuni Pepper Fin",macros:{p:8,o:1200,f:2,cal:120,poly:50},ingredients:["1 serving Pepper Fin Tuna","Wasabi","Soy Sauce"],steps:["Open container","Add wasabi and soy to taste","Enjoy"],why:"High-quality sashimi-grade tuna. Omega-3 + protein. Quick restaurant-quality snack.",colors:['red','green']},
{title:"Edamame",macros:{p:12,o:400,f:8,cal:150,poly:100},ingredients:["1 cup Edamame (in pods)","Sea Salt"],steps:["Boil edamame 5 mins","Drain and sprinkle with sea salt","Enjoy while warm"],why:"Complete plant protein. Isoflavones support cardiovascular health. High fiber.",colors:['green']},
{title:"Beef Jerky (Grass-Fed)",macros:{p:12,o:0,f:0,cal:80,poly:0},ingredients:["1oz Beef Jerky (Grass-fed)"],steps:["Open and enjoy"],why:"Pure bioavailable protein. Zero prep. convenient.",colors:['brown']},
{title:"Savory Pulp Crackers",macros:{p:6,o:1200,f:12,cal:140,poly:50},ingredients:["Veggie Pulp","Flaxseed","Chia Seeds","Water"],steps:["Mix pulp and seeds","Spread thin on sheet","Dehydrate 8hrs"],why:"Zero waste. Massive fiber hit binds to cholesterol.",colors:['brown']},
{title:"Citrus Ginger Pulp Chews",macros:{p:3,o:200,f:8,cal:110,poly:80},ingredients:["fruit pulp","almond flour","coconut"],steps:["Mix ingredients","Dehydrate until chewy"],why:"Uses leftover pulp. High fiber treat.",colors:['orange','white']},
{title:"Dark Chocolate Oatmeal Balls",macros:{p:10,o:300,f:5,cal:210,poly:200},ingredients:["1.5 cups rolled oats","1/2 cup dark chocolate chips","1/2 cup almond butter"],steps:["Mix oats, protein, and salt","Fold in chocolate chips","Roll into balls"],why:"Oats = beta-glucan (lowers LDL). Dark chocolate = flavonols.",colors:['brown']},
{title:"Centurion Protein Balls (PB)",macros:{p:12,o:800,f:4,cal:220,poly:30},ingredients:["1 cup oats","1/2 cup peanut butter","1/3 cup honey","Protein powder"],steps:["Mix all ingredients in a bowl","Roll into balls","Refrigerate"],why:"Quick protein hit + omega-3 from flax/chia.",colors:['brown']},
{title:"Hummus & Carrots",macros:{p:4,o:0,f:6,cal:150,poly:40},ingredients:["1/2 cup Hummus","2 Carrots (sliced)"],steps:["Slice carrots","Scoop hummus","Enjoy"],why:"Fiber rich carb with healthy fats.",colors:['orange','white']},
{title:"Roasted Seaweed Snacks",macros:{p:1,o:100,f:1,cal:30,poly:20},ingredients:["1 pack Seaweed sheets"],steps:["Eat straight from pack"],why:"Iodine powerhouse for thyroid health.",colors:['green']},
{title:"Omega Nut Mix",macros:{p:6,o:2500,f:4,cal:180,poly:150},ingredients:["Walnuts","Brazil Nuts","Almonds"],steps:["Combine nuts"],why:"Walnuts essential for lowering Lp(a).",colors:['brown']},
{title:"Hard Boiled Eggs",macros:{p:12,o:100,f:0,cal:140,poly:0},ingredients:["2 Eggs","Salt","Pepper"],steps:["Boil eggs for 10 mins","Cool in ice water","Peel and season"],why:"Choline source for brain health. Pure bioavailable protein.",colors:['white','yellow']},
{title:"Sardines",macros:{p:22,o:2800,f:0,cal:190,poly:0},ingredients:["1 tin Wild-Caught Sardines","Lemon","Hot Sauce (optional)"],steps:["Open tin","Squeeze lemon over sardines","Add hot sauce if desired","Eat with fork"],why:"Sardines = highest omega-3 per calorie. Small fish = low mercury. Bones = calcium. B12 + Vitamin D. Sustainable seafood.",colors:['silver','white']}
],
snack2:[
{title:"Mikuni Pepper Fin",macros:{p:8,o:1200,f:2,cal:120,poly:50},ingredients:["1 serving Pepper Fin Tuna","Wasabi","Soy Sauce"],steps:["Open container","Add wasabi and soy to taste","Enjoy"],why:"High-quality sashimi-grade tuna. Omega-3 + protein. Quick restaurant-quality snack.",colors:['red','green']},
{title:"Edamame",macros:{p:12,o:400,f:8,cal:150,poly:100},ingredients:["1 cup Edamame (in pods)","Sea Salt"],steps:["Boil edamame 5 mins","Drain and sprinkle with sea salt","Enjoy while warm"],why:"Complete plant protein. Isoflavones support cardiovascular health. High fiber.",colors:['green']},
{title:"Beef Jerky (Grass-Fed)",macros:{p:12,o:0,f:0,cal:80,poly:0},ingredients:["1oz Beef Jerky (Grass-fed)"],steps:["Open and enjoy"],why:"Pure bioavailable protein. Zero prep. convenient.",colors:['brown']},
{title:"Savory Pulp Crackers",macros:{p:6,o:1200,f:12,cal:140,poly:50},ingredients:["Veggie Pulp","Flaxseed","Chia Seeds","Water"],steps:["Mix pulp and seeds","Spread thin on sheet","Dehydrate 8hrs"],why:"Zero waste. Massive fiber hit binds to cholesterol.",colors:['brown']},
{title:"Citrus Ginger Pulp Chews",macros:{p:3,o:200,f:8,cal:110,poly:80},ingredients:["fruit pulp","almond flour","coconut"],steps:["Mix ingredients","Dehydrate until chewy"],why:"Uses leftover pulp. High fiber treat.",colors:['orange','white']},
{title:"Dark Chocolate Oatmeal Balls",macros:{p:10,o:300,f:5,cal:210,poly:200},ingredients:["1.5 cups rolled oats","1/2 cup dark chocolate chips","1/2 cup almond butter"],steps:["Mix oats, protein, and salt","Fold in chocolate chips","Roll into balls"],why:"Oats = beta-glucan (lowers LDL). Dark chocolate = flavonols.",colors:['brown']},
{title:"Centurion Protein Balls (PB)",macros:{p:12,o:800,f:4,cal:220,poly:30},ingredients:["1 cup oats","1/2 cup peanut butter","1/3 cup honey","Protein powder"],steps:["Mix all ingredients in a bowl","Roll into balls","Refrigerate"],why:"Quick protein hit + omega-3 from flax/chia.",colors:['brown']},
{title:"Hummus & Carrots",macros:{p:4,o:0,f:6,cal:150,poly:40},ingredients:["1/2 cup Hummus","2 Carrots (sliced)"],steps:["Slice carrots","Scoop hummus","Enjoy"],why:"Fiber rich carb with healthy fats.",colors:['orange','white']},
{title:"Roasted Seaweed Snacks",macros:{p:1,o:100,f:1,cal:30,poly:20},ingredients:["1 pack Seaweed sheets"],steps:["Eat straight from pack"],why:"Iodine powerhouse for thyroid health.",colors:['green']},
{title:"Omega Nut Mix",macros:{p:6,o:2500,f:4,cal:180,poly:150},ingredients:["Walnuts","Brazil Nuts","Almonds"],steps:["Combine nuts"],why:"Walnuts essential for lowering Lp(a).",colors:['brown']},
{title:"Hard Boiled Eggs",macros:{p:12,o:100,f:0,cal:140,poly:0},ingredients:["2 Eggs","Salt","Pepper"],steps:["Boil eggs for 10 mins","Cool in ice water","Peel and season"],why:"Choline source for brain health. Pure bioavailable protein.",colors:['white','yellow']},
{title:"Sardines",macros:{p:22,o:2800,f:0,cal:190,poly:0},ingredients:["1 tin Wild-Caught Sardines","Lemon","Hot Sauce (optional)"],steps:["Open tin","Squeeze lemon over sardines","Add hot sauce if desired","Eat with fork"],why:"Sardines = highest omega-3 per calorie. Small fish = low mercury. Bones = calcium. B12 + Vitamin D. Sustainable seafood.",colors:['silver','white']}
],
juice1:null, // Will be set to juices array below
juice2:null,
juice3:null
};
// Map all juice slots to the same juices array
MEALS.juice1=MEALS.juices;
MEALS.juice2=MEALS.juices;
MEALS.juice3=MEALS.juices;
// ============================================================================
// MEAL DATABASE - END
// ============================================================================
// ============================================================================

// USER CONFIG & TOKENS
// ============================================================================
const USERS={
jermaine:{name:"Jermaine",dob:"1983-01-13",goals:{protein:175,omega3:4000,fiber:50,water:140,weightTarget:210,heightInches:76.5,z2:45,z5:20,calBurn:500,sleepHours:8},defaultBios:{bmr:'2028',apob:'114',lpa:'178',weight:'215.7',hscrp:'0.4',hba1c:'5.4',bodyfat:'21.6',muscle:'97.0'},hrvBaseline:45},
sophia:{name:"Sophia",dob:"1987-01-25",goals:{protein:130,omega3:4000,fiber:35,water:100,weightTarget:140,heightInches:64,z2:30,z5:15,calBurn:350,sleepHours:8},defaultBios:{bmr:'1450',apob:'70',lpa:'20',weight:'148',hscrp:'0.5',hba1c:'5.2',bodyfat:'18.2',muscle:'68.0'},hrvBaseline:55}
};
const TOKENS={jermaine:'WLIGFPFJQY73G43BY7CK7H6UJXPQ7N5Y',sophia:'4QSDWYJJUZFHRWRH727NCK7WH4COQJF4'};
const COLORS={red:'#ff4757',orange:'#ff9500',yellow:'#ffd60a',green:'#34d399',purple:'#a855f7',white:'#fff',brown:'#A0522D',pink:'#f093fb',black:'#333',silver:'#ccc'};

// ============================================================================
// PROTOCOLS (v21)
// ============================================================================
const PROTOCOLS={
microcurrent:{title:"‚ö° MICROCURRENT",steps:["1. CLEANSE: Oil-free","2. GEL: Thick layer","3. FOREHEAD: Upward 3min","4. CHEEKS: Nose to ear 4min each","5. JAWLINE: Jaw to ear 3min","6. NECK: Upward only 2min","7. SLOW movements"]},
microneedling:{title:"üìç MICRONEEDLING",steps:["1. SANITIZE device","2. CLEANSE 2x","3. SERUM: Apply HA","4. NEEDLE: Cross-hatch","5. WAIT 10min","6. NO actives 24hrs","7. SPF mandatory next day"]},
massage:{title:"üíÜ MASSAGE",steps:["1. OIL: Apply facial oil","2. JAW: Chin to ear","3. CHEEKS: Lift to temples","4. EYES: Gentle circles","5. FOREHEAD: Horizontal","6. DRAIN: Down to collarbone"]},
cupping:{title:"üîµ CUPPING",steps:["1. OIL back","2. STATIC 3-5min on knots","3. SLIDING along spine","4. AVOID direct spine","5. MARKS = stagnation","6. HEAT: Hyperice 15min after"]},
clubstudio:{title:"üè¢ CLUB STUDIO",steps:["OPTION A: Full Recovery","1. CRYO 3min","2. WAIT 5min","3. SAUNA 20min","4. MASSAGE BED 20min","","OPTION B: Quick","1. CRYO or Sauna only","2. MASSAGE BED 15min"]},
hipflexor:{title:"üßò HIP FLEXOR STRETCH",steps:["DURATION: 5 min total","","1. Kneeling lunge position","2. Engage core, tuck pelvis","3. Shift weight forward","4. Hold 2.5 min each side"]},
shoulder:{title:"ü¶æ SHOULDER MOBILITY",steps:["1. ARM CIRCLES (1 min)","2. DOORWAY PEC STRETCH (2 min)","3. SLEEPER STRETCH (2 min)"]},
lowhrv:{title:"üíú LOW HRV PROTOCOL",steps:["HRV IS BELOW BASELINE","","‚Ä¢ Skip HIIT today","‚Ä¢ Focus on Zone 2 only","‚Ä¢ Extra 30min sleep","‚Ä¢ No alcohol today"]}
};

// ============================================================================
// BASE PROTOCOL (v21)
// ============================================================================
const BASE=[
{id:'morningBeverage',time:'7:15 AM',title:'Morning Beverage',desc:'Tap to select',macros:{p:0,o:0,f:0,cal:0,poly:0},colors:[],clickable:true,mealSlot:'juice2',cssClass:'optional'},
{id:'breakfast',time:'7:30 AM',title:'Breakfast',desc:'Tap to select',macros:{p:0,o:0,f:0,cal:0,poly:0},colors:[],clickable:true,mealSlot:'breakfast'},
{id:'breakfastSnack',time:'10:00 AM',title:'Morning Snack',desc:'Tap to select',macros:{p:0,o:0,f:0,cal:0,poly:0},colors:[],clickable:true,mealSlot:'snack1'},
{id:'lunch',time:'1:00 PM',title:'Lunch',desc:'Tap to select',macros:{p:0,o:0,f:0,cal:0,poly:0},colors:[],clickable:true,mealSlot:'lunch'},
{id:'lunchSnack',time:'3:00 PM',title:'Afternoon Snack',desc:'Tap to select',macros:{p:0,o:0,f:0,cal:0,poly:0},colors:[],clickable:true,mealSlot:'snack2'},
{id:'afternoonBeverage',time:'3:30 PM',title:'Afternoon Beverage',desc:'Tap to select',macros:{p:0,o:0,f:0,cal:0,poly:0},colors:[],clickable:true,mealSlot:'juice3',cssClass:'optional'},
{id:'dinner',time:'6:30 PM',title:'Dinner',desc:'Tap to select',macros:{p:0,o:0,f:0,cal:0,poly:0},colors:[],clickable:true,mealSlot:'dinner'},
{id:'alcohol',time:'8:00 PM',title:'Alcohol (Optional)',desc:'Tap to select',macros:{p:0,o:0,f:0,cal:0,poly:0},colors:[],clickable:true,mealSlot:'alcohol',cssClass:'optional'}
];

// ============================================================================
// MAIN APPLICATION - MERGED v21 Logic + v22 Oura Features
// ============================================================================
class CenturionApp{
constructor(){
console.log('üöÄ Centurion v23 SKELETON');
this.user=localStorage.getItem('c_user')||'jermaine';
this.history=[];this.currentIndex=0;this.currentDateStr=new Date().toLocaleDateString('en-CA');
this.checked=JSON.parse(localStorage.getItem(`c_chk_${this.user}`)||'{}');
this.meals=JSON.parse(localStorage.getItem(`c_meals_${this.user}`)||'{}');
this.portions=JSON.parse(localStorage.getItem(`c_portions_${this.user}`)||'{}');
this.water=JSON.parse(localStorage.getItem(`c_water_${this.user}`)||'{}');
this.bios=JSON.parse(localStorage.getItem(`c_bios_${this.user}`)||'null')||USERS[this.user].defaultBios;
this.protocol=[];this.currentPortion=1;this.currentMealSlot=null;this.inRecipeView=false;this.streak=0;
document.querySelectorAll('.user-switch button').forEach(b=>b.classList.remove('active'));
document.getElementById(`btn-${this.user}`)?.classList.add('active');
this.setPlaceholder();this.render();this.fetchOura();
}

save(){
localStorage.setItem(`c_chk_${this.user}`,JSON.stringify(this.checked));
localStorage.setItem(`c_meals_${this.user}`,JSON.stringify(this.meals));
localStorage.setItem(`c_portions_${this.user}`,JSON.stringify(this.portions));
localStorage.setItem(`c_water_${this.user}`,JSON.stringify(this.water));
localStorage.setItem(`c_bios_${this.user}`,JSON.stringify(this.bios));
}

setPlaceholder(){this.history=[{date:this.currentDateStr,score:0,totalSec:0,deepSec:0,remSec:0,rhr:'-',cal:0,high:0,med:0,workouts:[],hrv:null,tempDev:0,respRate:null,readiness:null,vascularAge:null}];this.currentIndex=0}

async fetchOura(){
this.setText('syncStatus','SYNCING...');
try{
const end=new Date();end.setDate(end.getDate()+1);const start=new Date();start.setDate(start.getDate()-14);
const startStr=start.toISOString().split('T')[0],endStr=end.toISOString().split('T')[0];
const token=TOKENS[this.user],proxy='https://oura-proxy.jclarke-9a0.workers.dev?url=';
const eps=['sleep','workout','daily_activity','daily_readiness','daily_hrv'];
const results=await Promise.allSettled(eps.map(async ep=>{
const url=`${proxy}${encodeURIComponent(`https://api.ouraring.com/v2/usercollection/${ep}?start_date=${startStr}&end_date=${endStr}`)}`;
const res=await fetch(url,{headers:{'Authorization':`Bearer ${token}`}});
if(!res.ok)throw new Error(ep);
return{name:ep,data:(await res.json()).data||[]};
}));
const data={};results.forEach(r=>{if(r.status==='fulfilled')data[r.value.name]=r.value.data});
this.processData(data);this.setText('syncStatus','SYNCED ‚úì');this.render();
}catch(e){console.error(e);this.setText('syncStatus','OFFLINE');this.render()}
}

processData(data){
const m=new Map();
const g=d=>{if(!m.has(d))m.set(d,{date:d,score:0,totalSec:0,deepSec:0,remSec:0,rhr:'-',cal:0,high:0,med:0,workouts:[],hrv:null,tempDev:0,respRate:null,readiness:null,vascularAge:null});return m.get(d)};
(data.sleep||[]).forEach(s=>{const d=g(s.day);d.totalSec+=s.total_sleep_duration||0;d.deepSec+=s.deep_sleep_duration||0;d.remSec+=s.rem_sleep_duration||0;if(s.lowest_heart_rate>=35&&s.lowest_heart_rate<=100)d.rhr=Math.round(s.lowest_heart_rate);if(s.average_breath)d.respRate=s.average_breath;const sc=s.score||(s.efficiency?Math.round(s.efficiency):0);if(sc>d.score)d.score=sc});
(data.daily_hrv||[]).forEach(h=>{const d=g(h.day);if(h.contributors?.balance)d.hrv=Math.round(h.contributors.balance)});
(data.daily_readiness||[]).forEach(r=>{const d=g(r.day);d.readiness=r.score||null;if(r.contributors?.body_temperature)d.tempDev=(r.contributors.body_temperature-50)/10});
(data.daily_activity||[]).forEach(a=>{const d=g(a.day);d.cal=a.active_calories||0;d.high=(a.high_activity_time||0)/60;d.med=(a.medium_activity_time||0)/60});
(data.workout||[]).forEach(w=>{const d=g(w.day);d.workouts.push({type:w.label||w.activity||'workout',calories:w.calories||300,time:new Date(w.start_datetime).toLocaleTimeString('en-US',{hour:'numeric',minute:'2-digit'})})});
this.history=Array.from(m.values()).sort((a,b)=>b.date.localeCompare(a.date));
this.currentIndex=this.history.findIndex(h=>h.date===this.currentDateStr);
if(this.currentIndex===-1){this.history.unshift({date:this.currentDateStr,score:0,totalSec:0,deepSec:0,remSec:0,rhr:'-',cal:0,high:0,med:0,workouts:[],hrv:null,tempDev:0,respRate:null,readiness:null,vascularAge:null});this.currentIndex=0}
}

changeDate(dir){const n=this.currentIndex-dir;if(n>=0&&n<this.history.length){this.currentIndex=n;this.currentDateStr=this.history[n].date;this.render()}}

switchUser(u){if(u===this.user)return;this.user=u;localStorage.setItem('c_user',u);document.querySelectorAll('.user-switch button').forEach(b=>b.classList.remove('active'));document.getElementById(`btn-${u}`).classList.add('active');this.checked=JSON.parse(localStorage.getItem(`c_chk_${u}`)||'{}');this.meals=JSON.parse(localStorage.getItem(`c_meals_${u}`)||'{}');this.portions=JSON.parse(localStorage.getItem(`c_portions_${u}`)||'{}');this.water=JSON.parse(localStorage.getItem(`c_water_${u}`)||'{}');this.bios=JSON.parse(localStorage.getItem(`c_bios_${u}`)||'null')||USERS[u].defaultBios;this.history=[];this.setPlaceholder();this.render();this.fetchOura()}

toggleTask(id){const dk=this.currentDateStr;if(!this.checked[dk])this.checked[dk]=[];const i=this.checked[dk].indexOf(id);if(i===-1)this.checked[dk].push(id);else this.checked[dk].splice(i,1);this.save();this.render()}

setText(id,txt){const el=document.getElementById(id);if(el)el.innerText=txt}

calcMacros(){const sel=this.meals[this.currentDateStr]||{};const portions=this.portions[this.currentDateStr]||{};let t={protein:0,omega3:0,fiber:0,calories:0,polyphenol:0};Object.keys(sel).forEach(slot=>{const m=MEALS[slot]?.[sel[slot]];if(m){const p=portions[slot]||1;t.protein+=(m.macros.p||0)*p;t.omega3+=(m.macros.o||0)*p;t.fiber+=(m.macros.f||0)*p;t.calories+=(m.macros.cal||0)*p;t.polyphenol+=(m.macros.poly||0)*p}});return t}

calcRainbow(){const sel=this.meals[this.currentDateStr]||{};let s=new Set();Object.keys(sel).forEach(slot=>{const m=MEALS[slot]?.[sel[slot]];if(m?.colors)m.colors.forEach(c=>s.add(c))});return s}

addWater(){const d=this.currentDateStr;if(!this.water[d])this.water[d]=0;this.water[d]+=8;const target=USERS[this.user].goals.water;if(this.water[d]>target)this.water[d]=target;this.save();this.updateWater()}

updateWater(){const cur=this.water[this.currentDateStr]||0;const target=USERS[this.user].goals.water;this.setText('waterScore',`${cur} / ${target} oz`);document.getElementById('waterFill').style.width=`${Math.min(100,cur/target*100)}%`}

openMealPicker(slot){
this.currentMealSlot=slot;this.inRecipeView=false;
this.setText('modalTitle',slot.toUpperCase());
const all=MEALS[slot]||[];const sel=this.meals[this.currentDateStr]?.[slot];
if(all.length===0){document.getElementById('modalBody').innerHTML='<div style="text-align:center;padding:40px;color:var(--text-tertiary)">No meals in database yet.<br>Add meals to MEALS.'+slot+' array.</div>';document.getElementById('mainModal').classList.add('show');return}
document.getElementById('modalBody').innerHTML=all.map((m,i)=>`<div class="menu-item" ${sel===i?'style="border-color:var(--acid)"':''} onclick="app.showRecipe('${slot}',${i})"><div><div class="menu-name">${sel===i?'‚úì ':''}${m.title}</div><div class="menu-meta">P:${m.macros.p}g Œ©3:${m.macros.o}mg Cal:${m.macros.cal}</div></div><div class="menu-arrow">‚Ä∫</div></div>`).join('');
document.getElementById('mainModal').classList.add('show');
}

showRecipe(slot,idx){
this.currentMealSlot=slot;this.currentMealIdx=idx;this.inRecipeView=true;
const meal=MEALS[slot][idx];
const allowHalf=['breakfast','lunch','dinner','snack1','snack2'].includes(slot);
const savedPortion=this.portions[this.currentDateStr]?.[slot]||1;
if(this.currentPortion===1&&savedPortion!==1)this.currentPortion=savedPortion;
const p=this.currentPortion;
let html=`<div class="recipe-hero"><div class="recipe-title">${meal.title}</div><div class="recipe-stats">${meal.time||'Quick'} ‚Ä¢ ${meal.servings||1} serving</div></div>`;
if(allowHalf){
html+=`<div style="display:flex;gap:10px;margin:15px 0;justify-content:center">
<button onclick="app.setCurrentPortion(0.5)" style="flex:1;padding:12px;background:${p===0.5?'var(--acid)':'var(--panel)'};color:${p===0.5?'#000':'var(--text)'};border:1px solid ${p===0.5?'var(--acid)':'var(--border)'};border-radius:8px;font-weight:700;cursor:pointer">HALF</button>
<button onclick="app.setCurrentPortion(1)" style="flex:1;padding:12px;background:${p===1?'var(--acid)':'var(--panel)'};color:${p===1?'#000':'var(--text)'};border:1px solid ${p===1?'var(--acid)':'var(--border)'};border-radius:8px;font-weight:700;cursor:pointer">FULL</button>
</div>`}
html+=`<div class="macro-grid"><div class="macro-stat"><div class="m-val">${Math.round((meal.macros.p||0)*p)}g</div><div class="m-lbl">PROTEIN</div></div><div class="macro-stat"><div class="m-val">${Math.round((meal.macros.o||0)*p)}mg</div><div class="m-lbl">OMEGA-3</div></div><div class="macro-stat"><div class="m-val">${Math.round((meal.macros.f||0)*p)}g</div><div class="m-lbl">FIBER</div></div><div class="macro-stat"><div class="m-val">${Math.round((meal.macros.cal||0)*p)}</div><div class="m-lbl">CALORIES</div></div></div>`;
if(meal.why)html+=`<div class="synergy-box"><div class="syn-title">üß¨ BIO HACK</div><div class="syn-text">${meal.why}</div></div>`;
if(meal.ingredients){html+=`<div style="margin-bottom:20px"><div style="font-size:0.8rem;font-weight:900;color:var(--acid);margin-bottom:10px">INGREDIENTS</div>`;meal.ingredients.forEach(ing=>{html+=`<div class="ing-item">${ing}</div>`});html+=`</div>`}
if(meal.steps){html+=`<div><div style="font-size:0.8rem;font-weight:900;color:var(--acid);margin-bottom:10px">PREPARATION</div>`;meal.steps.forEach((step,i)=>{html+=`<div class="step-item"><div style="font-weight:900;color:var(--cyan);font-size:1.2rem;min-width:30px">${i+1}</div><div>${step}</div></div>`});html+=`</div>`}
// Beverage pairing (v21)
if(meal.suggestedBeverage&&MEALS.juices){
const bevIdx=MEALS.juices.findIndex(b=>b.title===meal.suggestedBeverage);
if(bevIdx!==-1){const bev=MEALS.juices[bevIdx];
html+=`<div onclick="app.showBeverageRecipe(${bevIdx})" style="background:var(--panel-elevated);border:1px solid var(--cyan);border-radius:10px;padding:15px;margin:20px 0;cursor:pointer"><div style="font-size:0.7rem;color:var(--cyan);font-weight:900;margin-bottom:5px">üçπ PAIRS WELL WITH</div><div style="font-size:1rem;font-weight:900;color:#fff;margin-bottom:3px">${bev.title}</div><div style="font-size:0.75rem;color:var(--text-secondary)">${bev.why||''}</div></div>`;
}}
html+=`<button onclick="app.selectMeal('${slot}',${idx});app.closeModal()" style="width:100%;background:linear-gradient(135deg,#c8ff00,#00d4ff);color:#000;padding:18px;margin-top:25px;border:none;border-radius:12px;font-weight:900;font-size:1.1rem;cursor:pointer">ADD TO PROTOCOL</button>`;
document.getElementById('modalBody').innerHTML=html;
this.setText('modalTitle',meal.title.toUpperCase());
document.getElementById('mainModal').scrollTop=0;
}

setCurrentPortion(size){this.currentPortion=size;this.showRecipe(this.currentMealSlot,this.currentMealIdx)}

selectMeal(slot,idx){
const d=this.currentDateStr;
if(!this.meals[d])this.meals[d]={};
this.meals[d][slot]=idx;
if(['breakfast','lunch','dinner','snack1','snack2'].includes(slot)){if(!this.portions[d])this.portions[d]={};this.portions[d][slot]=this.currentPortion}
const protocolItem=this.protocol.find(p=>p.mealSlot===slot);
if(protocolItem){if(!this.checked[d])this.checked[d]=[];if(!this.checked[d].includes(protocolItem.id))this.checked[d].push(protocolItem.id)}
this.currentMealSlot=null;this.inRecipeView=false;this.currentPortion=1;
this.save();this.closeModal();this.render();
}

closeModal(){
if(this.inRecipeView&&this.currentMealSlot){this.inRecipeView=false;this.openMealPicker(this.currentMealSlot);return}
this.currentMealSlot=null;this.inRecipeView=false;
document.getElementById('mainModal').classList.remove('show');
}

openBio(){
this.setText('modalTitle','BIOMETRICS');
const w=this.bios.weight||'--';const bmr=this.bios.bmr||'--';
document.getElementById('modalBody').innerHTML=`<div style="padding:10px"><div style="display:grid;grid-template-columns:1fr 1fr;gap:12px">${['weight','bmr','apob','lpa','hscrp','hba1c','bodyfat','muscle'].map(f=>`<div style="background:var(--panel);padding:12px;border-radius:10px;border:1px solid var(--border)"><div style="font-size:0.6rem;color:var(--text-tertiary);margin-bottom:6px;font-weight:700">${f.toUpperCase()}</div><input id="bio-${f}" type="number" step="0.1" value="${this.bios[f]||''}" style="width:100%;padding:8px;background:var(--bg);border:1px solid var(--border);color:var(--text);border-radius:6px;font-size:1rem"></div>`).join('')}</div><button onclick="app.saveBio()" style="width:100%;background:linear-gradient(135deg,#c8ff00,#00d4ff);color:#000;padding:15px;margin-top:20px;border:none;border-radius:10px;font-weight:800">SAVE BIOMETRICS</button></div>`;
document.getElementById('mainModal').classList.add('show');
}

saveBio(){['weight','bmr','apob','lpa','hscrp','hba1c','bodyfat','muscle'].forEach(f=>{const el=document.getElementById(`bio-${f}`);if(el?.value)this.bios[f]=el.value});this.save();this.closeModal();this.render()}

showWeeklySummary(){
const last7=this.history.slice(0,7);
const avgScore=last7.length?Math.round(last7.reduce((s,d)=>s+(d.score||0),0)/last7.length):0;
const avgSleep=last7.length?(last7.reduce((s,d)=>s+d.totalSec,0)/last7.length/3600).toFixed(1):0;
const avgRHR=last7.filter(d=>d.rhr!=='-').length?Math.round(last7.filter(d=>d.rhr!=='-').reduce((s,d)=>s+parseInt(d.rhr),0)/last7.filter(d=>d.rhr!=='-').length):0;
this.setText('modalTitle','7-DAY SUMMARY');
document.getElementById('modalBody').innerHTML=`<div style="padding:20px;text-align:center"><div style="font-size:3rem;font-weight:800;background:linear-gradient(135deg,#c8ff00,#00d4ff);-webkit-background-clip:text;-webkit-text-fill-color:transparent;margin-bottom:10px">${avgScore}</div><div style="font-size:0.8rem;color:var(--text-tertiary);margin-bottom:30px">LONGEVITY SCORE</div><div style="display:grid;grid-template-columns:1fr 1fr;gap:15px"><div style="background:var(--panel);padding:20px;border-radius:12px;border:1px solid var(--border)"><div style="font-size:2rem;font-weight:800;color:var(--cyan)">${avgSleep}h</div><div style="font-size:0.7rem;color:var(--text-tertiary)">AVG SLEEP</div></div><div style="background:var(--panel);padding:20px;border-radius:12px;border:1px solid var(--border)"><div style="font-size:2rem;font-weight:800;color:var(--alert)">${avgRHR||'--'}</div><div style="font-size:0.7rem;color:var(--text-tertiary)">AVG RHR</div></div></div><button onclick="app.closeModal()" style="width:100%;background:linear-gradient(135deg,#c8ff00,#00d4ff);color:#000;padding:18px;border:none;border-radius:12px;font-weight:800;margin-top:30px">CLOSE</button></div>`;
document.getElementById('mainModal').classList.add('show');
}

// ============================================================================
// v21 WORKOUT IMPACT DATABASE
// ============================================================================
getWorkoutImpact(workoutType){
const type=workoutType.toLowerCase();
const database={
'cs4':{impact:'high',zones:['full-body','cardio','joints'],intensity:10,recovery:'cryo+sauna+massage'},
'box':{impact:'high',zones:['upper-body','shoulders','cardio','footwork'],intensity:9,recovery:'cryo+sauna'},
'boxing':{impact:'high',zones:['upper-body','shoulders','cardio','footwork'],intensity:9,recovery:'cryo+sauna'},
'h.e.a.t.':{impact:'high',zones:['full-body','explosive-power','agility'],intensity:9,recovery:'cryo+massage'},
'heat':{impact:'high',zones:['full-body','explosive-power','agility'],intensity:9,recovery:'cryo+massage'},
'club dance':{impact:'high',zones:['cardio','legs','coordination'],intensity:9,recovery:'ice+normatec'},
'dance':{impact:'high',zones:['cardio','legs','coordination'],intensity:9,recovery:'ice+normatec'},
'ride':{impact:'low',zones:['legs','cardio','hip-flexors'],intensity:8,recovery:'normatec+stretch'},
'rebound':{impact:'low',zones:['legs','core','cardio','lymphatic'],intensity:8,recovery:'normatec+hydration'},
'yoga sculpt':{impact:'low',zones:['full-body','strength','heat-stress'],intensity:8,recovery:'sauna+stretch+hydration'},
'cs strength':{impact:'low',zones:['muscular-strength','joints'],intensity:8,recovery:'massage+ice'},
'strength':{impact:'low',zones:['muscular-strength','joints'],intensity:8,recovery:'massage+ice'},
'reform':{impact:'low',zones:['core','glutes','stabilizers'],intensity:6,recovery:'stretch+optional'},
'hot pilates':{impact:'low',zones:['core','full-body','heat-stress'],intensity:7,recovery:'hydration+stretch'},
'pilates':{impact:'low',zones:['core','full-body'],intensity:5,recovery:'stretch+optional'},
'barre':{impact:'low',zones:['glutes','legs','isometric'],intensity:6,recovery:'stretch+normatec'},
'yoga flow':{impact:'low',zones:['flexibility','core','balance'],intensity:6,recovery:'optional'},
'flow':{impact:'low',zones:['flexibility','core','balance'],intensity:6,recovery:'optional'},
'yoga restore':{impact:'none',zones:['mobility','connective-tissue'],intensity:3,recovery:'none'},
'restore':{impact:'none',zones:['mobility','connective-tissue'],intensity:3,recovery:'none'},
'cryo':{impact:'none',zones:['cellular-repair','inflammation'],intensity:1,recovery:'none'},
'recovery':{impact:'none',zones:['cellular-repair'],intensity:1,recovery:'none'},
'hiit':{impact:'high',zones:['full-body','cardio'],intensity:9,recovery:'cryo+sauna'},
'running':{impact:'medium',zones:['legs','joints','cardio'],intensity:7,recovery:'normatec+ice'},
'cycling':{impact:'low',zones:['legs','hip-flexors'],intensity:7,recovery:'normatec'},
'walking':{impact:'low',zones:['cardio'],intensity:3,recovery:'optional'},
'other':{impact:'medium',zones:['unknown'],intensity:5,recovery:'massage'}
};
return database[type]||database['other'];
}

// ============================================================================
// v21 SMART RECOVERY (workout-aware)
// ============================================================================
getSmartRecovery(day){
const workouts=day.workouts||[];
if(workouts.length===0)return null;
let maxImpact=0;let workoutNames=[];
workouts.forEach(w=>{const impact=this.getWorkoutImpact(w.type);maxImpact=Math.max(maxImpact,impact.intensity);workoutNames.push(w.type.toUpperCase())});
let protocol={time:'6:30 PM',title:'',desc:'',type:'clubstudio'};
if(maxImpact>=9){
protocol.title='üî• FULL RECOVERY PROTOCOL';
protocol.desc=`Post-${workoutNames[0]} | Club Studio: Cryo ‚Üí Sauna ‚Üí Massage | Home: Theragun ‚Üí Normatec`;
}else if(maxImpact>=8){
protocol.title='üí™ ACTIVE RECOVERY';
protocol.desc=`Post-${workoutNames[0]} | Club Studio: Sauna ‚Üí Local Cryo | Home: Normatec 30min`;
}else if(maxImpact>=6){
protocol.title='‚ú® MAINTENANCE RECOVERY';
protocol.desc=`Post-${workoutNames[0]} | Massage Bed 20min | Home: Normatec + Stretch`;
}else if(maxImpact>=4){
protocol.title='üåô LIGHT RECOVERY';
protocol.desc='Optional stretch or massage bed';
}else{return null}
return protocol;
}

// ============================================================================
// v21 DAY-OF-WEEK RECOVERY FALLBACKS
// ============================================================================
getEveningRecovery(d,hadW,wType){
if(this.user==='jermaine'){
if(d===0)return{time:'2:00 PM',title:'üèä InShape',desc:'Full ritual',type:'clubstudio'};
if((d===2||d===4)&&hadW)return{time:'7:30 PM',title:'ü•ä Post-Boxing',desc:'Club Studio: Cryo + Sauna OR Home: Theragun + Normatec',type:'clubstudio'};
if(d===2||d===4)return{time:'6:30 PM',title:'üîµ Cupping',desc:'Both 15min each + Hyperice after',type:'cupping'};
if(d===1&&hadW)return{time:'7:00 PM',title:'üí™ Post-Lift',desc:'Club Studio: Cryo + Sauna OR Home: Full stack',type:'clubstudio'};
if(d===3)return{time:'6:30 PM',title:'üßò Mid-Week Recovery',desc:'Sauna 20min + Local Cryo + Massage Bed',type:'clubstudio'};
return{time:'6:30 PM',title:'‚ú® Light Recovery',desc:'Massage bed 20min OR Normatec 30min',type:'clubstudio'}}
if(this.user==='sophia'){
if(d===0)return{time:'2:00 PM',title:'üèä InShape',desc:'Together',type:'clubstudio'};
if((d===3||d===5)&&hadW)return{time:'7:00 PM',title:'üèÉ Post-Rebound',desc:'Cryo + Sauna OR Theragun + Normatec',type:'clubstudio'};
if(d===2||d===4)return{time:'6:30 PM',title:'üîµ Cupping',desc:'Both 15min + Hyperice',type:'cupping'};
if(d===1)return{time:'6:30 PM',title:'üí™ Recovery Day',desc:'Massage bed + Sauna OR Normatec',type:'clubstudio'};
return{time:'6:30 PM',title:'‚ú® Light Recovery',desc:'Optional',type:'clubstudio'}}
return null}

// ============================================================================
// v21 FACIAL PROTOCOLS
// ============================================================================
getEndOfDayFacial(d,isFirstWeek){
if(this.user==='jermaine'){
if(d===0&&isFirstWeek)return{title:'üìç Sophia Needle',desc:'45min - SPF 24hrs',type:'microneedling'};
if(d===1||d===3||d===5||d===0)return{title:'‚ö° Sophia Micro',desc:'Lift + Tone',type:'microcurrent'};
if(d===2||d===4)return{title:'üíÜ Sophia Massage',desc:'Hand + Wands',type:'massage'};
return{title:'‚ú® Sophia Maint',desc:'Optional',type:'massage'}}
if(this.user==='sophia'){
if(d===1||d===3||d===5||d===0)return{title:'‚ö° Jermaine Micro',desc:'Jawline focus',type:'microcurrent'};
if(d===2||d===4)return{title:'üí™ Jermaine Recovery',desc:'Cold + Jaw massage',type:'massage'};
return{title:'‚ú® Jermaine Maint',desc:'Optional',type:'massage'}}
return null}

// ============================================================================
// v21 LUNCH RECOVERY (stretching)
// ============================================================================
getLunchRecovery(dow){
if(this.user==='jermaine'&&(dow===1||dow===3||dow===5))return{title:'üßò Hip Flexor',desc:'5min stretch',type:'hipflexor',clickable:true};
if(this.user==='jermaine'&&(dow===2||dow===4))return{title:'ü¶æ Shoulder',desc:'5min mobility',type:'shoulder',clickable:true};
return null}

// ============================================================================
// v21 AI DAILY RECOMMENDATION (biomarker-aware)
// ============================================================================
getDailyRecommendation(mac,day,avgScore){
const apob=parseFloat(this.bios.apob||0);
const lpa=parseFloat(this.bios.lpa||0);
const hscrp=parseFloat(this.bios.hscrp||0);
const goals=USERS[this.user].goals;
const hrvBaseline=USERS[this.user].hrvBaseline;
// HRV-aware recommendations (v22 integration)
if(day.hrv&&day.hrv<hrvBaseline*0.85)return`‚ö†Ô∏è LOW HRV (${day.hrv}ms) ‚Üí RECOVERY MODE: Z2 only, skip HIIT, sleep +1hr`;
// Biomarker priorities
if(lpa>150&&mac.omega3<3000)return'LP(A) ELEVATED ‚Üí WALNUTS + FLAX ESSENTIAL';
if(apob>100&&mac.fiber<30)return'APOB HIGH ‚Üí FIBER TARGET: +20G TODAY';
if(hscrp>1.0)return'INFLAMMATION DETECTED ‚Üí TURMERIC STACK';
// Macro gaps
const proteinGap=goals.protein-mac.protein;
const omega3Gap=goals.omega3-mac.omega3;
const fiberGap=goals.fiber-mac.fiber;
if(proteinGap>50)return`PROTEIN GAP: +${Math.round(proteinGap)}G NEEDED`;
if(omega3Gap>2000)return`OMEGA-3 LOW ‚Üí +${Math.round(omega3Gap/1000)}G FISH/FLAX`;
if(fiberGap>20)return`FIBER DEFICIT: +${Math.round(fiberGap)}G BEANS/OATS`;
// Zone targets
const z2Remaining=Math.max(0,goals.z2-(day.med||0));
const z5Remaining=Math.max(0,goals.z5-(day.high||0));
if(z2Remaining>20)return`ZONE 2: +${Math.round(z2Remaining)}MIN WALK NEEDED`;
if(z5Remaining>10)return`ZONE 5: +${Math.round(z5Remaining)}MIN HIIT PENDING`;
// Sleep
if((day.totalSec||0)/3600<7)return`SLEEP DEBT: ${((day.totalSec||0)/3600).toFixed(1)}H ‚Üí TARGET 8H TONIGHT`;
// Score feedback
if(avgScore>=90)return`OPTIMAL PROTOCOL ‚Üí LONGEVITY SCORE: ${avgScore}`;
if(avgScore>=75)return`SOLID WEEK ‚Üí SCORE ${avgScore} ‚Üí FINE TUNE`;
if(avgScore<60)return`FOCUS MODE ‚Üí SCORE ${avgScore} ‚Üí SLEEP + MOVEMENT`;
return'ALL SYSTEMS OPTIMAL ‚Üí PROTOCOL LOCKED';
}

// ============================================================================
// v21 STREAK CALCULATOR
// ============================================================================
calculateStreak(){
let streak=0;
for(let i=0;i<this.history.length;i++){
const day=this.history[i];
const chk=this.checked[day.date]||[];
const requiredIds=BASE.filter(t=>!t.cssClass?.includes('optional')).map(t=>t.id);
const allChecked=requiredIds.every(id=>chk.includes(id));
if(allChecked&&requiredIds.length>0)streak++;else break;
}
this.streak=streak;
}

// ============================================================================
// v21 MACRO CALCULATOR FOR ANY DATE
// ============================================================================
calculateMacrosForDate(date){
const sel=this.meals[date]||{};
const portions=this.portions[date]||{};
let t={protein:0,omega3:0,fiber:0,calories:0,polyphenol:0};
Object.keys(sel).forEach(slot=>{
const idx=sel[slot];
const meal=MEALS[slot]?.[idx];
if(meal){
const portion=['breakfast','lunch','dinner','snack1','snack2'].includes(slot)?(portions[slot]||1):1;
t.protein+=(meal.macros.p||0)*portion;
t.omega3+=(meal.macros.o||0)*portion;
t.fiber+=(meal.macros.f||0)*portion;
t.calories+=(meal.macros.cal||0)*portion;
t.polyphenol+=(meal.macros.poly||0)*portion;
}
});
return t}

// ============================================================================
// v21 BEVERAGE RECIPE VIEW
// ============================================================================
showBeverageRecipe(idx){
const bev=MEALS.juices[idx];
if(!bev)return;
const mb=document.getElementById('modalBody');
this.setText('modalTitle',bev.title.toUpperCase());
let html=`<div class="recipe-hero"><div class="recipe-title">${bev.title}</div></div>`;
html+=`<div class="macro-grid"><div class="macro-stat"><div class="m-val">${bev.macros.p}g</div><div class="m-lbl">PROTEIN</div></div><div class="macro-stat"><div class="m-val">${bev.macros.o}mg</div><div class="m-lbl">OMEGA-3</div></div><div class="macro-stat"><div class="m-val">${bev.macros.f}g</div><div class="m-lbl">FIBER</div></div><div class="macro-stat"><div class="m-val">${bev.macros.cal}</div><div class="m-lbl">CALORIES</div></div></div>`;
if(bev.why)html+=`<div class="synergy-box"><div class="syn-title">üçπ WHY THIS WORKS</div><div class="syn-text">${bev.why}</div></div>`;
if(bev.ingredients){html+=`<div style="margin-bottom:20px"><div style="font-size:0.8rem;font-weight:900;color:var(--acid);margin-bottom:10px">INGREDIENTS</div>`;bev.ingredients.forEach(ing=>{html+=`<div class="ing-item">${ing}</div>`});html+=`</div>`}
if(bev.steps){html+=`<div><div style="font-size:0.8rem;font-weight:900;color:var(--acid);margin-bottom:10px">PREPARATION</div>`;bev.steps.forEach((step,i)=>{html+=`<div class="step-item"><div style="font-weight:900;color:var(--cyan);font-size:1.2rem;min-width:30px">${i+1}</div><div>${step}</div></div>`});html+=`</div>`}
html+=`<button onclick="app.closeModal()" style="width:100%;background:linear-gradient(135deg,#c8ff00,#00d4ff);color:#000;padding:18px;margin-top:25px;border:none;border-radius:12px;font-weight:900;font-size:1.1rem;cursor:pointer">CLOSE</button>`;
mb.innerHTML=html;
document.getElementById('mainModal').scrollTop=0;
}

showProtocolDetails(type){
const p=PROTOCOLS[type]||{title:"ROUTINE",steps:["Follow standard procedure."]};
let html=`<div style="text-align:center;margin:30px 0"><div style="font-size:1.8rem;font-weight:900;color:#fff">${p.title}</div></div><div style="background:var(--panel);border-radius:12px;border:1px solid var(--border);overflow:hidden">${p.steps.map(s=>`<div style="padding:18px 20px;border-bottom:1px solid var(--border);font-size:0.95rem;color:#ddd;line-height:1.6">${s}</div>`).join('')}</div>`;
this.setText('modalTitle','PROTOCOL');
document.getElementById('modalBody').innerHTML=html;
document.getElementById('mainModal').classList.add('show');
}

render(){
if(!this.history.length)return;
const day=this.history[this.currentIndex];
const date=day.date;
const sel=this.meals[date]||{};
const chk=this.checked[date]||[];
const goals=USERS[this.user].goals;
const hrvBaseline=USERS[this.user].hrvBaseline;
const hrvLow=day.hrv&&day.hrv<hrvBaseline*0.85;
this.setText('dateLabel',date);

// Recovery Battery (v22)
const batteryScore=day.readiness||Math.round((day.score||0)*0.8);
this.setText('batteryScore',batteryScore||'--');
document.getElementById('batteryFill').style.width=`${batteryScore||0}%`;
this.setText('bcHrv',day.hrv||'--');
this.setText('bcSleep',`${((day.totalSec||0)/3600).toFixed(1)}h`);
this.setText('bcReadiness',day.readiness||'--');
this.setText('bcStrain',Math.round((day.high||0)+(day.med||0)*0.5)||'--');

// Trends
const last7=this.history.slice(0,7);
const calcTrend=(cur,key)=>{if(!cur)return'';const prev=last7.slice(1,4).filter(d=>d[key]).map(d=>d[key]);if(!prev.length)return'';const avg=prev.reduce((a,b)=>a+b,0)/prev.length;const diff=cur-avg;if(Math.abs(diff)<2)return'';return diff>0?'<span class="trend-up">‚Üë</span>':'<span class="trend-down">‚Üì</span>'};
document.getElementById('bcHrvTrend').innerHTML=calcTrend(day.hrv,'hrv');
document.getElementById('bcSleepTrend').innerHTML=calcTrend(day.totalSec/3600,'totalSec');

// Scores
const avgScore=last7.length?Math.round(last7.reduce((s,d)=>s+(d.score||0),0)/last7.length):0;
this.setText('longevityScore',avgScore);
document.getElementById('longevityOrb').style.strokeDashoffset=251-(avgScore/100*251);
const dayScore=Math.min(100,Math.round(((day.totalSec||0)/3600/8)*100));
this.setText('dayGrade',dayScore>=85?'A':dayScore>=70?'B':'C');
document.getElementById('dayScoreOrb').style.strokeDashoffset=251-(dayScore/100*251);

// Status & Insights (v22 HRV-aware + v21 AI recommendations)
const mac=this.calcMacros();
let status=this.getDailyRecommendation(mac,day,avgScore);
let insights='';
if(hrvLow){
insights+=`<div class="insight-card warning"><div class="insight-header"><span class="insight-icon">üíú</span><span class="insight-title">HRV Below Baseline</span></div><div class="insight-body">Your HRV is ${day.hrv}ms vs baseline ${hrvBaseline}ms. Body needs recovery.</div><div class="insight-action">‚Üí Skip HIIT, walk 30min Z2, sleep +1hr</div></div>`;
}
if(Math.abs(day.tempDev||0)>0.5){
insights+=`<div class="insight-card ${Math.abs(day.tempDev||0)>1?'alert':'warning'}"><div class="insight-header"><span class="insight-icon">üå°Ô∏è</span><span class="insight-title">Temperature Deviation</span></div><div class="insight-body">Temp is ${day.tempDev>0?'+':''}${(day.tempDev||0).toFixed(1)}¬∞ from baseline.</div><div class="insight-action">‚Üí Monitor symptoms, reduce intensity</div></div>`;
}
this.setText('statusMsg',status);
document.getElementById('insightContainer').innerHTML=insights;

// Recovery Metrics (v22)
this.setText('hrvVal',day.hrv||'--');
const hrvCard=document.getElementById('hrvCard');
hrvCard.classList.remove('alert','warning','optimal');
if(hrvLow)hrvCard.classList.add('warning');else if(day.hrv&&day.hrv>=hrvBaseline)hrvCard.classList.add('optimal');
this.setText('tempVal',`${day.tempDev>0?'+':''}${(day.tempDev||0).toFixed(1)}¬∞`);
const tempInd=document.getElementById('tempIndicator');
tempInd.className='temp-indicator '+(Math.abs(day.tempDev||0)>1?'temp-high':Math.abs(day.tempDev||0)>0.5?'temp-elevated':'temp-normal');
this.setText('respVal',day.respRate?day.respRate.toFixed(1):'--');
this.setText('readinessVal',day.readiness||'--');
const upd=(id,val,max)=>{const el=document.getElementById(id);if(el)el.style.strokeDashoffset=138-(Math.min(val/max,1)*138)};
upd('readinessOrb',day.readiness||0,100);

// Sleep Debt (v22)
const sleepTarget=goals.sleepHours*7;
const sleepActual=last7.reduce((s,d)=>s+(d.totalSec||0)/3600,0);
const sleepDebt=sleepActual-sleepTarget;
this.setText('sleepDebtValue',`${sleepDebt>0?'+':''}${sleepDebt.toFixed(1)}h`);
const debtVis=document.getElementById('sleepDebtVisual');
debtVis.className='sleep-debt-visual '+(sleepDebt<-3?'debt-positive':sleepDebt>1?'debt-negative':'debt-neutral');

// Sleep Architecture
this.setText('sleepVal',`${((day.totalSec||0)/3600).toFixed(1)}h`);
this.setText('deepVal',`${Math.round((day.deepSec||0)/60)}m`);
this.setText('remVal',`${Math.round((day.remSec||0)/60)}m`);
upd('sleepOrb',(day.totalSec||0)/3600,8);
upd('deepOrb',(day.deepSec||0)/60,90);
upd('remOrb',(day.remSec||0)/60,90);

// Nutrition
const updMac=(id,val,max)=>{upd(id,val,max);const txt=document.getElementById(id.replace('Orb','Val'));if(txt)txt.innerText=Math.round(val)};
updMac('proteinOrb',mac.protein,goals.protein);
updMac('omega3Orb',mac.omega3,4000);
updMac('fiberOrb',mac.fiber,goals.fiber);
this.setText('polyphenolVal',Math.round(mac.polyphenol||0));
upd('polyphenolOrb',mac.polyphenol||0,1000);

// Metabolism (v21)
const bmr=parseFloat(this.bios.bmr||2000);
const totalBurn=bmr+(day.cal||0);
const balance=mac.calories-totalBurn;
this.setText('balanceVal',`${balance>0?'+':''}${Math.round(balance)}`);
this.setText('balanceLabel',balance<0?'DEFICIT':'SURPLUS');
this.setText('eatenVal',Math.round(mac.calories));
this.setText('burnedVal',Math.round(totalBurn));
this.setText('bmrVal',Math.round(bmr));
upd('balanceOrb',Math.abs(balance),500);

// Vascular (v21)
const actualAge=this.user==='jermaine'?43:39;
this.setText('actualAge',actualAge);
const vascLast7=this.history.slice(0,7).filter(d=>d.vascularAge);
if(vascLast7.length>0){
const avgVAge=Math.round(vascLast7.reduce((sum,d)=>sum+d.vascularAge,0)/vascLast7.length);
const diff=actualAge-avgVAge;
this.setText('vascularAge',avgVAge);
this.setText('ageDiff',Math.abs(diff));
this.setText('ageDiffLabel',diff>0?'YOUNGER':'OLDER');
}else{this.setText('vascularAge','--');this.setText('ageDiff','--');this.setText('vascularTrend','--')}

// Cardio
this.setText('rhrVal',day.rhr!=='-'?day.rhr:'--');
const updHeart=(id,val,max)=>{const el=document.getElementById(id);if(el)el.style.strokeDashoffset=100-(Math.min(val/max,1)*100)};
updHeart('z2Heart',day.med||0,45);
if(hrvLow){document.getElementById('z5Heart').style.stroke='var(--orange)';this.setText('z5Val','‚òÖ');this.setText('z5Label','RECOVERY')}
else{document.getElementById('z5Heart').style.stroke='var(--alert)';this.setText('z5Val',Math.round(day.high||0));this.setText('z5Label','ZONE 5');updHeart('z5Heart',day.high||0,20)}
this.setText('z2Val',Math.round(day.med||0));
this.setText('calVal',Math.round(day.cal||0));
updHeart('calHeart',day.cal||0,500);

// Water & Rainbow
this.updateWater();
const cols=this.calcRainbow();
this.setText('rainbowScore',Math.round((cols.size/6)*100)+'%');
document.getElementById('rainbowTrack').innerHTML=['red','orange','yellow','green','purple','white'].map(c=>`<div class="rainbow-seg" style="background:${cols.has(c)?COLORS[c]:'#333'};width:${cols.has(c)?16.6:0}%"></div>`).join('');

// Build Protocol (merged v21 + v22)
this.protocol=[...BASE];
const dateObj=new Date(date+'T12:00:00');
const dow=dateObj.getDay();
const weekOfMonth=Math.ceil(dateObj.getDate()/7);
const isFirstWeek=weekOfMonth===1;
const hadWorkout=day.workouts.length>0;
const workoutType=hadWorkout?day.workouts[0].type:'';

// Auto-detected workouts
day.workouts.forEach((w,i)=>{
const impact=this.getWorkoutImpact(w.type);
this.protocol.push({id:`workout_${i}`,time:w.time,title:`${w.type.toUpperCase()} Detected`,desc:`${w.calories} cal | Impact: ${impact.impact.toUpperCase()} (${impact.intensity}/10)`,autoDetected:true});
});

// Lunch recovery stretching (v21)
const lunchRec=this.getLunchRecovery(dow);
if(lunchRec)this.protocol.push({id:'lunch_recovery',time:'12:30 PM',title:lunchRec.title,desc:lunchRec.desc,clickable:lunchRec.clickable,type:lunchRec.type,cssClass:'recovery'});

// Smart recovery (workout-aware) or day-of-week fallback (v21)
const smartRec=this.getSmartRecovery(day);
if(smartRec){
this.protocol.push({id:'smart_recovery',time:smartRec.time,title:smartRec.title,desc:smartRec.desc,clickable:true,type:smartRec.type,cssClass:'recovery'});
}else{
const eveningRec=this.getEveningRecovery(dow,hadWorkout,workoutType);
if(eveningRec)this.protocol.push({id:'evening_recovery',time:eveningRec.time,title:eveningRec.title,desc:eveningRec.desc,clickable:true,type:eveningRec.type,cssClass:'recovery'});
}

// Facial protocol (v21)
const facial=this.getEndOfDayFacial(dow,isFirstWeek);
if(facial)this.protocol.push({id:'facial',time:'9:00 PM',title:facial.title,desc:facial.desc,clickable:true,type:facial.type,cssClass:'facial'});

// HRV low override (v22)
if(hrvLow)this.protocol.push({id:'hrv_rec',time:'ALL DAY',title:'‚ö†Ô∏è LOW HRV - RECOVERY',desc:'Skip HIIT, focus Zone 2',hrvAdjusted:true,clickable:true,type:'lowhrv'});

// Sort by time
this.protocol.sort((a,b)=>{const pt=t=>{const m=t.match(/(\d+):(\d+)\s*(AM|PM)/i);if(!m)return 0;let h=parseInt(m[1]);if(m[3].toUpperCase()==='PM'&&h!==12)h+=12;if(m[3].toUpperCase()==='AM'&&h===12)h=0;return h*60+parseInt(m[2])};return pt(a.time)-pt(b.time)});

// Streak (v21)
this.calculateStreak();
this.setText('streakCount',this.streak);
const streakPct=Math.min(this.streak/7,1);
document.getElementById('streakOrb').style.strokeDashoffset=251-(streakPct*251);

// Vascular trend (v21)
const vascLast14=this.history.slice(0,14).filter(d=>d.vascularAge);
if(vascLast14.length>=2){
const recent=vascLast14.slice(0,3).reduce((s,d)=>s+d.vascularAge,0)/Math.min(3,vascLast14.length);
const older=vascLast14.slice(-3).reduce((s,d)=>s+d.vascularAge,0)/Math.min(3,vascLast14.slice(-3).length);
const trend=recent-older;
this.setText('vascularTrend',`${trend>0?'+':''}${trend.toFixed(1)}`);
}else{this.setText('vascularTrend','--')}

// Apply meal selections
this.protocol.forEach(t=>{if(t.mealSlot&&sel[t.mealSlot]!==undefined){const m=MEALS[t.mealSlot]?.[sel[t.mealSlot]];if(m){const portion=this.portions[date]?.[t.mealSlot]||1;t.title=m.title+(portion===0.5?' (HALF)':'');t.desc=`P:${Math.round((m.macros.p||0)*portion)}g Cal:${Math.round((m.macros.cal||0)*portion)}`;t.macros={p:(m.macros.p||0)*portion,o:(m.macros.o||0)*portion,f:(m.macros.f||0)*portion,cal:(m.macros.cal||0)*portion,poly:(m.macros.poly||0)*portion};t.colors=m.colors}}});

// Render timeline
document.getElementById('timeline').innerHTML=this.protocol.map(t=>{
const isC=chk.includes(t.id);
const cc=`task-card ${isC?'checked':''} ${t.autoDetected?'auto-detected':''} ${t.hrvAdjusted?'hrv-adjusted':''} ${t.cssClass||''}`;
let ca='';
if(t.clickable&&t.type&&PROTOCOLS[t.type])ca=`onclick="app.showProtocolDetails('${t.type}')"`;
else if(t.mealSlot)ca=`onclick="app.openMealPicker('${t.mealSlot}')"`;
return `<div class="task"><div class="task-time">${t.time}</div><div class="${cc}" ${ca}><div class="task-info"><div class="task-title">${t.title}</div><div class="task-desc">${t.desc||'Tap to select'}</div></div>${(t.mealSlot||t.clickable)?'<div class="chevron">‚Ä∫</div>':''}${!t.autoDetected&&!t.hrvAdjusted?`<div class="check-btn" onclick="event.stopPropagation();app.toggleTask('${t.id}')"><div class="check-circle">${isC?'‚úì':''}</div></div>`:''}</div></div>`;
}).join('');
}

sync(){this.fetchOura()}
}

let app;window.onload=()=>{app=new CenturionApp();window.app=app};
</script>

</body>
</html>