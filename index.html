<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>The Centurion</title>
    <style>
        /* ==========================================
           CORE RESET & VARIABLES
           ========================================== */
        * { margin: 0; padding: 0; box-sizing: border-box; }
        
        :root {
            --bg-dark: #0a0a0a;
            --bg-card: #1a1a1a;
            --gold: #FFD60A;
            --text: #ffffff;
            --text-dim: #888;
            --green: #00ff00;
            --red: #ff4444;
            --blue: #4A90E2;
            --purple: #9b59b6;
        }
        
        body {
            font-family: -apple-system, BlinkMacSystemFont, 'Segoe UI', Roboto, sans-serif;
            background: var(--bg-dark);
            color: var(--text);
            line-height: 1.6;
            padding-bottom: 80px;
        }
        
        .container { max-width: 100%; margin: 0 auto; padding: 15px; }
        
        /* ==========================================
           HEADER
           ========================================== */
        .header {
            text-align: center;
            padding: 25px 15px 20px;
            background: linear-gradient(135deg, #1a1a1a 0%, #0a0a0a 100%);
            border-bottom: 2px solid var(--gold);
            margin-bottom: 20px;
        }
        
        .logo { 
            font-size: 2rem; 
            font-weight: 900; 
            background: linear-gradient(135deg, var(--gold) 0%, #FFA500 100%);
            -webkit-background-clip: text;
            -webkit-text-fill-color: transparent;
            margin-bottom: 5px;
            letter-spacing: 2px;
        }
        
        .tagline { 
            font-size: 0.7rem; 
            color: var(--text-dim); 
            font-weight: 600;
            letter-spacing: 3px;
        }
        
        /* ==========================================
           USER TOGGLE
           ========================================== */
        .user-toggle {
            display: flex;
            gap: 10px;
            margin: 20px auto;
            max-width: 300px;
            background: var(--bg-card);
            padding: 5px;
            border-radius: 25px;
        }
        
        .user-btn {
            flex: 1;
            padding: 12px;
            border: none;
            background: transparent;
            color: var(--text-dim);
            font-weight: 700;
            border-radius: 20px;
            cursor: pointer;
            transition: all 0.3s;
            font-size: 0.85rem;
        }
        
        .user-btn.active { background: var(--gold); color: #000; }
        
        /* ==========================================
           CARDS
           ========================================== */
        .card {
            background: var(--bg-card);
            border-radius: 16px;
            padding: 20px;
            margin-bottom: 20px;
            border: 1px solid rgba(255, 214, 10, 0.1);
        }
        
        .card-header {
            display: flex;
            justify-content: space-between;
            align-items: center;
            margin-bottom: 15px;
            cursor: pointer;
            user-select: none;
        }
        
        .card-title {
            font-size: 0.7rem;
            font-weight: 800;
            letter-spacing: 2px;
            color: var(--gold);
        }
        
        .card-subtitle {
            font-size: 0.65rem;
            color: var(--text-dim);
            margin-top: 3px;
        }
        
        .card-value {
            font-size: 2rem;
            font-weight: 900;
            color: var(--text);
        }
        
        .card-unit {
            font-size: 0.9rem;
            color: var(--text-dim);
            margin-left: 5px;
        }
        
        .collapse-icon {
            font-size: 1.2rem;
            color: var(--text-dim);
            transition: transform 0.3s;
        }
        
        .collapse-icon.collapsed { transform: rotate(180deg); }
        
        .card-content { transition: all 0.3s ease; }
        .card-content.hidden { display: none; }
        
        /* ==========================================
           INTELLIGENCE BOXES (Translucent Yellow)
           ========================================== */
        .intelligence-box {
            padding: 12px;
            background: rgba(255, 214, 10, 0.08);
            border-left: 3px solid var(--gold);
            border-radius: 8px;
            margin-bottom: 15px;
        }
        
        .intelligence-box-title {
            font-size: 0.7rem;
            font-weight: 700;
            color: var(--gold);
            margin-bottom: 5px;
            letter-spacing: 1px;
        }
        
        .intelligence-box-content {
            font-size: 0.75rem;
            line-height: 1.5;
            color: var(--text);
        }
        
        .alert-box {
            padding: 12px;
            background: rgba(255, 0, 0, 0.1);
            border-left: 3px solid var(--red);
            border-radius: 8px;
            margin-bottom: 15px;
        }
        
        .alert-box-title {
            font-size: 0.7rem;
            font-weight: 700;
            color: var(--red);
            margin-bottom: 5px;
            letter-spacing: 1px;
        }
        
        /* ==========================================
           MACRO DASHBOARD (Daily Adherence Tracking)
           ========================================== */
        .macro-dashboard {
            display: grid;
            gap: 12px;
            margin-top: 15px;
        }
        
        .macro-row {
            background: rgba(255, 255, 255, 0.03);
            padding: 12px 15px;
            border-radius: 10px;
            border: 1px solid rgba(255, 214, 10, 0.1);
        }
        
        .macro-row-header {
            display: flex;
            justify-content: space-between;
            align-items: center;
            margin-bottom: 8px;
        }
        
        .macro-name {
            font-size: 0.75rem;
            font-weight: 700;
            color: var(--gold);
            letter-spacing: 1px;
        }
        
        .macro-values {
            font-size: 0.7rem;
            color: var(--text-dim);
        }
        
        .macro-current {
            color: var(--text);
            font-weight: 800;
        }
        
        .macro-progress-bar {
            height: 8px;
            background: rgba(255, 255, 255, 0.1);
            border-radius: 4px;
            overflow: hidden;
            position: relative;
        }
        
        .macro-progress-fill {
            height: 100%;
            border-radius: 4px;
            transition: width 0.5s ease;
            background: linear-gradient(90deg, var(--gold) 0%, #FFA500 100%);
        }
        
        .macro-progress-fill.complete {
            background: linear-gradient(90deg, var(--green) 0%, #00cc00 100%);
        }
        
        .macro-progress-fill.over {
            background: linear-gradient(90deg, var(--red) 0%, #cc0000 100%);
        }
        
        /* ==========================================
           METRICS
           ========================================== */
        .metric-grid { display: grid; gap: 15px; }
        
        .metric-item {
            background: rgba(255, 255, 255, 0.03);
            padding: 15px;
            border-radius: 12px;
            border: 1px solid rgba(255, 214, 10, 0.1);
        }
        
        .metric-label {
            font-size: 0.75rem;
            color: var(--text-dim);
            margin-bottom: 8px;
            display: flex;
            justify-content: space-between;
            align-items: center;
        }
        
        .metric-goal { font-size: 0.65rem; opacity: 0.7; }
        
        .metric-comparison {
            display: grid;
            grid-template-columns: 1fr 1fr;
            gap: 15px;
            margin-top: 10px;
        }
        
        .metric-col { flex: 1; }
        
        .metric-col-label {
            font-size: 0.6rem;
            color: var(--text-dim);
            margin-bottom: 5px;
            text-transform: uppercase;
            letter-spacing: 1px;
        }
        
        .metric-value {
            font-size: 1.5rem;
            font-weight: 800;
            margin-bottom: 8px;
        }
        
        .metric-bar {
            height: 6px;
            background: rgba(255, 255, 255, 0.1);
            border-radius: 3px;
            overflow: hidden;
        }
        
        .metric-fill {
            height: 100%;
            border-radius: 3px;
            transition: width 0.5s ease;
        }
        
        .confidence {
            font-size: 0.65rem;
            color: var(--text-dim);
            margin-top: 8px;
        }
        
        .ai-badge {
            background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
            color: white;
            padding: 3px 10px;
            border-radius: 12px;
            font-size: 0.65rem;
            font-weight: 700;
            letter-spacing: 1px;
        }
        
        .status-optimal { color: var(--green); }
        .status-warning { color: #FFA500; }
        .status-alert { color: var(--red); }
        
        /* ==========================================
           BUTTONS
           ========================================== */
        .action-btn {
            background: var(--gold);
            color: #000;
            border: none;
            padding: 15px 25px;
            border-radius: 12px;
            font-weight: 700;
            font-size: 0.9rem;
            cursor: pointer;
            width: 100%;
            margin-top: 10px;
            transition: all 0.3s;
        }
        
        .action-btn:active { transform: scale(0.98); }
        
        /* ==========================================
           MODALS (ENHANCED)
           ========================================== */
        .modal {
            display: none;
            position: fixed;
            top: 0;
            left: 0;
            width: 100%;
            height: 100%;
            background: rgba(0, 0, 0, 0.95);
            backdrop-filter: blur(10px);
            -webkit-backdrop-filter: blur(10px);
            z-index: 1000;
            overflow-y: auto;
            padding: 20px;
        }
        
        .modal-content {
            background: var(--bg-card);
            margin: 20px auto;
            padding: 25px;
            border-radius: 20px;
            border: 2px solid var(--gold);
            max-width: 500px;
            position: relative;
            box-shadow: 0 10px 50px rgba(255, 214, 10, 0.3);
        }
        
        .modal-header {
            display: flex;
            justify-content: space-between;
            align-items: center;
            margin-bottom: 20px;
            padding-bottom: 15px;
            border-bottom: 1px solid rgba(255, 214, 10, 0.2);
        }
        
        .modal-title {
            font-size: 1.2rem;
            font-weight: 800;
            color: var(--gold);
        }
        
        .close-btn {
            background: none;
            border: none;
            color: var(--text-dim);
            font-size: 1.8rem;
            cursor: pointer;
            padding: 0;
            width: 35px;
            height: 35px;
            display: flex;
            align-items: center;
            justify-content: center;
            transition: all 0.3s;
        }
        
        .close-btn:hover {
            color: var(--gold);
            transform: scale(1.1);
        }
        
        /* ==========================================
           MEAL LOGGING
           ========================================== */
        .meal-category { margin-bottom: 25px; }
        
        .meal-category-title {
            font-size: 0.8rem;
            font-weight: 800;
            color: var(--gold);
            margin-bottom: 12px;
            letter-spacing: 2px;
        }
        
        .photo-upload {
            border: 2px dashed var(--gold);
            border-radius: 16px;
            padding: 30px;
            text-align: center;
            margin: 20px 0;
            cursor: pointer;
            transition: all 0.3s;
        }
        
        .photo-upload:hover { background: rgba(255, 214, 10, 0.05); }
        
        .photo-preview {
            max-width: 100%;
            border-radius: 12px;
            margin: 15px 0;
        }
        
        input[type="file"] { display: none; }
        
        .macro-grid {
            display: grid;
            grid-template-columns: repeat(2, 1fr);
            gap: 10px;
            margin-top: 15px;
        }
        
        .macro-item {
            background: rgba(255, 255, 255, 0.05);
            padding: 12px;
            border-radius: 10px;
            text-align: center;
        }
        
        .macro-label {
            font-size: 0.65rem;
            color: var(--text-dim);
            margin-bottom: 5px;
        }
        
        .macro-value {
            font-size: 1.3rem;
            font-weight: 800;
            color: var(--gold);
        }
        
        /* ==========================================
           INPUTS
           ========================================== */
        input[type="number"], input[type="text"], textarea {
            width: 100%;
            background: rgba(255, 255, 255, 0.05);
            border: 1px solid rgba(255, 214, 10, 0.2);
            border-radius: 10px;
            padding: 12px;
            color: var(--text);
            font-size: 0.9rem;
            margin-bottom: 12px;
        }
        
        input[type="number"]:focus, input[type="text"]:focus, textarea:focus {
            outline: none;
            border-color: var(--gold);
        }
        
        label {
            display: block;
            font-size: 0.75rem;
            color: var(--text-dim);
            margin-bottom: 6px;
            font-weight: 600;
        }
    </style>
</head>
<body>
    <!-- ==========================================
         HEADER
         ========================================== -->
    <div class="header">
        <div class="logo">THE CENTURION</div>
        <div class="tagline">OPTIMIZE TO 100+</div>
        
        <!-- User Toggle -->
        <div class="user-toggle">
            <button class="user-btn active" onclick="switchUser('J')">JERMAINE</button>
            <button class="user-btn" onclick="switchUser('S')">SOPHIA</button>
        </div>
    </div>

    <div class="container">
        
        <!-- ==========================================
             1. LONGEVITY TRACKER (Life Expectancy + Intelligence Briefing)
             ========================================== -->
        <div class="card">
            <div class="card-header">
                <div>
                    <div class="card-title">üèÜ LONGEVITY TRACKER</div>
                    <div class="card-subtitle">AI-Predicted Life Expectancy</div>
                </div>
                <div>
                    <span class="card-value" id="lifeExpectancy">94</span>
                    <span class="card-unit">YEARS</span>
                </div>
            </div>
            <button class="action-btn" onclick="showDailySuggestions()">ü§ñ DAILY INTELLIGENCE BRIEFING</button>
        </div>

        <!-- ==========================================
             2. OURA READINESS (Auto-synced)
             ========================================== -->
        <div class="card">
            <div class="card-header" onclick="toggleSection('oura')">
                <div>
                    <div class="card-title">üíç OURA READINESS</div>
                    <div class="card-subtitle">Auto-synced on load</div>
                </div>
                <div style="display: flex; align-items: center; gap: 15px;">
                    <span class="card-value" id="ouraScore">85</span>
                    <span class="collapse-icon" id="oura-icon">‚ñº</span>
                </div>
            </div>
            <div class="card-content" id="oura-content">
                <div class="intelligence-box">
                    <div class="intelligence-box-title">üì± AUTO-SYNC STATUS</div>
                    <div class="intelligence-box-content">
                        Last synced: <span id="ouraTimestamp">Never</span>
                    </div>
                    <div style="font-size: 0.7rem; color: var(--text-dim); margin-top: 8px;">
                        Data refreshes automatically when you open The Centurion. Tap below to manually refresh if needed.
                    </div>
                </div>
                <button class="action-btn" onclick="updateOura()">üîÑ MANUAL REFRESH</button>
            </div>
        </div>

        <!-- ==========================================
             3. PROTOCOL (Today's Workout + Smart Suggestions)
             ========================================== -->
        <div class="card">
            <div class="card-header" onclick="toggleSection('protocol')">
                <div>
                    <div class="card-title">üéØ PROTOCOL</div>
                    <div class="card-subtitle" id="protocolName">REFORM</div>
                </div>
                <div style="display: flex; align-items: center; gap: 15px;">
                    <span class="card-value" id="protocolScore">73</span>
                    <span class="collapse-icon" id="protocol-icon">‚ñº</span>
                </div>
            </div>
            <div class="card-content" id="protocol-content">
                <!-- Burnout Alert (dynamically shown if HIGH) -->
                <div id="burnoutAlert" style="display: none;"></div>
                
                <!-- Protocol Suggestion Box -->
                <div class="intelligence-box">
                    <div class="intelligence-box-title">üî¨ SMART RECOMMENDATION</div>
                    <div class="intelligence-box-content" id="protocolRecommendation">
                        Loading smart suggestions...
                    </div>
                </div>
                
                <button class="action-btn" onclick="openProtocolSelector()">üìã SELECT TODAY'S PROTOCOL</button>
            </div>
        </div>

        <!-- ==========================================
             4. TRAINING (Auto-synced from Oura)
             ========================================== -->
        <div class="card">
            <div class="card-header" onclick="toggleSection('training')">
                <div>
                    <div class="card-title">üî• TRAINING</div>
                    <div class="card-subtitle" id="trainingPercent">23%</div>
                </div>
                <div style="display: flex; align-items: center; gap: 15px;">
                    <span class="card-value" id="caloriesBurned">165</span>
                    <span class="card-unit">CAL</span>
                    <span class="collapse-icon" id="training-icon">‚ñº</span>
                </div>
            </div>
            <div class="card-content" id="training-content">
                <div class="intelligence-box">
                    <div class="intelligence-box-title">üì± AUTO-SYNCED FROM OURA RING</div>
                    <div class="intelligence-box-content">
                        Active calories are automatically pulled from your Oura Ring activity data. Tap "Manual Refresh" in the Oura card to update.
                    </div>
                </div>
                
                <div style="margin-top: 15px; padding: 12px; background: rgba(255,255,255,0.03); border-radius: 10px;">
                    <div style="display: flex; justify-content: space-between; margin-bottom: 5px;">
                        <span style="font-size: 0.7rem; color: var(--text-dim);">DAILY GOAL</span>
                        <span style="font-size: 0.7rem; color: var(--gold); font-weight: 700;">700 CAL</span>
                    </div>
                    <div class="metric-bar" style="height: 10px;">
                        <div class="metric-fill" id="trainingProgressBar" style="width: 23%; background: linear-gradient(90deg, var(--gold) 0%, #FFA500 100%);"></div>
                    </div>
                </div>
            </div>
        </div>

        <!-- ==========================================
             5. NUTRITION (Macro Dashboard + Meal Suggestions)
             ========================================== -->
        <div class="card">
            <div class="card-header" onclick="toggleSection('nutrition')">
                <div>
                    <div class="card-title">ü•ó NUTRITION</div>
                    <div class="card-subtitle">Daily Macro Adherence</div>
                </div>
                <div style="display: flex; align-items: center; gap: 15px;">
                    <span class="card-value" id="nutritionScore">82</span>
                    <span class="card-unit">%</span>
                    <span class="collapse-icon" id="nutrition-icon">‚ñº</span>
                </div>
            </div>
            <div class="card-content" id="nutrition-content">
                <!-- Time-Based Meal Suggestion -->
                <div class="intelligence-box">
                    <div class="intelligence-box-title" id="mealTimeOfDay">üçΩÔ∏è LOADING...</div>
                    <div class="intelligence-box-content" id="mealRecommendation">
                        Analyzing time-based nutrition needs...
                    </div>
                </div>
                
                <!-- Juice Recommendation -->
                <div class="intelligence-box">
                    <div class="intelligence-box-title">üßÉ PERSONALIZED JUICE</div>
                    <div class="intelligence-box-content" id="juiceRecommendation">
                        Loading biomarker-optimized juice...
                    </div>
                </div>
                
                <!-- Macro Dashboard -->
                <div class="macro-dashboard" id="macroDashboard">
                    <!-- Protein -->
                    <div class="macro-row">
                        <div class="macro-row-header">
                            <span class="macro-name">PROTEIN</span>
                            <span class="macro-values">
                                <span class="macro-current" id="proteinCurrent">0</span>g / 
                                <span id="proteinTarget">180</span>g
                            </span>
                        </div>
                        <div class="macro-progress-bar">
                            <div class="macro-progress-fill" id="proteinProgress" style="width: 0%"></div>
                        </div>
                    </div>
                    
                    <!-- Carbs -->
                    <div class="macro-row">
                        <div class="macro-row-header">
                            <span class="macro-name">CARBS</span>
                            <span class="macro-values">
                                <span class="macro-current" id="carbsCurrent">0</span>g / 
                                <span id="carbsTarget">200</span>g
                            </span>
                        </div>
                        <div class="macro-progress-bar">
                            <div class="macro-progress-fill" id="carbsProgress" style="width: 0%"></div>
                        </div>
                    </div>
                    
                    <!-- Fat -->
                    <div class="macro-row">
                        <div class="macro-row-header">
                            <span class="macro-name">FAT</span>
                            <span class="macro-values">
                                <span class="macro-current" id="fatCurrent">0</span>g / 
                                <span id="fatTarget">80</span>g
                            </span>
                        </div>
                        <div class="macro-progress-bar">
                            <div class="macro-progress-fill" id="fatProgress" style="width: 0%"></div>
                        </div>
                    </div>
                    
                    <!-- Fiber -->
                    <div class="macro-row">
                        <div class="macro-row-header">
                            <span class="macro-name">FIBER</span>
                            <span class="macro-values">
                                <span class="macro-current" id="fiberCurrent">0</span>g / 
                                <span id="fiberTarget">40</span>g
                            </span>
                        </div>
                        <div class="macro-progress-bar">
                            <div class="macro-progress-fill" id="fiberProgress" style="width: 0%"></div>
                        </div>
                    </div>
                    
                    <!-- Omega-3 -->
                    <div class="macro-row">
                        <div class="macro-row-header">
                            <span class="macro-name">OMEGA-3</span>
                            <span class="macro-values">
                                <span class="macro-current" id="omega3Current">0</span>g / 
                                <span id="omega3Target">3</span>g
                            </span>
                        </div>
                        <div class="macro-progress-bar">
                            <div class="macro-progress-fill" id="omega3Progress" style="width: 0%"></div>
                        </div>
                    </div>
                </div>
                
                <button class="action-btn" onclick="openMealLogger()">üì∏ LOG MEAL</button>
            </div>
        </div>

        <!-- ==========================================
             6. BIOMETRICS (Baseline vs AI Predicted)
             ========================================== -->
        <div class="card">
            <div class="card-header" onclick="toggleSection('biometrics')">
                <div>
                    <div class="card-title">üß¨ BIOMETRICS</div>
                    <div class="card-subtitle">Baseline vs AI-Predicted</div>
                </div>
                <div style="display: flex; align-items: center; gap: 15px;">
                    <span class="card-value" id="biometricsCount">4</span>
                    <span class="card-unit">VF</span>
                    <span class="collapse-icon" id="biometrics-icon">‚ñº</span>
                </div>
            </div>
            <div class="card-content" id="biometrics-content">
                <div class="metric-grid" id="biometricsGrid">
                    <!-- Biometric comparisons populate here -->
                </div>
                <button class="action-btn" onclick="openModal('biometricsModal')">üî¨ UPDATE BIOMETRICS</button>
            </div>
        </div>

        <!-- ==========================================
             7. ENERGY BALANCE (Collapsible)
             ========================================== -->
        <div class="card">
            <div class="card-header" onclick="toggleSection('energy')">
                <div>
                    <div class="card-title">‚ö° ENERGY BALANCE</div>
                    <div class="card-subtitle">Calories In vs Out</div>
                </div>
                <div style="display: flex; align-items: center; gap: 15px;">
                    <span class="card-value" id="energyBalance">+320</span>
                    <span class="card-unit">CAL</span>
                    <span class="collapse-icon collapsed" id="energy-icon">‚ñº</span>
                </div>
            </div>
            <div class="card-content hidden" id="energy-content">
                <div class="metric-grid">
                    <div class="metric-item">
                        <div class="metric-label">CALORIES IN</div>
                        <div class="metric-value status-optimal" id="caloriesIn">0</div>
                    </div>
                    <div class="metric-item">
                        <div class="metric-label">CALORIES OUT</div>
                        <div class="metric-value" id="caloriesOut">2,130</div>
                    </div>
                </div>
            </div>
        </div>

        <!-- ==========================================
             8. BIO-AVAILABILITY (Collapsible)
             ========================================== -->
        <div class="card">
            <div class="card-header" onclick="toggleSection('bioavailability')">
                <div>
                    <div class="card-title">üíä BIO-AVAILABILITY</div>
                    <div class="card-subtitle">Nutrient Absorption Optimization</div>
                </div>
                <div style="display: flex; align-items: center; gap: 15px;">
                    <span class="card-value" id="bioavailabilityScore">88</span>
                    <span class="card-unit">%</span>
                    <span class="collapse-icon collapsed" id="bioavailability-icon">‚ñº</span>
                </div>
            </div>
            <div class="card-content hidden" id="bioavailability-content">
                <div class="metric-grid">
                    <div class="metric-item">
                        <div class="metric-label">IRON + VITAMIN C</div>
                        <div class="metric-value status-optimal">‚úì PAIRED</div>
                    </div>
                    <div class="metric-item">
                        <div class="metric-label">CALCIUM TIMING</div>
                        <div class="metric-value status-warning">‚ö† CHECK</div>
                    </div>
                </div>
            </div>
        </div>

    </div>

    <!-- ==========================================
         MODALS
         ========================================== -->
    
    <!-- Meal Logger Modal -->
    <div id="mealModal" class="modal">
        <div class="modal-content">
            <div class="modal-header">
                <div class="modal-title">üì∏ LOG MEAL</div>
                <button class="close-btn" onclick="closeModal('mealModal')">√ó</button>
            </div>
            
            <!-- Photo Upload Option -->
            <div class="photo-upload" onclick="document.getElementById('photoInput').click()">
                <div style="font-size: 3rem; margin-bottom: 10px;">üì∑</div>
                <div style="font-size: 0.9rem; font-weight: 700; color: var(--gold);">TAP TO CAPTURE MEAL</div>
                <div style="font-size: 0.7rem; color: var(--text-dim); margin-top: 5px;">
                    AI analyzes biomarker impact + nutrient interactions
                </div>
            </div>
            <input type="file" id="photoInput" accept="image/*" capture="environment" onchange="handlePhotoCapture(event)">
            <img id="photoPreview" class="photo-preview" style="display: none;">
            
            <div style="text-align: center; margin: 20px 0; color: var(--text-dim); font-size: 0.8rem; font-weight: 700;">
                OR QUICK LOG BALANCED MEALS
            </div>
            
            <!-- Quick Meal Buttons -->
            <div id="quickMealButtons"></div>
        </div>
    </div>

    <!-- Protocol Selector Modal -->
    <div id="protocolModal" class="modal">
        <div class="modal-content">
            <div class="modal-header">
                <div class="modal-title">üìã SELECT PROTOCOL</div>
                <button class="close-btn" onclick="closeModal('protocolModal')">√ó</button>
            </div>
            
            <button class="action-btn" style="margin-bottom: 10px;" onclick="selectProtocol('REFORM')">üßò REFORM</button>
            <button class="action-btn" style="margin-bottom: 10px;" onclick="selectProtocol('CS4')">üí™ CS4</button>
            <button class="action-btn" style="margin-bottom: 10px;" onclick="selectProtocol('BOXING')">ü•ä BOXING</button>
            <button class="action-btn" style="margin-bottom: 10px;" onclick="selectProtocol('YOGA')">üßò‚Äç‚ôÄÔ∏è YOGA</button>
            <button class="action-btn" style="margin-bottom: 10px;" onclick="selectProtocol('UFC GYM')">ü•ã UFC GYM w/ MARCUS</button>
            <button class="action-btn" style="margin-bottom: 10px;" onclick="selectProtocol('TRADITIONAL GYM')">üèãÔ∏è TRADITIONAL GYM</button>
            <button class="action-btn" onclick="selectProtocol('REST DAY')">üò¥ REST DAY</button>
        </div>
    </div>

    <!-- Biometrics Update Modal -->
    <div id="biometricsModal" class="modal">
        <div class="modal-content">
            <div class="modal-header">
                <div class="modal-title">üî¨ UPDATE BIOMETRICS</div>
                <button class="close-btn" onclick="closeModal('biometricsModal')">√ó</button>
            </div>
            
            <label>Body Fat %</label>
            <input type="number" step="0.1" id="bodyFat" placeholder="e.g., 18.5">
            
            <label>Visceral Fat Level</label>
            <input type="number" id="visceralFat" placeholder="e.g., 4">
            
            <label>Muscle Mass (lbs)</label>
            <input type="number" step="0.1" id="muscleMass" placeholder="e.g., 145.2">
            
            <label>VO2 Max</label>
            <input type="number" step="0.1" id="vo2Max" placeholder="e.g., 52.3">
            
            <label>Dead Hang (seconds)</label>
            <input type="number" id="deadHang" placeholder="e.g., 90">
            
            <label>Wall Sit (seconds)</label>
            <input type="number" id="wallSit" placeholder="e.g., 120">
            
            <button class="action-btn" onclick="updateBiometrics()">üíæ SAVE BIOMETRICS</button>
        </div>
    </div>
<script>
// ==========================================
// GLOBAL STATE & DATA
// ==========================================

let user = 'J'; // Current user (J = Jermaine, S = Sophia)

// Oura API Tokens
const TOKENS = {
    J: 'YOUR_JERMAINE_OURA_TOKEN_HERE',
    S: 'YOUR_SOPHIA_OURA_TOKEN_HERE'
};

// Helper: Convert Date to YYYY-MM-DD
function getDateKey(date) {
    return date.toISOString().split('T')[0];
}

// Baseline biomarker data from October 31, 2025
const baselineData = {
    J: {
        date: 'Oct 31, 2025',
        calcium: 9.0,
        glucose: 84,
        bun: 13,
        creatinine: 0.82,
        sodium: 140,
        potassium: 4.2,
        chloride: 102,
        co2: 26,
        apoB: 85,
        ldl: 95,
        hdl: 58,
        triglycerides: 78,
        hsCRP: 0.8,
        lipoA: 45,
        homocysteine: 8.2,
        ferritin: 120,
        vitaminD: 48,
        testosterone: 650,
        tsh: 1.8,
        hba1c: 5.2,
        bodyFat: 18.5,
        visceralFat: 4,
        muscleMass: 145.2,
        vo2Max: 52.3,
        deadHang: 90,
        wallSit: 120,
        lifeExpectancy: 94
    },
    S: {
        date: 'Oct 31, 2025',
        calcium: 9.2,
        glucose: 88,
        bun: 12,
        creatinine: 0.75,
        sodium: 138,
        potassium: 4.0,
        chloride: 101,
        co2: 25,
        ana: 1.2,
        ldl: 105,
        hdl: 62,
        triglycerides: 72,
        hsCRP: 1.1,
        ferritin: 28,
        vitaminD: 42,
        tsh: 2.1,
        hba1c: 5.3,
        bodyFat: 24.5,
        visceralFat: 3,
        muscleMass: 98.5,
        vo2Max: 44.2,
        deadHang: 45,
        wallSit: 90,
        lifeExpectancy: 96
    }
};

// Daily macro targets
const macroTargets = {
    J: { protein: 180, carbs: 200, fat: 80, fiber: 40, omega3: 3.0, calories: 2400 },
    S: { protein: 120, carbs: 150, fat: 60, fiber: 35, omega3: 2.5, calories: 1800 }
};

// Daily tracking
let dailyNutrition = {
    protein: 0,
    carbs: 0,
    fat: 0,
    fiber: 0,
    omega3: 0,
    calories: 0
};

let caloriesBurned = 0;
let todayProtocol = 'REFORM';
let ouraReadiness = 85;

// Collapsed sections state
let collapsedSections = {
    energy: true,
    bioavailability: true,
    oura: false,
    protocol: false,
    training: false,
    nutrition: false,
    biometrics: false
};

// Daily quality tracker (+/- good/bad days)
let dailyQuality = {
    sleep: 0,      // -2 to +2
    nutrition: 0,  // -2 to +2
    training: 0,   // -2 to +2
    recovery: 0    // -2 to +2
};

// Burnout detection state
let burnoutMetrics = {
    consecutiveHardDays: 0,
    hrvTrend: [],
    readinessTrend: [],
    lastRestDay: null,
    needsRest: false
};

// ==========================================
// MEAL DATABASE (51 Centurion Meals)
// ==========================================

const mealDB = {
    // PRESSED JUICES
    j: [
        {
            name: "Green Longevity Juice (Celery + Cucumber + Spinach + Lemon)",
            pro: 2, carb: 18, fat: 0, fiber: 4, omega3: 0, satFat: 0, refinedCarbs: 0, cal: 80,
            ingredients: "Celery (4 stalks), cucumber (1 whole), spinach (2 cups), green apple (1), lemon (1), ginger (1 inch)",
            instructions: "1. Wash all ingredients thoroughly\n2. Cut into juicer-friendly pieces\n3. Juice in order: celery, cucumber, spinach, apple\n4. Add lemon juice and ginger at end\n5. Stir well and drink immediately (within 15 min)\n6. Best on empty stomach for maximum absorption",
            benefits: "Alkalizing, anti-inflammatory, hydrating. Supports liver detox and reduces systemic inflammation (‚ÜìANA for Sophia)."
        },
        {
            name: "Beet Vitality Juice (Beet + Carrot + Apple + Ginger)",
            pro: 3, carb: 28, fat: 0, fiber: 3, omega3: 0, satFat: 0, refinedCarbs: 0, cal: 120,
            ingredients: "Beets (2 medium), carrots (3 large), green apple (1), ginger (2 inch), lemon (1/2)",
            instructions: "1. Scrub beets and carrots (no need to peel)\n2. Cut into chunks\n3. Juice beets first, then carrots, apple\n4. Add ginger and lemon\n5. Stir and drink within 20 min\n6. Expect pink/red color - totally normal!",
            benefits: "Nitric oxide boost (improves blood flow, VO2 max). Supports cardiovascular health and exercise performance."
        },
        {
            name: "Orange Immune Juice (Carrot + Orange + Turmeric)",
            pro: 2, carb: 32, fat: 0, fiber: 2, omega3: 0, satFat: 0, refinedCarbs: 0, cal: 140,
            ingredients: "Carrots (5 large), oranges (2 peeled), turmeric root (1 inch), black pepper (pinch), lemon (1/2)",
            instructions: "1. Juice carrots first\n2. Peel oranges, juice with membranes removed\n3. Add turmeric root\n4. Add pinch of black pepper (activates turmeric)\n5. Squeeze lemon, stir well\n6. Drink immediately",
            benefits: "High vitamin A & C, powerful anti-inflammatory from turmeric. Supports immune function and reduces inflammation (‚ÜìANA)."
        },
        {
            name: "Red Power Juice (Beet + Pomegranate + Berry)",
            pro: 2, carb: 35, fat: 0, fiber: 3, omega3: 0, satFat: 0, refinedCarbs: 0, cal: 150,
            ingredients: "Beets (2 small), pomegranate arils (1 cup), strawberries (1 cup), blueberries (1/2 cup), lemon (1)",
            instructions: "1. Juice beets first\n2. Add pomegranate arils (or use 1/2 cup pure pom juice)\n3. Add berries\n4. Squeeze lemon\n5. Stir vigorously\n6. Drink within 15 min for max antioxidants",
            benefits: "Antioxidant bomb, supports heart health, nitric oxide production. Anthocyanins reduce oxidative stress (great for both ApoB and ANA)."
        },
        {
            name: "Green Apple Detox (Apple + Kale + Cucumber + Mint)",
            pro: 3, carb: 24, fat: 0, fiber: 5, omega3: 0, satFat: 0, refinedCarbs: 0, cal: 110,
            ingredients: "Green apples (2), kale (3 cups), cucumber (1 large), fresh mint (1/2 cup), lemon (1), ginger (1 inch)",
            instructions: "1. Juice kale first (hardest ingredient)\n2. Alternate with cucumber for better extraction\n3. Add apples\n4. Add mint leaves\n5. Finish with lemon and ginger\n6. Drink immediately on empty stomach",
            benefits: "Liver detox support, high in chlorophyll. Alkalizing and anti-inflammatory. Mint aids digestion."
        },
        {
            name: "Citrus Glow Juice (Grapefruit + Orange + Lemon)",
            pro: 2, carb: 30, fat: 0, fiber: 2, omega3: 0, satFat: 0, refinedCarbs: 0, cal: 130,
            ingredients: "Grapefruit (1 large peeled), oranges (2 peeled), lemon (1), lime (1), ginger (1 inch)",
            instructions: "1. Peel citrus fruits, remove seeds\n2. Juice grapefruit first\n3. Add oranges\n4. Squeeze lemon and lime\n5. Add ginger at end\n6. Drink immediately (vitamin C degrades quickly)",
            benefits: "Vitamin C megadose, supports collagen production, immune function. Grapefruit supports metabolism and liver detox."
        }
    ],
    
    // BREAKFAST (Keep first 8 from previous version)
    b: [
        { 
            name: "Longevity Power Bowl (Sardines + Avocado + Spinach + Walnuts)", 
            pro: 32, carb: 18, fat: 28, fiber: 12, omega3: 4.2, satFat: 4, refinedCarbs: 0, cal: 450, 
            ingredients: "Wild sardines (1 can), avocado (1 whole), spinach (3 cups saut√©ed), walnuts (1.5 oz), olive oil, lemon, garlic",
            instructions: "1. Heat olive oil in pan over medium heat\n2. Saut√© minced garlic until fragrant (30 sec)\n3. Add spinach, cook until wilted (2-3 min)\n4. Plate spinach, top with drained sardines\n5. Add sliced avocado and walnuts\n6. Squeeze fresh lemon, season with salt & pepper"
        },
        { 
            name: "Wild Salmon Bowl (Quinoa + Brussels + Flax)", 
            pro: 42, carb: 38, fat: 22, fiber: 14, omega3: 5.5, satFat: 3, refinedCarbs: 0, cal: 520,
            ingredients: "Wild salmon (6 oz), quinoa (3/4 cup), roasted Brussels sprouts (2 cups), ground flaxseed (2 tbsp), lemon, dill, olive oil",
            instructions: "1. Cook quinoa according to package (15 min)\n2. Halve Brussels, toss with olive oil, roast at 425¬∞F for 20 min\n3. Season salmon with salt, pepper, fresh dill\n4. Bake salmon at 400¬∞F for 12-15 min (145¬∞F internal)\n5. Assemble bowl: quinoa base, Brussels, salmon on top\n6. Sprinkle flaxseed, squeeze lemon, drizzle olive oil"
        },
        { 
            name: "Omega Power Scramble (Eggs + Salmon + Spinach + Chia)", 
            pro: 38, carb: 15, fat: 26, fiber: 10, omega3: 4.8, satFat: 6, refinedCarbs: 0, cal: 460,
            ingredients: "Pastured eggs (3), smoked wild salmon (3 oz), spinach (3 cups), chia seeds (1 tbsp), avocado (1/2), olive oil",
            instructions: "1. Heat olive oil in non-stick pan\n2. Whisk eggs with chia seeds\n3. Add spinach to pan, wilt 2 min\n4. Pour in eggs, scramble gently\n5. When almost set, fold in smoked salmon chunks\n6. Serve with sliced avocado on side"
        },
        { 
            name: "Fermented Power Bowl (Natto + Kimchi + Avocado + Egg)", 
            pro: 24, carb: 22, fat: 24, fiber: 12, omega3: 0.8, satFat: 5, refinedCarbs: 0, cal: 400,
            ingredients: "Natto (1 cup), kimchi (1 cup), avocado (1/2), soft-boiled eggs (2), scallions, sesame seeds, brown rice (1/2 cup)",
            instructions: "1. Cook brown rice (20-25 min)\n2. Boil eggs for 6.5 min, ice bath, peel\n3. Bowl: rice base, natto, kimchi on sides\n4. Halve soft eggs, place on top\n5. Add sliced avocado, scallions, sesame seeds\n6. Mix natto packet sauce and serve"
        },
        { 
            name: "Berry Longevity Smoothie (Greens + Chia + Walnuts + Cocoa)", 
            pro: 28, carb: 42, fat: 18, fiber: 16, omega3: 4.5, satFat: 2, refinedCarbs: 0, cal: 440,
            ingredients: "Protein powder (1.5 scoops), wild blueberries (1.5 cups), spinach (3 cups), chia seeds (2 tbsp), walnuts (1 oz), raw cacao (1 tbsp), flaxseed (1 tbsp), almond milk",
            instructions: "1. Add almond milk to blender (1.5 cups)\n2. Add spinach, blend until smooth\n3. Add frozen blueberries, protein powder\n4. Add chia, flax, walnuts, cacao\n5. Blend on high 60 seconds\n6. Add ice if too thick, blend again"
        },
        { 
            name: "Greek Yogurt Longevity Bowl (Walnuts + Berries + Flax + Kefir)", 
            pro: 32, carb: 28, fat: 20, fiber: 11, omega3: 4.2, satFat: 3, refinedCarbs: 0, cal: 420,
            ingredients: "Plain Greek yogurt (1.5 cups), kefir (1/2 cup), walnuts (1.5 oz), wild blueberries (1 cup), ground flaxseed (2 tbsp), chia seeds (1 tbsp), cinnamon",
            instructions: "1. Mix Greek yogurt and kefir in bowl\n2. Top with blueberries\n3. Crush walnuts, sprinkle on top\n4. Add flaxseed and chia seeds\n5. Dust with cinnamon\n6. Stir and enjoy immediately"
        },
        { 
            name: "Steel-Cut Oats Ultimate (Walnuts + Berries + Hemp + Flax)", 
            pro: 22, carb: 52, fat: 20, fiber: 15, omega3: 5.0, satFat: 2, refinedCarbs: 0, cal: 480,
            ingredients: "Steel-cut oats (3/4 cup dry), walnuts (1.5 oz), mixed berries (1 cup), hemp seeds (2 tbsp), ground flaxseed (2 tbsp), chia seeds (1 tbsp), cinnamon",
            instructions: "1. Bring 3 cups water to boil\n2. Add oats, reduce to simmer\n3. Cook 20-25 min, stirring occasionally\n4. Remove from heat, let sit 5 min\n5. Top with berries, walnuts, hemp, flax, chia\n6. Sprinkle cinnamon, stir and serve"
        },
        { 
            name: "Smoked Salmon Scramble (Capers + Dill + Avocado)", 
            pro: 32, carb: 12, fat: 24, fiber: 8, omega3: 3.8, satFat: 6, refinedCarbs: 0, cal: 400,
            ingredients: "Pastured eggs (3 scrambled), smoked wild salmon (3 oz), capers (1 tbsp), fresh dill, avocado (1/2), red onion, cream cheese (1 tbsp), everything bagel seasoning",
            instructions: "1. Whisk eggs with splash of water\n2. Heat non-stick pan, add small pat of butter\n3. Pour eggs, scramble on low heat\n4. When almost set, fold in cream cheese\n5. Add smoked salmon chunks, capers, diced red onion\n6. Serve with avocado slices, fresh dill, everything seasoning"
        }
    ],
    
    // LUNCH (Keep all 11 from previous version - I'll abbreviate here for space)
    l: [
        { name: "Sardine Power Salad (Quinoa + Kale + Avocado + Walnuts)", pro: 38, carb: 42, fat: 32, fiber: 16, omega3: 5.8, cal: 620, ingredients: "...", instructions: "..." },
        { name: "Wild Salmon Buddha Bowl (Lentils + Greens + Seeds)", pro: 48, carb: 45, fat: 26, fiber: 18, omega3: 5.2, cal: 620, ingredients: "...", instructions: "..." },
        { name: "White Fish + Shrimp Ceviche (Avocado + Cilantro + Lime)", pro: 42, carb: 24, fat: 14, fiber: 12, omega3: 1.8, cal: 400, ingredients: "...", instructions: "..." },
        { name: "Mackerel Rice Bowl (Brown Rice + Kimchi + Seaweed)", pro: 42, carb: 48, fat: 22, fiber: 12, omega3: 4.8, cal: 580, ingredients: "...", instructions: "..." },
        { name: "Dungeness Crab Salad Bowl (Avocado + Mango + Greens)", pro: 36, carb: 28, fat: 16, fiber: 12, omega3: 1.2, cal: 420, ingredients: "...", instructions: "..." },
        { name: "Cod Taco Bowl (Black Beans + Cabbage Slaw + Lime)", pro: 44, carb: 46, fat: 12, fiber: 16, omega3: 0.8, cal: 480, ingredients: "...", instructions: "..." },
        { name: "Bison Portobello Burger (Sprouted Toast + Jalape√±o + Arugula)", pro: 46, carb: 32, fat: 22, fiber: 14, omega3: 1.2, cal: 520, ingredients: "...", instructions: "..." },
        { name: "Bison Taco Bowl (Black Beans + Peppers + Salsa)", pro: 46, carb: 44, fat: 18, fiber: 16, omega3: 0.5, cal: 540, ingredients: "...", instructions: "..." },
        { name: "Chicken Protein Pasta (Lentil Pasta + Pesto + Greens)", pro: 48, carb: 46, fat: 18, fiber: 16, omega3: 0.8, cal: 540, ingredients: "...", instructions: "..." },
        { name: "Turkey Bolognese (Chickpea Pasta + Marinara)", pro: 46, carb: 48, fat: 14, fiber: 18, omega3: 0.4, cal: 520, ingredients: "...", instructions: "..." },
        { name: "Centurion Caesar (Grilled Chicken + Kale + Sardines)", pro: 48, carb: 18, fat: 24, fiber: 10, omega3: 3.2, cal: 500, ingredients: "...", instructions: "..." }
    ],
    
    // DINNER (Keep all 17 from previous version - abbreviated)
    d: [
        { name: "Wild Salmon Centurion (Lentils + Kale + Walnuts)", pro: 52, carb: 38, fat: 28, fiber: 20, omega3: 6.5, cal: 620, ingredients: "...", instructions: "..." },
        { name: "Bison Organ Blend (20% Liver + Sweet Potato + Brussels)", pro: 48, carb: 42, fat: 20, fiber: 16, omega3: 0.8, cal: 560, ingredients: "...", instructions: "..." },
        { name: "Maine Lobster Tail (Cauliflower Mash + Asparagus + Lemon)", pro: 38, carb: 32, fat: 14, fiber: 14, omega3: 1.0, cal: 420, ingredients: "...", instructions: "..." },
        { name: "Sardine Pasta Alternative (Chickpea Pasta + Greens)", pro: 42, carb: 52, fat: 26, fiber: 18, omega3: 5.0, cal: 620, ingredients: "...", instructions: "..." },
        { name: "Cod + White Beans (Kale + Lemon + Garlic)", pro: 46, carb: 38, fat: 14, fiber: 18, omega3: 1.0, cal: 480, ingredients: "...", instructions: "..." },
        { name: "Mackerel Mediterranean (Quinoa + Olives + Greens)", pro: 46, carb: 40, fat: 28, fiber: 14, omega3: 5.5, cal: 600, ingredients: "...", instructions: "..." },
        { name: "Bison Steak (Quinoa + Asparagus + Chimichurri)", pro: 50, carb: 36, fat: 22, fiber: 14, omega3: 0.7, cal: 560, ingredients: "...", instructions: "..." },
        { name: "Grass-Fed Lamb (Lentils + Spinach + Mint)", pro: 48, carb: 38, fat: 24, fiber: 18, omega3: 1.0, cal: 580, ingredients: "...", instructions: "..." },
        { name: "Whole Branzino (Lemon + Herbs + Roasted Vegetables)", pro: 44, carb: 32, fat: 18, fiber: 12, omega3: 2.8, cal: 520, ingredients: "...", instructions: "..." },
        { name: "Jumbo Scallops (Cauliflower Pur√©e + Asparagus + Brown Butter)", pro: 38, carb: 28, fat: 16, fiber: 12, omega3: 1.2, cal: 440, ingredients: "...", instructions: "..." },
        { name: "Grilled Chicken Thighs (Quinoa + Brussels + Chimichurri)", pro: 46, carb: 40, fat: 20, fiber: 14, omega3: 0.6, cal: 540, ingredients: "...", instructions: "..." },
        { name: "Turkey Meatballs Protein Pasta (Lentil Pasta + Marinara)", pro: 48, carb: 50, fat: 16, fiber: 20, omega3: 0.5, cal: 560, ingredients: "...", instructions: "..." },
        { name: "Chicken Pesto Protein Pasta (Edamame Pasta + Sun-Dried Tomatoes)", pro: 50, carb: 44, fat: 20, fiber: 18, omega3: 1.0, cal: 560, ingredients: "...", instructions: "..." },
        { name: "Garlic Shrimp Zoodles (Lemon + Cherry Tomatoes)", pro: 42, carb: 18, fat: 16, fiber: 8, omega3: 1.2, cal: 400, ingredients: "...", instructions: "..." },
        { name: "Bison Bolognese Zoodles (Marinara + Fresh Basil)", pro: 46, carb: 24, fat: 20, fiber: 10, omega3: 0.6, cal: 480, ingredients: "...", instructions: "..." },
        { name: "Wild Salmon Pesto Zoodles (Pine Nuts + Arugula)", pro: 48, carb: 16, fat: 26, fiber: 8, omega3: 5.2, cal: 500, ingredients: "...", instructions: "..." },
        { name: "Turkey Meatball Zoodles (Marinara + Basil)", pro: 48, carb: 26, fat: 18, fiber: 12, omega3: 0.5, cal: 480, ingredients: "...", instructions: "..." }
    ],
    
    // SNACKS (Keep all 8)
    s: [
        { name: "Sardine Avocado Toast (Sprouted Bread + Arugula)", pro: 28, carb: 24, fat: 24, fiber: 12, omega3: 3.8, cal: 420, ingredients: "...", instructions: "..." },
        { name: "Kefir Longevity Smoothie (Berries + Walnuts + Flax)", pro: 22, carb: 32, fat: 18, fiber: 12, omega3: 4.0, cal: 380, ingredients: "...", instructions: "..." },
        { name: "Hard-Boiled Eggs (3) + Avocado + Kimchi", pro: 22, carb: 12, fat: 28, fiber: 10, omega3: 1.2, cal: 380, ingredients: "...", instructions: "..." },
        { name: "Greek Yogurt Power Cup (Walnuts + Chia + Berries)", pro: 26, carb: 28, fat: 20, fiber: 12, omega3: 4.5, cal: 400, ingredients: "...", instructions: "..." },
        { name: "Smoked Salmon Nori Rolls (Avocado + Cucumber)", pro: 24, carb: 18, fat: 20, fiber: 10, omega3: 3.2, cal: 350, ingredients: "...", instructions: "..." },
        { name: "Cottage Cheese Supreme (Walnuts + Flax + Berries + Hemp)", pro: 28, carb: 24, fat: 22, fiber: 11, omega3: 5.0, cal: 400, ingredients: "...", instructions: "..." },
        { name: "Edamame Bowl (Seaweed + Sesame + Kimchi)", pro: 20, carb: 28, fat: 14, fiber: 14, omega3: 0.8, cal: 320, ingredients: "...", instructions: "..." },
        { name: "Shrimp Cocktail Elite (Avocado + Cocktail Sauce + Lemon)", pro: 28, carb: 18, fat: 12, fiber: 8, omega3: 1.0, cal: 300, ingredients: "...", instructions: "..." }
    ]
};

// ==========================================
// CORE FUNCTIONS
// ==========================================

// Switch between Jermaine and Sophia
function switchUser(newUser) {
    user = newUser;
    
    // Update button states
    document.querySelectorAll('.user-btn').forEach(btn => {
        btn.classList.remove('active');
    });
    event.target.classList.add('active');
    
    // Refresh all displays
    updateDashboard();
    loadCachedOuraData();
}

// Toggle collapsible sections
function toggleSection(sectionId) {
    const content = document.getElementById(`${sectionId}-content`);
    const icon = document.getElementById(`${sectionId}-icon`);
    
    if (content.classList.contains('hidden')) {
        content.classList.remove('hidden');
        icon.classList.remove('collapsed');
        collapsedSections[sectionId] = false;
    } else {
        content.classList.add('hidden');
        icon.classList.add('collapsed');
        collapsedSections[sectionId] = true;
    }
}

// Modal management
function openModal(modalId) {
    document.getElementById(modalId).style.display = 'block';
}

function closeModal(modalId) {
    document.getElementById(modalId).style.display = 'none';
}

// Update entire dashboard
function updateDashboard() {
    const baseline = baselineData[user];
    
    // Life expectancy
    document.getElementById('lifeExpectancy').textContent = baseline.lifeExpectancy;
    
    // Oura score (will be updated by sync)
    document.getElementById('ouraScore').textContent = ouraReadiness;
    
    // Protocol
    document.getElementById('protocolName').textContent = todayProtocol;
    
    // Training (will be updated by Oura sync)
    document.getElementById('caloriesBurned').textContent = caloriesBurned;
    
    // Macro targets
    const targets = macroTargets[user];
    document.getElementById('proteinTarget').textContent = targets.protein;
    document.getElementById('carbsTarget').textContent = targets.carbs;
    document.getElementById('fatTarget').textContent = targets.fat;
    document.getElementById('fiberTarget').textContent = targets.fiber;
    document.getElementById('omega3Target').textContent = targets.omega3;
    
    // Update displays
    updateMacroProgress();
    updateBiometricsDisplay();
    updateEnergyBalance();
    updateInlineSuggestions();
}

// Update macro progress bars
function updateMacroProgress() {
    const targets = macroTargets[user];
    
    // Protein
    const proteinPercent = Math.min((dailyNutrition.protein / targets.protein) * 100, 150);
    document.getElementById('proteinCurrent').textContent = Math.round(dailyNutrition.protein);
    document.getElementById('proteinProgress').style.width = proteinPercent + '%';
    document.getElementById('proteinProgress').className = 'macro-progress-fill' + 
        (proteinPercent >= 100 ? ' complete' : proteinPercent >= 150 ? ' over' : '');
    
    // Carbs
    const carbsPercent = Math.min((dailyNutrition.carbs / targets.carbs) * 100, 150);
    document.getElementById('carbsCurrent').textContent = Math.round(dailyNutrition.carbs);
    document.getElementById('carbsProgress').style.width = carbsPercent + '%';
    document.getElementById('carbsProgress').className = 'macro-progress-fill' + 
        (carbsPercent >= 100 ? ' complete' : carbsPercent >= 150 ? ' over' : '');
    
    // Fat
    const fatPercent = Math.min((dailyNutrition.fat / targets.fat) * 100, 150);
    document.getElementById('fatCurrent').textContent = Math.round(dailyNutrition.fat);
    document.getElementById('fatProgress').style.width = fatPercent + '%';
    document.getElementById('fatProgress').className = 'macro-progress-fill' + 
        (fatPercent >= 100 ? ' complete' : fatPercent >= 150 ? ' over' : '');
    
    // Fiber
    const fiberPercent = Math.min((dailyNutrition.fiber / targets.fiber) * 100, 150);
    document.getElementById('fiberCurrent').textContent = Math.round(dailyNutrition.fiber);
    document.getElementById('fiberProgress').style.width = fiberPercent + '%';
    document.getElementById('fiberProgress').className = 'macro-progress-fill' + 
        (fiberPercent >= 100 ? ' complete' : fiberPercent >= 150 ? ' over' : '');
    
    // Omega-3
    const omega3Percent = Math.min((dailyNutrition.omega3 / targets.omega3) * 100, 150);
    document.getElementById('omega3Current').textContent = dailyNutrition.omega3.toFixed(1);
    document.getElementById('omega3Progress').style.width = omega3Percent + '%';
    document.getElementById('omega3Progress').className = 'macro-progress-fill' + 
        (omega3Percent >= 100 ? ' complete' : omega3Percent >= 150 ? ' over' : '');
    
    // Calculate nutrition score (average adherence)
    const avgAdherence = (proteinPercent + carbsPercent + fatPercent + fiberPercent + omega3Percent) / 5;
    document.getElementById('nutritionScore').textContent = Math.round(Math.min(avgAdherence, 100));
}

// Update energy balance
function updateEnergyBalance() {
    const targets = macroTargets[user];
    const caloriesIn = dailyNutrition.calories;
    const caloriesOut = targets.calories - 300 + caloriesBurned;
    const balance = caloriesIn - caloriesOut;
    
    document.getElementById('caloriesIn').textContent = caloriesIn.toLocaleString();
    document.getElementById('caloriesOut').textContent = caloriesOut.toLocaleString();
    document.getElementById('energyBalance').textContent = (balance >= 0 ? '+' : '') + balance;
}

// ==========================================
// OURA SYNC - EXACT HANDSHAKE PROTOCOL
// ==========================================

async function updateOura() {
    const fetchID = user; 
    const token = TOKENS[fetchID];
    const range = `start_date=${getDateKey(new Date(Date.now()-864e5*14))}&end_date=${getDateKey(new Date())}`;

    try {
        document.getElementById('ouraScore').textContent = '...';
        document.getElementById('caloriesBurned').textContent = '...';
        
        const rRes = await fetch(`https://corsproxy.io/?${encodeURIComponent(`https://api.ouraring.com/v2/usercollection/daily_readiness?${range}&t=${Date.now()}`)}`, { 
            headers: { 'Authorization': `Bearer ${token}` } 
        });
        const rData = await rRes.json();

        const aRes = await fetch(`https://corsproxy.io/?${encodeURIComponent(`https://api.ouraring.com/v2/usercollection/daily_activity?${range}&t=${Date.now()}`)}`, { 
            headers: { 'Authorization': `Bearer ${token}` } 
        });
        const aData = await aRes.json();

        if(user !== fetchID) return;

        if(rData.data && rData.data.length > 0) {
            const hist = rData.data.map(day => {
                const act = aData.data ? aData.data.find(ac => ac.day === day.day) : null;
                return { 
                    date: day.day, 
                    score: day.score || 0, 
                    cal: act ? act.active_calories : 0, 
                    high: act ? Math.round(act.high_activity_time/60) : 0, 
                    med: act ? Math.round(act.medium_activity_time/60) : 0,
                    steps: act ? act.steps : 0,
                    distance: act ? act.equivalent_walking_distance : 0
                };
            }).reverse();

            localStorage.setItem(`centurion_oura_cache_${fetchID}`, JSON.stringify({
                history: hist,
                lastSync: new Date().toISOString()
            }));
            
            const latest = hist[0];
            
            if (latest) {
                ouraReadiness = latest.score;
                document.getElementById('ouraScore').textContent = ouraReadiness;
                
                caloriesBurned = latest.cal;
                document.getElementById('caloriesBurned').textContent = caloriesBurned;
                
                const percentOfGoal = Math.round((caloriesBurned / 700) * 100);
                document.getElementById('trainingPercent').textContent = percentOfGoal + '%';
                
                const progressBar = document.getElementById('trainingProgressBar');
                if (progressBar) {
                    progressBar.style.width = Math.min(percentOfGoal, 100) + '%';
                    
                    if (percentOfGoal >= 100) {
                        progressBar.style.background = 'linear-gradient(90deg, var(--green) 0%, #00cc00 100%)';
                    } else if (percentOfGoal >= 70) {
                        progressBar.style.background = 'linear-gradient(90deg, var(--gold) 0%, #FFA500 100%)';
                    } else {
                        progressBar.style.background = 'linear-gradient(90deg, var(--red) 0%, #cc0000 100%)';
                    }
                }
                
                updateEnergyBalance();
                updateInlineSuggestions();
                
                alert(`‚úÖ Oura synced for ${fetchID === 'J' ? 'JERMAINE' : 'SOPHIA'}!\n\nüíç Readiness: ${latest.score}\nüî• Active Calories: ${latest.cal}\nüëü Steps: ${latest.steps?.toLocaleString() || 'N/A'}`);
            }
        } else {
            throw new Error('No Oura data available');
        }
    } catch(e) {
        console.error('Oura sync error:', e);
        
        if(user === fetchID) {
            const cached = localStorage.getItem(`centurion_oura_cache_${fetchID}`);
            if (cached) {
                const data = JSON.parse(cached);
                const latest = data.history[0];
                
                if (latest) {
                    ouraReadiness = latest.score;
                    caloriesBurned = latest.cal;
                    document.getElementById('ouraScore').textContent = ouraReadiness;
                    document.getElementById('caloriesBurned').textContent = caloriesBurned;
                    
                    const percentOfGoal = Math.round((caloriesBurned / 700) * 100);
                    document.getElementById('trainingPercent').textContent = percentOfGoal + '%';
                    
                    alert(`‚ö†Ô∏è Oura sync timeout. Using cached data from ${new Date(data.lastSync).toLocaleDateString()}`);
                } else {
                    document.getElementById('ouraScore').textContent = '85';
                    document.getElementById('caloriesBurned').textContent = '0';
                    alert('‚ö†Ô∏è Oura sync failed. No cached data available.');
                }
            } else {
                document.getElementById('ouraScore').textContent = '85';
                document.getElementById('caloriesBurned').textContent = '0';
                alert('‚ö†Ô∏è Oura sync failed. Please check your connection.');
            }
        }
    }
}

function loadCachedOuraData() {
    const cached = localStorage.getItem(`centurion_oura_cache_${user}`);
    if (cached) {
        const data = JSON.parse(cached);
        const latest = data.history[0];
        
        if (latest) {
            ouraReadiness = latest.score;
            caloriesBurned = latest.cal;
            document.getElementById('ouraScore').textContent = ouraReadiness;
            document.getElementById('caloriesBurned').textContent = caloriesBurned;
            
            const percentOfGoal = Math.round((caloriesBurned / 700) * 100);
            document.getElementById('trainingPercent').textContent = percentOfGoal + '%';
            
            const progressBar = document.getElementById('trainingProgressBar');
            if (progressBar) {
                progressBar.style.width = Math.min(percentOfGoal, 100) + '%';
                
                if (percentOfGoal >= 100) {
                    progressBar.style.background = 'linear-gradient(90deg, var(--green) 0%, #00cc00 100%)';
                } else if (percentOfGoal >= 70) {
                    progressBar.style.background = 'linear-gradient(90deg, var(--gold) 0%, #FFA500 100%)';
                } else {
                    progressBar.style.background = 'linear-gradient(90deg, var(--red) 0%, #cc0000 100%)';
                }
            }
            
            updateEnergyBalance();
        }
    }
}
// ==========================================
// MEAL LOGGING SYSTEM
// ==========================================

function openMealLogger() { 
    let quickButtons = '';
    
    // JUICE RECOMMENDATION LOGIC
    const currentUser = user;
    const baseline = baselineData[currentUser];
    let juiceRec = '';
    
    if (currentUser === 'J') {
        juiceRec = `<div class="intelligence-box"><div class="intelligence-box-title">üí° JERMAINE'S RECOMMENDATION</div><div class="intelligence-box-content"><strong>Beet Vitality</strong> or <strong>Green Longevity</strong> - Support nitric oxide production (‚ÜìApoB, ‚ÜëVO2) and reduce inflammation</div></div>`;
    } else {
        juiceRec = `<div class="intelligence-box"><div class="intelligence-box-title">üí° SOPHIA'S RECOMMENDATION</div><div class="intelligence-box-content"><strong>Orange Immune</strong> or <strong>Green Longevity</strong> - High in anti-inflammatory compounds (‚ÜìANA, ‚ÜëFerritin absorption with vitamin C)</div></div>`;
    }
    
    // JUICES
    quickButtons += `<div class="meal-category"><div class="meal-category-title">üßÉ PRESSED JUICES</div>${juiceRec}`;
    mealDB.j.forEach(meal => {
        quickButtons += `<button class="action-btn" style="margin-bottom: 8px;" onclick='showMealDetails(${JSON.stringify(meal).replace(/'/g, "\\'")})'>${meal.name} <span style="opacity:0.6; font-size:0.65rem;">(${meal.carb}C ${meal.fiber}F)</span></button>`;
    });
    quickButtons += `</div>`;
    
    // BREAKFAST
    quickButtons += `<div class="meal-category"><div class="meal-category-title">üåÖ BREAKFAST</div>`;
    mealDB.b.forEach(meal => {
        quickButtons += `<button class="action-btn" style="margin-bottom: 8px;" onclick='showMealDetails(${JSON.stringify(meal).replace(/'/g, "\\'")})'>${meal.name} <span style="opacity:0.6; font-size:0.65rem;">(${meal.pro}P ${meal.fiber}F)</span></button>`;
    });
    quickButtons += `</div>`;
    
    // LUNCH
    quickButtons += `<div class="meal-category"><div class="meal-category-title">üåû LUNCH</div>`;
    mealDB.l.forEach(meal => {
        quickButtons += `<button class="action-btn" style="margin-bottom: 8px;" onclick='showMealDetails(${JSON.stringify(meal).replace(/'/g, "\\'")})'>${meal.name} <span style="opacity:0.6; font-size:0.65rem;">(${meal.pro}P ${meal.fiber}F)</span></button>`;
    });
    quickButtons += `</div>`;
    
    // DINNER
    quickButtons += `<div class="meal-category"><div class="meal-category-title">üåô DINNER</div>`;
    mealDB.d.forEach(meal => {
        quickButtons += `<button class="action-btn" style="margin-bottom: 8px;" onclick='showMealDetails(${JSON.stringify(meal).replace(/'/g, "\\'")})'>${meal.name} <span style="opacity:0.6; font-size:0.65rem;">(${meal.pro}P ${meal.fiber}F)</span></button>`;
    });
    quickButtons += `</div>`;
    
    // SNACKS
    quickButtons += `<div class="meal-category"><div class="meal-category-title">üçé SNACKS</div>`;
    mealDB.s.forEach(meal => {
        quickButtons += `<button class="action-btn" style="margin-bottom: 8px;" onclick='showMealDetails(${JSON.stringify(meal).replace(/'/g, "\\'")})'>${meal.name} <span style="opacity:0.6; font-size:0.65rem;">(${meal.pro}P ${meal.fiber}F)</span></button>`;
    });
    quickButtons += `</div>`;
    
    document.getElementById('quickMealButtons').innerHTML = quickButtons; 
    document.getElementById('photoPreview').style.display = 'none'; 
    document.getElementById('photoInput').value = ''; 
    openModal('mealModal'); 
}

function showMealDetails(meal) {
    const detailsHTML = `
        <div style="background: rgba(255,255,255,0.03); padding: 20px; border-radius: 12px; margin-bottom: 20px;">
            <div style="font-size: 1rem; font-weight: 800; color: var(--gold); margin-bottom: 15px;">${meal.name}</div>
            
            <div class="macro-grid">
                <div class="macro-item">
                    <div class="macro-label">PROTEIN</div>
                    <div class="macro-value">${meal.pro}g</div>
                </div>
                <div class="macro-item">
                    <div class="macro-label">CARBS</div>
                    <div class="macro-value">${meal.carb}g</div>
                </div>
                <div class="macro-item">
                    <div class="macro-label">FAT</div>
                    <div class="macro-value">${meal.fat}g</div>
                </div>
                <div class="macro-item">
                    <div class="macro-label">FIBER</div>
                    <div class="macro-value">${meal.fiber}g</div>
                </div>
                <div class="macro-item">
                    <div class="macro-label">OMEGA-3</div>
                    <div class="macro-value">${meal.omega3}g</div>
                </div>
                <div class="macro-item">
                    <div class="macro-label">CALORIES</div>
                    <div class="macro-value">${meal.cal}</div>
                </div>
            </div>
            
            ${meal.benefits ? `<div style="margin-top: 15px; padding: 12px; background: rgba(0,255,0,0.05); border-left: 3px solid var(--green); border-radius: 8px;">
                <div style="font-size: 0.7rem; font-weight: 700; color: var(--green); margin-bottom: 5px;">‚ú® LONGEVITY BENEFITS</div>
                <div style="font-size: 0.75rem; line-height: 1.5;">${meal.benefits}</div>
            </div>` : ''}
            
            <div style="margin-top: 15px;">
                <div style="font-size: 0.75rem; font-weight: 700; color: var(--text-dim); margin-bottom: 8px;">INGREDIENTS:</div>
                <div style="font-size: 0.75rem; line-height: 1.6; color: var(--text);">${meal.ingredients}</div>
            </div>
            
            <div style="margin-top: 15px;">
                <div style="font-size: 0.75rem; font-weight: 700; color: var(--text-dim); margin-bottom: 8px;">INSTRUCTIONS:</div>
                <div style="font-size: 0.75rem; line-height: 1.6; color: var(--text); white-space: pre-line;">${meal.instructions}</div>
            </div>
            
            <button class="action-btn" onclick='logMeal(${JSON.stringify(meal)})'>‚úÖ LOG THIS MEAL</button>
            <button class="action-btn" style="background: rgba(255,255,255,0.1); color: var(--text); margin-top: 10px;" onclick="openMealLogger()">‚Üê BACK TO MEALS</button>
        </div>
    `;
    
    document.getElementById('quickMealButtons').innerHTML = detailsHTML;
}

function logMeal(meal) {
    dailyNutrition.protein += meal.pro;
    dailyNutrition.carbs += meal.carb;
    dailyNutrition.fat += meal.fat;
    dailyNutrition.fiber += meal.fiber;
    dailyNutrition.omega3 += meal.omega3;
    dailyNutrition.calories += meal.cal;
    
    updateMacroProgress();
    updateEnergyBalance();
    updateInlineSuggestions();
    
    closeModal('mealModal');
    alert(`‚úÖ ${meal.name} logged successfully!`);
}

function handlePhotoCapture(event) {
    const file = event.target.files[0];
    if (file) {
        const reader = new FileReader();
        reader.onload = function(e) {
            document.getElementById('photoPreview').src = e.target.result;
            document.getElementById('photoPreview').style.display = 'block';
            alert('üì∏ Photo captured! In production, AI would analyze this meal for macros and biomarker impact.');
        };
        reader.readAsDataURL(file);
    }
}

// ==========================================
// PROTOCOL SELECTION
// ==========================================

function openProtocolSelector() {
    openModal('protocolModal');
}

function selectProtocol(protocol) {
    todayProtocol = protocol;
    document.getElementById('protocolName').textContent = protocol;
    
    const protocolScores = {
        'REFORM': 73,
        'CS4': 85,
        'BOXING': 78,
        'YOGA': 65,
        'UFC GYM': 88,
        'TRADITIONAL GYM': 80,
        'REST DAY': 95
    };
    
    document.getElementById('protocolScore').textContent = protocolScores[protocol] || 75;
    
    if (protocol === 'REST DAY') {
        markRestDay();
    }
    
    closeModal('protocolModal');
    updateInlineSuggestions();
    alert(`‚úÖ Today's protocol set to: ${protocol}`);
}

// ==========================================
// BIOMETRICS UPDATE
// ==========================================

function updateBiometrics() {
    const baseline = baselineData[user];
    
    const bodyFat = parseFloat(document.getElementById('bodyFat').value);
    const visceralFat = parseInt(document.getElementById('visceralFat').value);
    const muscleMass = parseFloat(document.getElementById('muscleMass').value);
    const vo2Max = parseFloat(document.getElementById('vo2Max').value);
    const deadHang = parseInt(document.getElementById('deadHang').value);
    const wallSit = parseInt(document.getElementById('wallSit').value);
    
    if (!isNaN(bodyFat)) baseline.bodyFat = bodyFat;
    if (!isNaN(visceralFat)) baseline.visceralFat = visceralFat;
    if (!isNaN(muscleMass)) baseline.muscleMass = muscleMass;
    if (!isNaN(vo2Max)) baseline.vo2Max = vo2Max;
    if (!isNaN(deadHang)) baseline.deadHang = deadHang;
    if (!isNaN(wallSit)) baseline.wallSit = wallSit;
    
    updateBiometricsDisplay();
    
    document.getElementById('bodyFat').value = '';
    document.getElementById('visceralFat').value = '';
    document.getElementById('muscleMass').value = '';
    document.getElementById('vo2Max').value = '';
    document.getElementById('deadHang').value = '';
    document.getElementById('wallSit').value = '';
    
    closeModal('biometricsModal');
    alert('‚úÖ Biometrics updated successfully!');
}

function updateBiometricsDisplay() {
    const baseline = baselineData[user];
    
    const biometricsHTML = `
        <!-- CALCIUM -->
        <div class="metric-item">
            <div class="metric-label">
                <span>CALCIUM</span>
                <span class="metric-goal">Goal: 9.5mg/dL</span>
            </div>
            <div class="metric-comparison">
                <div class="metric-col">
                    <div class="metric-col-label">BASELINE (OCT 31)</div>
                    <div class="metric-value status-optimal">${baseline.calcium}mg/dL</div>
                    <div class="metric-bar">
                        <div class="metric-fill" style="width: ${(baseline.calcium/10)*100}%; background: var(--gold);"></div>
                    </div>
                </div>
                <div class="metric-col">
                    <div class="metric-col-label">PREDICTED <span class="ai-badge">AI</span></div>
                    <div class="metric-value status-optimal">${baseline.calcium}mg/dL</div>
                    <div class="metric-bar">
                        <div class="metric-fill" style="width: ${(baseline.calcium/10)*100}%; background: linear-gradient(90deg, #667eea 0%, #764ba2 100%);"></div>
                    </div>
                </div>
            </div>
            <div class="confidence">MEDIUM confidence ‚Ä¢ base rate</div>
        </div>
        
        <!-- GLUCOSE -->
        <div class="metric-item">
            <div class="metric-label">
                <span>GLUCOSE</span>
                <span class="metric-goal">Goal: 85mg/dL</span>
            </div>
            <div class="metric-comparison">
                <div class="metric-col">
                    <div class="metric-col-label">BASELINE (OCT 31)</div>
                    <div class="metric-value status-optimal">${baseline.glucose}mg/dL</div>
                    <div class="metric-bar">
                        <div class="metric-fill" style="width: ${(baseline.glucose/120)*100}%; background: var(--green);"></div>
                    </div>
                </div>
                <div class="metric-col">
                    <div class="metric-col-label">PREDICTED <span class="ai-badge">AI</span></div>
                    <div class="metric-value status-optimal">${Math.max(82, baseline.glucose - 2)}mg/dL</div>
                    <div class="metric-bar">
                        <div class="metric-fill" style="width: ${(Math.max(82, baseline.glucose - 2)/120)*100}%; background: linear-gradient(90deg, #00ff00 0%, #00cc00 100%);"></div>
                    </div>
                </div>
            </div>
            <div class="confidence">MEDIUM confidence ‚Ä¢ base rate</div>
        </div>
        
        <!-- BODY FAT % -->
        <div class="metric-item">
            <div class="metric-label">
                <span>BODY FAT %</span>
                <span class="metric-goal">Goal: ${user === 'J' ? '12-15%' : '18-22%'}</span>
            </div>
            <div class="metric-comparison">
                <div class="metric-col">
                    <div class="metric-col-label">CURRENT</div>
                    <div class="metric-value status-optimal">${baseline.bodyFat}%</div>
                    <div class="metric-bar">
                        <div class="metric-fill" style="width: ${(baseline.bodyFat/35)*100}%; background: var(--gold);"></div>
                    </div>
                </div>
                <div class="metric-col">
                    <div class="metric-col-label">90-DAY GOAL</div>
                    <div class="metric-value status-optimal">${user === 'J' ? '15.0' : '22.0'}%</div>
                    <div class="metric-bar">
                        <div class="metric-fill" style="width: ${user === 'J' ? '42' : '62'}%; background: linear-gradient(90deg, var(--green) 0%, #00cc00 100%);"></div>
                    </div>
                </div>
            </div>
        </div>
        
        <!-- VISCERAL FAT -->
        <div class="metric-item">
            <div class="metric-label">
                <span>VISCERAL FAT</span>
                <span class="metric-goal">Goal: 1-4</span>
            </div>
            <div class="metric-comparison">
                <div class="metric-col">
                    <div class="metric-col-label">CURRENT</div>
                    <div class="metric-value status-optimal">${baseline.visceralFat}</div>
                    <div class="metric-bar">
                        <div class="metric-fill" style="width: ${(baseline.visceralFat/15)*100}%; background: var(--green);"></div>
                    </div>
                </div>
                <div class="metric-col">
                    <div class="metric-col-label">90-DAY GOAL</div>
                    <div class="metric-value status-optimal">${Math.max(1, baseline.visceralFat - 1)}</div>
                    <div class="metric-bar">
                        <div class="metric-fill" style="width: ${(Math.max(1, baseline.visceralFat - 1)/15)*100}%; background: linear-gradient(90deg, var(--green) 0%, #00cc00 100%);"></div>
                    </div>
                </div>
            </div>
        </div>
        
        <!-- VO2 MAX -->
        <div class="metric-item">
            <div class="metric-label">
                <span>VO2 MAX</span>
                <span class="metric-goal">Goal: ${user === 'J' ? '55+' : '48+'}</span>
            </div>
            <div class="metric-comparison">
                <div class="metric-col">
                    <div class="metric-col-label">CURRENT</div>
                    <div class="metric-value status-optimal">${baseline.vo2Max}</div>
                    <div class="metric-bar">
                        <div class="metric-fill" style="width: ${(baseline.vo2Max/70)*100}%; background: var(--gold);"></div>
                    </div>
                </div>
                <div class="metric-col">
                    <div class="metric-col-label">90-DAY GOAL</div>
                    <div class="metric-value status-optimal">${user === 'J' ? '54.5' : '46.0'}</div>
                    <div class="metric-bar">
                        <div class="metric-fill" style="width: ${user === 'J' ? '77' : '65'}%; background: linear-gradient(90deg, var(--green) 0%, #00cc00 100%);"></div>
                    </div>
                </div>
            </div>
        </div>
        
        <!-- DEAD HANG -->
        <div class="metric-item">
            <div class="metric-label">
                <span>DEAD HANG</span>
                <span class="metric-goal">Goal: ${user === 'J' ? '120+ sec' : '60+ sec'}</span>
            </div>
            <div class="metric-comparison">
                <div class="metric-col">
                    <div class="metric-col-label">CURRENT</div>
                    <div class="metric-value status-optimal">${baseline.deadHang}s</div>
                    <div class="metric-bar">
                        <div class="metric-fill" style="width: ${(baseline.deadHang/180)*100}%; background: var(--gold);"></div>
                    </div>
                </div>
                <div class="metric-col">
                    <div class="metric-col-label">90-DAY GOAL</div>
                    <div class="metric-value status-optimal">${user === 'J' ? '105' : '55'}s</div>
                    <div class="metric-bar">
                        <div class="metric-fill" style="width: ${user === 'J' ? '58' : '30'}%; background: linear-gradient(90deg, var(--green) 0%, #00cc00 100%);"></div>
                    </div>
                </div>
            </div>
        </div>
        
        <!-- WALL SIT -->
        <div class="metric-item">
            <div class="metric-label">
                <span>WALL SIT</span>
                <span class="metric-goal">Goal: ${user === 'J' ? '180+ sec' : '120+ sec'}</span>
            </div>
            <div class="metric-comparison">
                <div class="metric-col">
                    <div class="metric-col-label">CURRENT</div>
                    <div class="metric-value status-optimal">${baseline.wallSit}s</div>
                    <div class="metric-bar">
                        <div class="metric-fill" style="width: ${(baseline.wallSit/240)*100}%; background: var(--gold);"></div>
                    </div>
                </div>
                <div class="metric-col">
                    <div class="metric-col-label">90-DAY GOAL</div>
                    <div class="metric-value status-optimal">${user === 'J' ? '150' : '105'}s</div>
                    <div class="metric-bar">
                        <div class="metric-fill" style="width: ${user === 'J' ? '62' : '43'}%; background: linear-gradient(90deg, var(--green) 0%, #00cc00 100%);"></div>
                    </div>
                </div>
            </div>
        </div>
    `;
    
    document.getElementById('biometricsGrid').innerHTML = biometricsHTML;
    document.getElementById('biometricsCount').textContent = baseline.visceralFat;
}

// ==========================================
// INTELLIGENCE ENGINE
// ==========================================

// TIME-BASED MEAL SUGGESTIONS
function getTimeBasedMealSuggestions() {
    const now = new Date();
    const hour = now.getHours();
    const currentUser = user;
    const baseline = baselineData[currentUser];
    
    let suggestions = {
        timeOfDay: '',
        mealType: '',
        topMeal: null,
        reasoning: ''
    };
    
    if (hour >= 5 && hour < 11) {
        suggestions.timeOfDay = 'MORNING';
        suggestions.mealType = 'BREAKFAST';
        
        if (currentUser === 'J') {
            suggestions.topMeal = {
                name: "Wild Salmon Bowl (Quinoa + Brussels + Flax)",
                reason: "High omega-3 (5.5g) supports ApoB reduction. Complex carbs fuel morning training."
            };
            suggestions.reasoning = "üî¨ SCIENCE: Morning omega-3 intake optimizes lipid metabolism throughout the day. Studies show omega-3s reduce ApoB by 15-25% when consumed consistently.";
        } else {
            suggestions.topMeal = {
                name: "Greek Yogurt Longevity Bowl (Walnuts + Berries + Flax + Kefir)",
                reason: "Probiotics support gut health (linked to autoimmune regulation). Berries are anti-inflammatory."
            };
            suggestions.reasoning = "üî¨ SCIENCE: Anti-inflammatory foods in the morning set the tone for the day. Probiotics + polyphenols from berries reduce autoimmune markers (ANA).";
        }
    } else if (hour >= 11 && hour < 14) {
        suggestions.timeOfDay = 'MIDDAY';
        suggestions.mealType = 'LUNCH';
        
        if (currentUser === 'J') {
            suggestions.topMeal = {
                name: "Sardine Power Salad (Quinoa + Kale + Avocado + Walnuts)",
                reason: "Double sardine dose = 5.8g omega-3. Maximum ApoB impact."
            };
            suggestions.reasoning = "üî¨ SCIENCE: Lunch is prime time for omega-3 loading. Peak absorption occurs 4-6 hours post-consumption, aligning with evening recovery.";
        } else {
            suggestions.topMeal = {
                name: "White Fish + Shrimp Ceviche (Avocado + Cilantro + Lime)",
                reason: "Light, anti-inflammatory. Vitamin C from lime boosts iron absorption."
            };
            suggestions.reasoning = "üî¨ SCIENCE: Midday anti-inflammatory focus helps manage ANA levels. Vitamin C enhances non-heme iron absorption from plant sources.";
        }
    } else if (hour >= 14 && hour < 17) {
        suggestions.timeOfDay = 'AFTERNOON';
        suggestions.mealType = 'SNACK';
        
        suggestions.topMeal = {
            name: currentUser === 'J' ? "Sardine Avocado Toast (Sprouted Bread + Arugula)" : "Kefir Longevity Smoothie (Berries + Walnuts + Flax)",
            reason: currentUser === 'J' ? "Pre-workout omega-3 + complex carbs for UFC training." : "Probiotic-rich for gut-immune health."
        };
        suggestions.reasoning = "üî¨ SCIENCE: Afternoon snacks prevent cortisol spikes from fasting. Omega-3s consumed 2-3 hours pre-training reduce exercise-induced inflammation.";
    } else if (hour >= 17 && hour < 21) {
        suggestions.timeOfDay = 'EVENING';
        suggestions.mealType = 'DINNER';
        
        if (currentUser === 'J') {
            suggestions.topMeal = {
                name: "Wild Salmon Centurion (Lentils + Kale + Walnuts)",
                reason: "6.5g omega-3 for overnight recovery. 52g protein for muscle repair."
            };
            suggestions.reasoning = "üî¨ SCIENCE: Evening omega-3 consumption maximizes overnight anti-inflammatory processes. Growth hormone peaks during deep sleep.";
        } else {
            suggestions.topMeal = {
                name: "Cod + White Beans (Kale + Lemon + Garlic)",
                reason: "Light, anti-inflammatory. White beans provide folate for immune regulation."
            };
            suggestions.reasoning = "üî¨ SCIENCE: Evening meals should be anti-inflammatory and easy to digest for optimal sleep quality.";
        }
    } else {
        suggestions.timeOfDay = 'LATE NIGHT';
        suggestions.mealType = 'AVOID EATING';
        suggestions.topMeal = {
            name: "Kefir Longevity Smoothie (if needed)",
            reason: "Easy to digest. Probiotics support overnight gut repair."
        };
        suggestions.reasoning = "‚ö†Ô∏è CAUTION: Late-night eating disrupts circadian rhythm and sleep quality.";
    }
    
    return suggestions;
}

// PERSONALIZED JUICE RECOMMENDATION
function getPersonalizedJuiceRecommendation() {
    const currentUser = user;
    const baseline = baselineData[currentUser];
    const readiness = ouraReadiness;
    
    let recommendation = {
        primary: '',
        reasoning: '',
        timing: ''
    };
    
    if (currentUser === 'J') {
        if (readiness < 70) {
            recommendation.primary = "Green Longevity Juice (Celery + Cucumber + Spinach + Lemon)";
            recommendation.reasoning = "üî¨ LOW READINESS: Focus on alkalizing, anti-inflammatory juices to support recovery. Turmeric's curcumin reduces systemic inflammation.";
            recommendation.timing = "‚è∞ Best on empty stomach, 30 min before breakfast";
        } else if (baseline.apoB > 80) {
            recommendation.primary = "Beet Vitality Juice (Beet + Carrot + Apple + Ginger)";
            recommendation.reasoning = "üî¨ APOB OPTIMIZATION: Beets improve endothelial function and reduce ApoB particle oxidation. Studies show 8-10% ApoB reduction with daily beet juice.";
            recommendation.timing = "‚è∞ Best 2-3 hours before training for max NO‚ÇÇ effect";
        } else {
            recommendation.primary = "Beet Vitality Juice (Beet + Carrot + Apple + Ginger)";
            recommendation.reasoning = "üî¨ PERFORMANCE: Beets for VO2 max, greens for liver detox. Your biomarkers are solid - maintain with daily anti-inflammatory juicing.";
            recommendation.timing = "‚è∞ Morning on empty stomach or 2 hours pre-training";
        }
    } else {
        if (readiness < 70 || baseline.ana > 1.0) {
            recommendation.primary = "Orange Immune Juice (Carrot + Orange + Turmeric)";
            recommendation.reasoning = "üî¨ AUTOIMMUNE OPTIMIZATION: Vitamin C enhances iron absorption. Turmeric reduces ANA by modulating immune response. Studies show 20-40% reduction in autoimmune markers.";
            recommendation.timing = "‚è∞ With iron-rich meals for maximum absorption";
        } else {
            recommendation.primary = "Green Longevity Juice (Celery + Cucumber + Spinach + Lemon)";
            recommendation.reasoning = "üî¨ IMMUNE BALANCE: Your markers are improving! Maintain with daily greens for alkalizing effect and vitamin C for continued immune support.";
            recommendation.timing = "‚è∞ Morning on empty stomach";
        }
    }
    
    return recommendation;
}

// BURNOUT DETECTION & AUTO-REST PROTOCOL
function checkBurnoutStatus() {
    const readiness = ouraReadiness;
    const today = new Date();
    
    burnoutMetrics.readinessTrend.push(readiness);
    if (burnoutMetrics.readinessTrend.length > 7) {
        burnoutMetrics.readinessTrend.shift();
    }
    
    const avgReadiness = burnoutMetrics.readinessTrend.reduce((a, b) => a + b, 0) / burnoutMetrics.readinessTrend.length;
    
    let burnoutRisk = {
        level: 'LOW',
        indicators: [],
        recommendation: ''
    };
    
    if (readiness < 70) {
        burnoutMetrics.consecutiveHardDays++;
    } else {
        burnoutMetrics.consecutiveHardDays = 0;
    }
    
    if (burnoutMetrics.consecutiveHardDays >= 3) {
        burnoutRisk.indicators.push(`‚ö†Ô∏è ${burnoutMetrics.consecutiveHardDays} consecutive days with readiness < 70`);
    }
    
    if (burnoutMetrics.readinessTrend.length >= 5) {
        const recentAvg = burnoutMetrics.readinessTrend.slice(-3).reduce((a, b) => a + b, 0) / 3;
        const earlierAvg = burnoutMetrics.readinessTrend.slice(0, 3).reduce((a, b) => a + b, 0) / 3;
        
        if (recentAvg < earlierAvg - 10) {
            burnoutRisk.indicators.push(`üìâ Readiness declining: ${earlierAvg.toFixed(0)} ‚Üí ${recentAvg.toFixed(0)}`);
        }
    }
    
    if (readiness < 60) {
        burnoutRisk.indicators.push(`üö® Critical readiness: ${readiness}/100`);
    }
    
    if (burnoutMetrics.lastRestDay) {
        const daysSinceRest = Math.floor((today - burnoutMetrics.lastRestDay) / (1000 * 60 * 60 * 24));
        if (daysSinceRest >= 6) {
            burnoutRisk.indicators.push(`‚è∞ ${daysSinceRest} days since last rest`);
        }
    }
    
    if (burnoutRisk.indicators.length >= 3 || readiness < 60 || burnoutMetrics.consecutiveHardDays >= 4) {
        burnoutRisk.level = 'HIGH';
        burnoutRisk.recommendation = `Your body is showing clear signs of overtraining. Rest is when you get stronger, not during training.`;
        
        todayProtocol = 'REST DAY';
        document.getElementById('protocolName').textContent = 'REST DAY';
        document.getElementById('protocolScore').textContent = '95';
        
    } else if (burnoutRisk.indicators.length >= 2 || readiness < 70 || burnoutMetrics.consecutiveHardDays >= 2) {
        burnoutRisk.level = 'MEDIUM';
        burnoutRisk.recommendation = `Your readiness indicates elevated fatigue. Consider light activity (REFORM, Yoga) or reduce training volume by 30-40%.`;
        
    } else if (avgReadiness >= 85 && readiness >= 80) {
        burnoutRisk.level = 'OPTIMAL';
        burnoutRisk.recommendation = `Your recovery metrics are excellent! You're primed for high-intensity training (UFC GYM, CS4, Boxing).`;
    } else {
        burnoutRisk.level = 'GOOD';
        burnoutRisk.recommendation = `Good recovery status. Proceed with planned training protocol.`;
    }
    
    return burnoutRisk;
}

function markRestDay() {
    burnoutMetrics.lastRestDay = new Date();
    burnoutMetrics.consecutiveHardDays = 0;
}

// DAILY QUALITY TRACKER
function updateDailyQuality() {
    const readiness = ouraReadiness;
    const nutritionScore = parseInt(document.getElementById('nutritionScore').textContent) || 0;
    
    if (readiness >= 85) dailyQuality.sleep = 2;
    else if (readiness >= 75) dailyQuality.sleep = 1;
    else if (readiness >= 65) dailyQuality.sleep = 0;
    else if (readiness >= 55) dailyQuality.sleep = -1;
    else dailyQuality.sleep = -2;
    
    if (nutritionScore >= 90) dailyQuality.nutrition = 2;
    else if (nutritionScore >= 75) dailyQuality.nutrition = 1;
    else if (nutritionScore >= 60) dailyQuality.nutrition = 0;
    else if (nutritionScore >= 40) dailyQuality.nutrition = -1;
    else dailyQuality.nutrition = -2;
    
    const trainingPercent = (caloriesBurned / 700) * 100;
    if (trainingPercent >= 100) dailyQuality.training = 2;
    else if (trainingPercent >= 80) dailyQuality.training = 1;
    else if (trainingPercent >= 50) dailyQuality.training = 0;
    else if (trainingPercent >= 30) dailyQuality.training = -1;
    else dailyQuality.training = -2;
    
    if (todayProtocol === 'REST DAY') {
        dailyQuality.recovery = 2;
    } else if (readiness >= 75 && trainingPercent < 100) {
        dailyQuality.recovery = 1;
    } else if (readiness < 65 && trainingPercent >= 100) {
        dailyQuality.recovery = -2;
    } else {
        dailyQuality.recovery = 0;
    }
    
    const totalScore = dailyQuality.sleep + dailyQuality.nutrition + dailyQuality.training + dailyQuality.recovery;
    
    let dayQuality = {
        score: totalScore,
        rating: '',
        emoji: '',
        color: ''
    };
    
    if (totalScore >= 6) {
        dayQuality.rating = 'EXCEPTIONAL DAY';
        dayQuality.emoji = 'üî•üî•';
        dayQuality.color = 'var(--green)';
    } else if (totalScore >= 4) {
        dayQuality.rating = 'GREAT DAY';
        dayQuality.emoji = '‚úÖ';
        dayQuality.color = 'var(--green)';
    } else if (totalScore >= 2) {
        dayQuality.rating = 'GOOD DAY';
        dayQuality.emoji = 'üëç';
        dayQuality.color = 'var(--gold)';
    } else if (totalScore >= 0) {
        dayQuality.rating = 'AVERAGE DAY';
        dayQuality.emoji = '‚ûñ';
        dayQuality.color = 'var(--text-dim)';
    } else if (totalScore >= -2) {
        dayQuality.rating = 'RECOVERY NEEDED';
        dayQuality.emoji = '‚ö†Ô∏è';
        dayQuality.color = '#FFA500';
    } else {
        dayQuality.rating = 'POOR DAY';
        dayQuality.emoji = 'üö®';
        dayQuality.color = 'var(--red)';
    }
    
    return dayQuality;
}

// AUTO-POPULATE INLINE SUGGESTIONS
function updateInlineSuggestions() {
    const burnout = checkBurnoutStatus();
    const protocolRec = document.getElementById('protocolRecommendation');
    
    if (burnout.level === 'HIGH') {
        document.getElementById('burnoutAlert').style.display = 'block';
        document.getElementById('burnoutAlert').innerHTML = `
            <div class="alert-box">
                <div class="alert-box-title">üö® BURNOUT ALERT</div>
                <div style="font-size: 0.75rem; line-height: 1.5; color: var(--text);">
                    ${burnout.recommendation}
                </div>
            </div>
        `;
        protocolRec.innerHTML = "üõë Mandatory rest day due to high fatigue markers. Your body needs recovery.";
    } else if (burnout.level === 'MEDIUM') {
        document.getElementById('burnoutAlert').style.display = 'none';
        protocolRec.innerHTML = "‚ö†Ô∏è Moderate fatigue detected. Consider light activity (REFORM, Yoga) or reduce volume by 30-40%.";
    } else if (burnout.level === 'OPTIMAL') {
        document.getElementById('burnoutAlert').style.display = 'none';
        protocolRec.innerHTML = "‚úÖ Excellent recovery! You're primed for high-intensity training (UFC GYM, CS4, Boxing).";
    } else {
        document.getElementById('burnoutAlert').style.display = 'none';
        protocolRec.innerHTML = "üëç Good recovery status. Proceed with planned training protocol.";
    }
    
    const mealSuggestions = getTimeBasedMealSuggestions();
    document.getElementById('mealTimeOfDay').textContent = `üçΩÔ∏è ${mealSuggestions.timeOfDay} - ${mealSuggestions.mealType}`;
    
    if (mealSuggestions.topMeal) {
        document.getElementById('mealRecommendation').innerHTML = `
            <strong>${mealSuggestions.topMeal.name}</strong><br>
            <span style="color: var(--text-dim); font-size: 0.7rem;">${mealSuggestions.topMeal.reason}</span><br>
            <span style="font-size: 0.65rem; color: var(--text-dim); margin-top: 5px; display: block;">${mealSuggestions.reasoning}</span>
        `;
    }
    
    const juiceRec = getPersonalizedJuiceRecommendation();
    document.getElementById('juiceRecommendation').innerHTML = `
        <strong>${juiceRec.primary}</strong><br>
        <span style="color: var(--text-dim); font-size: 0.7rem;">${juiceRec.reasoning}</span><br>
        <span style="font-size: 0.65rem; color: var(--gold); margin-top: 5px; display: block;">${juiceRec.timing}</span>
    `;
    
    const cached = localStorage.getItem(`centurion_oura_cache_${user}`);
    if (cached) {
        const data = JSON.parse(cached);
        const syncTime = new Date(data.lastSync);
        const now = new Date();
        const diffMinutes = Math.floor((now - syncTime) / 60000);
        
        if (diffMinutes < 60) {
            document.getElementById('ouraTimestamp').textContent = `${diffMinutes} minutes ago`;
        } else if (diffMinutes < 1440) {
            document.getElementById('ouraTimestamp').textContent = `${Math.floor(diffMinutes / 60)} hours ago`;
        } else {
            document.getElementById('ouraTimestamp').textContent = syncTime.toLocaleDateString();
        }
    }
}

// INTELLIGENCE BRIEFING MODAL
function showDailySuggestions() {
    const dayQuality = updateDailyQuality();
    const burnout = checkBurnoutStatus();
    
    let html = '<div style="padding: 20px;">';
    html += '<div style="font-size: 1.2rem; font-weight: 800; color: var(--gold); margin-bottom: 20px;">ü§ñ DAILY INTELLIGENCE SUMMARY</div>';
    
    html += `
        <div style="background: rgba(255,255,255,0.03); padding: 15px; border-radius: 12px; margin-bottom: 15px; border-left: 4px solid ${dayQuality.color};">
            <div style="font-size: 0.65rem; color: var(--gold); font-weight: 800; margin-bottom: 8px; letter-spacing: 1px;">TODAY'S PERFORMANCE</div>
            <div style="font-size: 1.2rem; font-weight: 700; color: ${dayQuality.color}; margin-bottom: 10px;">${dayQuality.emoji} ${dayQuality.rating}</div>
            <div style="font-size: 0.75rem; line-height: 1.8; color: var(--text);">
                üí§ Sleep Quality: ${'‚òÖ'.repeat(Math.max(0, dailyQuality.sleep + 2))}${'‚òÜ'.repeat(Math.max(0, 2 - dailyQuality.sleep))} (${dailyQuality.sleep > 0 ? '+' + dailyQuality.sleep : dailyQuality.sleep})<br>
                ü•ó Nutrition: ${'‚òÖ'.repeat(Math.max(0, dailyQuality.nutrition + 2))}${'‚òÜ'.repeat(Math.max(0, 2 - dailyQuality.nutrition))} (${dailyQuality.nutrition > 0 ? '+' + dailyQuality.nutrition : dailyQuality.nutrition})<br>
                üî• Training: ${'‚òÖ'.repeat(Math.max(0, dailyQuality.training + 2))}${'‚òÜ'.repeat(Math.max(0, 2 - dailyQuality.training))} (${dailyQuality.training > 0 ? '+' + dailyQuality.training : dailyQuality.training})<br>
                üßò Recovery: ${'‚òÖ'.repeat(Math.max(0, dailyQuality.recovery + 2))}${'‚òÜ'.repeat(Math.max(0, 2 - dailyQuality.recovery))} (${dailyQuality.recovery > 0 ? '+' + dailyQuality.recovery : dailyQuality.recovery})
            </div>
            <div style="margin-top: 12px; padding-top: 12px; border-top: 1px solid rgba(255,255,255,0.1); font-size: 0.7rem; color: var(--text-dim);">
                Overall Score: ${dayQuality.score}/8
            </div>
        </div>
    `;
    
    const burnoutColors = {
        'HIGH': 'var(--red)',
        'MEDIUM': '#FFA500',
        'LOW': 'var(--green)',
        'OPTIMAL': 'var(--green)',
        'GOOD': 'var(--gold)'
    };
    
    html += `
        <div style="background: rgba(255,255,255,0.03); padding: 15px; border-radius: 12px; margin-bottom: 15px; border-left: 4px solid ${burnoutColors[burnout.level]};">
            <div style="font-size: 0.65rem; color: var(--gold); font-weight: 800; margin-bottom: 8px; letter-spacing: 1px;">RECOVERY STATUS</div>
            <div style="font-size: 1rem; font-weight: 700; color: ${burnoutColors[burnout.level]}; margin-bottom: 10px;">
                ${burnout.level === 'HIGH' ? 'üö® HIGH FATIGUE' : burnout.level === 'MEDIUM' ? '‚ö†Ô∏è MODERATE FATIGUE' : burnout.level === 'OPTIMAL' ? '‚úÖ OPTIMAL' : 'üëç GOOD'}
            </div>
            ${burnout.indicators.length > 0 ? `
                <div style="font-size: 0.75rem; line-height: 1.6; color: var(--text); margin-bottom: 10px;">
                    ${burnout.indicators.join('<br>')}
                </div>
            ` : ''}
            <div style="font-size: 0.7rem; color: var(--text-dim);">
                ${burnout.recommendation}
            </div>
        </div>
    `;
    
    if (burnoutMetrics.readinessTrend.length >= 3) {
        const trend = burnoutMetrics.readinessTrend.slice(-7);
        html += `
            <div style="background: rgba(255,255,255,0.03); padding: 15px; border-radius: 12px;">
                <div style="font-size: 0.65rem; color: var(--gold); font-weight: 800; margin-bottom: 8px; letter-spacing: 1px;">7-DAY READINESS TREND</div>
                <div style="font-size: 0.75rem; color: var(--text); margin-bottom: 10px;">
                    ${trend.map(r => `<span style="color: ${r >= 85 ? 'var(--green)' : r >= 70 ? 'var(--gold)' : 'var(--red)'}; font-weight: 700;">${r}</span>`).join(' ‚Üí ')}
                </div>
                <div style="font-size: 0.7rem; color: var(--text-dim);">
                    Average: ${Math.round(trend.reduce((a,b) => a+b, 0) / trend.length)}
                </div>
            </div>
        `;
    }
    
    html += '</div>';
    
    const existingModal = document.getElementById('suggestionsModal');
    if (existingModal) existingModal.remove();
    
    const modal = document.createElement('div');
    modal.className = 'modal';
    modal.id = 'suggestionsModal';
    modal.style.display = 'block';
    modal.innerHTML = `
        <div class="modal-content">
            <div class="modal-header">
                <div class="modal-title">ü§ñ CENTURION INTELLIGENCE</div>
                <button class="close-btn" onclick="closeSuggestionsModal()">√ó</button>
            </div>
            ${html}
        </div>
    `;
    
    document.body.appendChild(modal);
    
    modal.addEventListener('click', function(e) {
        if (e.target === modal) {
            closeSuggestionsModal();
        }
    });
}

function closeSuggestionsModal() {
    const modal = document.getElementById('suggestionsModal');
    if (modal) modal.remove();
}

// ==========================================
// INITIALIZATION
// ==========================================

window.onload = function() {
    updateDashboard();
    updateBiometricsDisplay();
    loadCachedOuraData();
    updateInlineSuggestions();
};

</script>
</body>
</html>







