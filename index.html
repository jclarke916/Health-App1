<!DOCTYPE html>

<html lang="en">
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width,initial-scale=1.0,maximum-scale=1.0,user-scalable=no">
<title>Centurion v19.4 - 61 Meals (BJ's Bowl)</title>
<style>
:root{--bg:#050505;--panel:#121212;--border:#222;--acid:#ccff00;--cyan:#00f0ff;--purple:#bf5af2;--alert:#ff453a;--text:#fff}
*{box-sizing:border-box;margin:0;padding:0}
body{background:var(--bg);color:var(--text);font-family:-apple-system,BlinkMacSystemFont,"Segoe UI",Roboto,sans-serif;padding-bottom:120px;-webkit-tap-highlight-color:transparent}
.header{background:rgba(10,10,10,0.95);padding:15px;padding-top:12px;border-bottom:1px solid #333;position:sticky;top:0;z-index:100;backdrop-filter:blur(10px);position:relative}
.user-switch{display:flex;gap:6px;background:#1a1a1a;padding:3px;border-radius:24px;margin-bottom:8px;border:1px solid #333}
.user-switch button{flex:1;padding:8px 10px;border:none;background:transparent;color:#666;border-radius:20px;cursor:pointer;font-weight:800;font-size:0.7rem;transition:all 0.3s;letter-spacing:0.5px}
.user-switch button.active{background:var(--acid);color:#000;box-shadow:0 0 15px rgba(204,255,0,0.4)}
.date-nav{display:flex;justify-content:space-between;align-items:center;margin-top:10px;background:#000;border:1px solid #333;border-radius:10px;padding:6px}
.nav-btn{background:transparent;border:none;color:var(--cyan);padding:5px 20px;font-size:1.2rem;cursor:pointer;text-shadow:0 0 8px rgba(0,240,255,0.6)}
#dateLabel{flex:1;text-align:center;color:#fff;font-weight:700;font-size:0.9rem;font-family:monospace;letter-spacing:1px}
.bio-btn{background:var(--acid);color:#000;border:none;padding:8px 14px;border-radius:6px;font-size:0.65rem;font-weight:900;cursor:pointer;box-shadow:0 0 10px rgba(204,255,0,0.3);letter-spacing:0.5px;margin-left:8px}
.hero{padding:25px 15px;display:flex;gap:15px;align-items:center}
.dual-score{display:flex;gap:15px;align-items:center}
.score-box{border:2px solid #333;border-radius:50%;display:flex;flex-direction:column;align-items:center;justify-content:center;position:relative;background:#000}
.score-box.small{width:70px;height:70px}
.score-box.primary{width:90px;height:90px;border-width:3px;background:radial-gradient(circle,rgba(204,255,0,0.08) 0%,transparent 70%);border-color:var(--acid);box-shadow:0 0 25px rgba(204,255,0,0.2)}
.score-val{font-size:1.4rem;font-weight:900;line-height:1;color:#fff}
.score-val.longevity{font-size:2.2rem;background:linear-gradient(135deg,var(--acid) 0%,var(--cyan) 100%);-webkit-background-clip:text;-webkit-text-fill-color:transparent;filter:drop-shadow(0 0 8px rgba(204,255,0,0.6))}
.score-label{font-size:0.45rem;color:#666;text-transform:uppercase;margin-top:4px;font-weight:800;letter-spacing:1px}
.score-avg-badge{position:absolute;bottom:-12px;background:#111;border:1px solid #333;padding:2px 6px;border-radius:8px;font-size:0.4rem;color:var(--cyan);font-weight:900;letter-spacing:0.5px}
.section-header{padding:15px;font-size:0.65rem;font-weight:900;color:#888;letter-spacing:1.5px;text-transform:uppercase;margin-top:10px;display:flex;align-items:center;gap:10px}
.section-header::after{content:'';height:1px;background:#333;flex:1}
.grid-3{display:grid;grid-template-columns:1fr 1fr 1fr;gap:10px;padding:0 15px;margin-bottom:20px}
.grid-4{display:grid;grid-template-columns:1fr 1fr 1fr 1fr;gap:8px;padding:0 15px;margin-bottom:20px}
.orb-card{background:linear-gradient(145deg,#111 0%,#080808 100%);border:1px solid #222;border-radius:14px;padding:15px 5px;display:flex;flex-direction:column;align-items:center;transition:transform 0.1s}
.orb-card:active{transform:scale(0.96)}
.orb-container{width:55px;height:55px;position:relative;margin-bottom:8px;margin-left:auto;margin-right:auto}
.orb-svg{transform:rotate(-90deg);width:100%;height:100%;position:absolute;top:0;left:0;z-index:1}
.orb-bg{fill:none;stroke:#1a1a1a;stroke-width:5}
.orb-fg{fill:none;stroke-width:5;stroke-dasharray:145;stroke-dashoffset:145;transition:stroke-dashoffset 1s cubic-bezier(0.4,0,0.2,1);stroke-linecap:round;filter:drop-shadow(0 0 4px currentColor)}
.orb-val-box{position:absolute;top:50%;left:50%;transform:translate(-50%,-50%);width:100%;text-align:center;z-index:10;pointer-events:none}
.orb-val{font-family:'Courier New',monospace;font-size:0.7rem;font-weight:900;color:#fff;text-shadow:0 0 4px #000;letter-spacing:-0.5px;line-height:1;margin-top:2px}
.orb-label{font-size:0.45rem;font-weight:800;color:#666;text-transform:uppercase;letter-spacing:0.5px}
.heart-svg{width:100%;height:100%;overflow:visible;z-index:1;position:absolute;top:0;left:0}
.heart-bg{fill:none;stroke:#1a1a1a;stroke-width:2.5}
.heart-fg{fill:none;stroke-width:2.5;stroke-dasharray:100;stroke-dashoffset:100;transition:stroke-dashoffset 1s ease;filter:drop-shadow(0 0 3px currentColor)}
.beating{animation:heartbeat 1.5s infinite;transform-origin:center}
@keyframes heartbeat{0%{transform:scale(1)}15%{transform:scale(1.1)}30%{transform:scale(1)}45%{transform:scale(1.1)}60%{transform:scale(1)}}
.rainbow-container{padding:0 15px;margin-bottom:20px}
.rainbow-header{display:flex;justify-content:space-between;align-items:center;margin-bottom:10px}
.rainbow-title{font-size:0.65rem;font-weight:900;color:#ccc;letter-spacing:1px}
.rainbow-score{font-size:0.9rem;font-weight:900;color:var(--acid);font-family:monospace;text-shadow:0 0 10px rgba(204,255,0,0.3)}
.rainbow-track{height:10px;background:#111;border-radius:5px;display:flex;overflow:hidden;border:1px solid #333}
.rainbow-seg{height:100%;width:0%;transition:width 0.5s ease;box-shadow:inset 0 0 5px rgba(0,0,0,0.5)}
.timeline{padding:0 15px;margin-bottom:40px}
.task{display:flex;gap:12px;margin-bottom:15px;min-height:60px}
.task-time{width:45px;color:#666;font-size:0.7rem;padding-top:15px;text-align:right;font-family:monospace;font-weight:bold}
.task-card{flex:1;background:linear-gradient(180deg,#111 0%,#0d0d0d 100%);border:1px solid #333;border-radius:12px;padding:15px;position:relative;transition:all 0.2s;display:flex;justify-content:space-between;align-items:center}
.task-card:active{transform:scale(0.98);background:#1a1a1a}
.task-card.checked{border-color:var(--acid);background:rgba(204,255,0,0.03);box-shadow:0 0 15px rgba(204,255,0,0.05)}
.task-card.auto-detected{border-color:var(--cyan);background:rgba(0,240,255,0.03)}
.task-card.recovery{border-color:var(--purple);background:rgba(191,90,242,0.03)}
.task-card.facial{border-color:var(--cyan);background:rgba(0,240,255,0.05)}
.task-card.optional{border-style:dashed;border-color:#444;opacity:0.7}
.task-card.optional .task-title::after{content:" (Optional)";font-size:0.65rem;color:#666;font-weight:400}
.task-info{flex:1}
.task-title{font-weight:900;font-size:0.85rem;margin-bottom:5px;color:#fff}
.task-desc{font-size:0.7rem;color:#888;line-height:1.4}
.chevron{font-size:1.5rem;color:#333;margin-left:15px;font-weight:900;transition:color 0.2s}
.task-card:active .chevron{color:var(--acid)}
.check-btn{width:40px;height:40px;display:flex;align-items:center;justify-content:center;cursor:pointer;margin-left:5px}
.check-circle{width:26px;height:26px;border:2px solid #555;border-radius:50%;background:rgba(0,0,0,0.5);display:flex;align-items:center;justify-content:center;font-weight:900;font-size:1rem;color:transparent;transition:all 0.2s}
.task-card.checked .check-circle{background:var(--acid);border-color:var(--acid);color:#000;box-shadow:0 0 10px var(--acid)}
.modal-overlay{position:fixed;top:0;left:0;width:100%;height:100%;background:rgba(0,0,0,0.95);z-index:500;display:none;overflow-y:auto;backdrop-filter:blur(8px)}
.modal-overlay.show{display:block}
.modal-content{width:100%;min-height:100vh;background:#050505;padding-bottom:150px}
.modal-header{padding:20px;border-bottom:1px solid #222;display:flex;justify-content:space-between;align-items:center;position:sticky;top:0;background:rgba(5,5,5,0.95);z-index:10}
.modal-title{font-size:1rem;font-weight:900;color:var(--acid);text-transform:uppercase;letter-spacing:1px;max-width:85%}
.modal-close{background:transparent;border:none;color:#fff;font-size:2rem;cursor:pointer;line-height:1}
.modal-body{padding:20px 20px 180px 20px}
.menu-item{padding:20px;border-bottom:1px solid #222;cursor:pointer;display:flex;justify-content:space-between;align-items:center;transition:background 0.2s;background:linear-gradient(90deg,#111 0%,#0d0d0d 100%);margin-bottom:1px}
.menu-item:active{background:#1a1a1a}
.menu-left{flex:1}
.menu-name{font-size:1rem;font-weight:800;color:#fff;margin-bottom:6px;letter-spacing:0.5px}
.menu-meta{font-size:0.7rem;color:#888;font-family:monospace}
.menu-arrow{color:#333;font-size:1.5rem;font-weight:900;margin-left:10px}
.footer{position:fixed;bottom:0;left:0;width:100%;background:#000;padding:12px 15px;border-top:1px solid #333;display:flex;justify-content:space-between;align-items:center;z-index:90}
.sync-status{font-size:0.6rem;color:#666;font-family:monospace}
.sync-btn{background:var(--acid);color:#000;border:none;padding:8px 16px;border-radius:6px;cursor:pointer;font-weight:900;font-size:0.7rem}

.debug-console{position:fixed;bottom:60px;left:0;right:0;max-height:300px;background:rgba(0,0,0,0.98);border-top:2px solid var(‚Äìacid);z-index:199;overflow-y:auto;padding:10px;font-size:0.65rem;color:#0f0;font-family:monospace;display:none}
.debug-console.show{display:block}
.debug-btn{position:fixed;bottom:70px;right:10px;z-index:200;background:var(‚Äìacid);color:#000;border:none;padding:8px 12px;border-radius:6px;font-weight:900;cursor:pointer;font-size:0.7rem}
.debug-log{margin-bottom:4px;border-bottom:1px solid #222;padding-bottom:4px}
.debug-time{color:#666;margin-right:8px}
.debug-type{color:var(‚Äìcyan);margin-right:8px;font-weight:900}

/* RECIPE PAGE STYLES */
.recipe-hero{margin-bottom:25px;text-align:center}
.recipe-title{font-size:1.6rem;font-weight:900;line-height:1.2;margin-bottom:8px;color:#fff}
.recipe-stats{font-size:0.85rem;color:#888;font-weight:700;font-family:monospace}
.macro-grid{display:grid;grid-template-columns:repeat(4,1fr);gap:10px;margin-bottom:25px}
.macro-stat{background:#111;border:1px solid #333;padding:12px 5px;border-radius:10px;text-align:center}
.m-val{font-size:1.1rem;font-weight:900;color:#fff;font-family:monospace;line-height:1}
.m-lbl{font-size:0.5rem;color:var(‚Äìacid);text-transform:uppercase;margin-top:6px;font-weight:900;letter-spacing:0.5px}
.synergy-box{background:linear-gradient(135deg,rgba(0,240,255,0.08) 0%,rgba(0,0,0,0) 100%);border:1px solid rgba(0,240,255,0.3);padding:20px;border-radius:12px;margin-bottom:25px;position:relative}
.syn-title{color:var(‚Äìcyan);font-weight:900;font-size:0.75rem;text-transform:uppercase;margin-bottom:10px;letter-spacing:1px}
.syn-text{color:#ccc;font-size:0.95rem;font-style:italic;line-height:1.6}
.ing-item{color:#ccc;font-size:0.9rem;border-bottom:1px solid #1a1a1a;padding:12px 0;display:flex;align-items:center}
.ing-item::before{content:‚Äô‚Ä¢‚Äô;color:var(‚Äìacid);font-weight:bold;margin-right:12px;font-size:1.3rem}
.step-item{display:flex;gap:15px;font-size:0.9rem;color:#ddd;line-height:1.6;margin-bottom:15px;background:#111;padding:15px;border-radius:10px;border:1px solid #222}
</style>

</head>
<body>

<div class="header">
    <div class="user-switch">
        <button id="btn-jermaine" onclick="if(window.app)app.switchUser('jermaine')">JERMAINE</button>
        <button id="btn-sophia" onclick="if(window.app)app.switchUser('sophia')">SOPHIA</button>
    </div>
    <div class="date-nav">
        <button class="nav-btn" onclick="if(window.app)app.changeDate(-1)">‚óÄ</button>
        <span id="dateLabel">LOADING...</span>
        <button class="nav-btn" onclick="if(window.app)app.changeDate(1)">‚ñ∂</button>
        <button class="bio-btn" onclick="if(window.app)app.openBio()">BIO</button>
    </div>
</div>

<div class="hero">
    <div class="dual-score">
        <div class="score-box small">
            <div class="score-val" id="dayGrade">--</div>
            <div class="score-label">TODAY</div>
        </div>
        <div class="score-box primary">
            <div class="score-val longevity" id="longevityScore">85</div>
            <div class="score-label">LONGEVITY</div>
            <div class="score-avg-badge">7-DAY AVG</div>
        </div>
    </div>
    <div class="status" id="statusMsg">INITIALIZING...</div>
</div>

<div class="section-header">SLEEP ARCHITECTURE</div>
<div class="grid-3">
    <div class="orb-card"><div class="orb-container"><svg class="orb-svg" viewBox="0 0 50 50"><circle class="orb-bg" cx="25" cy="25" r="21"></circle><circle class="orb-fg" id="sleepOrb" cx="25" cy="25" r="21" style="stroke:#bf5af2"></circle></svg><div class="orb-val-box"><div class="orb-val" id="sleepVal">--</div></div></div><div class="orb-label" style="color:#bf5af2">TOTAL</div></div>
    <div class="orb-card"><div class="orb-container"><svg class="orb-svg" viewBox="0 0 50 50"><circle class="orb-bg" cx="25" cy="25" r="21"></circle><circle class="orb-fg" id="deepOrb" cx="25" cy="25" r="21" style="stroke:#007aff"></circle></svg><div class="orb-val-box"><div class="orb-val" id="deepVal">--</div></div></div><div class="orb-label" style="color:#007aff">DEEP</div></div>
    <div class="orb-card"><div class="orb-container"><svg class="orb-svg" viewBox="0 0 50 50"><circle class="orb-bg" cx="25" cy="25" r="21"></circle><circle class="orb-fg" id="remOrb" cx="25" cy="25" r="21" style="stroke:#bf5af2"></circle></svg><div class="orb-val-box"><div class="orb-val" id="remVal">--</div></div></div><div class="orb-label" style="color:#bf5af2">REM</div></div>
</div>

<div class="section-header">FUEL (NUTRITION)</div>
<div class="grid-4">
    <div class="orb-card"><div class="orb-container"><svg class="orb-svg" viewBox="0 0 50 50"><circle class="orb-bg" cx="25" cy="25" r="21"></circle><circle class="orb-fg" id="proteinOrb" cx="25" cy="25" r="21" style="stroke:#fff"></circle></svg><div class="orb-val-box"><div class="orb-val" id="proteinVal">0</div></div></div><div class="orb-label" style="color:#fff">PROTEIN</div></div>
    <div class="orb-card"><div class="orb-container"><svg class="orb-svg" viewBox="0 0 50 50"><circle class="orb-bg" cx="25" cy="25" r="21"></circle><circle class="orb-fg" id="omega3Orb" cx="25" cy="25" r="21" style="stroke:#00d4ff"></circle></svg><div class="orb-val-box"><div class="orb-val" id="omega3Val">0</div></div></div><div class="orb-label" style="color:#00d4ff">OMEGA-3</div></div>
    <div class="orb-card"><div class="orb-container"><svg class="orb-svg" viewBox="0 0 50 50"><circle class="orb-bg" cx="25" cy="25" r="21"></circle><circle class="orb-fg" id="fiberOrb" cx="25" cy="25" r="21" style="stroke:#30d158"></circle></svg><div class="orb-val-box"><div class="orb-val" id="fiberVal">0</div></div></div><div class="orb-label" style="color:#30d158">FIBER</div></div>
    <div class="orb-card"><div class="orb-container"><svg class="orb-svg" viewBox="0 0 50 50"><circle class="orb-bg" cx="25" cy="25" r="21"></circle><circle class="orb-fg" id="calorieOrb" cx="25" cy="25" r="21" style="stroke:#FFD60A"></circle></svg><div class="orb-val-box"><div class="orb-val" id="calorieVal">0</div></div></div><div class="orb-label" style="color:#FFD60A">CALORIES</div></div>
</div>

<div class="section-header">ENGINE (CARDIO)</div>
<div class="grid-4">
    <div class="orb-card">
        <div class="orb-container"><svg class="heart-svg beating" viewBox="0 0 24 24"><path class="heart-bg" d="M12 21.35l-1.45-1.32C5.4 15.36 2 12.28 2 8.5 2 5.42 4.42 3 7.5 3c1.74 0 3.41.81 4.5 2.09C13.09 3.81 14.76 3 16.5 3 19.58 3 22 5.42 22 8.5c0 3.78-3.4 6.86-8.55 11.54L12 21.35z"></path><path class="heart-fg" d="M12 21.35l-1.45-1.32C5.4 15.36 2 12.28 2 8.5 2 5.42 4.42 3 7.5 3c1.74 0 3.41.81 4.5 2.09C13.09 3.81 14.76 3 16.5 3 19.58 3 22 5.42 22 8.5c0 3.78-3.4 6.86-8.55 11.54L12 21.35z" style="fill:none;stroke:#ff453a;stroke-width:2.5;"></path></svg><div class="orb-val-box"><div class="orb-val" id="rhrVal">--</div></div></div>
        <div class="orb-label" style="color:#ff453a">RHR</div>
    </div>
    <div class="orb-card">
        <div class="orb-container"><svg class="heart-svg" viewBox="0 0 24 24"><path class="heart-bg" d="M12 21.35l-1.45-1.32C5.4 15.36 2 12.28 2 8.5 2 5.42 4.42 3 7.5 3c1.74 0 3.41.81 4.5 2.09C13.09 3.81 14.76 3 16.5 3 19.58 3 22 5.42 22 8.5c0 3.78-3.4 6.86-8.55 11.54L12 21.35z"></path><path class="heart-fg" id="z2Heart" pathLength="100" stroke-dasharray="100" stroke-dashoffset="100" d="M12 21.35l-1.45-1.32C5.4 15.36 2 12.28 2 8.5 2 5.42 4.42 3 7.5 3c1.74 0 3.41.81 4.5 2.09C13.09 3.81 14.76 3 16.5 3 19.58 3 22 5.42 22 8.5c0 3.78-3.4 6.86-8.55 11.54L12 21.35z" style="fill:none;stroke:#00f0ff;stroke-width:2.5"></path></svg><div class="orb-val-box"><div class="orb-val" id="z2Val">0</div></div></div>
        <div class="orb-label" style="color:#00f0ff">ZONE 2</div>
    </div>
    <div class="orb-card">
        <div class="orb-container"><svg class="heart-svg" viewBox="0 0 24 24"><path class="heart-bg" d="M12 21.35l-1.45-1.32C5.4 15.36 2 12.28 2 8.5 2 5.42 4.42 3 7.5 3c1.74 0 3.41.81 4.5 2.09C13.09 3.81 14.76 3 16.5 3 19.58 3 22 5.42 22 8.5c0 3.78-3.4 6.86-8.55 11.54L12 21.35z"></path><path class="heart-fg" id="z5Heart" pathLength="100" stroke-dasharray="100" stroke-dashoffset="100" d="M12 21.35l-1.45-1.32C5.4 15.36 2 12.28 2 8.5 2 5.42 4.42 3 7.5 3c1.74 0 3.41.81 4.5 2.09C13.09 3.81 14.76 3 16.5 3 19.58 3 22 5.42 22 8.5c0 3.78-3.4 6.86-8.55 11.54L12 21.35z" style="fill:none;stroke:#ff453a;stroke-width:2.5"></path></svg><div class="orb-val-box"><div class="orb-val" id="z5Val">0</div></div></div>
        <div class="orb-label" style="color:#ff453a">ZONE 5</div>
    </div>
    <div class="orb-card">
        <div class="orb-container"><svg class="heart-svg" viewBox="0 0 24 24"><path class="heart-bg" d="M12 21.35l-1.45-1.32C5.4 15.36 2 12.28 2 8.5 2 5.42 4.42 3 7.5 3c1.74 0 3.41.81 4.5 2.09C13.09 3.81 14.76 3 16.5 3 19.58 3 22 5.42 22 8.5c0 3.78-3.4 6.86-8.55 11.54L12 21.35z"></path><path class="heart-fg" id="calHeart" pathLength="100" stroke-dasharray="100" stroke-dashoffset="100" d="M12 21.35l-1.45-1.32C5.4 15.36 2 12.28 2 8.5 2 5.42 4.42 3 7.5 3c1.74 0 3.41.81 4.5 2.09C13.09 3.81 14.76 3 16.5 3 19.58 3 22 5.42 22 8.5c0 3.78-3.4 6.86-8.55 11.54L12 21.35z" style="fill:none;stroke:#FFD60A;stroke-width:2.5"></path></svg><div class="orb-val-box"><div class="orb-val" id="calVal">0</div></div></div>
        <div class="orb-label" style="color:#FFD60A">BURN</div>
    </div>
</div>

<div class="section-header">VASCULAR AGE ü´Ä</div>
<div class="section">
    <div style="display:flex;gap:0;align-items:center;padding:15px;background:#0a0a0a;border-radius:10px;border:1px solid #222">
        <div style="flex:1;text-align:center;border-right:1px solid #222;padding:10px">
            <div style="font-size:0.7rem;color:#666;margin-bottom:5px">VASCULAR</div>
            <div style="font-size:2rem;font-weight:900;color:#00f0ff" id="vascularAgeVal">--</div>
        </div>
        <div style="flex:1;text-align:center;border-right:1px solid #222;padding:10px">
            <div style="font-size:0.7rem;color:#666;margin-bottom:5px">ACTUAL</div>
            <div style="font-size:2rem;font-weight:900;color:#666" id="chronologicalAge">--</div>
        </div>
        <div style="flex:1;text-align:center;padding:10px">
            <div style="font-size:0.7rem;font-weight:600;margin-bottom:5px" id="vascularAgeTrend">TRACKING</div>
            <div style="font-size:0.7rem;color:#666;margin-bottom:5px">DELTA</div>
            <div style="font-size:2rem;font-weight:900" id="ageDelta">--</div>
        </div>
    </div>
</div>

<div class="section-header">PHYTONUTRIENT DIVERSITY üåà</div>
<div class="rainbow-container">
    <div class="rainbow-header"><div class="rainbow-title">RAINBOW SCORE</div><div class="rainbow-score" id="rainbowScore">0%</div></div>
    <div class="rainbow-track" id="rainbowTrack"></div>
</div>

<div class="section-header">SYNERGY PROTOCOL üîÑ AUTO-DETECT</div>
<div class="timeline" id="timeline"></div>

<div class="modal-overlay" id="mainModal">
    <div class="modal-content">
        <div class="modal-header">
            <div class="modal-title" id="modalTitle">TITLE</div>
            <button class="modal-close" onclick="app.closeModal()">√ó</button>
        </div>
        <div class="modal-body" id="modalBody"></div>
    </div>
</div>

<div class="footer">
    <span class="sync-status" id="syncStatus">INIT</span>
    <button class="sync-btn" onclick="if(window.app)app.sync()">üîÑ SYNC</button>
</div>

<button class="debug-btn" onclick="toggleDebug()">üêõ DEBUG</button>

<div class="debug-console" id="debugConsole"></div>

<script>
const debugLogs=[];
function log(msg,type='LOG'){
const t=new Date().toLocaleTimeString();
debugLogs.push({t:t,type:type,msg:msg});
if(debugLogs.length>50)debugLogs.shift();
console.log(msg);
renderDebug();
}
function logerr(msg){log(msg,'ERROR')}
function renderDebug(){
const el=document.getElementById('debugConsole');
if(!el)return;
let html='';
debugLogs.forEach(l=>{
const color=l.type==='ERROR'?'#ff453a':'#0f0';
html+=`<div class="debug-log"><span class="debug-time">[${l.t}]</span><span class="debug-type" style="color:${color}">${l.type}</span><span style="color:#ccc">${l.msg}</span></div>`;
});
el.innerHTML=html;
el.scrollTop=el.scrollHeight;
}
function toggleDebug(){
const el=document.getElementById('debugConsole');
if(el.classList.contains('show')){el.classList.remove('show')}else{el.classList.add('show')}
}

const USERS={
jermaine:{name:"Jermaine",dob:"1983-01-13",goals:{protein:175,omega3:4000,fiber:50,water:140,weightTarget:210,heightInches:76.5,z2:45,z5:20,calBurn:500},defaultBios:{bmr:'2028',apob:'114',lpa:'178',weight:'215.7',hscrp:'0.4',hba1c:'5.4',bodyfat:'21.6',muscle:'97.0'}},
sophia:{name:"Sophia",dob:"1987-01-25",goals:{protein:130,omega3:4000,fiber:35,water:100,weightTarget:140,heightInches:64,z2:30,z5:15,calBurn:350},defaultBios:{bmr:'1450',apob:'70',lpa:'20',weight:'148',hscrp:'0.5',hba1c:'5.2',bodyfat:'18.2',muscle:'68.0'}}
};

// ============================================================================
// ============================================================================
// MEAL DATABASE - START
// Replace this entire section (lines until "MEAL DATABASE - END") with the
// 50-meal database from the separate text file when ready to expand
// ============================================================================
const MEALS={
breakfast:[
{title:"Greek Yogurt & Berries",time:"5min",servings:1,macros:{p:20,o:0,f:4,cal:250},ingredients:["1 cup Greek Yogurt","1/2 cup Mixed Berries","1 tbsp Honey","1 tbsp Walnuts"],steps:["Scoop yogurt into bowl","Top with berries and walnuts","Drizzle with honey"],why:"Probiotics + Antioxidants. Quick high protein start.",colors:['white','purple','brown']},
{title:"Omega Breakfast",time:"15min",servings:1,macros:{p:58,o:3500,f:12,cal:680},ingredients:["8oz Wild Salmon","2 Eggs","2 cups Kale","1 cup Blueberries","1 tsp EVOO"],steps:["Heat EVOO in pan","Season salmon with salt/pepper","Sear salmon 4min per side","Scramble eggs separately","Massage kale for 2min","Plate kale as base","Top with salmon, eggs, and berries"],why:"Salmon + Eggs = Choline/Omega-3 synergy for brain health.",colors:['orange','purple','green']},
{title:"Sophia's Sea Moss Oatmeal",time:"10min",servings:1,macros:{p:48,o:8200,f:18,cal:580},ingredients:["1 cup Oats","1 tbsp Sea Moss","3 tbsp Flaxseed","Pea Protein","Berries"],steps:["Cook oats in water or oat milk","Stir in Sea Moss gel and protein","Top with ground flax and berries"],why:"Sea Moss minerals support thyroid. Flax lowers Lp(a).",colors:['purple','white']},
{title:"PB Sea Moss Power Shake",time:"5min",servings:1,macros:{p:54,o:7200,f:16,cal:680},ingredients:["Pea Protein","Sea Moss","Flaxseed","PB","Spinach"],steps:["Blend all ingredients with Oat Milk"],why:"Sea Moss supports mucus membranes. Pea protein = 54g complete.",colors:['green','white']},
{title:"Smoked Trout Hash",time:"18min",servings:1,macros:{p:54,o:3200,f:16,cal:640},ingredients:["6oz Trout","2 Eggs","1 Sweet Potato","Brussels Sprouts","Garlic"],steps:["Dice sweet potato and saute","Add sprouts and garlic","Crack eggs into wells","Cover until eggs set","Top with flaked trout"],why:"Trout is lower mercury than tuna. Sprouts = Sulforaphane.",colors:['orange','green']},
{title:"Savory Turmeric Oats",time:"12min",servings:1,macros:{p:20,o:1200,f:12,cal:450},ingredients:["1 cup Oats","Turmeric","Black Pepper","Spinach","Poached Egg"],steps:["Cook oats with turmeric/pepper","Stir in spinach","Top with egg"],why:"Turmeric + Pepper = 2000% absorption boost.",colors:['yellow','green']},
{title:"Mackerel Scramble",time:"12min",servings:1,macros:{p:56,o:4800,f:10,cal:660},ingredients:["mackerel","eggs","arugula","turmeric"],steps:["Whisk eggs with turmeric","Scramble with mackerel","Serve over wilted arugula"],why:"Mackerel is highest Omega-3 fish. Turmeric reduces inflammation.",colors:['yellow','green']},
{title:"Smoked Salmon Avocado Toast",time:"12min",servings:1,macros:{p:54,o:3400,f:14,cal:680},ingredients:["smoked salmon","sprouted grain bread","avocado","eggs"],steps:["Toast bread","Mash avocado","Top with salmon and poached egg"],why:"Sprouted grains easier to digest. Salmon + Avocado = healthy fats.",colors:['orange','green']},
{title:"Flax Protein Parfait",time:"5min",servings:1,macros:{p:48,o:8600,f:18,cal:580},ingredients:["pea protein","flaxseed","greek yogurt","berries"],steps:["Mix yogurt and protein","Layer with flax and berries"],why:"Flax is highest plant source of ALA. Yogurt = probiotics.",colors:['white','purple']},
{title:"Tofu Scramble Supreme",time:"12min",servings:1,macros:{p:44,o:2800,f:10,cal:580},ingredients:["tofu","spinach","mushrooms","turmeric"],steps:["Crumble tofu","Saut√© with veggies and spices"],why:"Soy protein lowers cholesterol. Turmeric/Pepper combo.",colors:['yellow','green','white']},
{title:"Protein Pancakes",time:"15min",servings:1,macros:{p:52,o:6400,f:14,cal:620},ingredients:["pea protein","flaxseed","oats","berries"],steps:["Blend batter ingredients","Cook on griddle","Top with berries"],why:"High protein start to day. Oats = soluble fiber.",colors:['purple','white']},
{title:"Eggs & Oatmeal Combo",time:"12min",servings:1,macros:{p:52,o:7800,f:16,cal:640},ingredients:["¬Ω cup steel-cut oats","2 tbsp ground flaxseed","1 tbsp Sea Moss Gel","3 eggs","1 cup spinach","¬Ω avocado","Berries"],steps:["Cook oats with Sea Moss","Scramble eggs with spinach","Plate oatmeal with flax, berries","Serve eggs on side with avocado"],why:"Best of both worlds. Flax omega-3 + egg choline. Sea Moss minerals.",colors:['green','white']},
{title:"Power Berry Smoothie",time:"5min",servings:1,macros:{p:58,o:8400,f:18,cal:680},ingredients:["1 scoop Pea Protein","2 tbsp Ground Flaxseed","2 tbsp Hemp Seeds","1 cup Greek Yogurt","2 tbsp Peanut Butter","1 cup Mixed Berries","1 cup Oat Milk","1 tsp Vanilla Extract"],steps:["Add all ingredients to blender","Blend on high for 60 seconds","Pour into glass","Optional: top with extra berries"],why:"Triple protein stack (pea + yogurt + peanut). Flax + Hemp = massive omega-3 hit. Berries = antioxidants.",colors:['purple','brown','white']},
{title:"Sprouted Salmon Power Sandwich",time:"8min",servings:1,macros:{p:48,o:6200,f:14,cal:580},ingredients:["2 slices Sprouted Grain Bread","4oz Smoked Salmon","2 tbsp Spinach Hummus","1 tbsp Ground Flaxseed","1 tbsp Hemp Seeds","Handful Spinach","Lemon","Black Pepper"],steps:["Toast sprouted bread","Spread hummus on both slices","Layer salmon on bottom slice","Sprinkle flax and hemp seeds","Add fresh spinach leaves","Squeeze lemon, crack pepper","Close sandwich"],why:"Sprouted grains = higher bioavailability. Salmon = omega-3 DHA/EPA. Flax + Hemp = ALA omega-3 stack. Hummus = plant protein + fiber.",colors:['pink','green','brown']}
],
lunch:[
{title:"Classic Bison Burger",time:"20min",servings:1,macros:{p:42,o:400,f:8,cal:550},ingredients:["6oz Ground Bison","1 Whole Wheat Bun","Lettuce/Tomato/Onion","1 tsp Mustard","Side Green Salad"],steps:["Form bison patty (don't overwork)","Grill or pan sear 3-4 mins/side (Medium Rare)","Toast bun lightly","Assemble with fresh veggies","Serve with side salad"],why:"Bison = Lower TMAO & inflammation than beef. High Heme Iron.",colors:['brown','green','red']},
{title:"Ahi Poke Bowl",time:"15min",servings:1,macros:{p:45,o:1200,f:8,cal:520},ingredients:["6oz Ahi Tuna","Brown Rice","Cucumber","Mango","Seaweed","Sesame Oil"],steps:["Cube raw tuna","Toss in sesame oil and soy","Plate over brown rice","Top with sliced veg and mango"],why:"Raw fish preserves delicate Omega-3s. Seaweed = Iodine.",colors:['red','green','yellow']},
{title:"Turkey Club Wrap",time:"10min",servings:1,macros:{p:38,o:400,f:6,cal:540},ingredients:["1 large tortilla","4oz turkey breast","2 slices turkey bacon","Lettuce","Tomato","Mayo (light)"],steps:["Cook bacon until crisp","Spread mayo on wrap","Layer turkey, bacon, veg","Roll tightly and slice"],why:"High protein lunch standard.",colors:['white','green','red']},
{title:"Bean & Cheese Burrito",time:"10min",servings:1,macros:{p:22,o:200,f:14,cal:580},ingredients:["1 large whole wheat tortilla","1/2 cup refried beans (vegetarian)","1/4 cup cheddar","Salsa","Spinach","Greek yogurt"],steps:["Spread beans on tortilla","Add cheese and salsa","Add spinach","Roll and heat in pan","Dip in yogurt"],why:"Beans = fiber/protein combo. Whole wheat = sustained energy.",colors:['brown','green','white']},
{title:"Zoodles & Shrimp",time:"15min",servings:1,macros:{p:35,o:600,f:5,cal:400},ingredients:["Zucchini","Shrimp","Garlic","Lemon","Olive Oil"],steps:["Spiralize zucchini","Saute shrimp with garlic","Toss zoodles in pan for 1 min"],why:"Low carb, high nutrient density.",colors:['green','pink']},
{title:"Cottage Cheese Bowl",time:"5min",servings:1,macros:{p:30,o:200,f:4,cal:350},ingredients:["Cottage Cheese","Pineapple","Walnuts","Chia Seeds"],steps:["Scoop cheese into bowl","Top with fruit and nuts"],why:"Casein protein creates slow release amino acids.",colors:['white','yellow']},
{title:"Salmon Pesto Pasta",time:"20min",servings:1,macros:{p:56,o:4200,f:12,cal:740},ingredients:["6oz Salmon","Chickpea Pasta","Pesto","Tomatoes","Arugula"],steps:["Boil chickpea pasta","Sear salmon separately","Toss pasta with pesto","Combine salmon and pasta","Top with tomatoes"],why:"Chickpea pasta = high fiber/protein. Pesto = polyphenols.",colors:['pink','green','red']},
{title:"Chipotle Bowl (Bison)",time:"18min",servings:1,macros:{p:58,o:2800,f:20,cal:740},ingredients:["6oz Bison","Brown Rice","Black Beans","Peppers","Guacamole"],steps:["Brown bison in pan","Warm black beans","Build bowl with rice base","Top with meat, beans, peppers","Add guacamole"],why:"Bison = nutrient dense red meat. Beans = soluble fiber.",colors:['brown','black','green','red']},
{title:"Chipotle Bowl (Tofu)",time:"20min",servings:1,macros:{p:46,o:3200,f:22,cal:680},ingredients:["tofu","brown rice","black beans","peppers"],steps:["Season and bake tofu","Assemble bowl with beans and rice"],why:"Plant-based complete protein. High fiber.",colors:['white','black','green']},
{title:"Mediterranean Quinoa Salad",time:"15min",servings:1,macros:{p:22,o:1200,f:14,cal:580},ingredients:["quinoa","cucumber","tomatoes","olives","feta"],steps:["Mix cooked quinoa with chopped veg","Add olives and feta","Drizzle with olive oil"],why:"Mediterranean diet gold standard. Olives = healthy fats.",colors:['white','green','red','black']},
{title:"Lentil Soup with Kale",time:"30min",servings:2,macros:{p:24,o:800,f:18,cal:450},ingredients:["lentils","kale","carrots","celery"],steps:["Simmer lentils with veg","Add kale at end to wilt"],why:"High fiber lowers cholesterol. Kale = nutrient density.",colors:['brown','green','orange']},
{title:"Turkey Burger & Sweet Potato",time:"20min",servings:1,macros:{p:38,o:300,f:8,cal:580},ingredients:["turkey","sweet potato","lettuce","tomato"],steps:["Grill turkey burger","Roast sweet potato wedges","Serve with salad"],why:"Lean protein. Sweet potato = Vitamin A.",colors:['white','orange','green']},
{title:"Chickpea Curry (Quick)",time:"20min",servings:2,macros:{p:18,o:400,f:14,cal:480},ingredients:["1 can chickpeas","1 cup coconut milk (light)","1 tbsp red curry paste","1 cup spinach","1/2 cup bell pepper","1/2 onion","Basmati rice"],steps:["Saut√© onion and peppers","Add curry paste, cook 1 min","Add coconut milk and chickpeas","Simmer 10 mins","Stir in spinach","Serve over rice"],why:"Chickpeas = fiber/protein. Turmeric in paste = anti-inflammatory.",colors:['yellow','green','white']},
{title:"Bison Taco Salad",time:"15min",servings:1,macros:{p:45,o:800,f:12,cal:620},ingredients:["5oz ground bison","2 cups romaine","1/2 cup black beans","1/4 cup salsa","1/4 avocado","1 tbsp greek yogurt","Cumin, chili powder"],steps:["Brown bison with spices","Drain fat","Assemble lettuce base","Top with meat, beans, salsa","Add avocado and yogurt dollop"],why:"Bison = nutrient dense red meat. Beans = soluble fiber.",colors:['brown','black','green','red']},
{title:"Edamame & Quinoa Bowl",time:"15min",servings:1,macros:{p:24,o:1800,f:12,cal:540},ingredients:["1 cup cooked quinoa","1 cup shelled edamame","1/2 cup shredded purple cabbage","1 carrot (shredded)","Ginger soy dressing","Sesame seeds"],steps:["Warm quinoa and edamame","Toss with cabbage and carrot","Drizzle dressing","Top with sesame seeds"],why:"Edamame = soy protein. Purple cabbage = antioxidants.",colors:['green','purple','orange']},
{title:"Smoked Salmon Bagel (Open)",time:"5min",servings:1,macros:{p:32,o:2800,f:6,cal:480},ingredients:["1 whole grain bagel","4oz smoked salmon","2 tbsp cream cheese","Capers","Red onion","Dill","Cucumber slices"],steps:["Toast bagel","Spread cream cheese","Layer salmon","Top with capers, onion, dill","Serve cucumber on side"],why:"Salmon = omega-3. Whole grain = fiber.",colors:['orange','white','green']},
{title:"Leftover Roast Chicken Salad",time:"10min",servings:1,macros:{p:40,o:600,f:8,cal:520},ingredients:["5oz roast chicken (cold)","2 cups arugula","1/2 apple (diced)","1/4 cup walnuts","Celery","Yogurt dressing"],steps:["Chop chicken and celery","Toss with arugula and apple","Add walnuts","Mix with yogurt dressing"],why:"Chicken = protein. Walnuts = ALA omega-3. Apple = quercetin.",colors:['white','green','brown']},
{title:"Tempeh Reuben Bowl",time:"15min",servings:1,macros:{p:28,o:1200,f:16,cal:560},ingredients:["6oz tempeh strips","1/2 cup sauerkraut","1 slice swiss cheese","Rye croutons","Thousand island dressing (light)","Mixed greens"],steps:["Pan fry tempeh strips","Melt cheese on tempeh","Place over greens","Add kraut and croutons","Drizzle dressing"],why:"Tempeh/Kraut = gut health powerhouse.",colors:['brown','green']},
{title:"Shrimp & Asparagus Stir Fry",time:"15min",servings:1,macros:{p:35,o:800,f:8,cal:450},ingredients:["6oz shrimp","1 bunch asparagus","Garlic","Ginger","Soy sauce","Sesame oil","Cauliflower rice"],steps:["Saut√© garlic/ginger in oil","Add asparagus, stir fry 3min","Add shrimp, cook until pink","Add soy sauce","Serve over cauli rice"],why:"Shrimp = astaxanthin. Asparagus = prebiotic. Low carb option.",colors:['pink','green','white']},
{title:"Turkey Club (Sourdough)",time:"10min",servings:1,macros:{p:40,o:500,f:6,cal:550},ingredients:["Sliced Turkey","Sourdough Bread","Avocado","Tomato","Lettuce"],steps:["Toast sourdough","Layer turkey and veg","Add mashed avocado"],why:"Sourdough is fermented/low glycemic. Turkey = lean protein.",colors:['white','red','green']},
{title:"Costco Cauliflower Pizza",time:"25min",servings:2,macros:{p:36,o:200,f:8,cal:580},ingredients:["1 Costco Cauliflower Pizza Crust","1 cup Marinara Sauce","2 cups Mozzarella","Toppings: Peppers, Mushrooms, Onions","Italian Herbs","Side Salad"],steps:["Preheat oven to 425¬∞F","Spread marinara on cauliflower crust","Add mozzarella and toppings","Sprinkle with herbs","Bake 18-20 mins until cheese bubbles","Serve with side salad"],why:"Cauliflower crust = lower carb, higher fiber. Costco convenience meets nutrition.",colors:['white','red','green']},
{title:"Bone Broth Pho",time:"15min",servings:1,macros:{p:42,o:600,f:8,cal:420},ingredients:["3 cups Bone Broth (beef or chicken)","6oz Sliced Beef or Chicken","Rice Noodles","Bean Sprouts","Fresh Basil","Cilantro","Lime","Jalape√±o","Hoisin","Sriracha"],steps:["Heat bone broth to boiling","Cook rice noodles according to package","Add sliced meat to hot broth (cooks in 2min)","Drain noodles, add to bowl","Pour hot broth and meat over noodles","Top with sprouts, herbs, lime, jalape√±o","Add hoisin and sriracha to taste"],why:"Bone broth = collagen, glycine, minerals for gut/joint health. High protein, anti-inflammatory.",colors:['brown','white','green']},
{title:"Belgian Mussels & Frites",time:"20min",servings:1,macros:{p:38,o:1200,f:6,cal:520},ingredients:["2lbs Mussels (cleaned)","1 cup White Wine","3 cloves Garlic","Shallots","Fresh Thyme","Butter","Parsley","Lemon","Sweet Potato Fries","Side Salad"],steps:["Saut√© shallots and garlic in butter","Add white wine and thyme, bring to boil","Add mussels, cover and steam 5-7 mins until open","Discard any unopened mussels","Finish with parsley and lemon","Serve with baked sweet potato fries and salad"],why:"Mussels = zinc, iron, B12, omega-3. Sweet potato = vitamin A. High protein, low calorie.",colors:['black','orange','green']},
{title:"Cioppino Seafood Power Bowl",time:"25min",servings:1,macros:{p:54,o:2400,f:12,cal:620},ingredients:["4oz Cod (cubed)","6 Mussels","4oz Shrimp","1/2 cup Quinoa","1/2 cup Brown Rice","1 can Diced Tomatoes","3 cloves Garlic","1/2 cup White Wine","Fresh Basil","2 tbsp Olive Oil","Red Pepper Flakes","Lemon"],steps:["Cook quinoa and brown rice together","In large pan, heat olive oil","Saut√© garlic and red pepper flakes","Add diced tomatoes and white wine","Bring to simmer, add cod and mussels","Cover 5 mins until mussels open","Add shrimp, cook 3 mins until pink","Plate grains in bowl","Top with seafood stew","Garnish with basil and lemon"],why:"Triple seafood stack = omega-3 DHA/EPA + zinc + B12. Mussels = 10x RDA zinc. Quinoa = complete protein. Tomatoes = lycopene.",colors:['red','white','green']}
],
dinner:[
{title:"Whole Branzino w/ Seafood Medley",time:"40min",servings:2,macros:{p:52,o:2800,f:12,cal:580},ingredients:["2 Whole Branzino (cleaned)","1/2lb Shrimp","1/2lb Mussels","Cherry Tomatoes","1/2 cup White Wine","Garlic & Parsley","Lemon Slices"],steps:["Score fish, stuff with lemon/herbs","Place in roasting pan","Surround with shrimp, mussels, tomatoes","Pour wine and garlic over everything","Bake at 400¬∞F for 25 mins"],why:"Whole Fish = Collagen/Glycine from skin/bones. Shellfish = Zinc stack.",colors:['white','pink','red']},
{title:"Turkey Chili",time:"35min",servings:2,macros:{p:35,o:400,f:15,cal:500},ingredients:["1lb ground turkey","1 can kidney beans","1 can diced tomatoes","1 onion","1 bell pepper","Chili powder","Cumin","Garlic"],steps:["Brown turkey with onion/garlic","Add peppers and spices","Add tomatoes and beans","Simmer 30 mins"],why:"Turkey = lean protein. Beans = fiber. Tomatoes = lycopene.",colors:['brown','red']},
{title:"Beef Bolognese (Zoodles)",time:"40min",servings:2,macros:{p:40,o:500,f:10,cal:550},ingredients:["1lb ground beef","1 jar marinara (no sugar)","1 onion","2 carrots","Celery","Zucchini noodles"],steps:["Brown beef","Add chopped veg, cook 5 min","Add sauce, simmer 20 min","Serve over raw or lightly saut√©ed zoodles"],why:"Beef = iron. Tomato sauce = lycopene.",colors:['red','green']},
{title:"Stuffed Peppers",time:"50min",servings:4,macros:{p:30,o:400,f:10,cal:450},ingredients:["Bell Peppers","Ground Bison","Brown Rice","Spinach","Tomato Sauce"],steps:["Hollow peppers","Mix meat/rice/veg","Stuff peppers","Bake at 375F for 40m"],why:"Vitamin C from peppers boosts iron absorption from bison.",colors:['red','green','brown']},
{title:"Sesame Seared Tuna",time:"15min",servings:2,macros:{p:50,o:1500,f:2,cal:400},ingredients:["Ahi Tuna Steaks","Sesame Seeds","Soy Sauce","Ginger","Asparagus"],steps:["Coat tuna in seeds","Sear 1 min/side","Serve with steamed asparagus"],why:"High selenium content in tuna. Ginger aids digestion.",colors:['red','white','green']},
{title:"Seafood Cioppino",time:"40min",servings:2,macros:{p:42,o:1800,f:8,cal:480},ingredients:["White Fish","Mussels/Shrimp","Tomato Broth","Fennel","Garlic"],steps:["Saute fennel and garlic","Add broth and simmer","Poach fish gently in broth"],why:"Tomato (cooked) = high Lycopene. Low calorie, high mineral.",colors:['white','red','green']},
{title:"Herb Crusted Cod",time:"20min",servings:1,macros:{p:52,o:2800,f:10,cal:580},ingredients:["8oz wild cod","¬Ω cup almond flour","1 egg","Parsley","Dill","Lemon zest","Asparagus","1 tbsp EVOO"],steps:["Mix almond flour, herbs, zest","Dip cod in egg, then flour","Pan fry 4min per side in EVOO","Steam asparagus","Plate with lemon wedges"],why:"Cod = lean protein. Almonds = Vitamin E. Asparagus = prebiotic fiber.",colors:['white','green']},
{title:"Grass-Fed Steak & Sprouts",time:"25min",servings:1,macros:{p:60,o:1200,f:14,cal:720},ingredients:["8oz grass-fed sirloin","2 cups Brussels sprouts","¬Ω sweet potato","Garlic","Rosemary","Balsamic vinegar","1 tbsp EVOO"],steps:["Halve sprouts, toss in balsamic","Roast sprouts and potato 20min at 400¬∞F","Sear steak 3min per side","Rest steak 5min","Slice against grain"],why:"Grass-fed beef = CLA and Omega-3. Brussels = sulforaphane. Sweet potato = potassium.",colors:['red','green','orange']},
{title:"Mediterranean Chicken",time:"25min",servings:1,macros:{p:55,o:800,f:12,cal:640},ingredients:["8oz chicken breast","1 cup quinoa","Cucumber","Cherry tomatoes","Kalamata olives","Feta cheese","Oregano","Olive oil"],steps:["Cook quinoa","Grill chicken with oregano","Chop veg","Mix quinoa, veg, olives","Top with sliced chicken and feta","Drizzle olive oil"],why:"Chicken = lean complete protein. Olives = hydroxytyrosol (potent antioxidant). Quinoa = complete plant protein.",colors:['white','black','red']},
{title:"Tempeh Stir Fry (Plant)",time:"15min",servings:1,macros:{p:42,o:2200,f:18,cal:580},ingredients:["8oz tempeh","Broccoli","Bell peppers","Snap peas","Ginger","Garlic","Tamari","Sesame oil","Brown rice"],steps:["Steam tempeh 5min (removes bitterness)","Cube and saut√© in sesame oil","Add veggies, ginger, garlic","Add splash of water to steam veg","Finish with tamari","Serve over rice"],why:"Tempeh = fermented soy (gut health). Ginger = anti-inflammatory. Broccoli = sulforaphane.",colors:['brown','green','red']},
{title:"Sheet Pan Salmon & Veggies",time:"20min",servings:1,macros:{p:45,o:3200,f:10,cal:620},ingredients:["6oz salmon fillet","1 cup broccoli florets","1 cup bell peppers","1 tbsp olive oil","Lemon slices","Dill","Garlic powder"],steps:["Preheat oven to 400¬∞F","Toss veggies in oil and spices","Place salmon and veggies on pan","Top salmon with lemon/dill","Roast 15-18 mins"],why:"Salmon = omega-3. One pan meal. Broccoli = detox support.",colors:['orange','green','red']},
{title:"Shrimp Scampi with Zoodles",time:"15min",servings:1,macros:{p:30,o:600,f:6,cal:420},ingredients:["6oz shrimp","2 zucchini (spiralized)","2 tbsp butter/ghee","3 cloves garlic","Lemon juice","Parsley","Red pepper flakes"],steps:["Saut√© garlic in butter","Add shrimp, cook pink","Add lemon and flakes","Toss in zoodles for 1 min","Garnish parsley"],why:"Shrimp = iodine/selenium. Zucchini = low cal volume.",colors:['pink','green','white']},
{title:"Lamb Kofta Bowl",time:"25min",servings:1,macros:{p:40,o:900,f:10,cal:680},ingredients:["6oz ground lamb","1 tsp cumin/coriander","Cucumber yogurt sauce","Tomatoes","Onion","Mixed greens","Pita"],steps:["Mix lamb with spices","Form small oblong patties","Grill or pan fry 8 mins","Assemble bowl with greens","Top with kofta and sauce"],why:"Lamb = zinc/iron. Fermented yogurt = gut health.",colors:['brown','green','white','red']},
{title:"Pesto Chicken Zoodles",time:"15min",servings:1,macros:{p:45,o:500,f:8,cal:550},ingredients:["6oz chicken breast","2 zucchini","1/4 cup basil pesto","Cherry tomatoes","Parmesan"],steps:["Cook chicken pieces","Spiralize zucchini","Toss chicken and zoodles with pesto","Add halved tomatoes","Warm through"],why:"Basil = anti-bacterial. Chicken = protein base.",colors:['green','white','red']},
{title:"Seared Scallops & Risotto",time:"30min",servings:1,macros:{p:35,o:700,f:4,cal:580},ingredients:["6oz sea scallops","1/2 cup arborio rice","2 cups broth","White wine (splash)","Parmesan","Peas","Butter"],steps:["Cook risotto (ladle broth slowly)","Stir in peas/parm","Sear scallops in hot butter (2 min/side)","Serve scallops atop risotto"],why:"Scallops = B12/magnesium. Peas = plant protein.",colors:['white','green']},
{title:"Chicken Stir Fry",time:"15min",servings:1,macros:{p:40,o:300,f:8,cal:520},ingredients:["6oz chicken breast","Broccoli","Snap peas","Carrots","Soy sauce","Ginger/Garlic","Sesame oil"],steps:["Slice chicken thin","Stir fry chicken","Remove, stir fry veg","Combine with sauce","Simmer 1 min"],why:"Lean protein + fiber rich veg.",colors:['white','green','orange']},
{title:"Baked Cod with Salsa",time:"20min",servings:1,macros:{p:45,o:2000,f:8,cal:480},ingredients:["8oz cod fillet","1/2 cup salsa","1/4 avocado","Cilantro","Lime","Asparagus side"],steps:["Place cod in baking dish","Top with salsa","Bake 400¬∞F for 15 min","Top with avocado/cilantro","Serve with steamed asparagus"],why:"Cod = low calorie protein source.",colors:['white','red','green']},
{title:"Egg Roll in a Bowl",time:"15min",servings:1,macros:{p:35,o:600,f:10,cal:480},ingredients:["1/2lb ground pork/turkey","1 bag coleslaw mix","Ginger","Garlic","Soy sauce","Sriracha","Green onions"],steps:["Brown meat","Add slaw mix, ginger, garlic","Saut√© until wilted","Stir in soy/sriracha","Top with green onions"],why:"Cabbage = cruciferous benefits. High volume meal.",colors:['white','green']},
{title:"Lemon Garlic Shrimp",time:"15min",servings:1,macros:{p:30,o:500,f:4,cal:380},ingredients:["8oz shrimp","2 tbsp butter","3 cloves garlic","Lemon juice","Parsley","Green beans"],steps:["Steam green beans","Saut√© garlic in butter","Cook shrimp","Finish with lemon/parsley","Plate together"],why:"Shrimp = high protein low fat.",colors:['pink','green','white']},
{title:"Meatballs & Marinara",time:"30min",servings:2,macros:{p:32,o:400,f:8,cal:550},ingredients:["1lb ground beef","1 egg","1/4 cup almond flour","Italian herbs","Marinara sauce","Spinach side"],steps:["Mix meat, egg, flour, herbs","Roll balls","Bake 400¬∞F 20 min","Simmer in sauce 5 min","Serve with wilted spinach"],why:"Beef = B12/Zinc. Spinach = folate.",colors:['red','green']},
{title:"Curry Chicken Salad",time:"10min",servings:1,macros:{p:40,o:800,f:8,cal:560},ingredients:["5oz cooked chicken","Greek yogurt","Curry powder","Grapes/Raisins","Cashews","Celery"],steps:["Chop chicken","Mix yogurt and curry powder","Combine all","Serve in lettuce cups"],why:"Curry = turmeric anti-inflammatory. Yogurt = probiotics.",colors:['yellow','green']},
{title:"Chicken Breast Power Bowl",time:"25min",servings:1,macros:{p:52,o:400,f:14,cal:620},ingredients:["8oz chicken breast","1/2 cup quinoa","1/2 cup brown rice","2 cups broccoli","Garlic","Olive oil","Lemon"],steps:["Cook quinoa and brown rice together","Season chicken with salt, pepper, garlic","Grill or bake chicken 20 min at 375¬∞F","Steam broccoli for 5 min","Plate rice/quinoa base","Top with sliced chicken and broccoli","Drizzle with olive oil and lemon"],why:"Complete protein + complex carbs + fiber. Quinoa = all 9 amino acids. Broccoli = sulforaphane.",colors:['white','brown','green']},
{title:"Mediterranean Mussels Pasta",time:"25min",servings:1,macros:{p:44,o:1800,f:10,cal:580},ingredients:["2lbs Mussels (cleaned)","Chickpea Pasta","Cherry Tomatoes","Kalamata Olives","Garlic","White Wine","Fresh Basil","Olive Oil","Red Pepper Flakes","Parmesan"],steps:["Cook chickpea pasta al dente","Saut√© garlic in olive oil","Add tomatoes, cook until blistered","Add white wine, bring to boil","Add mussels, cover 5-7 mins until open","Discard unopened mussels","Toss pasta with mussel broth","Top with olives, basil, red pepper","Finish with parmesan"],why:"Mussels = zinc, iron, B12, omega-3 stack. Chickpea pasta = protein + fiber. Mediterranean diet gold.",colors:['black','red','green']},
{title:"BJ's Chicken Quinoa Bowl",time:"30min",servings:1,macros:{p:48,o:600,f:12,cal:580},ingredients:["8oz Grilled Chicken Breast","1 cup Quinoa","1/2 cup Black Beans","1/2 Avocado","Corn","Cherry Tomatoes","Red Onion","Cilantro","Lime","Olive Oil","Feta Cheese"],steps:["Cook quinoa according to package","Season and grill chicken breast","Warm black beans","Dice tomatoes, onion, avocado","Assemble bowl: quinoa base","Top with sliced chicken","Add beans, corn, tomatoes, onion","Top with avocado and feta","Drizzle with olive oil and lime","Garnish with cilantro"],why:"Complete protein from quinoa + chicken. Black beans = fiber + resistant starch. Avocado = healthy fats. Balanced macros.",colors:['white','brown','green','red']}
],
juices:[
{title:"The Red Pipe Clearer",macros:{p:2,o:0,f:1,cal:110},ingredients:["Beets","Carrots","Ginger","Lemon"],steps:["Wash produce","Juice beets first","Drink immediately"],why:"Beets increase Nitric Oxide, dilating blood vessels.",colors:['red','orange']},
{title:"The ANA Green Soother",macros:{p:2,o:0,f:1,cal:90},ingredients:["Celery","Cucumber","Turmeric","Ginger"],steps:["Juice turmeric/ginger","Follow with watery veg","Add black pepper"],why:"Turmeric/Ginger is the ultimate anti-inflammatory stack.",colors:['green','yellow']},
{title:"The Citrus Alkalizer",macros:{p:2,o:0,f:2,cal:120},ingredients:["2 Apples","2 Oranges","2 cups Spinach","4 Celery Stalks","1 Lemon"],steps:["Wash all produce thoroughly","Juice spinach and celery first","Follow with apples and oranges","Finish with lemon","Stir and drink immediately"],why:"Apple + Celery = potassium flush. Spinach = alkalizing minerals. Citrus = Vitamin C boost.",colors:['green','orange']},
{title:"Longevity Gold Elixir",macros:{p:1,o:0,f:0,cal:60},ingredients:["oranges","sea moss","turmeric"],steps:["Juice oranges","Stir in sea moss gel and turmeric"],why:"Vitamin C + Minerals. Immune booster.",colors:['orange','yellow']},
{title:"Homemade Kombucha Flight",macros:{p:0,o:0,f:0,cal:35},ingredients:["16oz Homemade Kombucha","Ice","Lemon slice","Mint sprig"],steps:["Pour chilled kombucha over ice","Garnish with fresh mint and lemon"],why:"Potent probiotics for gut microbiome diversity.",colors:['yellow']},
{title:"Golden Milk (Hot)",macros:{p:2,o:200,f:3,cal:95},ingredients:["2 cups Oat Milk","2 tsp Turmeric","1 tsp Sea Moss Gel","1 tsp Coconut Oil","Pinch Black Pepper","Honey (optional)"],steps:["Heat oat milk in saucepan","Whisk in turmeric and black pepper","Add sea moss gel and coconut oil","Simmer 5 mins (low heat)","Strain if needed","Serve hot with handful of mixed nuts or hummus"],why:"Turmeric needs fat + heat for bioavailability. Sea moss = 92 minerals. Black pepper = 2000x curcumin absorption. Serve hot with fat source.",colors:['yellow','orange']}
],
snack:[
{title:"Beef Jerky (Grass-Fed)",macros:{p:12,o:0,f:0,cal:80},ingredients:["1oz Beef Jerky (Grass-fed)"],steps:["Open and enjoy"],why:"Pure bioavailable protein. Zero prep. convenient.",colors:['brown']},
{title:"Savory Pulp Crackers",macros:{p:6,o:1200,f:12,cal:140},ingredients:["Veggie Pulp","Flaxseed","Chia Seeds","Water"],steps:["Mix pulp and seeds","Spread thin on sheet","Dehydrate 8hrs"],why:"Zero waste. Massive fiber hit binds to cholesterol.",colors:['brown']},
{title:"Citrus Ginger Pulp Chews",macros:{p:3,o:200,f:8,cal:110},ingredients:["fruit pulp","almond flour","coconut"],steps:["Mix ingredients","Dehydrate until chewy"],why:"Uses leftover pulp. High fiber treat.",colors:['orange','white']},
{title:"Dark Chocolate Oatmeal Balls",macros:{p:10,o:300,f:5,cal:210},ingredients:["1.5 cups rolled oats","1/2 cup dark chocolate chips","1/2 cup almond butter"],steps:["Mix oats, protein, and salt","Fold in chocolate chips","Roll into balls"],why:"Oats = beta-glucan (lowers LDL). Dark chocolate = flavonols.",colors:['brown']},
{title:"Centurion Protein Balls (PB)",macros:{p:12,o:800,f:4,cal:220},ingredients:["1 cup oats","1/2 cup peanut butter","1/3 cup honey","Protein powder"],steps:["Mix all ingredients in a bowl","Roll into balls","Refrigerate"],why:"Quick protein hit + omega-3 from flax/chia.",colors:['brown']},
{title:"Hummus & Carrots",macros:{p:4,o:0,f:6,cal:150},ingredients:["1/2 cup Hummus","2 Carrots (sliced)"],steps:["Slice carrots","Scoop hummus","Enjoy"],why:"Fiber rich carb with healthy fats.",colors:['orange','white']},
{title:"Roasted Seaweed Snacks",macros:{p:1,o:100,f:1,cal:30},ingredients:["1 pack Seaweed sheets"],steps:["Eat straight from pack"],why:"Iodine powerhouse for thyroid health.",colors:['green']},
{title:"Omega Nut Mix",macros:{p:6,o:2500,f:4,cal:180},ingredients:["Walnuts","Brazil Nuts","Almonds"],steps:["Combine nuts"],why:"Walnuts essential for lowering Lp(a).",colors:['brown']},
{title:"Hard Boiled Eggs",macros:{p:12,o:100,f:0,cal:140},ingredients:["2 Eggs","Salt","Pepper"],steps:["Boil eggs for 10 mins","Cool in ice water","Peel and season"],why:"Choline source for brain health. Pure bioavailable protein.",colors:['white','yellow']}
]
};
// ============================================================================
// MEAL DATABASE - END
// ============================================================================
// ============================================================================

const BASE=[
{id:'morningJuice',time:'7:00 AM',title:'Morning Juice',desc:'Tap to select',macros:{p:0,o:0,f:0,cal:0},colors:[],clickable:true,mealSlot:'juices'},
{id:'breakfast',time:'7:30 AM',title:'Breakfast',desc:'Tap to select',macros:{p:0,o:0,f:0,cal:0},colors:[],clickable:true,mealSlot:'breakfast'},
{id:'breakfastSnack',time:'10:00 AM',title:'Morning Snack',desc:'Tap to select',macros:{p:0,o:0,f:0,cal:0},colors:[],clickable:true,mealSlot:'snack'},
{id:'lunch',time:'1:00 PM',title:'Lunch',desc:'Tap to select',macros:{p:0,o:0,f:0,cal:0},colors:[],clickable:true,mealSlot:'lunch'},
{id:'lunchSnack',time:'3:00 PM',title:'Afternoon Snack',desc:'Tap to select',macros:{p:0,o:0,f:0,cal:0},colors:[],clickable:true,mealSlot:'snack'},
{id:'optionalKombucha',time:'3:30 PM',title:'Kombucha',desc:'Tap to select',macros:{p:0,o:0,f:0,cal:0},colors:[],clickable:true,mealSlot:'juices',cssClass:'optional'},
{id:'dinner',time:'6:30 PM',title:'Dinner',desc:'Tap to select',macros:{p:0,o:0,f:0,cal:0},colors:[],clickable:true,mealSlot:'dinner'}
];
const TOKENS={jermaine:'WLIGFPFJQY73G43BY7CK7H6UJXPQ7N5Y',sophia:'4QSDWYJJUZFHRWRH727NCK7WH4COQJF4'};
const COLORS={red:{hex:'#ff453a'},orange:{hex:'#ff9f0a'},yellow:{hex:'#ffd60a'},green:{hex:'#30d158'},purple:{hex:'#bf5af2'},white:{hex:'#fff'},brown:{hex:'#A0522D'}};
const PROTOCOLS={
microcurrent:{title:"‚ö° MICROCURRENT",steps:["1. CLEANSE: Oil-free","2. GEL: Thick layer","3. FOREHEAD: Upward 3min","4. CHEEKS: Nose to ear 4min each","5. JAWLINE: Jaw to ear 3min","6. NECK: Upward only 2min","7. SLOW movements"]},
microneedling:{title:"üìç MICRONEEDLING",steps:["1. SANITIZE device","2. CLEANSE 2x","3. SERUM: Apply HA","4. NEEDLE: Cross-hatch","5. WAIT 10min","6. NO actives 24hrs","7. SPF mandatory next day"]},
massage:{title:"üíÜ MASSAGE",steps:["1. OIL: Apply facial oil","2. JAW: Chin to ear","3. CHEEKS: Lift to temples","4. EYES: Gentle circles","5. FOREHEAD: Horizontal","6. DRAIN: Down to collarbone"]},
cupping:{title:"üîµ CUPPING",steps:["1. OIL back","2. STATIC 3-5min on knots","3. SLIDING along spine","4. AVOID direct spine","5. MARKS = stagnation","6. HEAT: Hyperice 15min after"]},
normatec:{title:"ü¶µ NORMATEC",steps:["1. SETUP Legs/Hips","2. LEVEL 7 flush","3. TIME 30-45min","4. ZONE boost if sore","5. HYDRATE 16oz after","6. Can do 2x daily"]},
inshape:{title:"üèä INSHAPE",steps:["1. STEAM 15min","2. SAUNA 20min","3. POOL 20min light","4. AQUA BED 30min","5. SHOWER cold finish","6. NORMATEC 45min home"]},
clubstudio:{title:"üè¢ CLUB STUDIO",steps:["OPTION A: Full Recovery (45min)","1. CRYO Chamber 3min (full body cold)","2. WAIT 5min (let body warm)","3. SAUNA 20min (contrast therapy)","4. LOCAL CRYO areas as needed","5. MASSAGE BED 20min","6. HYPERICE suite if available","","OPTION B: Quick Session (20min)","1. CRYO 3min OR Sauna 20min","2. MASSAGE BED 15min","","OPTION C: Home Instead","Use Theragun + Normatec + Hyperice"]}
};

class CenturionApp{
constructor(){
console.log('üöÄ v19.4 - 61 MEALS');
const V='19.4.0';
if(localStorage.getItem('centurion_version')!==V){localStorage.clear();localStorage.setItem('centurion_version',V)}
this.user=localStorage.getItem('centurion_user')||'jermaine';
this.history=[];this.currentIndex=0;this.currentDateStr=new Date().toLocaleDateString('en-CA');
this.checked={};this.meals={};this.bios={};this.protocol=[];
// Initialize UI button states
document.querySelectorAll('.user-switch button').forEach(b=>b.classList.remove('active'));
document.getElementById(`btn-${this.user}`)?.classList.add('active');
this.loadUserData();this.setPlaceholderData();this.render();this.fetchOuraData();}

loadUserData(){
try{
const c=localStorage.getItem(`c_checked_${this.user}`);this.checked=c?JSON.parse(c):{};
const m=localStorage.getItem(`c_meals_${this.user}`);this.meals=m?JSON.parse(m):{};
const b=localStorage.getItem(`c_bios_${this.user}`);this.bios=b?JSON.parse(b):USERS[this.user].defaultBios;
}catch(e){this.checked={};this.meals={}}}

saveUserData(){
localStorage.setItem(`c_checked_${this.user}`,JSON.stringify(this.checked));
localStorage.setItem(`c_meals_${this.user}`,JSON.stringify(this.meals));
localStorage.setItem(`c_bios_${this.user}`,JSON.stringify(this.bios))}

setPlaceholderData(){this.history=[{date:this.currentDateStr,score:0,totalSec:0,deepSec:0,remSec:0,rhr:'-',cal:0,high:0,med:0,workouts:[]}];this.currentIndex=0}

getLunchRecovery(d){
if(this.user==='jermaine'&&(d===1||d===3||d===5))return{title:'üßò Hip Flexor',desc:'5min stretch'};
if(this.user==='jermaine'&&(d===2||d===4))return{title:'ü¶æ Shoulder',desc:'5min mobility'};
return null}

// Workout Impact Database - Club Studio classes ranked by impact and intensity
getWorkoutImpact(workoutType){
const type=workoutType.toLowerCase();
const database={
// VERY HIGH INTENSITY + HIGH IMPACT - Full recovery essential
'cs4':{impact:'high',zones:['full-body','cardio','joints'],intensity:10,recovery:'cryo+sauna+massage',duration:45,description:'HIIT circuit: treadmills, rowers, functional strength'},
'box':{impact:'high',zones:['upper-body','shoulders','cardio','footwork'],intensity:9,recovery:'cryo+sauna',duration:50,description:'9 rounds boxing + athletic drills'},
'boxing':{impact:'high',zones:['upper-body','shoulders','cardio','footwork'],intensity:9,recovery:'cryo+sauna',duration:50,description:'9 rounds boxing + athletic drills'},
'h.e.a.t.':{impact:'high',zones:['full-body','explosive-power','agility'],intensity:9,recovery:'cryo+massage',duration:50,description:'High Energy Athletic Training - sports drills'},
'heat':{impact:'high',zones:['full-body','explosive-power','agility'],intensity:9,recovery:'cryo+massage',duration:50,description:'High Energy Athletic Training - sports drills'},
'club dance':{impact:'high',zones:['cardio','legs','coordination'],intensity:9,recovery:'ice+normatec',duration:50,description:'Choreographed dance cardio with jumps'},
'dance':{impact:'high',zones:['cardio','legs','coordination'],intensity:9,recovery:'ice+normatec',duration:50,description:'Choreographed dance cardro with jumps'},

// HIGH INTENSITY + LOW IMPACT - Cardiovascular recovery focus
'ride':{impact:'low',zones:['legs','cardio','hip-flexors'],intensity:8,recovery:'normatec+stretch',duration:45,description:'Rhythm-based cycling - zero joint impact'},
'rebound':{impact:'low',zones:['legs','core','cardio','lymphatic'],intensity:8,recovery:'normatec+hydration',duration:45,description:'Trampoline cardio - joint-protective'},
'yoga sculpt':{impact:'low',zones:['full-body','strength','heat-stress'],intensity:8,recovery:'sauna+stretch+hydration',duration:60,description:'Heated yoga + weights + cardio'},
'cs strength':{impact:'low',zones:['muscular-strength','joints'],intensity:8,recovery:'massage+ice',duration:50,description:'Heavy lifting - dumbbells and benches'},
'strength':{impact:'low',zones:['muscular-strength','joints'],intensity:8,recovery:'massage+ice',duration:50,description:'Heavy lifting - dumbbells and benches'},

// MODERATE INTENSITY + LOW IMPACT - Active recovery appropriate
'reform':{impact:'low',zones:['core','glutes','stabilizers'],intensity:6,recovery:'stretch+optional',duration:50,description:'Reformer Pilates - time under tension'},
'hot pilates':{impact:'low',zones:['core','full-body','heat-stress'],intensity:7,recovery:'hydration+stretch',duration:50,description:'Mat Pilates in 95¬∞F heat'},
'pilates':{impact:'low',zones:['core','full-body'],intensity:5,recovery:'stretch+optional',duration:50,description:'Mat Pilates'},
'barre':{impact:'low',zones:['glutes','legs','isometric'],intensity:6,recovery:'stretch+normatec',duration:50,description:'Ballet-inspired isometric holds'},
'yoga flow':{impact:'low',zones:['flexibility','core','balance'],intensity:6,recovery:'optional',duration:60,description:'Vinyasa flow'},
'flow':{impact:'low',zones:['flexibility','core','balance'],intensity:6,recovery:'optional',duration:60,description:'Vinyasa flow'},

// LOW INTENSITY - Recovery focused
'yoga restore':{impact:'none',zones:['mobility','connective-tissue'],intensity:3,recovery:'none',duration:60,description:'Yin/restorative - 3-5min holds'},
'restore':{impact:'none',zones:['mobility','connective-tissue'],intensity:3,recovery:'none',duration:60,description:'Yin/restorative - 3-5min holds'},
'cryo':{impact:'none',zones:['cellular-repair','inflammation'],intensity:1,recovery:'none',duration:15,description:'Cryotherapy session'},
'recovery':{impact:'none',zones:['cellular-repair'],intensity:1,recovery:'none',duration:30,description:'Compression boots'},

// GENERIC FALLBACKS (for non-Club Studio workouts)
'hiit':{impact:'high',zones:['full-body','cardio'],intensity:9,recovery:'cryo+sauna'},
'running':{impact:'medium',zones:['legs','joints','cardio'],intensity:7,recovery:'normatec+ice'},
'cycling':{impact:'low',zones:['legs','hip-flexors'],intensity:7,recovery:'normatec'},
'walking':{impact:'low',zones:['cardio'],intensity:3,recovery:'optional'},
'other':{impact:'medium',zones:['unknown'],intensity:5,recovery:'massage'}
};
return database[type]||database['other'];
}

// Intelligent recovery recommendation based on workout data
getSmartRecovery(day){
const workouts=day.workouts||[];
if(workouts.length===0)return null;

// Analyze all workouts for the day
let maxImpact=0;
let totalIntensity=0;
let affectedZones=new Set();
let workoutNames=[];

workouts.forEach(w=>{
const impact=this.getWorkoutImpact(w.type);
maxImpact=Math.max(maxImpact,impact.intensity);
totalIntensity+=impact.intensity;
impact.zones.forEach(z=>affectedZones.add(z));
workoutNames.push(w.type.toUpperCase());
});

// Determine recovery protocol based on Club Studio intensity rankings
let protocol={time:'6:30 PM',title:'',desc:'',type:'clubstudio'};

if(maxImpact>=9){
// VERY HIGH (CS4, Box, H.E.A.T., Club Dance)
protocol.title='üî• FULL RECOVERY PROTOCOL';
protocol.desc=`Post-${workoutNames[0]} | Club Studio: Cryo 3min ‚Üí Sauna 20min ‚Üí Massage Bed | Home: Ice bath ‚Üí Theragun ‚Üí Normatec 45min`;
}else if(maxImpact>=8){
// HIGH (Ride, Rebound, Yoga Sculpt, CS Strength)
protocol.title='üí™ ACTIVE RECOVERY';
protocol.desc=`Post-${workoutNames[0]} | Club Studio: Sauna 15min ‚Üí Local Cryo ‚Üí Massage | Home: Normatec 30min ‚Üí Hyperice`;
}else if(maxImpact>=6){
// MODERATE (Reform, Hot Pilates, Barre)
protocol.title='‚ú® MAINTENANCE RECOVERY';
protocol.desc=`Post-${workoutNames[0]} | Club Studio: Massage Bed 20min | Home: Normatec 20min + Stretch`;
}else if(maxImpact>=4){
// LIGHT (Yoga Flow)
protocol.title='üåô LIGHT RECOVERY';
protocol.desc='Optional stretch or Club Studio massage bed';
}else{
// MINIMAL (Restore, Cryo) - No additional recovery needed
return null;
}

return protocol;
}

getEveningRecovery(d,w,t){
if(this.user==='jermaine'){
if(d===0)return{time:'2:00 PM',title:'üèä InShape',desc:'Full ritual',type:'inshape'};
if((d===2||d===4)&&w)return{time:'7:30 PM',title:'ü•ä Post-Boxing',desc:'Club Studio: Cryo 3min + Sauna 20min OR Home: Theragun + Normatec',type:'clubstudio'};
if(d===2||d===4)return{time:'6:30 PM',title:'üîµ Cupping',desc:'Both 15min each + Hyperice after',type:'cupping'};
if(d===1&&w)return{time:'7:00 PM',title:'üí™ Post-Lift',desc:'Club Studio: Cryo + Sauna OR Home: Full stack',type:'clubstudio'};
if(d===3)return{time:'6:30 PM',title:'üßò Mid-Week Recovery',desc:'Club Studio: Sauna 20min + Local Cryo + Massage Bed OR Home: Normatec + Hyperice',type:'clubstudio'};
return{time:'6:30 PM',title:'‚ú® Light Recovery',desc:'Club Studio: Massage bed 20min OR Home: Normatec 30min',type:'clubstudio'}}
if(this.user==='sophia'){
if(d===0)return{time:'2:00 PM',title:'üèä InShape',desc:'Together',type:'inshape'};
if((d===3||d===5)&&w)return{time:'7:00 PM',title:'üèÉ Post-Rebound',desc:'Club Studio: Cryo + Sauna OR Home: Theragun + Normatec',type:'clubstudio'};
if(d===2||d===4)return{time:'6:30 PM',title:'üîµ Cupping',desc:'Both 15min + Hyperice',type:'cupping'};
if(d===1)return{time:'6:30 PM',title:'üí™ Recovery Day',desc:'Club Studio: Massage bed + Sauna OR Home: Normatec',type:'clubstudio'};
return{time:'6:30 PM',title:'‚ú® Light Recovery',desc:'Club Studio or Home - Optional',type:'clubstudio'}}
return null}

getEndOfDayFacial(d,f){
if(this.user==='jermaine'){
if(d===0&&f)return{title:'üìç Sophia Needle',desc:'45min - SPF 24hrs',type:'microneedling'};
if(d===1||d===3||d===5||d===0)return{title:'‚ö° Sophia Micro',desc:'Lift + Tone',type:'microcurrent'};
if(d===2||d===4)return{title:'üíÜ Sophia Massage',desc:'Hand + Wands',type:'massage'};
return{title:'‚ú® Sophia Maint',desc:'Optional',type:'massage'}}
if(this.user==='sophia'){
if(d===1||d===3||d===5||d===0)return{title:'‚ö° Jermaine Micro',desc:'Jawline focus',type:'microcurrent'};
if(d===2||d===4)return{title:'üí™ Jermaine Recovery',desc:'Cold + Jaw massage',type:'massage'};
return{title:'‚ú® Jermaine Maint',desc:'Optional',type:'massage'}}
return null}

showProtocolDetails(t){
const d=PROTOCOLS[t]||{title:"ROUTINE",steps:["Follow standard."]};
let h=`<div style="text-align:center;margin:30px 0"><div style="font-size:1.8rem;font-weight:900;color:#fff;text-shadow:0 0 10px var(--cyan)">${d.title}</div></div><div style="background:#111;border-radius:12px;border:1px solid #333;overflow:hidden">${d.steps.map(s=>`<div style="padding:18px 20px;border-bottom:1px solid #222;font-size:0.95rem;color:#ddd;line-height:1.6">${s}</div>`).join('')}</div>`;
this.setText('modalTitle','PROTOCOL');
document.getElementById('modalBody').innerHTML=h;
document.getElementById('mainModal').classList.add('show')}

async fetchOuraData(){
this.setText('syncStatus','SYNCING...');
try{
const end=new Date();end.setDate(end.getDate()+1);
const start=new Date();start.setDate(start.getDate()-10);
const startStr=start.toISOString().split('T')[0];
const endStr=end.toISOString().split('T')[0];
const token=TOKENS[this.user];
const proxyUrl='https://oura-proxy.jclarke-9a0.workers.dev';
const sleepUrl=`${proxyUrl}?url=${encodeURIComponent(`https://api.ouraring.com/v2/usercollection/sleep?start_date=${startStr}&end_date=${endStr}`)}`;
log(`üîó Sleep URL: ${sleepUrl.substring(0,120)}...`);
const workoutUrl=`${proxyUrl}?url=${encodeURIComponent(`https://api.ouraring.com/v2/usercollection/workout?start_date=${startStr}&end_date=${endStr}`)}`;
const activityUrl=`${proxyUrl}?url=${encodeURIComponent(`https://api.ouraring.com/v2/usercollection/daily_activity?start_date=${startStr}&end_date=${endStr}`)}`;
const readinessUrl=`${proxyUrl}?url=${encodeURIComponent(`https://api.ouraring.com/v2/usercollection/daily_readiness?start_date=${startStr}&end_date=${endStr}`)}`;

// Fetch main data
const[sleepRes,workoutRes,activityRes,readinessRes]=await Promise.all([
fetch(sleepUrl,{headers:{'Authorization':`Bearer ${token}`}}),
fetch(workoutUrl,{headers:{'Authorization':`Bearer ${token}`}}),
fetch(activityUrl,{headers:{'Authorization':`Bearer ${token}`}}),
fetch(readinessUrl,{headers:{'Authorization':`Bearer ${token}`}})]);

if(!sleepRes.ok||!workoutRes.ok)throw new Error('API failed');
const sleepData=await sleepRes.json();
const workoutData=await workoutRes.json();
const activityData=await activityRes.json();
const readinessData=await readinessRes.json();

// Try to fetch cardio age separately (might not be available)
let cardioAgeData={data:[]};
try{
const cardioAgeUrl=`${proxyUrl}?url=${encodeURIComponent(`https://api.ouraring.com/v2/usercollection/daily_cardiovascular_age?start_date=${startStr}&end_date=${endStr}`)}`;
const cardioAgeRes=await fetch(cardioAgeUrl,{headers:{'Authorization':`Bearer ${token}`}});
if(cardioAgeRes.ok){
cardioAgeData=await cardioAgeRes.json();
log(`‚úÖ Cardio Age endpoint accessible: ${cardioAgeData.data?.length || 0} records`);
}else{
log(`‚ö†Ô∏è Cardio Age endpoint returned ${cardioAgeRes.status}: ${cardioAgeRes.statusText}`);
}
}catch(e){
log(`‚ö†Ô∏è Cardio Age fetch failed: ${e.message}`);
}

log('üîç OURA DATA RECEIVED:');
log('Sleep records: '+(sleepData.data?.length || 0));
log('Workout records: '+(workoutData.data?.length || 0));
log('Activity records: '+(activityData.data?.length || 0));
if(activityData.data&&activityData.data.length>0){
log('Sample activity (checking for VO2 max): '+JSON.stringify(activityData.data[0]));
}
log('Readiness records: '+(readinessData.data?.length || 0));
if(cardioAgeData.data&&cardioAgeData.data.length>0){
log('Sample cardio age data: '+JSON.stringify(cardioAgeData.data[0]));
}
if(sleepData.data?.length > 0) log('Sample sleep: '+JSON.stringify(sleepData.data[0]));
this.processData(sleepData.data||[],workoutData.data||[],activityData.data||[],readinessData.data||[],cardioAgeData.data||[]);
this.setText('syncStatus','SYNCED ‚úì');
this.render()}
catch(error){
logerr('‚ùå Sync failed: '+error);
this.setText('syncStatus','OFFLINE');
this.render()}}

processData(sleepData,workoutData,activityData,readinessData,cardioAgeData){
log('üìä PROCESSING DATA:');
log('Sleep entries to process: '+sleepData.length);
log('Workout entries to process: '+workoutData.length);
const m=new Map();
const g=(d)=>{if(!m.has(d))m.set(d,{date:d,score:0,totalSec:0,deepSec:0,remSec:0,rhr:'-',cal:0,high:0,med:0,workouts:[]});return m.get(d)};
sleepData.forEach(s=>{
const d=g(s.day);
d.totalSec+=s.total_sleep_duration||0;
d.deepSec+=s.deep_sleep_duration||0;
d.remSec+=s.rem_sleep_duration||0;
// Get actual RHR from sleep data (this is the real BPM value)
if(s.lowest_heart_rate&&s.lowest_heart_rate>=35&&s.lowest_heart_rate<=100){
d.rhr=Math.round(s.lowest_heart_rate);
log(`‚úÖ RHR for ${s.day}: ${d.rhr} BPM (from sleep data)`);
}
// Calculate sleep score from efficiency if not provided
const sleepScore = s.score || (s.efficiency ? Math.round(s.efficiency) : 0);
if(sleepScore && sleepScore>d.score)d.score=sleepScore;
log(`Sleep ${s.day}: ${(s.total_sleep_duration/3600).toFixed(1)}h - Score: ${sleepScore} (from ${s.score ? 'API' : 'efficiency '+s.efficiency})`);
});
readinessData.forEach(r=>{
const d=g(r.day);
// Readiness contributors are scores (0-100), not actual BPM - ignore them
});
cardioAgeData.forEach(c=>{
const d=g(c.day);
if(c.vascular_age){
d.vascularAge=c.vascular_age;
}
});
let workoutLogCount=0;
workoutData.forEach(w=>{
const d=g(w.day);
const dt=new Date(w.start_datetime);
const t=dt.toLocaleTimeString('en-US',{hour:'numeric',minute:'2-digit',hour12:true});
// Debug: log first 3 workout objects to see structure
if(workoutLogCount<3){
log(`üîç Workout Object #${workoutLogCount+1} (${w.day}):`,JSON.stringify(w,null,2));
workoutLogCount++;
}
// Try to get the most specific workout type: label > activity > 'other'
const workoutType=w.label||w.activity||'other';
d.workouts.push({type:workoutType,intensity:w.intensity||'moderate',calories:w.calories||300,time:t,start:w.start_datetime});
log(`üí™ Workout on ${w.day}: ${workoutType} at ${t} (label=${w.label}, activity=${w.activity})`);
});
activityData.forEach(a=>{const d=g(a.day);d.cal=a.active_calories||0;d.high=(a.high_activity_time||0)/60;d.med=(a.medium_activity_time||0)/60});
this.history=Array.from(m.values()).sort((a,b)=>b.date.localeCompare(a.date));
log('‚úÖ Processed history: '+this.history.length+' days');
this.currentIndex=this.history.findIndex(h=>h.date===this.currentDateStr);
if(this.currentIndex===-1){this.history.unshift({date:this.currentDateStr,score:0,totalSec:0,deepSec:0,remSec:0,rhr:'-',cal:0,high:0,med:0,workouts:[]});this.currentIndex=0}}

changeDate(dir){
const n=this.currentIndex-dir;
if(n>=0&&n<this.history.length){this.currentIndex=n;this.currentDateStr=this.history[n].date;this.render()}}

switchUser(u){
try{
log(`üîÑ Switch user called: ${u} (current: ${this.user})`);
if(u===this.user){log('‚ö†Ô∏è Already on this user, skipping');return;}
this.setText('statusMsg','SWITCHING...');
document.querySelectorAll('.user-switch button').forEach(b=>b.classList.remove('active'));
document.getElementById(`btn-${u}`).classList.add('active');
this.user=u;localStorage.setItem('centurion_user',u);
log(`‚úÖ User switched to: ${u}`);
this.history=[];
this.loadUserData();
this.setPlaceholderData();
this.render();
this.fetchOuraData();
}catch(e){logerr(`‚ùå Switch user error: ${e.message}`)}}

toggleTask(id){
const dk=this.history[this.currentIndex].date;
if(!this.checked[dk])this.checked[dk]=[];
const i=this.checked[dk].indexOf(id);
if(i===-1)this.checked[dk].push(id);else this.checked[dk].splice(i,1);
this.saveUserData();this.render()}

openBio(){
const mb=document.getElementById('modalBody');
this.setText('modalTitle','BIOMETRICS');
const w=this.bios.weight||'--';const bmr=this.bios.bmr||'--';
const h=USERS[this.user].goals.heightInches||70;
const bmi=w&&h&&w!=='--'?((w/(h*h))*703).toFixed(1):'--';
mb.innerHTML=`<div style="padding:20px"><div style="background:#111;padding:15px;border-radius:10px;margin-bottom:20px;border:1px solid #333"><div style="color:#888;font-size:0.7rem;margin-bottom:5px">CURRENT STATUS</div><div style="font-size:2rem;font-weight:900">${w} lbs</div><div style="color:var(--acid);font-size:0.8rem">BMI: ${bmi} | BMR: ${bmr}</div></div><div style="display:grid;grid-template-columns:1fr 1fr;gap:15px"><div style="background:#111;padding:15px;border-radius:10px;border:1px solid #333"><div style="font-size:0.6rem;color:#666;margin-bottom:8px;font-weight:900">WEIGHT (LBS)</div><input id="bio-weight" type="number" value="${this.bios.weight||''}" style="width:100%;padding:10px;background:#0a0a0a;border:1px solid #444;color:#fff;border-radius:6px;font-size:1rem;font-family:monospace"></div><div style="background:#111;padding:15px;border-radius:10px;border:1px solid #333"><div style="font-size:0.6rem;color:#666;margin-bottom:8px;font-weight:900">BMR</div><input id="bio-bmr" type="number" value="${this.bios.bmr||''}" style="width:100%;padding:10px;background:#0a0a0a;border:1px solid #444;color:#fff;border-radius:6px;font-size:1rem;font-family:monospace"></div><div style="background:#111;padding:15px;border-radius:10px;border:1px solid#333"><div style="font-size:0.6rem;color:#666;margin-bottom:8px;font-weight:900">APOB (mg/dL)</div><input id="bio-apob" type="number" value="${this.bios.apob||''}" style="width:100%;padding:10px;background:#0a0a0a;border:1px solid #444;color:#fff;border-radius:6px;font-size:1rem;font-family:monospace"></div><div style="background:#111;padding:15px;border-radius:10px;border:1px solid #333"><div style="font-size:0.6rem;color:#666;margin-bottom:8px;font-weight:900">LP(A) (mg/dL)</div><input id="bio-lpa" type="number" value="${this.bios.lpa||''}" style="width:100%;padding:10px;background:#0a0a0a;border:1px solid #444;color:#fff;border-radius:6px;font-size:1rem;font-family:monospace"></div><div style="background:#111;padding:15px;border-radius:10px;border:1px solid #333"><div style="font-size:0.6rem;color:#666;margin-bottom:8px;font-weight:900">hsCRP (mg/L)</div><input id="bio-hscrp" type="number" step="0.1" value="${this.bios.hscrp||''}" style="width:100%;padding:10px;background:#0a0a0a;border:1px solid #444;color:#fff;border-radius:6px;font-size:1rem;font-family:monospace"></div><div style="background:#111;padding:15px;border-radius:10px;border:1px solid #333"><div style="font-size:0.6rem;color:#666;margin-bottom:8px;font-weight:900">HbA1c (%)</div><input id="bio-hba1c" type="number" step="0.1" value="${this.bios.hba1c||''}" style="width:100%;padding:10px;background:#0a0a0a;border:1px solid #444;color:#fff;border-radius:6px;font-size:1rem;font-family:monospace"></div><div style="background:#111;padding:15px;border-radius:10px;border:1px solid #333"><div style="font-size:0.6rem;color:#666;margin-bottom:8px;font-weight:900">BODY FAT (%)</div><input id="bio-bodyfat" type="number" step="0.1" value="${this.bios.bodyfat||''}" style="width:100%;padding:10px;background:#0a0a0a;border:1px solid #444;color:#fff;border-radius:6px;font-size:1rem;font-family:monospace"></div><div style="background:#111;padding:15px;border-radius:10px;border:1px solid #333"><div style="font-size:0.6rem;color:#666;margin-bottom:8px;font-weight:900">MUSCLE (LBS)</div><input id="bio-muscle" type="number" step="0.1" value="${this.bios.muscle||''}" style="width:100%;padding:10px;background:#0a0a0a;border:1px solid #444;color:#fff;border-radius:6px;font-size:1rem;font-family:monospace"></div></div><button onclick="app.saveBio()" style="width:100%;background:var(--acid);color:#000;padding:15px;margin-top:20px;border:none;border-radius:10px;font-weight:900">SAVE BIOMETRICS</button></div>`;
document.getElementById('mainModal').classList.add('show')}

saveBio(){
['weight','bmr','apob','lpa','hscrp','hba1c','bodyfat','muscle'].forEach(f=>{const el=document.getElementById(`bio-${f}`);if(el&&el.value)this.bios[f]=el.value});
this.saveUserData();this.closeModal();this.render()}

openMealPicker(slot){
const mb=document.getElementById('modalBody');
this.setText('modalTitle',slot.toUpperCase());
const all=MEALS[slot]||[];
const currentSel=this.meals[this.history[this.currentIndex].date]?.[slot];
let h='';
all.forEach((m,i)=>{
const isSelected=currentSel===i;
const selectedClass=isSelected?'style="background:#1a1a1a;border-color:var(--acid)"':'';
const checkmark=isSelected?'<span style="color:var(--acid);margin-right:8px;font-weight:900">‚úì</span>':'';
h+=`<div class="menu-item" ${selectedClass} onclick="app.showRecipe('${slot}',${i})"><div class="menu-left"><div class="menu-name">${checkmark}${m.title}</div><div class="menu-meta">P:${m.macros.p}g ‚Ä¢ Œ©3:${m.macros.o}mg ‚Ä¢ F:${m.macros.f}g ‚Ä¢ Cal:${m.macros.cal}</div></div><div class="menu-arrow">‚Ä∫</div></div>`;
});
mb.innerHTML=h;
document.getElementById('mainModal').classList.add('show')}

showRecipe(slot,idx){
const meal=MEALS[slot][idx];
const mb=document.getElementById('modalBody');
this.setText('modalTitle',meal.title.toUpperCase());
let html=`<div class="recipe-hero"><div class="recipe-title">${meal.title}</div><div class="recipe-stats">${meal.time||'Quick'} ‚Ä¢ ${meal.servings||1} serving</div></div>`;
html+=`<div class="macro-grid"><div class="macro-stat"><div class="m-val">${meal.macros.p}g</div><div class="m-lbl">PROTEIN</div></div><div class="macro-stat"><div class="m-val">${meal.macros.o}mg</div><div class="m-lbl">OMEGA-3</div></div><div class="macro-stat"><div class="m-val">${meal.macros.f}g</div><div class="m-lbl">FIBER</div></div><div class="macro-stat"><div class="m-val">${meal.macros.cal}</div><div class="m-lbl">CALORIES</div></div></div>`;
html+=`<div class="synergy-box"><div class="syn-title">üß¨ BIO HACK</div><div class="syn-text">${meal.why}</div></div>`;
html+=`<div style="margin-bottom:20px"><div style="font-size:0.8rem;font-weight:900;color:var(--acid);margin-bottom:10px;text-transform:uppercase">INGREDIENTS</div>`;
meal.ingredients.forEach(ing=>{html+=`<div class="ing-item">${ing}</div>`});
html+=`</div><div><div style="font-size:0.8rem;font-weight:900;color:var(--acid);margin-bottom:10px;text-transform:uppercase">PREPARATION</div>`;
meal.steps.forEach((step,i)=>{html+=`<div class="step-item"><div style="font-weight:900;color:var(--cyan);font-size:1.2rem;min-width:30px">${i+1}</div><div>${step}</div></div>`});
html+=`</div><button onclick="app.selectMeal('${slot}',${idx});app.closeModal()" style="width:100%;background:var(--acid);color:#000;padding:18px;margin-top:25px;border:none;border-radius:12px;font-weight:900;font-size:1.1rem;cursor:pointer;text-transform:uppercase;box-shadow:0 0 20px rgba(204,255,0,0.3);letter-spacing:1px">ADD TO PROTOCOL</button>`;
mb.innerHTML=html}

closeModal(){document.getElementById('mainModal').classList.remove('show')}

selectMeal(slot,idx){
const d=this.history[this.currentIndex].date;
if(!this.meals[d])this.meals[d]={};
this.meals[d][slot]=idx;
this.saveUserData();this.closeModal();this.render()}

getDailyRecommendation(mac,day,avgScore){
const apob=parseFloat(this.bios.apob||0);
const lpa=parseFloat(this.bios.lpa||0);
const hscrp=parseFloat(this.bios.hscrp||0);
const goals=USERS[this.user].goals;

// Analyze workout type to determine optimal zone targets for the day
const workouts=day.workouts||[];
let optimalZ2=goals.z2; // Default targets
let optimalZ5=goals.z5;
let zoneContext='';

if(workouts.length>0){
const primaryWorkout=workouts[0]; // Use first/main workout
const impact=this.getWorkoutImpact(primaryWorkout.type);

if(impact.intensity>=9){
// TIER 1: CS4, Box, H.E.A.T., Club Dance - already hits both zones
optimalZ2=Math.max(0,goals.z2-(day.med||0)); // Only additional Z2 needed
optimalZ5=0; // Z5 already hit in workout
zoneContext=`${primaryWorkout.type.toUpperCase()} hit Z5 target`;
}else if(impact.intensity===8){
// TIER 2: Ride, Rebound, Yoga Sculpt, CS Strength - high cardio but may need Z5 boost
if(primaryWorkout.type.toLowerCase()==='ride'||primaryWorkout.type.toLowerCase()==='rebound'){
optimalZ2=0; // Ride/Rebound crush Z2
optimalZ5=Math.max(0,Math.round(goals.z5*0.5-(day.high||0))); // May need 10min Z5 finisher
zoneContext='High cardio class - minimal Z5 finisher if energy allows';
}else{
optimalZ2=Math.max(0,Math.round(goals.z2*0.5-(day.med||0))); // Light Z2 walk
optimalZ5=0; // Skip Z5 on strength days
zoneContext='Strength day - light Z2 walk for recovery';
}
}else if(impact.intensity>=6){
// TIER 3: Reform, Barre, Hot Pilates - ACTIVE RECOVERY
optimalZ2=Math.max(0,Math.round(goals.z2*0.67-(day.med||0))); // 30min Z2 walk
optimalZ5=0; // NO Z5 on recovery days
zoneContext='Recovery day - Z2 walk only, skip Z5';
}else if(impact.intensity>=3){
// TIER 4: Yoga Flow, Light activity
optimalZ2=Math.max(0,Math.round(goals.z2*0.67-(day.med||0))); // 30min Z2
optimalZ5=Math.max(0,Math.round(goals.z5*0.5-(day.high||0))); // Optional 10min Z5
zoneContext='Light day - optional Z5 if feeling strong';
}else{
// TIER 5: Rest day (Restore, Cryo, or no workout)
optimalZ2=Math.max(0,Math.round(goals.z2*0.44-(day.med||0))); // 20min recovery walk
optimalZ5=0; // NO Z5 on rest days
zoneContext='Rest day - light Z2 walk only';
}
}

// Priority 1: Critical biomarker issues
if(lpa>150&&mac.omega3<3000)return'LP(A) ELEVATED ‚Üí WALNUTS + FLAX ESSENTIAL';
if(apob>100&&mac.fiber<30)return'APOB HIGH ‚Üí FIBER TARGET: +20G TODAY';
if(hscrp>1.0)return'INFLAMMATION DETECTED ‚Üí TURMERIC STACK';

// Priority 2: Daily macro gaps
const proteinGap=goals.protein-mac.protein;
const omega3Gap=goals.omega3-mac.omega3;
const fiberGap=goals.fiber-mac.fiber;

if(proteinGap>50)return`PROTEIN GAP: +${Math.round(proteinGap)}G NEEDED`;
if(omega3Gap>2000)return`OMEGA-3 LOW ‚Üí +${Math.round(omega3Gap/1000)}G FISH/FLAX`;
if(fiberGap>20)return`FIBER DEFICIT: +${Math.round(fiberGap)}G BEANS/OATS`;

// Priority 3: Smart zone targets (adjusted for workout type)
if(optimalZ2>20)return`ZONE 2: +${Math.round(optimalZ2)}MIN WALK NEEDED | ${zoneContext}`;
if(optimalZ5>10)return`ZONE 5: +${Math.round(optimalZ5)}MIN HIIT PENDING | ${zoneContext}`;
if(zoneContext&&optimalZ2<=20&&optimalZ5<=10)return`ZONE TARGETS MET | ${zoneContext}`;

// Priority 4: Sleep quality
const sleepHours=(day.totalSec||0)/3600;
if(sleepHours<7)return`SLEEP DEBT: ${sleepHours.toFixed(1)}H ‚Üí TARGET 8H TONIGHT`;

// Priority 5: Longevity score feedback
if(avgScore>=90)return`OPTIMAL PROTOCOL ‚Üí LONGEVITY SCORE: ${avgScore}`;
if(avgScore>=75)return`SOLID WEEK ‚Üí SCORE ${avgScore} ‚Üí FINE TUNE`;
if(avgScore<60)return`FOCUS MODE ‚Üí SCORE ${avgScore} ‚Üí SLEEP + MOVEMENT`;

// Default: On track
return'ALL SYSTEMS OPTIMAL ‚Üí PROTOCOL LOCKED';
}

calculateMacros(){
const d=this.history[this.currentIndex].date;
const c=this.checked[d]||[];
let t={protein:0,omega3:0,fiber:0,calories:0};
this.protocol.forEach(tk=>{if(c.includes(tk.id)){t.protein+=tk.macros.p||0;t.omega3+=tk.macros.o||0;t.fiber+=tk.macros.f||0;t.calories+=tk.macros.cal||0}});
return t}

calculateRainbow(){
const d=this.history[this.currentIndex].date;
const c=this.checked[d]||[];
let s=new Set();
this.protocol.forEach(t=>{if(c.includes(t.id)&&t.colors)t.colors.forEach(col=>s.add(col))});
return s}

render(){
if(!this.history.length)return;
this.protocol=JSON.parse(JSON.stringify(BASE));
const day=this.history[this.currentIndex];
const date=day.date;
let sel=this.meals[date]||{};
const dow=new Date(date).getDay();
const isFS=new Date(date).getDate()<=7;
const hadW=day.workouts&&day.workouts.length>0;
const wType=hadW?day.workouts[0].type:null;

// AUTO-RECOMMEND meals if not yet selected
const goals=USERS[this.user].goals;
['breakfast','lunch','dinner'].forEach(slot=>{
if(sel[slot]===undefined){
const mealList=MEALS[slot]||[];
if(mealList.length>0){
// Calculate current macro totals before this meal
const currentMacros=this.calculateMacros();
const proteinNeeded=goals.protein-currentMacros.protein;
const omega3Needed=goals.omega3-currentMacros.omega3;
// Score each meal
let bestIdx=0;
let bestScore=0;
mealList.forEach((meal,idx)=>{
let score=0;
if(proteinNeeded>40&&meal.macros.p>50)score+=3;
if(omega3Needed>2000&&meal.macros.o>2000)score+=2;
if(score>bestScore){bestScore=score;bestIdx=idx}
});
sel[slot]=bestIdx;
log(`üéØ Auto-recommended ${slot}: ${mealList[bestIdx].title} (P:${mealList[bestIdx].macros.p}g)`);
}
}
});
this.meals[date]=sel;
this.saveUserData();

const lr=this.getLunchRecovery(dow);
if(lr)this.protocol.push({id:'lunch_recovery',time:'11:30 AM',title:lr.title,desc:lr.desc,macros:{p:0,o:0,f:0,cal:0},colors:[],clickable:false});

day.workouts.forEach((w,i)=>{this.protocol.push({id:`workout_${i}`,time:w.time,title:`${w.type.toUpperCase()} Detected`,desc:`${w.calories} cal | ${w.intensity}`,macros:{p:0,o:0,f:0,cal:0},colors:[],clickable:false,autoDetected:true})});

// Smart AI-powered recovery recommendation based on workout data
const smartRec=this.getSmartRecovery(day);
if(smartRec){
this.protocol.push({id:'smart_recovery',time:smartRec.time,title:smartRec.title,desc:smartRec.desc+' - Tap for protocol',macros:{p:0,o:0,f:0,cal:0},colors:[],clickable:true,type:smartRec.type,cssClass:'recovery'});
}else{
// Fallback to day-of-week recovery if no workout data
const er=this.getEveningRecovery(dow,hadW,wType);
if(er)this.protocol.push({id:'evening_recovery',time:er.time,title:er.title,desc:er.desc+' - Tap for protocol',macros:{p:0,o:0,f:0,cal:0},colors:[],clickable:true,type:er.type,cssClass:'recovery'});
}

const fac=this.getEndOfDayFacial(dow,isFS);
if(fac)this.protocol.push({id:'facial',time:'9:00 PM',title:fac.title,desc:fac.desc+' - Tap for protocol',macros:{p:0,o:0,f:0,cal:0},colors:[],clickable:true,type:fac.type,cssClass:'facial'});

this.protocol.forEach(t=>{if(t.mealSlot&&sel[t.mealSlot]!==undefined){const all=MEALS[t.mealSlot]||[];if(all[sel[t.mealSlot]]){const m=all[sel[t.mealSlot]];t.title=m.title;t.desc=`P:${m.macros.p} C:${m.macros.cal}`;t.macros=m.macros;t.colors=m.colors}}});

this.protocol.sort((a,b)=>{
const parseTime=(t)=>{
const match=t.match(/(\d+):(\d+)\s*(AM|PM)/i);
if(!match)return 0;
let h=parseInt(match[1]);
const m=parseInt(match[2]);
const ap=match[3].toUpperCase();
if(ap==='PM'&&h!==12)h+=12;
if(ap==='AM'&&h===12)h=0;
return h*60+m;
};
return parseTime(a.time)-parseTime(b.time);
});

this.setText('dateLabel',date);
const mac=this.calculateMacros();
const sc=Math.min(100,Math.round(((day.totalSec||0)/3600/8)*100));
this.setText('dayGrade',sc>=85?'A':sc>=70?'B':'C');

// Calculate 7-day longevity score
const last7=this.history.slice(0,7);
const avgScore=last7.length>0?Math.round(last7.reduce((sum,d)=>sum+(d.score||0),0)/last7.length):0;
this.setText('longevityScore',avgScore);
log(`üíØ Longevity Score: ${avgScore} (7-day avg)`);

// AI-powered daily recommendation based on biomarkers and progress
const rec=this.getDailyRecommendation(mac,day,avgScore);
this.setText('statusMsg',rec);

const upd=(id,val,max,col)=>{const el=document.getElementById(id);if(el){el.style.strokeDashoffset=145-(Math.min(val/max,1)*145);el.style.stroke=col}const txt=document.getElementById(id.replace('Orb','Val'));if(txt)txt.innerText=Math.round(val)};
const updOrb=(id,val,max,col)=>{const el=document.getElementById(id);if(el){el.style.strokeDashoffset=145-(Math.min(val/max,1)*145);el.style.stroke=col}};
const sleepHours=(day.totalSec||0)/3600;
const deepMins=Math.round((day.deepSec||0)/60);
const remMins=Math.round((day.remSec||0)/60);
log(`üìä Rendering ${day.date}: Sleep=${sleepHours.toFixed(1)}h, Deep=${deepMins}m, REM=${remMins}m`);
this.setText('sleepVal',`${sleepHours.toFixed(1)}h`);
this.setText('deepVal',`${deepMins}m`);
this.setText('remVal',`${remMins}m`);
updOrb('sleepOrb',sleepHours,8,'#bf5af2');
updOrb('deepOrb',deepMins,90,'#007aff');
updOrb('remOrb',remMins,90,'#bf5af2');

// RHR and Zones Display
this.setText('rhrVal',day.rhr!=='-'?day.rhr:'--');

// Vascular Age Display
const calcAge=(dob)=>{
const today=new Date();
const birth=new Date(dob);
let age=today.getFullYear()-birth.getFullYear();
const m=today.getMonth()-birth.getMonth();
if(m<0||(m===0&&today.getDate()<birth.getDate()))age--;
return age;
};
const chronologicalAge=calcAge(USERS[this.user].dob);

if(day.vascularAge){
this.setText('vascularAgeVal',day.vascularAge);
this.setText('chronologicalAge',chronologicalAge);
const delta=day.vascularAge-chronologicalAge;
const deltaEl=document.getElementById('ageDelta');
if(deltaEl){
deltaEl.innerText=delta>0?`+${delta}`:delta.toString();
deltaEl.style.color=delta>0?'#ff453a':(delta<0?'#30d158':'#666');
}
// Calculate 7-day trend
const last7=this.history.slice(0,7).filter(h=>h.vascularAge).map(h=>h.vascularAge);
if(last7.length>=2){
const trend=last7[0]-last7[last7.length-1];
const trendEl=document.getElementById('vascularAgeTrend');
if(trendEl){
if(trend>0){
trendEl.innerHTML='IMPROVING';
trendEl.style.color='#30d158'; // Green
}else if(trend<0){
trendEl.innerHTML='AGING';
trendEl.style.color='#ff453a'; // Red
}else{
trendEl.innerHTML='STABLE';
trendEl.style.color='#666'; // Gray
}
}
}
}else{
this.setText('vascularAgeVal','--');
this.setText('chronologicalAge',chronologicalAge);
this.setText('ageDelta','--');
}

// Smart Recovery System: Check if yesterday exceeded Zone 5
const yesterdayIdx=this.currentIndex+1;
const yesterday=this.history[yesterdayIdx];
let z5Recovery=false;
let adjustedZ2Target=45;

if(yesterday&&yesterday.high>=20){
// Yesterday exceeded Z5 goal (20min) - today is recovery day
z5Recovery=true;
adjustedZ2Target=30; // Lower Z2 target for recovery
log(`üåü Recovery day: Yesterday hit ${Math.round(yesterday.high)}min Z5, adjusting today's targets`);
}

const updHeart=(id,val,max)=>{const el=document.getElementById(id);if(el)el.style.strokeDashoffset=100-(Math.min(val/max,1)*100)};
updHeart('z2Heart',day.med||0,adjustedZ2Target);

// Zone 5 heart: Show star if in recovery mode
if(z5Recovery){
const z5Heart=document.getElementById('z5Heart');
const z5Val=document.getElementById('z5Val');
if(z5Heart){
z5Heart.style.strokeDashoffset=0; // Fill completely
z5Heart.style.stroke='#ffd60a'; // Gold color for recovery star
}
if(z5Val){
z5Val.innerHTML='<span style="font-size:2rem">‚òÖ</span>'; // Big star in the heart
z5Val.style.color='#ffd60a'; // Gold color
}
// Add explanation to status message if no higher priority alerts
const currentStatus=document.getElementById('statusMsg').innerText;
if(currentStatus.includes('OPTIMAL')||currentStatus.includes('ZONE')){
this.setText('statusMsg',`Z5 RECOVERY MODE ‚Üí Z2 TARGET: ${adjustedZ2Target}MIN`);
}
}else{
updHeart('z5Heart',day.high||0,20);
}

// Prevent heart value overflow - cap display at 999 and adjust font size for 3-digit numbers
const z2Display=Math.min(Math.round(day.med||0),999);
const z5Display=Math.min(Math.round(day.high||0),999);
const calDisplay=Math.min(Math.round(day.cal||0),999);

const z2Val=document.getElementById('z2Val');
const z5Val=document.getElementById('z5Val');
const calVal=document.getElementById('calVal');

z2Val.innerText=z2Display;
z2Val.style.fontSize=z2Display>=100?'0.6rem':'0.7rem'; // Smaller font for 3 digits

if(!z5Recovery){
z5Val.innerText=z5Display;
z5Val.style.fontSize=z5Display>=100?'0.6rem':'0.7rem';
}

calVal.innerText=calDisplay;
calVal.style.fontSize=calDisplay>=100?'0.6rem':'0.7rem';

updHeart('calHeart',day.cal||0,500);

upd('proteinOrb',mac.protein,USERS[this.user].goals.protein,'#fff');
upd('omega3Orb',mac.omega3,4000,'#00d4ff');
upd('fiberOrb',mac.fiber,50,'#30d158');
upd('calorieOrb',mac.calories,2500,'#FFD60A');

const cols=this.calculateRainbow();
this.setText('rainbowScore',Math.round((cols.size/6)*100)+'%');
let rh='';
['red','orange','yellow','green','purple','white'].forEach(c=>{rh+=`<div class="rainbow-seg" style="background:${cols.has(c)?COLORS[c].hex:'#333'};width:${cols.has(c)?16.6:0}%"></div>`});
document.getElementById('rainbowTrack').innerHTML=rh;

const chk=this.checked[date]||[];
let th='';
this.protocol.forEach(t=>{
const isC=chk.includes(t.id);
let ca='';let cc=`task-card ${isC?'checked':''} ${t.autoDetected?'auto-detected':''} ${t.cssClass||''}`;
if(t.clickable){if(t.type&&(t.type in PROTOCOLS))ca=`onclick="app.showProtocolDetails('${t.type}')"`;else if(t.mealSlot)ca=`onclick="app.openMealPicker('${t.mealSlot}')"`}
th+=`<div class="task"><div class="task-time">${t.time}</div><div class="${cc}" ${ca}><div class="task-info"><div class="task-title">${t.title}</div><div class="task-desc">${t.desc}</div></div>${t.clickable?'<div class="chevron">‚Ä∫</div>':''}${!t.autoDetected&&!t.type?`<div class="check-btn" onclick="event.stopPropagation();app.toggleTask('${t.id}')"><div class="check-circle">${isC?'‚úì':''}</div></div>`:''}</div></div>`});
document.getElementById('timeline').innerHTML=th}

setText(id,txt){const el=document.getElementById(id);if(el)el.innerText=txt}
sync(){this.fetchOuraData()}}

let app;
window.onload=()=>{app=new CenturionApp();window.app=app};
</script>

</body>
</html>