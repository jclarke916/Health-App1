<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>The Centurion | v34 Chef Mode</title>
    <link href="https://fonts.googleapis.com/css2?family=Inter:wght@300;400;600;700&display=swap" rel="stylesheet">
    <style>
        :root {
            --bg-dark: #000000; 
            --card-bg: #111111; 
            --text-main: #E5E4E2; 
            --text-dim: #888888;
            --accent-gold: #D4AF37;
            --accent-silver: #C0C0C0;
            --badge-green: #2a9d48;
            --badge-orange: #c47f00;
            --alert-red: #993333; 
        }
        
        body { font-family: 'Inter', sans-serif; background-color: var(--bg-dark); color: var(--text-main); margin: 0; display: flex; flex-direction: column; align-items: center; padding: 20px; }
        .container { max-width: 1000px; width: 100%; position: relative; }
        
        header { text-align: center; margin-bottom: 25px; border-bottom: 1px solid #333; padding-bottom: 20px; }
        h1 { font-weight: 300; letter-spacing: 2px; text-transform: uppercase; background: linear-gradient(to right, #E5E4E2, #888888); -webkit-background-clip: text; -webkit-text-fill-color: transparent; margin: 0; }
        
        .profile-badges { display: flex; justify-content: center; gap: 10px; margin-top: 20px; flex-wrap: wrap; }
        .badge { background: #1a1a1a; padding: 8px 16px; border-radius: 4px; border: 1px solid #333; font-size: 0.75rem; display: flex; align-items: center; gap: 8px; letter-spacing: 0.5px; text-transform: uppercase; color: var(--accent-silver); }
        .badge-interactive { cursor: pointer; transition: all 0.3s ease; border: 1px solid var(--accent-gold); color: var(--accent-gold); }
        .badge-interactive:hover { background: rgba(212, 175, 55, 0.1); box-shadow: 0 0 15px rgba(212, 175, 55, 0.1); }

        .status-bar { text-align: center; color: var(--text-dim); font-size: 0.85rem; margin-bottom: 20px; text-transform: uppercase; letter-spacing: 1.5px; }
        
        .controls { display: flex; justify-content: space-between; gap: 10px; margin-bottom: 25px; width: 100%; flex-wrap: wrap;}
        .nav-btn { flex: 1; padding: 14px; background: var(--card-bg); border: 1px solid #333; color: var(--text-main); border-radius: 6px; cursor: pointer; font-weight: 600; transition: 0.2s; font-size: 0.8rem; min-width: 100px; text-transform: uppercase; letter-spacing: 1px; }
        .nav-btn:hover { border-color: var(--accent-silver); background: #1a1a1a; }
        .action-btn { border-color: var(--accent-gold); color: var(--accent-gold); }
        .action-btn:hover { background: rgba(212, 175, 55, 0.1); }

        .tabs { display: flex; justify-content: space-between; background: var(--card-bg); padding: 5px; border-radius: 8px; margin-bottom: 25px; overflow-x: auto; border: 1px solid #222; }
        .tab-btn { background: none; border: none; color: #555; padding: 10px 8px; cursor: pointer; font-weight: 600; flex: 1; min-width: 60px; font-size: 0.8rem; text-align: center; transition: 0.3s; }
        .tab-btn span { display: block; font-size: 0.65rem; opacity: 0.7; margin-top: 4px; }
        .tab-btn.active { color: var(--accent-gold); background: rgba(255,255,255,0.03); border-radius: 4px; }
        
        .main-layout { display: grid; grid-template-columns: 1.4fr 1fr; gap: 24px; align-items: start; transition: opacity 0.3s ease; opacity: 1; }
        
        .card { background: var(--card-bg); border-radius: 12px; padding: 30px; border: 1px solid #222; position: relative; overflow: hidden; }
        .card::before { content: ""; position: absolute; top: 0; left: 0; width: 4px; height: 100%; background: var(--accent-gold); }
        
        .label { color: var(--accent-silver); font-size: 0.65rem; text-transform: uppercase; letter-spacing: 2px; font-weight: 700; margin-bottom: 5px; opacity: 0.8; }
        .value { font-size: 1.1rem; margin-bottom: 8px; font-weight: 500; color: #fff; cursor: pointer; transition: 0.2s; border-bottom: 1px solid transparent; display: inline-block;}
        .value:hover { color: var(--accent-gold); border-bottom: 1px solid var(--accent-gold); }
        
        .workout-tag { font-size: 0.9rem; color: var(--accent-gold); border-bottom: 1px solid #333; padding-bottom: 15px; margin-bottom: 20px; font-weight: 700; text-transform: uppercase; letter-spacing: 1px; }
        .ingredients-list { font-size: 0.85rem; color: var(--text-dim); margin-bottom: 15px; font-style: italic; }
        
        .juice-box { background: #0a0a0a; border-radius: 12px; padding: 30px; border: 1px solid #222; display: flex; flex-direction: column; gap: 15px; }
        .juice-header { font-weight: 700; color: var(--accent-gold); font-size: 1rem; letter-spacing: 1px; text-transform: uppercase; }
        .oz-tag { background: var(--accent-gold); color: #000; padding: 2px 6px; border-radius: 2px; font-size: 0.7rem; font-weight: 800; float: right; }

        /* MODALS */
        .modal { display: none; position: fixed; z-index: 100; left: 0; top: 0; width: 100%; height: 100%; overflow: auto; background-color: rgba(0,0,0,0.9); backdrop-filter: blur(8px); }
        .modal-content { background-color: #050505; margin: 5% auto; padding: 30px; border: 1px solid #333; width: 90%; max-width: 650px; border-radius: 12px; box-shadow: 0 0 50px rgba(0,0,0,0.8); position: relative; }
        .close-btn { color: #555; float: right; font-size: 28px; font-weight: bold; cursor: pointer; }
        .close-btn:hover { color: var(--accent-gold); }
        
        .guide-title { font-size: 1.3rem; font-weight: 300; color: var(--accent-gold); margin-bottom: 20px; text-transform: uppercase; letter-spacing: 1px; border-bottom: 1px solid #333; padding-bottom: 10px; }
        
        /* RECIPE MODAL SPECIFIC */
        #recipeTitle { margin-bottom: 10px; border-bottom: none; padding-bottom: 0;}
        .recipe-badge-container { margin-bottom: 20px; }
        .recipe-time-badge { display: inline-block; padding: 6px 14px; border-radius: 20px; font-size: 0.85rem; font-weight: 700; letter-spacing: 0.5px; color: #fff; box-shadow: 0 2px 5px rgba(0,0,0,0.2); }
        .green-badge { background-color: var(--badge-green); }
        .orange-badge { background-color: var(--badge-orange); }
        .red-badge { background-color: var(--alert-red); }

        .recipe-section-title { color: var(--accent-gold); font-size: 0.9rem; text-transform: uppercase; letter-spacing: 1px; margin-top: 20px; margin-bottom: 10px; font-weight: 700; }
        .recipe-list { list-style: none; padding: 0; margin: 0; }
        .recipe-list li { margin-bottom: 8px; color: #ccc; font-size: 0.9rem; line-height: 1.5; padding-left: 15px; position: relative; }
        .recipe-list li::before { content: "‚Ä¢"; color: var(--accent-gold); position: absolute; left: 0; }
        .recipe-steps { counter-reset: step; }
        .recipe-steps p { margin-bottom: 15px; color: #ccc; font-size: 0.9rem; line-height: 1.6; position: relative; padding-left: 25px; }
        .recipe-steps p::before { counter-increment: step; content: counter(step); position: absolute; left: 0; top: 0; background: var(--accent-gold); color: #000; width: 18px; height: 18px; border-radius: 50%; font-size: 0.7rem; display: flex; align-items: center; justify-content: center; font-weight: bold; }

        .portion-table { width: 100%; border-collapse: collapse; margin-top: 10px; }
        .portion-table th { text-align: left; border-bottom: 1px solid #333; padding: 12px 5px; color: var(--accent-silver); font-size: 0.7rem; text-transform: uppercase; letter-spacing: 1px; }
        .portion-table td { padding: 15px 5px; border-bottom: 1px solid #222; font-size: 0.9rem; color: #ccc; }
        
        .stat-grid { display: grid; grid-template-columns: 1fr 1fr; gap: 20px; margin-top: 20px; }
        .stat-box { background: #0f0f0f; padding: 20px; border-radius: 8px; border: 1px solid #222; }
        .stat-name { font-weight: 700; font-size: 1rem; margin-bottom: 15px; color: var(--accent-gold); text-transform: uppercase; letter-spacing: 1px; }
        .stat-row { display: flex; justify-content: space-between; align-items: center; font-size: 0.85rem; margin-bottom: 8px; color: #666; border-bottom: 1px solid #1a1a1a; padding-bottom: 5px; }
        .stat-row:last-child { border-bottom: none; }
        .stat-row strong { color: #eee; }
        .stat-target { color: var(--accent-gold) !important; font-weight: 800; }

        .workout-list { list-style: none; padding: 0; margin: 0; }
        .workout-list li { margin-bottom: 15px; border-bottom: 1px solid #222; padding-bottom: 10px; color: #aaa; font-size: 0.85rem; }
        .workout-list li strong { color: #E5E4E2; display: block; margin-bottom: 4px; font-size: 0.95rem; }
        .workout-day { color: var(--accent-gold); font-size: 0.75rem; text-transform: uppercase; letter-spacing: 1px; font-weight: 700; margin-right: 10px; }
        .recovery-badge { display: inline-block; background: #333; color: #fff; padding: 2px 6px; border-radius: 3px; font-size: 0.65rem; margin-top: 5px; text-transform: uppercase; }
        .recovery-badge.heat { background: #5a2a2a; color: #ffcccc; }
        .recovery-badge.cold { background: #2a3a5a; color: #ccccff; }
        .recovery-badge.tech { background: #2a5a4a; color: #ccffcc; }
        
        .protein-tag { color: var(--accent-gold); font-size: 0.75rem; font-weight: 700; margin-left: 8px; }
        .red-meat-tag { color: #ff6b6b; font-size: 0.6rem; border: 1px solid #ff6b6b; padding: 1px 4px; border-radius: 2px; margin-left: 6px; vertical-align: middle; text-transform: uppercase; }
        
        @media (max-width: 768px) { .main-layout { grid-template-columns: 1fr; } }
    </style>
</head>
<body>

<div class="container">
    <header>
        <h1>THE CENTURION</h1>
        <div class="profile-badges">
            <div class="badge badge-interactive" onclick="openProfileModal()">üßîüèæ‚Äç‚ôÇÔ∏è JERMAINE</div>
            <div class="badge badge-interactive" onclick="openProfileModal()">üë©üèæ‚Äçü¶± SOPHIA</div>
            <div class="badge">üåø SEA MOSS: 2 TBSP</div>
            <div class="badge">üõ°Ô∏è PROCESSED FREE</div>
        </div>
    </header>

    <div class="status-bar" id="syncStatus">initializing...</div>

    <div class="controls">
        <button class="nav-btn" onclick="changeWeek(-1)">PREV</button>
        <button class="nav-btn" onclick="resetToCurrent()">TODAY</button>
        <button class="nav-btn" onclick="changeWeek(1)">NEXT</button>
        <button class="nav-btn action-btn" onclick="openWorkoutModal()">üèãÔ∏è WORKOUTS</button>
        <button class="nav-btn action-btn" onclick="openPortionModal()">üìè PORTIONS</button>
    </div>

    <div class="tabs" id="dayTabs"></div>
    <div id="dayContent" class="main-layout"></div>
</div>

<div id="recipeModal" class="modal">
    <div class="modal-content">
        <span class="close-btn" onclick="closeModal('recipeModal')">&times;</span>
        <div class="guide-title" id="recipeTitle">Dish Title</div>
        <div class="recipe-badge-container">
             <div class="recipe-time-badge" id="recipeTime">30 mins</div>
        </div>
        
        <div class="recipe-section-title">Detailed Ingredients</div>
        <ul class="recipe-list" id="recipeIngredients"></ul>
        <div class="recipe-section-title">Chef's Preparation</div>
        <div class="recipe-steps" id="recipeInstructions"></div>
    </div>
</div>

<div id="portionModal" class="modal">
    <div class="modal-content">
        <span class="close-btn" onclick="closeModal('portionModal')">&times;</span>
        <div class="guide-title">Portion Protocol</div>
        <table class="portion-table">
            <thead><tr><th>MACRO</th><th>JERMAINE (BUILD)</th><th>SOPHIA (TONE)</th></tr></thead>
            <tbody>
                <tr><td><strong>PROTEIN</strong></td><td>2 Palms</td><td>1 Palm</td></tr>
                <tr><td><strong>VEGGIES</strong></td><td>2+ Fists</td><td>2+ Fists</td></tr>
                <tr><td><strong>CARBS</strong></td><td>2 Cupped Hands</td><td>1 Cupped Hand</td></tr>
                <tr><td><strong>FATS</strong></td><td>2 Thumbs</td><td>1 Thumb</td></tr>
                <tr><td style="color:var(--accent-gold)"><strong>JUICE</strong></td><td style="color:var(--accent-gold)">20-24 oz</td><td style="color:var(--accent-gold)">16 oz</td></tr>
            </tbody>
        </table>
    </div>
</div>

<div id="workoutModal" class="modal">
    <div class="modal-content">
        <span class="close-btn" onclick="closeModal('workoutModal')">&times;</span>
        <div class="guide-title">Training & Recovery</div>
        <ul class="workout-list">
            <li><span class="workout-day">MON</span> <strong>LIFT (Together) @ In-Shape</strong>Focus: Heavy Compounds. <br><span class="recovery-badge tech">Recovery: Aqua Massage + Sauna</span></li>
            <li><span class="workout-day">TUE</span> <strong>BOXING W/ MARCUS @ UFC</strong>Focus: High Intensity Conditioning.<br><span class="recovery-badge cold">Recovery: Thera Knee Ice + Heat Packs</span></li>
            <li><span class="workout-day">WED</span> <strong>REFORM + CS4 @ Club Studio</strong>Focus: Pilates Stability + Strength Circuit.<br><span class="recovery-badge tech">Recovery: Normatec Hips (Home)</span></li>
            <li><span class="workout-day">THU</span> <strong>BOXING W/ MARCUS @ UFC</strong>Focus: Technique & Sparring drills.<br><span class="recovery-badge cold">Recovery: Thera Cold/Heat Contrast</span></li>
            <li><span class="workout-day">FRI</span> <strong>YOGA + REFORM @ Club Studio</strong>Focus: Mobility, Core & Decompression.<br><span class="recovery-badge heat">Recovery: Club Studio Sauna (20m)</span></li>
            <li><span class="workout-day">SAT</span> <strong>RECOVERY LAB @ In-Shape</strong><strong>Task:</strong> Zone 2 Cardio (30m) + Amenities.<br><span class="recovery-badge tech">Protocol: Water Massage + Sauna</span></li>
            <li><span class="workout-day">SUN</span> <strong>HOME BASE RECOVERY</strong><strong>Task:</strong> Total Rest.<br><span class="recovery-badge tech">Protocol: Normatec Legs (30m) + Thera</span></li>
        </ul>
    </div>
</div>

<div id="profileModal" class="modal">
    <div class="modal-content">
        <span class="close-btn" onclick="closeModal('profileModal')">&times;</span>
        <div class="guide-title">Biometric Data</div>
        <div class="stat-grid">
            <div class="stat-box">
                <div class="stat-name">JERMAINE</div>
                <div class="stat-row"><span>Age / Height</span><strong>42 / 6'4"</strong></div>
                <div class="stat-row"><span>Current Weight</span><strong>210.8 lbs</strong></div>
                <div class="stat-row"><span>Target Weight</span><strong class="stat-target">195.0 lbs</strong></div>
                <div class="stat-row"><span>Muscle Mass</span><strong>99.4 lbs</strong></div>
            </div>
            <div class="stat-box">
                <div class="stat-name">SOPHIA</div>
                <div class="stat-row"><span>Age / Height</span><strong>38 / 5'2"</strong></div>
                <div class="stat-row"><span>Current Weight</span><strong>136.1 lbs</strong></div>
                <div class="stat-row"><span>Target Weight</span><strong class="stat-target">118.5 lbs</strong></div>
                <div class="stat-row"><span>Muscle Mass</span><strong>50.0 lbs</strong></div>
            </div>
        </div>
    </div>
</div>

<script>
    // --- WORKOUT SCHEDULE LOGIC ---
    const weeklyWorkouts = [
        "üèãÔ∏è LIFT (In-Shape)", 
        "ü•ä BOXING (UFC Marcus)", 
        "üßò REFORM + CS4 (Club Studio)", 
        "ü•ä BOXING (UFC Marcus)", 
        "üßò YOGA + REFORM (Club Studio)", 
        "üíß RECOVERY LAB (In-Shape)", 
        "üîã HOME RECOVERY (Normatec)"
    ];

    // MEAL DATA (Truncated for brevity in display, but logic assumes full list)
    const mealLibrary = {
        breakfasts: [
            { val: "Sea Moss & Triple-Protein Smoothie", p: "45g", ing: "Sea Moss, Pea Protein, Hemp, PB2, Blackberries.", herSwap: "Same for Sophia" },
            { val: "Crab & Spinach Scramble", p: "35g", ing: "Lump crab, 3 eggs, spinach, green onions.", herSwap: "Modified: Well-Done Eggs Only" },
            { val: "Japanese Tamagoyaki Scramble", p: "32g", ing: "3 Eggs, dashi, coconut aminos, spinach, nori.", herSwap: "Modified: Well-Done Eggs Only" },
            { val: "Salmon & Capers Sprouted Toast", p: "32g", ing: "Smoked salmon, capers, sprouted bread, avocado.", herSwap: "Same for Sophia" },
            { val: "Turkey & Apple Hash", p: "35g", ing: "Ground turkey, apple, sage, walnuts.", herSwap: "Modified: Well-Done Eggs Only" },
            { val: "Mediterranean Breakfast Hash", p: "28g", ing: "Chickpeas, kale, tomatoes, olives, 2 eggs.", herSwap: "Modified: Well-Done Eggs Only" },
            { val: "Southwest Bison Scramble", p: "38g", ing: "Bison, 3 Eggs, jalape√±os, black beans.", herSwap: "Modified: Well-Done Eggs Only" }
        ],
        lunches: [
            { val: "Roasted Purple Yam Power Bowl", p: "35g", type: "white", ing: "Purple yams, quinoa, spinach, pepitas." },
            { val: "Bison Laab (Thai Meat Salad)", p: "40g", type: "red", ing: "Bison, lime, mint, cilantro, daikon." },
            { val: "Pasture-Raised Turkey Burger", p: "40g", type: "white", ing: "Turkey patty, avocado, tomato, lettuce wrap." },
            { val: "Cucumber-Wrapped 'Naruto' Sushi", p: "42g", type: "white", ing: "Ahi tuna, salmon, avocado, cucumber wrap." },
            { val: "Ginger-Turkey Cabbage 'Potstickers'", p: "38g", type: "white", ing: "Turkey, ginger, garlic, cabbage leaves." },
            { val: "Mendo-Style 'Sophisticated' Cobb", p: "42g", type: "white", ing: "Pasture turkey, kale, avocado, pickled onions." },
            { val: "Ahi Tuna & Power Greens Bowl", p: "45g", type: "white", ing: "Ahi tuna, edamame, cucumber, radish." }
        ],
        dinners: [
            { val: "SF Style Cioppino", p: "40g", type: "white", ing: "Clams, mussels, shrimp, crab, tomato broth, fennel." },
            { val: "Moules Marini√®res (Steamed Mussels)", p: "32g", type: "white", ing: "Fresh mussels, white wine, garlic, shallots, parsley." },
            { val: "Spicy Thai Basil Mussels", p: "35g", type: "white", ing: "Mussels, chili paste, basil, coconut milk, lime." },
            { val: "Mussels Fra Diavolo", p: "38g", type: "white", ing: "Mussels, spicy marinara, garlic, red pepper flakes." },
            { val: "Mussels w/ Chorizo & Leeks", p: "40g", type: "white", ing: "Mussels, spanish chorizo, leeks, saffron broth." },
            { val: "Coconut Turmeric Mussels", p: "35g", type: "white", ing: "Mussels, turmeric, ginger, coconut milk, cilantro." },
            { val: "Duck & Mushroom Ragu", p: "45g", type: "red", ing: "Ground duck, mushrooms, chickpea pasta, herbs." },
            { val: "Lemon-Rosemary Brick Chicken", p: "45g", type: "white", ing: "Pasture chicken, pressed & roasted, crispy skin." },
            { val: "Miso-Glazed Black Cod", p: "40g", type: "white", ing: "Sablefish, white miso, mirin, bok choy." },
            { val: "Bistro Pan-Seared Steak", p: "45g", type: "red", ing: "Steak, herb ghee, asparagus, mushrooms." },
            { val: "Pan-Seared Jumbo Sea Scallops", p: "35g", type: "white", ing: "Scallops, cauliflower mash, lemon, parsley." },
            { val: "Whole Roasted Branzino", p: "38g", type: "white", ing: "Branzino, lemon, rosemary, asparagus." },
            { val: "Bison & Mushroom Stroganoff", p: "45g", type: "red", ing: "Bison, mushrooms, yogurt, chickpea pasta." },
            { val: "One-Bowl Deconstructed Lasagna", p: "42g", type: "red", ing: "Chickpea pasta, bison, marinara, ricotta." },
            { val: "Roasted Veggie & Pesto Pizza", p: "25g", type: "white", ing: "Cauliflower crust, pesto, artichokes, peppers." },
            { val: "Red Curry Bison & Veggies", p: "38g", type: "red", ing: "Bison, curry paste, coconut milk, peppers." },
            { val: "Steamed Crab Legs & Asparagus", p: "32g", type: "white", ing: "Crab legs, ghee, lemon, asparagus." },
            { val: "Mahi-Mahi Kabobs", p: "40g", type: "white", ing: "Mahi-mahi chunks, peppers, onions, zucchini." },
            { val: "Walnut-Crusted Salmon", p: "42g", type: "white", ing: "Salmon, walnuts, broccoli, EVOO." },
            { val: "Zucchini Wrapper 'Dumplings'", p: "35g", type: "white", ing: "Shrimp/turkey, ginger, zucchini wrappers." },
            { val: "Bison Stuffed Bell Peppers", p: "42g", type: "red", ing: "Bison, quinoa, tomatoes, peppers." },
            { val: "Baked Cod with Zoodles", p: "38g", type: "white", ing: "Cod, zucchini noodles, olives, tomatoes." },
            { val: "Thai Coconut Shrimp Soup", p: "35g", type: "white", ing: "Shrimp, coconut milk, broth, ginger." },
            { val: "Braised Venison Shanks", p: "45g", type: "red", ing: "Venison shank, bone broth, rosemary, carrots." },
            { val: "Herb Roast Chicken & Yams", p: "40g", type: "white", ing: "Chicken, purple yams, roasted carrots." },
            { val: "Ahi Tuna Steaks & Bok Choy", p: "45g", type: "white", ing: "Ahi tuna, sesame, bok choy, garlic." },
            { val: "Grilled Ostrich Fillets", p: "42g", type: "red", ing: "Ostrich steak, chimichurri, grilled asparagus." },
            { val: "Wild Mushroom & Quinoa Risotto", p: "28g", type: "white", ing: "Quinoa, mushrooms, garlic, yeast." },
            { val: "Turkey Loaf with Mashed Cauli", p: "38g", type: "white", ing: "Turkey, peppers, cauliflower mash." },
            { val: "Halibut with Mango Salsa", p: "40g", type: "white", ing: "Halibut, mango, cilantro, lime." },
            { val: "Bison Bolognese over Zoodles", p: "42g", type: "red", ing: "Bison, marinara, zucchini noodles." },
            { val: "Duck Breast with Cherry Glaze", p: "38g", type: "white", ing: "Duck breast, cherries, balsamic, spinach." },
            { val: "Sardine & Fennel Pasta", p: "32g", type: "white", ing: "Sardines, fennel bulb, chickpea pasta, lemon." },
            { val: "Venison Steaks & Sprouts", p: "45g", type: "red", ing: "Venison, Brussels sprouts, balsamic." },
            { val: "Crispy Salmon Skin & Arugula", p: "35g", type: "white", ing: "Salmon skin, arugula, lemon, hemp." },
            { val: "Chicken Proven√ßal", p: "42g", type: "white", ing: "Chicken, tomatoes, olives, capers, herbs." },
            { val: "Pesto Shrimp & Chickpea Pasta", p: "38g", type: "white", ing: "Shrimp, pesto, chickpea pasta." },
            { val: "Sashimi Platter & Seaweed", p: "45g", type: "white", ing: "Mixed raw fish, seaweed salad, radish." },
            { val: "Firecracker Shrimp & Broccoli", p: "38g", type: "white", ing: "Wild shrimp, chili flakes, broccoli, sesame." },
            { val: "Lemon-Garlic Butter Shrimp Zoodles", p: "35g", type: "white", ing: "Wild shrimp, ghee, lemon, zucchini noodles." },
            { val: "Fisherman's Stew", p: "42g", type: "white", ing: "Wild shrimp, cod, mussels, tomato fennel broth." },
            { val: "Chicken Marsala (Clean)", p: "40g", type: "white", ing: "Chicken, mushrooms, marsala wine, parsley." },
            { val: "Leg of Lamb (Roasted)", p: "45g", type: "red", ing: "Lamb leg, rosemary, garlic, roasted carrots." },
            { val: "Duck Confit Salad", p: "35g", type: "white", ing: "Duck leg, frisee, walnuts, vinaigrette." },
            { val: "Turkey Chili (No Beans)", p: "40g", type: "white", ing: "Ground turkey, tomatoes, peppers, spices." },
            { val: "Snapper Vera Cruz", p: "38g", type: "white", ing: "Red snapper, tomato, olive, caper sauce." },
            { val: "Chicken Cacciatore", p: "40g", type: "white", ing: "Chicken thighs, bell peppers, tomato, onion." },
            { val: "Grilled Octopus", p: "35g", type: "white", ing: "Octopus tentacles, lemon, olive oil, oregano." },
            { val: "Bison Meatballs & Spaghetti Squash", p: "42g", type: "red", ing: "Bison meatballs, marinara, squash." },
            { val: "Clams Casino (Clean)", p: "30g", type: "white", ing: "Clams, bacon bits, peppers, garlic." },
            { val: "Elk Burgers", p: "45g", type: "red", ing: "Ground elk, mushrooms, onions, sweet potato fries." },
            { val: "Sole Meuni√®re (Ghee)", p: "35g", type: "white", ing: "Dover sole, lemon, parsley, ghee sauce." },
            { val: "Sablefish & Spinach", p: "40g", type: "white", ing: "Black cod, garlic spinach, lemon." },
            { val: "Turkey Stuffed Zucchini Boats", p: "38g", type: "white", ing: "Ground turkey, marinara, zucchini halves." },
            { val: "Roast Chicken & Root Veggies", p: "40g", type: "white", ing: "Whole chicken, carrots, parsnips, turnips." },
            { val: "Seared Scallops & Risotto", p: "35g", type: "white", ing: "Scallops, cauliflower risotto, truffle oil." }
        ],
        juices: [
            { name: "The Detox", oz: "16oz", ing: "Celery, Cucumber, Apple, Lemon, Ginger" },
            { name: "Red Power", oz: "20oz", ing: "Beets, Carrots, Orange, Ginger" },
            { name: "The Alkaline", oz: "16oz", ing: "Kale, Spinach, Pear, Lime" },
            { name: "Joint Guard", oz: "18oz", ing: "Carrots, Pear, Celery, Turmeric" },
            { name: "The Flush", oz: "16oz", ing: "Red Cabbage, Apple, Mint, Lemon" },
            { name: "The Endurance", oz: "24oz", ing: "Watermelon, Lime, Mint" },
            { name: "The Rainbow", oz: "18oz", ing: "Carrots, Beets, Celery, Ginger" }
        ]
    };

    // EXPANDED RECIPE DATABASE
    const recipeDatabase = {
        "default": { time: "30 mins", ingredients: ["Fresh Ingredients", "Olive Oil / Ghee", "Spices"], steps: ["Prep ingredients", "Cook thoroughly", "Serve immediately"] },
        "SF Style Cioppino": { 
            time: "45 mins", 
            ingredients: ["1 lb Mussels (scrubbed)", "1 lb Clams", "8oz Shrimp (raw)", "1 Dungeness Crab (cracked)", "1 Fennel Bulb (sliced)", "28oz Crushed Tomatoes", "2 cups Fish Broth", "1 cup Dry White Wine", "3 Garlic Cloves", "Red Pepper Flakes"], 
            steps: ["Saut√© fennel, onion, and garlic in olive oil until soft (5 mins).", "Add wine, reduce by half.", "Add tomatoes and broth. Simmer 20 mins.", "Add clams and mussels first (cover tightly, cook 5 mins until opened).", "Add shrimp and crab, cook 3-4 more mins.", "Discard any unopened shells. Serve with parsley."] 
        },
        "Duck & Mushroom Ragu": { 
            time: "60 mins", 
            ingredients: ["1 lb Ground Duck", "8oz Mushrooms (Cremini)", "1 jar Clean Marinara", "1 box Chickpea Pasta", "Fresh Thyme", "1 Onion", "Red Wine Splash"], 
            steps: ["Brown ground duck in a Dutch oven. Remove excess fat (save for later!).", "Saut√© chopped onions and mushrooms in the remaining duck fat.", "Deglaze pan with a splash of red wine.", "Add marinara and thyme. Simmer on low for 40 mins to develop flavor.", "Serve over chickpea pasta cooked al dente."] 
        },
        "Mussels Fra Diavolo": { 
            time: "25 mins", 
            ingredients: ["2 lbs Mussels", "28oz Crushed Tomatoes", "4 Garlic Cloves (sliced)", "1 tsp Red Pepper Flakes", "1/2 cup White Wine", "Parsley"], 
            steps: ["Saut√© garlic and red pepper flakes in olive oil (do not burn).", "Add wine and tomatoes. Simmer 10 mins.", "Increase heat to high. Add mussels.", "Cover tightly. Steam 5-7 mins.", "Discard unopened shells. Top with fresh parsley."] 
        },
        "Braised Venison Shanks": { 
            time: "3 hours", 
            ingredients: ["2 Venison Shanks", "Beef Bone Broth", "Carrots", "Celery", "Onion", "Rosemary", "Red Wine"], 
            steps: ["Season shanks heavily with salt/pepper.", "Sear on all sides in a hot Dutch oven.", "Remove meat. Saut√© veggies.", "Return meat. Add wine and broth to cover 3/4 way.", "Cover and bake at 325¬∞F for 2.5 - 3 hours until falling off bone."] 
        },
        "Lemon-Rosemary Brick Chicken": {
            time: "45 mins",
            ingredients: ["1 Whole Pasture Chicken (Spatchcocked)", "2 Lemons", "Fresh Rosemary", "4 Garlic Cloves", "Ghee"],
            steps: ["Preheat oven to 400¬∞F.", "Rub chicken with ghee, garlic, and rosemary.", "Place skin-side down in a cold cast iron skillet.", "Place a heavy pot (or foil-wrapped brick) on top to press it flat.", "Cook on medium-high heat for 15 mins (skin gets crispy).", "Flip and roast in oven for 20-25 mins until 165¬∞F."]
        },
        "Coconut Turmeric Mussels": {
            time: "20 mins",
            ingredients: ["2 lbs Mussels", "1 can Coconut Milk", "1 tbsp Fresh Turmeric (grated)", "1 tbsp Ginger (grated)", "1 Lime", "Cilantro"],
            steps: ["Saut√© ginger and turmeric in coconut oil until fragrant.", "Add coconut milk and bring to a simmer.", "Add mussels and cover.", "Steam 5-7 mins until opened.", "Squeeze lime juice over top and garnish with cilantro."]
        }
    };

    let weekOffset = 0;

    // --- SEED LOGIC ---
    function mulberry32(a) {
        return function() {
            var t = a += 0x6D2B79F5;
            t = Math.imul(t ^ t >>> 15, t | 1);
            t ^= t + Math.imul(t ^ t >>> 7, t | 61);
            return ((t ^ t >>> 14) >>> 0) / 4294967296;
        }
    }

    function seededShuffle(array, rng) {
        let newArray = [...array];
        let cur = newArray.length, rand;
        while (cur != 0) {
            rand = Math.floor(rng() * cur);
            cur--;
            [newArray[cur], newArray[rand]] = [newArray[rand], newArray[cur]];
        }
        return newArray;
    }

    function getWrappedSlice(array, start, length) {
        let result = [];
        for (let i = 0; i < length; i++) {
            result.push(array[(start + i) % array.length]);
        }
        return result;
    }

    function getMondayDate(offset) {
        let d = new Date();
        let day = d.getDay();
        let diff = d.getDate() - day + (day == 0 ? -6:1);
        let monday = new Date(d.setDate(diff));
        monday.setDate(monday.getDate() + (offset * 7));
        return monday;
    }

    function changeWeek(direction) {
        const layout = document.getElementById('dayContent');
        layout.classList.add('fade');
        setTimeout(() => {
            weekOffset += direction;
            generateSyncedWeek();
            layout.classList.remove('fade');
        }, 150);
    }

    function resetToCurrent() {
        const layout = document.getElementById('dayContent');
        layout.classList.add('fade');
        setTimeout(() => {
            weekOffset = 0;
            generateSyncedWeek(true);
            layout.classList.remove('fade');
        }, 150);
    }

    function openModal(id) { document.getElementById(id).style.display = 'block'; }
    function closeModal(id) { document.getElementById(id).style.display = 'none'; }
    function openPortionModal() { openModal('portionModal'); }
    function openWorkoutModal() { openModal('workoutModal'); }
    function openProfileModal() { openModal('profileModal'); }

    window.onclick = function(event) { 
        if (event.target.classList.contains('modal')) event.target.style.display = 'none';
    }

    // UPDATED RECIPE ENGINE
    function openRecipeModal(dishName) {
        const modal = document.getElementById('recipeModal');
        const titleEl = document.getElementById('recipeTitle');
        const timeEl = document.getElementById('recipeTime');
        const ingList = document.getElementById('recipeIngredients');
        const stepList = document.getElementById('recipeInstructions');

        let recipe = recipeDatabase[dishName];
        
        // SMART FALLBACK ENGINE
        if (!recipe) {
            recipe = { ...recipeDatabase["default"] };
            if (dishName.includes("Salmon")) {
                recipe.time = "15 mins";
                recipe.ingredients = ["Wild Salmon", "Lemon", "Ghee", "Salt", "Asparagus/Greens"];
                recipe.steps = ["Pat fish dry.", "Sear skin-side down in ghee (4 mins).", "Flip and cook 2 mins.", "Serve with steamed greens."];
            } else if (dishName.includes("Chicken")) {
                recipe.time = "25 mins";
                recipe.ingredients = ["Pasture Chicken", "Olive Oil", "Herbs (Thyme/Rosemary)", "Seasonal Veg"];
                recipe.steps = ["Season chicken liberally.", "Sear in pan or grill until 165¬∞F internal.", "Rest for 5 mins.", "Serve with roasted veggies."];
            } else if (dishName.includes("Salad") || dishName.includes("Bowl")) {
                recipe.time = "10 mins";
                recipe.ingredients = ["Protein of choice", "Mixed Greens", "Olive Oil", "Lemon/Vinegar", "Seeds/Nuts"];
                recipe.steps = ["Chopped all veggies.", "Whisk oil and vinegar.", "Toss greens with dressing.", "Top with warm or cold protein."];
            } else if (dishName.includes("Bison") || dishName.includes("Steak")) {
                 recipe.time = "20 mins";
                 recipe.ingredients = ["Meat", "Salt/Pepper", "Ghee", "Rosemary"];
                 recipe.steps = ["Heat cast iron to high.", "Sear meat 3-4 mins per side.", "Baste with ghee.", "Rest for 10 mins."];
            } else if (dishName.includes("Mussels")) {
                 recipe.time = "20 mins";
                 recipe.ingredients = ["Mussels", "Garlic", "White Wine/Broth", "Parsley"];
                 recipe.steps = ["Clean mussels (remove beards).", "Saut√© garlic.", "Add liquid and steam covered for 6 mins.", "Discard unopened shells."];
            } else if (dishName.includes("Ostrich")) {
                 recipe.time = "15 mins";
                 recipe.ingredients = ["Ostrich Steak", "Salt/Pepper", "Olive Oil"];
                 recipe.steps = ["Treat exactly like filet mignon.", "Sear hot and fast.", "Do not cook past Medium-Rare (it gets tough)."];
            }
        }

        // --- DYNAMIC COLOR LOGIC ---
        let minutes = 0;
        if (recipe.time.includes("hour")) minutes = 60; // Simple check for long recipes
        else minutes = parseInt(recipe.time);

        timeEl.className = 'recipe-time-badge'; 

        if (minutes <= 15) {
            timeEl.classList.add('green-badge');
            timeEl.innerText = `‚ö° ${recipe.time}`;
        } else if (minutes > 15 && minutes <= 30) {
            timeEl.classList.add('orange-badge');
             timeEl.innerText = `‚è±Ô∏è ${recipe.time}`;
        } else {
            timeEl.classList.add('red-badge');
             timeEl.innerText = `‚è≥ ${recipe.time}`;
        }

        titleEl.innerText = dishName;
        ingList.innerHTML = recipe.ingredients.map(i => `<li>${i}</li>`).join('');
        stepList.innerHTML = recipe.steps.map(s => `<p>${s}</p>`).join('');

        openModal('recipeModal');
    }

    function generateSyncedWeek(forceToday = false) {
        const today = new Date();
        const year = today.getFullYear();
        const rng = mulberry32(year); 

        const shuffledB = seededShuffle(mealLibrary.breakfasts, rng);
        const shuffledL = seededShuffle(mealLibrary.lunches, rng);
        const shuffledD = seededShuffle(mealLibrary.dinners, rng);
        const shuffledJ = seededShuffle(mealLibrary.juices, rng);

        const d = new Date();
        d.setUTCDate(d.getUTCDate() + 4 - (d.getUTCDay()||7));
        const weekNo = Math.ceil((((d - new Date(Date.UTC(d.getUTCFullYear(),0,1))) / 86400000) + 1)/7);
        const effectiveWeek = weekNo + weekOffset;
        
        const startB = (Math.abs(effectiveWeek) * 7) % mealLibrary.breakfasts.length;
        const startL = (Math.abs(effectiveWeek) * 7) % mealLibrary.lunches.length;
        const startD = (Math.abs(effectiveWeek) * 7) % mealLibrary.dinners.length;
        const startJ = (Math.abs(effectiveWeek) * 7) % mealLibrary.juices.length;

        const sB = getWrappedSlice(shuffledB, startB, 7);
        const sL = getWrappedSlice(shuffledL, startL, 7);
        const sD = getWrappedSlice(shuffledD, startD, 7);
        const sJ = getWrappedSlice(shuffledJ, startJ, 7);

        let ahiCount = 0;
        for (let i = 0; i < 7; i++) {
            if (sL[i].val.includes("Ahi") || sL[i].val.includes("Tuna")) {
                ahiCount++;
                if (ahiCount > 2) {
                    let safeIdx = (i + 15) % shuffledL.length;
                    while (shuffledL[safeIdx].val.includes("Ahi") || shuffledL[safeIdx].val.includes("Tuna")) {
                        safeIdx = (safeIdx + 1) % shuffledL.length;
                    }
                    sL[i] = shuffledL[safeIdx];
                }
            }
            if (sD[i].val.includes("Ahi") || sD[i].val.includes("Tuna")) {
                ahiCount++;
                if (ahiCount > 2) {
                    let safeIdx = (i + 15) % shuffledD.length;
                    while (shuffledD[safeIdx].val.includes("Ahi") || shuffledD[safeIdx].val.includes("Tuna")) {
                        safeIdx = (safeIdx + 1) % shuffledD.length;
                    }
                    sD[i] = shuffledD[safeIdx];
                }
            }
        }

        for (let i = 0; i < 7; i++) {
            if (sL[i].type === 'red' && sD[i].type === 'red') {
                let swapIdx = (i + 2) % 7; 
                [sD[i], sD[swapIdx]] = [sD[swapIdx], sD[i]];
            }
        }

        let monday = getMondayDate(weekOffset);
        let sunday = new Date(monday);
        sunday.setDate(monday.getDate() + 6);
        const opts = { month: 'short', day: 'numeric' };
        document.getElementById('syncStatus').innerText = `${monday.toLocaleDateString('en-US', opts)} ‚Äî ${sunday.toLocaleDateString('en-US', opts)}`;

        const days = ['mon', 'tue', 'wed', 'thu', 'fri', 'sat', 'sun'];
        
        let weeklySchedule = {};
        days.forEach((day, i) => {
            weeklySchedule[day] = { 
                workout: weeklyWorkouts[i],
                b: sB[i], l: sL[i], d: sD[i], j: sJ[i],
                bedtime: (day === 'wed' || day === 'thu') ? "12:30 AM" : "12:00 AM" 
            };
        });

        const tabsContainer = document.getElementById('dayTabs');
        tabsContainer.innerHTML = '';
        
        days.forEach((dayKey, i) => {
            let tabDate = new Date(monday);
            tabDate.setDate(monday.getDate() + i);
            let dateNum = tabDate.getDate();
            
            let btn = document.createElement('button');
            btn.className = 'tab-btn';
            btn.innerHTML = `${dayKey.toUpperCase()}<span>${dateNum}</span>`;
            
            btn.onclick = () => {
                document.querySelectorAll('.tab-btn').forEach(b => b.classList.remove('active'));
                btn.classList.add('active');
                renderDay(dayKey, weeklySchedule);
            };
            tabsContainer.appendChild(btn);
        });

        let activeIdx = 0;
        let todayDay = new Date().getDay();
        let trueTodayIdx = (todayDay + 6) % 7; 

        if (forceToday) {
            activeIdx = trueTodayIdx;
        } else {
            activeIdx = trueTodayIdx;
        }

        const allTabs = document.querySelectorAll('.tab-btn');
        if(allTabs[activeIdx]) {
            allTabs[activeIdx].classList.add('active');
            renderDay(days[activeIdx], weeklySchedule);
        }
    }

    function renderDay(day, schedule) {
        const data = schedule[day];
        const redTag = (type) => type === 'red' ? '<span class="red-meat-tag">RED</span>' : '';
        
        document.getElementById('dayContent').innerHTML = `
            <div class="card">
                <div class="workout-tag">${data.workout}</div>
                <div class="label">üç≥ Breakfast <span class="protein-tag">(${data.b.p})</span></div>
                <div class="value" onclick="openRecipeModal('${data.b.val}')">üßîüèæ‚Äç‚ôÇÔ∏è J: ${data.b.val}</div>
                <div class="value" style="color: var(--text-dim); font-size:0.9rem;" onclick="openRecipeModal('${data.b.val}')">üë©üèæ‚Äçü¶± S: ${data.b.herSwap}</div>
                <div class="ingredients-list">üõí ${data.b.ing}</div>
                
                <div class="label" style="margin-top:20px;">ü•ó Lunch <span class="protein-tag">(${data.l.p})</span> ${redTag(data.l.type)}</div>
                <div class="value" onclick="openRecipeModal('${data.l.val}')">${data.l.val}</div>
                <div class="ingredients-list">üõí ${data.l.ing}</div>
                
                <div class="label" style="margin-top:20px;">üçΩÔ∏è Dinner <span class="protein-tag">(${data.d.p})</span> ${redTag(data.d.type)}</div>
                <div class="value" onclick="openRecipeModal('${data.d.val}')">${data.d.val}</div>
                <div class="ingredients-list">üõí ${data.d.ing}</div>
            </div>
            
            <div class="juice-box">
                <div class="juice-header">üßÉ KUVINGS: ${data.j.name.toUpperCase()} <span class="oz-tag">${data.j.oz}</span></div>
                <div class="label">Ingredients</div><div style="font-size:0.9rem; color:#888;">${data.j.ing}</div>
                <div style="margin-top:15px; border-top:1px solid #222; padding-top:10px;">
                    <div class="label">üóìÔ∏è DAILY PROTOCOL</div>
                    <div style="font-size: 0.8rem; line-height: 1.6; color:#666;">
                        ‚úÖ 2 tbsp Sea Moss Gel <br>‚úÖ 4-8oz Kombucha <br>‚úÖ 7:30 PM Liquid Cut-off <br>‚úÖ Bedtime: ${data.bedtime}
                    </div>
                </div>
            </div>`;
    }

    window.onload = () => generateSyncedWeek(true);
</script>
</body>
</html>