<!DOCTYPE html>

<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Centurion Debug</title>
    <style>
        body { margin: 0; padding: 20px; background: #000; color: #0f0; font-family: monospace; font-size: 14px; }
        .log { margin: 5px 0; padding: 5px; background: #111; border-left: 3px solid #0f0; }
        .error { border-left-color: #f00; color: #f00; }
        .success { border-left-color: #0f0; }
        .info { border-left-color: #0ff; color: #0ff; }
        button { background: #0f0; color: #000; border: none; padding: 10px 20px; margin: 10px 5px; cursor: pointer; font-weight: bold; }
    </style>
</head>
<body>
    <h1>üîç CENTURION DEBUG MODE</h1>
    <div id="logs"></div>
    <button onclick="testInit()">TEST INITIALIZATION</button>
    <button onclick="testFetch()">TEST OURA FETCH</button>
    <button onclick="clearLogs()">CLEAR LOGS</button>

<script>
const log = (msg, type = 'info') => {
    const div = document.createElement('div');
    div.className = `log ${type}`;
    div.textContent = `[${new Date().toLocaleTimeString()}] ${msg}`;
    document.getElementById('logs').appendChild(div);
    console.log(msg);
};

const clearLogs = () => {
    document.getElementById('logs').innerHTML = '';
};

log('Debug mode loaded', 'success');

// Test basic initialization
function testInit() {
    log('Testing initialization...', 'info');
    
    try {
        log('Step 1: Creating class instance', 'info');
        
        class TestCore {
            constructor() {
                log('Constructor called', 'success');
                this.user = 'jermaine';
                this.init();
            }
            
            init() {
                log('Init method called', 'success');
                log('Loading UI...', 'info');
                this.showUI();
            }
            
            showUI() {
                log('UI shown successfully', 'success');
            }
        }
        
        const test = new TestCore();
        log('‚úì Initialization test PASSED', 'success');
        
    } catch(e) {
        log(`‚úó Error: ${e.message}`, 'error');
        log(`Stack: ${e.stack}`, 'error');
    }
}

// Test Oura API fetch
async function testFetch() {
    log('Testing Oura API fetch...', 'info');
    
    const TOKENS = {
        'jermaine': 'WLIGFPFJQY73G43BY7CK7H6UJXPQ7N5Y',
        'sophia': '4QSDWYJJUZFHRWRH727NCK7WH4COQJF4'
    };
    
    try {
        log('Creating date range...', 'info');
        const d = new Date();
        d.setDate(d.getDate() + 1);
        const end = d.toISOString().split('T')[0];
        d.setDate(d.getDate() - 8);
        const start = d.toISOString().split('T')[0];
        
        log(`Date range: ${start} to ${end}`, 'info');
        
        const url = `https://corsproxy.io/?${encodeURIComponent(`https://api.ouraring.com/v2/usercollection/sleep?start_date=${start}&end_date=${end}`)}`;
        
        log('Fetching from Oura API...', 'info');
        log(`URL length: ${url.length} chars`, 'info');
        
        const controller = new AbortController();
        const timeout = setTimeout(() => {
            controller.abort();
            log('Fetch timeout after 8 seconds', 'error');
        }, 8000);
        
        const response = await fetch(url, {
            headers: { 'Authorization': `Bearer ${TOKENS.jermaine}` },
            cache: 'no-store',
            signal: controller.signal
        });
        
        clearTimeout(timeout);
        
        log(`Response status: ${response.status}`, response.ok ? 'success' : 'error');
        log(`Response headers: ${JSON.stringify([...response.headers])}`, 'info');
        
        if(response.ok) {
            const data = await response.json();
            log(`Data received: ${data.data ? data.data.length : 0} records`, 'success');
            log('‚úì Fetch test PASSED', 'success');
        } else {
            const text = await response.text();
            log(`Response body: ${text.substring(0, 200)}...`, 'error');
            log('‚úó Fetch test FAILED', 'error');
        }
        
    } catch(e) {
        log(`‚úó Fetch error: ${e.message}`, 'error');
        log(`Error type: ${e.name}`, 'error');
        if(e.stack) log(`Stack: ${e.stack.substring(0, 300)}`, 'error');
    }
}

log('Ready to test. Click buttons above.', 'info');
</script>

</body>
</html>