<!DOCTYPE html>

<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no">
    <title>The Centurion | v15.2 FOOD FIRST + VARIETY</title>
    <link href="https://fonts.googleapis.com/css2?family=JetBrains+Mono:wght@400;700&family=Inter:wght@300;400;600;800;900&display=swap" rel="stylesheet">
    <style>
        :root {
            --bg: #000000; --panel: #0a0a0a; --border: #222; --acid: #ccff00; --cyan: #00f0ff;
            --gold: #FFD60A; --alert: #ff453a; --purple: #bf5af2; --text: #ffffff; --muted: #666;
            --font-ui: 'Inter', sans-serif; --font-data: 'JetBrains Mono', monospace;
        }
        * { box-sizing: border-box; -webkit-tap-highlight-color: transparent; }
        body { margin: 0; padding: 0 0 120px 0; background: var(--bg); color: var(--text); font-family: var(--font-ui); min-height: 100vh; background-image: radial-gradient(circle at top right, #111 0%, #000 70%); }

```
    .hud-header { padding: 15px 16px; background: rgba(0,0,0,0.95); position: sticky; top: 0; z-index: 100; border-bottom: 1px solid var(--border); }
    .top-bar { display: flex; justify-content: space-between; align-items: center; margin-bottom: 10px; }
    .app-name { font-size: 0.6rem; font-weight: 900; letter-spacing: 2px; color: var(--muted); }
    .user-switch { display: flex; gap: 4px; background: #222; padding: 2px; border-radius: 20px; }
    .u-badge { padding: 6px 14px; border-radius: 16px; font-size: 0.6rem; font-weight: 700; color: #666; background: transparent; border: none; cursor: pointer; transition: all 0.2s; }
    .u-badge.active { background: var(--text); color: #000; }
    .bio-btn { background: rgba(255,255,255,0.1); border: 1px solid var(--border); color: var(--muted); padding: 4px 8px; border-radius: 8px; font-size: 0.55rem; font-weight: 700; cursor: pointer; margin-right: 10px; }
    .date-nav { display: flex; justify-content: center; align-items: center; gap: 20px; font-family: var(--font-data); font-size: 0.8rem; font-weight: 700; color: #fff; padding-top: 10px; border-top: 1px solid #222; margin-top: 10px; }
    .nav-btn { background: transparent; border: 1px solid var(--border); color: var(--gold); padding: 8px 20px; border-radius: 4px; cursor: pointer; font-size: 0.8rem; font-weight: 900; }
    .date-display { min-width: 120px; text-align: center; letter-spacing: 1px; color: var(--acid); }
    
    .hero-section { padding: 20px 16px; display: flex; align-items: center; justify-content: space-between; }
    .grade-box { position: relative; width: 90px; height: 90px; display: flex; align-items: center; justify-content: center; border: 4px solid var(--border); border-radius: 50%; }
    .grade-val { font-family: var(--font-data); font-size: 2.5rem; font-weight: 900; color: #fff; }
    .grade-label { position: absolute; bottom: -20px; font-size: 0.5rem; font-weight: 700; color: var(--muted); }
    .tactical-box { flex: 1; margin-left: 20px; border-left: 3px solid var(--acid); padding: 10px; background: linear-gradient(90deg, rgba(255,255,255,0.03) 0%, transparent 100%); }
    .tac-label { font-size: 0.55rem; color: var(--acid); font-weight: 900; letter-spacing: 1px; margin-bottom: 4px; text-transform: uppercase; }
    .tac-cmd { font-size: 0.8rem; font-weight: 700; color: #fff; line-height: 1.3; }
    .tac-meta { font-family: var(--font-data); font-size: 0.55rem; color: var(--muted); margin-top: 4px; }
    
    .health-badge { display: inline-block; padding: 3px 8px; border-radius: 4px; font-size: 0.5rem; font-weight: 900; letter-spacing: 0.5px; margin-left: 8px; }
    .badge-lpa { background: rgba(255,69,58,0.2); border: 1px solid var(--alert); color: var(--alert); }
    .badge-ana { background: rgba(255,165,0,0.2); border: 1px solid #ff9f0a; color: #ff9f0a; }
    
    .section-header { display: flex; justify-content: space-between; align-items: center; margin: 25px 16px 10px; }
    .section-label { font-size: 0.55rem; font-weight: 900; color: var(--muted); letter-spacing: 1px; text-transform: uppercase; }
    .grid-3 { display: grid; grid-template-columns: 1fr 1fr 1fr; gap: 8px; padding: 0 16px; margin-bottom: 10px; }
    .grid-4 { display: grid; grid-template-columns: 1fr 1fr 1fr 1fr; gap: 8px; padding: 0 16px; margin-bottom: 10px; }
    
    .orb-card { background: var(--panel); border: 1px solid var(--border); border-radius: 12px; padding: 10px 5px; display: flex; flex-direction: column; align-items: center; position: relative; }
    .orb-container { width: 50px; height: 50px; position: relative; display: flex; align-items: center; justify-content: center; margin-bottom: 5px; }
    .orb-svg { transform: rotate(-90deg); width: 100%; height: 100%; }
    .orb-bg { fill: none; stroke: #222; stroke-width: 4; }
    .orb-fg { fill: none; stroke: var(--cyan); stroke-width: 4; stroke-dasharray: 145; stroke-dashoffset: 145; transition: stroke-dashoffset 1s ease; stroke-linecap: round; }
    
    .heart-svg { width: 100%; height: 100%; overflow: visible; }
    .heart-bg { fill: none; stroke: #222; stroke-width: 2; }
    .heart-fg { fill: none; stroke: var(--alert); stroke-width: 2; stroke-dasharray: 100; stroke-dashoffset: 100; transition: stroke-dashoffset 1s ease; }
    .beating { animation: heartbeat 1.5s infinite; transform-origin: center; }
    @keyframes heartbeat { 0% { transform: scale(1); } 15% { transform: scale(1.15); } 30% { transform: scale(1); } 45% { transform: scale(1.15); } 60% { transform: scale(1); } }
    
    .orb-val-box { position: absolute; text-align: center; }
    .orb-val { font-family: var(--font-data); font-size: 0.7rem; font-weight: 700; color: #fff; }
    .orb-label { font-size: 0.45rem; font-weight: 700; color: var(--muted); letter-spacing: 1px; text-transform: uppercase; margin-top: 4px; }
    
    .rainbow-container { padding: 0 16px; margin-bottom: 20px; }
    .rainbow-track { height: 6px; background: #222; border-radius: 3px; display: flex; overflow: hidden; margin-top: 8px; }
    .rainbow-seg { height: 100%; width: 0%; transition: width 0.5s ease; }
    .rainbow-meta { display: flex; justify-content: space-between; font-size: 0.55rem; color: #888; margin-top: 4px; }
    
    .timeline-container { padding: 0 16px; margin-bottom: 40px; }
    .time-slot { display: flex; gap: 12px; margin-bottom: 15px; position: relative; }
    .ts-time { width: 45px; font-family: var(--font-data); font-size: 0.7rem; color: var(--muted); text-align: right; padding-top: 5px; }
    .ts-card { flex: 1; background: var(--panel); border: 1px solid var(--border); border-radius: 12px; padding: 12px; position: relative; cursor: pointer; transition: all 0.2s; }
    .ts-title { font-size: 0.8rem; font-weight: 700; color: #fff; margin-bottom: 2px; }
    .ts-desc { font-size: 0.6rem; color: #888; line-height: 1.3; }
    .ts-why { font-size: 0.55rem; color: #666; margin-top: 4px; font-style: italic; line-height: 1.2; border-left: 2px solid var(--gold); padding-left: 8px; margin-top: 6px; }
    .check-btn { position: absolute; top: 12px; right: 12px; width: 20px; height: 20px; border-radius: 50%; border: 1px solid #444; background: transparent; display: flex; align-items: center; justify-content: center; font-weight: 800; font-size: 0.7rem; color: #000; }
    .ts-card.checked { border-color: var(--acid); background: rgba(204,255,0,0.05); }
    .ts-card.checked .check-btn { background: var(--acid); border-color: var(--acid); }
    
    .ai-section { padding: 16px; margin-bottom: 80px; }
    .ai-card { background: #080808; border: 1px solid #333; padding: 15px; border-radius: 12px; position: relative; }
    .ai-btn { width: 100%; padding: 12px; background: var(--acid); color: #000; font-weight: 900; border: none; border-radius: 6px; cursor: pointer; font-size: 0.7rem; }
    
    .sync-footer { position: fixed; bottom: 0; left: 0; width: 100%; background: #000; padding: 12px 16px; border-top: 1px solid var(--border); display: flex; justify-content: space-between; align-items: center; font-family: var(--font-data); font-size: 0.6rem; color: #555; z-index: 200; }
    .pulse { animation: pulse 2s infinite; display: inline-block; width: 6px; height: 6px; background: var(--acid); border-radius: 50%; margin-right: 6px; }
    @keyframes pulse { 0% { opacity: 1; } 50% { opacity: 0.3; } }
    
    .modal { display: none; position: fixed; top: 0; left: 0; width: 100%; height: 100%; background: rgba(0,0,0,0.95); z-index: 2000; padding: 20px; overflow-y: auto; }
    .modal.active { display: block; }
    .modal-content { background: var(--panel); border: 1px solid var(--acid); border-radius: 16px; padding: 20px; margin-top: 40px; }
    .input-group { margin-bottom: 15px; }
    .input-group label { display: block; font-size: 0.6rem; color: #888; margin-bottom: 5px; text-transform: uppercase; }
    .input-group input { width: 100%; background: #111; border: 1px solid #333; padding: 12px; color: #fff; font-family: var(--font-data); border-radius: 6px; }
    .save-btn { width: 100%; padding: 15px; background: var(--acid); color: #000; font-weight: 900; border: none; border-radius: 8px; cursor: pointer; }
</style>
```

</head>
<body>
    <div class="hud-header">
        <div class="top-bar">
            <div class="app-name">CENTURION v15.2 FOOD FIRST + VARIETY</div>
            <div style="display:flex; gap:10px;">
                <button onclick="centurion.openBio()" class="bio-btn">BIO</button>
                <div class="user-switch">
                    <button id="btn-jermaine" class="u-badge active" onclick="centurion.switchUser('jermaine')">JER</button>
                    <button id="btn-sophia" class="u-badge" onclick="centurion.switchUser('sophia')">SOPH</button>
                </div>
            </div>
        </div>
        <div class="date-nav">
            <button class="nav-btn" onclick="centurion.changeDate(-1)">◀</button>
            <span class="date-display" id="dateDisplay">LOADING...</span>
            <button class="nav-btn" onclick="centurion.changeDate(1)">▶</button>
        </div>
    </div>

```
<div id="dashboard">
    <div class="hero-section">
        <div class="grade-box">
            <div class="grade-val" id="dayGrade">--</div>
            <div class="grade-label">DAY GRADE</div>
        </div>
        <div class="tactical-box">
            <div class="tac-label" id="userLabel">USER: --</div>
            <div class="tac-cmd" id="statusMsg">INITIALIZING...</div>
            <div class="tac-meta" id="bioDisplay">--</div>
        </div>
    </div>

    <div class="section-header"><span class="section-label">SLEEP ARCHITECTURE</span></div>
    <div class="grid-3">
        <div class="orb-card">
            <div class="orb-container"><svg class="orb-svg"><circle class="orb-bg" cx="25" cy="25" r="20"></circle><circle class="orb-fg" id="sleepOrb" cx="25" cy="25" r="20" style="stroke:#bf5af2"></circle></svg><div class="orb-val-box"><div class="orb-val" id="sleepVal">--</div></div></div>
            <div class="orb-label">TOTAL</div>
        </div>
        <div class="orb-card">
            <div class="orb-container"><svg class="orb-svg"><circle class="orb-bg" cx="25" cy="25" r="20"></circle><circle class="orb-fg" id="deepOrb" cx="25" cy="25" r="20" style="stroke:#007aff"></circle></svg><div class="orb-val-box"><div class="orb-val" id="deepVal">--</div></div></div>
            <div class="orb-label">DEEP</div>
        </div>
        <div class="orb-card">
            <div class="orb-container"><svg class="orb-svg"><circle class="orb-bg" cx="25" cy="25" r="20"></circle><circle class="orb-fg" id="remOrb" cx="25" cy="25" r="20" style="stroke:#bf5af2"></circle></svg><div class="orb-val-box"><div class="orb-val" id="remVal">--</div></div></div>
            <div class="orb-label">REM</div>
        </div>
    </div>

    <div class="section-header"><span class="section-label">CARDIO STATUS</span></div>
    <div class="grid-4">
        <div class="orb-card">
            <div class="orb-container">
                <svg class="heart-svg beating" viewBox="0 0 24 24"><path class="heart-bg" d="M12 21.35l-1.45-1.32C5.4 15.36 2 12.28 2 8.5 2 5.42 4.42 3 7.5 3c1.74 0 3.41.81 4.5 2.09C13.09 3.81 14.76 3 16.5 3 19.58 3 22 5.42 22 8.5c0 3.78-3.4 6.86-8.55 11.54L12 21.35z" style="stroke:#ff453a; fill:rgba(255,69,58,0.2);"></path></svg>
                <div class="orb-val-box"><div class="orb-val" id="rhrVal">--</div></div>
            </div>
            <div class="orb-label">RHR</div>
        </div>
        <div class="orb-card">
            <div class="orb-container">
                <svg class="heart-svg" viewBox="0 0 24 24"><path class="heart-bg" d="M12 21.35l-1.45-1.32C5.4 15.36 2 12.28 2 8.5 2 5.42 4.42 3 7.5 3c1.74 0 3.41.81 4.5 2.09C13.09 3.81 14.76 3 16.5 3 19.58 3 22 5.42 22 8.5c0 3.78-3.4 6.86-8.55 11.54L12 21.35z"></path><path class="heart-fg" id="z2Heart" pathLength="100" d="M12 21.35l-1.45-1.32C5.4 15.36 2 12.28 2 8.5 2 5.42 4.42 3 7.5 3c1.74 0 3.41.81 4.5 2.09C13.09 3.81 14.76 3 16.5 3 19.58 3 22 5.42 22 8.5c0 3.78-3.4 6.86-8.55 11.54L12 21.35z" style="stroke:#00f0ff"></path></svg>
                <div class="orb-val-box"><div class="orb-val" id="z2Val">--</div></div>
            </div>
            <div class="orb-label">Z2</div>
        </div>
        <div class="orb-card">
            <div class="orb-container">
                <svg class="heart-svg" viewBox="0 0 24 24"><path class="heart-bg" d="M12 21.35l-1.45-1.32C5.4 15.36 2 12.28 2 8.5 2 5.42 4.42 3 7.5 3c1.74 0 3.41.81 4.5 2.09C13.09 3.81 14.76 3 16.5 3 19.58 3 22 5.42 22 8.5c0 3.78-3.4 6.86-8.55 11.54L12 21.35z"></path><path class="heart-fg" id="z5Heart" pathLength="100" d="M12 21.35l-1.45-1.32C5.4 15.36 2 12.28 2 8.5 2 5.42 4.42 3 7.5 3c1.74 0 3.41.81 4.5 2.09C13.09 3.81 14.76 3 16.5 3 19.58 3 22 5.42 22 8.5c0 3.78-3.4 6.86-8.55 11.54L12 21.35z" style="stroke:#FFD60A"></path></svg>
                <div class="orb-val-box"><div class="orb-val" id="z5Val">--</div></div>
            </div>
            <div class="orb-label">Z5</div>
        </div>
        <div class="orb-card">
            <div class="orb-container">
                <svg class="heart-svg" viewBox="0 0 24 24"><path class="heart-bg" d="M12 21.35l-1.45-1.32C5.4 15.36 2 12.28 2 8.5 2 5.42 4.42 3 7.5 3c1.74 0 3.41.81 4.5 2.09C13.09 3.81 14.76 3 16.5 3 19.58 3 22 5.42 22 8.5c0 3.78-3.4 6.86-8.55 11.54L12 21.35z"></path><path class="heart-fg" id="calHeart" pathLength="100" d="M12 21.35l-1.45-1.32C5.4 15.36 2 12.28 2 8.5 2 5.42 4.42 3 7.5 3c1.74 0 3.41.81 4.5 2.09C13.09 3.81 14.76 3 16.5 3 19.58 3 22 5.42 22 8.5c0 3.78-3.4 6.86-8.55 11.54L12 21.35z" style="stroke:#fff"></path></svg>
                <div class="orb-val-box"><div class="orb-val" id="calVal">--</div></div>
            </div>
            <div class="orb-label">CAL</div>
        </div>
    </div>

    <div class="section-header"><span class="section-label">PHYTONUTRIENT DIVERSITY</span></div>
    <div class="rainbow-container">
        <div style="display:flex; justify-content:space-between; font-size:0.6rem; color:#fff; font-weight:700;">
            <span>RAINBOW SCORE</span>
            <span id="rainbowScore">0%</span>
        </div>
        <div class="rainbow-track" id="rainbowTrack"></div>
        <div class="rainbow-meta">Anti-inflammatory + ApoB reduction</div>
    </div>

    <div class="section-label" style="margin-left:16px;">SYNERGY PROTOCOL</div>
    <div class="timeline-container" id="timelineList"></div>

    <div class="section-label" style="margin-left:16px;">MACRO TOTALS</div>
    <div class="grid-4" id="macroList"></div>

    <div class="ai-section">
        <div class="ai-card">
            <div style="color:#00f0ff; font-weight:900; font-size:0.7rem; margin-bottom:5px;">GEMINI COACH</div>
            <div id="aiOutput" style="font-size:0.7rem; line-height:1.5; color:#ddd; min-height:20px; margin-bottom:15px;">Ready.</div>
            <button class="ai-btn" onclick="centurion.runAI()">GENERATE COACHING</button>
        </div>
    </div>
</div>

<div id="bioModal" class="modal">
    <div class="modal-content">
        <div style="display:flex;justify-content:space-between;margin-bottom:20px;">
            <span style="color:#ccff00;font-weight:900;">BIOMARKERS</span>
            <span onclick="centurion.closeBio()" style="color:#666;cursor:pointer;">✕</span>
        </div>
        <div class="input-group"><label>VO2 Max</label><input id="in-vo2" type="number"></div>
        <div class="input-group"><label>ApoB (mg/dL)</label><input id="in-apob" type="number"></div>
        <div class="input-group"><label>Lp(a) (nmol/L)</label><input id="in-lpa" type="number"></div>
        <div class="input-group"><label>ANA Titer</label><input id="in-ana" type="text" placeholder="1:320"></div>
        <div class="input-group"><label>hs-CRP (mg/L)</label><input id="in-crp" type="number"></div>
        <button class="save-btn" onclick="centurion.saveBio()">SAVE</button>
    </div>
</div>

<div class="sync-footer">
    <div><span class="pulse"></span><span id="ouraBar">INIT</span></div>
    <div onclick="centurion.fetchData()" style="cursor:pointer">SYNC</div>
</div>
```

<script>
// MEAL DATABASE v15.2
{
  jermaine: {
    breakfast: [
      {
        id: 'jer_b1',
        name: 'Wild Salmon Power Bowl',
        quick: 'Salmon 8oz, 2 Eggs, Kale, Blueberries, Walnuts, Avocado',
        macros: {p:58, o:3500, poly:220, f:12},
        colors: ['orange','purple','green','white','yellow'],
        ingredients: [
          '8oz wild salmon fillet',
          '2 pasture-raised eggs',
          '2 cups kale (chopped)',
          '1 cup blueberries',
          '1oz walnuts (chopped)',
          '½ avocado (sliced)',
          '1 tsp EVOO',
          'Celtic salt, black pepper'
        ],
        steps: [
          'Heat EVOO in pan over medium heat',
          'Season salmon with salt, pepper. Cook 4min per side until flaky',
          'Scramble eggs in separate pan with salt',
          'Massage kale with pinch salt until tender',
          'Plate: kale base, top with salmon, eggs, avocado',
          'Add blueberries and walnuts on top'
        ],
        time: '15 min',
        why: 'Salmon = 3500mg omega-3. Eggs = choline for liver. Walnuts = plant omega-3. Blueberries = polyphenols'
      },
      {
        id: 'jer_b2',
        name: 'Mackerel Scramble Feast',
        quick: 'Mackerel 6oz, 2 Eggs, Spinach, Raspberries, Pecans, Avocado',
        macros: {p:56, o:4200, poly:200, f:14},
        colors: ['orange','red','green','white'],
        ingredients: [
          '6oz wild mackerel',
          '2 pasture-raised eggs',
          '2 cups spinach',
          '1 cup raspberries',
          '1oz pecans',
          '½ avocado',
          'Turmeric powder (1 tsp)',
          'EVOO, salt, pepper'
        ],
        steps: [
          'Sauté spinach in EVOO until wilted',
          'Add eggs, scramble with turmeric and pepper',
          'Cook mackerel separately 3min per side',
          'Plate eggs and spinach, top with mackerel',
          'Add avocado, raspberries, pecans'
        ],
        time: '12 min',
        why: 'Mackerel = 4200mg omega-3 (highest). Turmeric = curcumin. Raspberries = ellagitannins'
      },
      {
        id: 'jer_b3',
        name: 'Sardine Power Plate',
        quick: 'Sardines 4oz, 2 Eggs, Arugula, Blackberries, Almonds, Olive Oil',
        macros: {p:54, o:3200, poly:190, f:13},
        colors: ['orange','purple','green','white'],
        ingredients: [
          '4oz wild sardines (fresh or flash-frozen)',
          '2 pasture-raised eggs',
          '2 cups arugula',
          '1 cup blackberries',
          '1oz almonds',
          '2 tbsp EVOO',
          'Lemon juice (½ lemon)',
          'Garlic (2 cloves, minced)'
        ],
        steps: [
          'Heat 1 tbsp EVOO, sauté garlic 30sec',
          'Add sardines, cook 2min per side',
          'Scramble eggs with remaining EVOO',
          'Toss arugula with lemon juice',
          'Plate arugula, top with eggs, sardines',
          'Add blackberries and almonds'
        ],
        time: '10 min',
        why: 'Sardines = omega-3 + vitamin D. Arugula = nitrates. Almonds = vitamin E. EVOO = polyphenols'
      },
      {
        id: 'jer_b4',
        name: 'Smoked Salmon Stack',
        quick: 'Wild Salmon 8oz, 2 Eggs, Kale, Pomegranate, Walnuts',
        macros: {p:58, o:3500, poly:240, f:11},
        colors: ['orange','red','green','white'],
        ingredients: [
          '8oz wild salmon',
          '2 pasture-raised eggs (soft boiled)',
          '2 cups kale',
          '½ cup pomegranate seeds',
          '1oz walnuts',
          'Avocado oil (1 tsp)',
          'Fresh dill',
          'Lemon'
        ],
        steps: [
          'Boil eggs 6-7min for jammy yolks',
          'Pan-sear salmon in avocado oil 3min per side',
          'Massage kale until tender',
          'Slice eggs in half',
          'Layer: kale, salmon, eggs, pomegranate',
          'Top with walnuts and fresh dill'
        ],
        time: '14 min',
        why: 'Pomegranate = punicalagin (arterial protection). Dill = antioxidants. Soft eggs = easier digestion'
      },
      {
        id: 'jer_b5',
        name: 'Mediterranean Sunrise',
        quick: 'Salmon 6oz, 2 Eggs, Olives, Tomatoes, Feta, Arugula',
        macros: {p:55, o:3000, poly:210, f:10},
        colors: ['orange','red','green','white'],
        ingredients: [
          '6oz wild salmon',
          '2 pasture-raised eggs',
          '2 cups arugula',
          '10 kalamata olives',
          '½ cup cherry tomatoes',
          '2oz feta cheese',
          '2 tbsp EVOO',
          'Oregano, garlic'
        ],
        steps: [
          'Season salmon with oregano, garlic',
          'Grill salmon 4min per side',
          'Scramble eggs with feta',
          'Toss arugula with EVOO and tomatoes',
          'Plate arugula salad',
          'Top with salmon, eggs, olives'
        ],
        time: '13 min',
        why: 'Mediterranean = heart-healthy. Olives = polyphenols. Tomatoes = lycopene. Feta = calcium'
      }
    ],
    
    lunch: [
      {
        id: 'jer_l1',
        name: 'Mackerel Power Bowl',
        quick: 'Mackerel 6oz, Quinoa, Arugula, Beets, Olives, EVOO, Pomegranate',
        macros: {p:55, o:4200, poly:250, f:18},
        colors: ['red','green','white','purple'],
        ingredients: [
          '6oz wild mackerel',
          '1 cup cooked quinoa',
          '2 cups arugula',
          '1 cup roasted beets (diced)',
          '10 kalamata olives',
          '2 tbsp EVOO',
          '¼ cup pomegranate seeds',
          'Lemon juice, garlic'
        ],
        steps: [
          'Grill mackerel 3min per side',
          'Mix quinoa with dehydrated pulp powder',
          'Massage arugula with EVOO and lemon',
          'Plate quinoa as base',
          'Add arugula, beets, mackerel',
          'Top with olives and pomegranate'
        ],
        time: '12 min',
        why: 'Mackerel = 4200mg omega-3. Beets = nitrates. EVOO = polyphenols. Pomegranate = punicalagin'
      },
      {
        id: 'jer_l2',
        name: 'Salmon Nicoise Bowl',
        quick: 'Salmon 6oz, Green Beans, Eggs, Olives, Tomatoes, EVOO',
        macros: {p:58, o:3500, poly:220, f:16},
        colors: ['orange','green','red','white'],
        ingredients: [
          '6oz wild salmon',
          '2 cups green beans (blanched)',
          '2 hard-boiled eggs',
          '½ cup cherry tomatoes',
          '10 olives',
          '2 tbsp EVOO',
          'Dijon mustard (1 tsp)',
          'Capers (1 tbsp)'
        ],
        steps: [
          'Grill salmon 4min per side',
          'Blanch green beans 3min',
          'Slice hard-boiled eggs',
          'Make dressing: EVOO, mustard, capers',
          'Arrange beans, tomatoes, eggs on plate',
          'Top with salmon, drizzle dressing'
        ],
        time: '15 min',
        why: 'French-inspired. Green beans = fiber. Eggs = protein. Mustard = polyphenols'
      },
      {
        id: 'jer_l3',
        name: 'Sardine Superfood Salad',
        quick: 'Sardines 2 cans, Kale, Sweet Potato, Walnuts, Cranberries',
        macros: {p:52, o:3800, poly:230, f:20},
        colors: ['orange','green','purple','white'],
        ingredients: [
          '2 cans wild sardines',
          '2 cups kale (massaged)',
          '1 cup roasted sweet potato cubes',
          '1oz walnuts',
          '¼ cup dried cranberries (no sugar)',
          '2 tbsp EVOO',
          'Apple cider vinegar (1 tbsp)',
          'Dijon mustard'
        ],
        steps: [
          'Roast sweet potato cubes 20min at 400°F',
          'Massage kale until tender',
          'Make dressing: EVOO, vinegar, mustard',
          'Toss kale with sweet potato',
          'Top with sardines, walnuts, cranberries',
          'Drizzle with dressing'
        ],
        time: '25 min (mostly passive)',
        why: 'Sardines = omega-3 + calcium. Sweet potato = beta-carotene. Cranberries = proanthocyanidins'
      },
      {
        id: 'jer_l4',
        name: 'Tuna Poke Bowl',
        quick: 'Ahi Tuna 6oz, Brown Rice, Edamame, Avocado, Seaweed, Sesame',
        macros: {p:56, o:2800, poly:200, f:17},
        colors: ['red','green','white','purple'],
        ingredients: [
          '6oz sushi-grade ahi tuna (cubed)',
          '1 cup cooked brown rice',
          '½ cup edamame',
          '½ avocado (sliced)',
          'Nori seaweed (1 sheet, crumbled)',
          '1 tbsp sesame seeds',
          'Coconut aminos (2 tbsp)',
          'Lime juice, ginger'
        ],
        steps: [
          'Marinate tuna in coconut aminos, lime, ginger 10min',
          'Cook brown rice (or use pre-cooked)',
          'Steam edamame 5min',
          'Plate rice as base',
          'Add tuna, edamame, avocado',
          'Top with seaweed and sesame seeds'
        ],
        time: '15 min',
        why: 'Tuna = omega-3 + selenium. Edamame = plant protein. Seaweed = iodine. Sesame = lignans'
      },
      {
        id: 'jer_l5',
        name: 'Grilled Sardines Mediterranean',
        quick: 'Sardines 4oz, Farro, Roasted Peppers, Artichokes, Olives',
        macros: {p:50, o:3200, poly:240, f:19},
        colors: ['orange','red','green','white'],
        ingredients: [
          '4oz fresh sardines',
          '1 cup cooked farro',
          '½ cup roasted red peppers',
          '½ cup artichoke hearts',
          '10 olives',
          '2 tbsp EVOO',
          'Fresh parsley',
          'Lemon zest'
        ],
        steps: [
          'Grill sardines 2min per side',
          'Mix farro with dehydrated pulp',
          'Chop peppers and artichokes',
          'Toss farro with vegetables and EVOO',
          'Top with grilled sardines',
          'Garnish with parsley and lemon zest'
        ],
        time: '12 min',
        why: 'Farro = ancient grain (fiber). Peppers = vitamin C. Artichokes = cynarin (liver support)'
      }
    ],
    
    dinner: [
      {
        id: 'jer_d1',
        name: 'Wild Salmon Zen',
        quick: 'Salmon 8oz, Sweet Potato, Broccoli, Brussels, Fresh Herbs',
        macros: {p:60, o:4000, poly:200, f:16},
        colors: ['orange','green','white'],
        ingredients: [
          '8oz wild salmon',
          '1 medium Japanese sweet potato',
          '2 cups broccoli florets',
          '1 cup Brussels sprouts (halved)',
          'Fresh herbs (basil, cilantro)',
          '2 tbsp EVOO',
          'Dehydrated ginger-turmeric powder',
          'Garlic (4 cloves)'
        ],
        steps: [
          'Roast sweet potato 400°F for 30min',
          'Steam broccoli and Brussels 8min',
          'Season salmon with ginger-turmeric powder',
          'Pan-sear salmon 4min per side',
          'Sauté garlic in EVOO, toss with veggies',
          'Plate sweet potato, veggies, salmon, herbs'
        ],
        time: '35 min',
        why: 'Cruciferous = sulforaphane. Sweet potato = beta-carotene. Fresh herbs = antioxidants'
      },
      {
        id: 'jer_d2',
        name: 'Mackerel Asian Bowl',
        quick: 'Mackerel 8oz, Bok Choy, Shiitake, Brown Rice, Ginger',
        macros: {p:58, o:4200, poly:180, f:15},
        colors: ['orange','green','white'],
        ingredients: [
          '8oz wild mackerel',
          '2 cups bok choy (chopped)',
          '1 cup shiitake mushrooms',
          '1 cup brown rice',
          'Fresh ginger (2 tbsp grated)',
          'Garlic (3 cloves)',
          'Coconut aminos',
          'Sesame oil'
        ],
        steps: [
          'Cook brown rice (or pre-cooked)',
          'Sauté ginger and garlic in sesame oil',
          'Add bok choy and mushrooms, cook 5min',
          'Grill mackerel 3min per side',
          'Mix rice with dehydrated pulp',
          'Plate rice, veggies, mackerel, drizzle aminos'
        ],
        time: '20 min',
        why: 'Mackerel = max omega-3. Shiitake = beta-glucans. Bok choy = cruciferous. Ginger = anti-inflammatory'
      },
      {
        id: 'jer_d3',
        name: 'Mediterranean Salmon',
        quick: 'Salmon 8oz, Zucchini, Eggplant, Tomatoes, Olives, Feta',
        macros: {p:62, o:3800, poly:220, f:14},
        colors: ['orange','green','red','white'],
        ingredients: [
          '8oz wild salmon',
          '1 zucchini (sliced)',
          '1 cup eggplant (cubed)',
          '½ cup cherry tomatoes',
          '10 olives',
          '2oz feta cheese',
          '2 tbsp EVOO',
          'Fresh oregano, thyme'
        ],
        steps: [
          'Roast zucchini and eggplant 400°F for 20min',
          'Season salmon with oregano and thyme',
          'Grill salmon 4min per side',
          'Toss roasted veggies with tomatoes, EVOO',
          'Plate veggies, top with salmon',
          'Add olives and feta crumbles'
        ],
        time: '25 min',
        why: 'Mediterranean diet = heart health. Eggplant = nasunin. Feta = calcium. EVOO = polyphenols'
      },
      {
        id: 'jer_d4',
        name: 'Arctic Char Power Plate',
        quick: 'Arctic Char 8oz, Asparagus, Wild Rice, Lemon-Dill',
        macros: {p:60, o:3600, poly:190, f:16},
        colors: ['orange','green','white'],
        ingredients: [
          '8oz Arctic char fillet',
          '2 cups asparagus',
          '1 cup wild rice blend',
          'Fresh dill (¼ cup)',
          'Lemon (1 whole)',
          '2 tbsp EVOO',
          'Garlic (2 cloves)',
          'Capers (1 tbsp)'
        ],
        steps: [
          'Cook wild rice (or pre-cooked)',
          'Roast asparagus 400°F for 12min',
          'Pan-sear char skin-side down 3min, flip 2min',
          'Make sauce: EVOO, lemon juice, dill, capers',
          'Mix rice with dehydrated pulp',
          'Plate rice, asparagus, char, drizzle sauce'
        ],
        time: '20 min',
        why: 'Arctic char = omega-3 alternative. Asparagus = glutathione. Wild rice = fiber. Dill = antioxidants'
      },
      {
        id: 'jer_d5',
        name: 'Miso Glazed Salmon',
        quick: 'Salmon 8oz, Broccolini, Edamame, Brown Rice, Miso',
        macros: {p:64, o:3800, poly:210, f:17},
        colors: ['orange','green','white'],
        ingredients: [
          '8oz wild salmon',
          '2 cups broccolini',
          '½ cup edamame',
          '1 cup brown rice',
          'White miso paste (2 tbsp)',
          'Rice vinegar (1 tbsp)',
          'Sesame seeds',
          'Green onions'
        ],
        steps: [
          'Mix miso with vinegar, brush on salmon',
          'Bake salmon 400°F for 12min',
          'Steam broccolini and edamame 6min',
          'Cook brown rice',
          'Mix rice with dehydrated pulp powder',
          'Plate rice, veggies, salmon, top with sesame and onions'
        ],
        time: '18 min',
        why: 'Miso = probiotics. Broccolini = sulforaphane. Edamame = plant protein. Sesame = lignans'
      }
    ]
  },
  
  sophia: {
    breakfast: [
      {
        id: 'soph_b1',
        name: 'Fresh Halibut Sunrise',
        quick: 'Fresh Halibut 6oz, Kale, Blueberries, Avocado',
        macros: {p:46, o:1500, poly:180, f:12},
        colors: ['green','purple','yellow'],
        ingredients: [
          '6oz FRESH halibut (cooked today)',
          '2 cups kale (chopped)',
          '1 cup blueberries',
          '½ avocado (sliced)',
          '1 tsp EVOO',
          'Lemon juice',
          'Celtic salt'
        ],
        steps: [
          'Heat EVOO in pan over medium',
          'Season halibut with salt, cook 3min per side',
          'Massage kale with lemon until tender',
          'Plate kale as base',
          'Add halibut, blueberries, avocado'
        ],
        time: '10 min',
        why: 'FRESH fish only (low histamine). Kale not spinach (lower histamine). Blueberries = quercetin'
      },
      {
        id: 'soph_b2',
        name: 'Cod Power Bowl',
        quick: 'Fresh Cod 6oz, Kale, Blackberries, Coconut',
        macros: {p:44, o:1200, poly:160, f:13},
        colors: ['green','purple','white'],
        ingredients: [
          '6oz FRESH cod fillet',
          '2 cups kale',
          '1 cup blackberries',
          '¼ cup fresh coconut meat',
          'Coconut oil (1 tsp)',
          'Fresh basil',
          'Lemon'
        ],
        steps: [
          'Pan-sear cod in coconut oil 3min per side',
          'Massage kale until tender',
          'Chop fresh coconut',
          'Plate kale, top with cod',
          'Add blackberries, coconut, fresh basil'
        ],
        time: '12 min',
        why: 'Cod = low histamine protein. Coconut = anti-inflammatory MCTs. Basil = antihistamine'
      },
      {
        id: 'soph_b3',
        name: 'Sea Bass Mediterranean',
        quick: 'Fresh Sea Bass 6oz, Arugula, Cucumber, Blueberries',
        macros: {p:45, o:1400, poly:170, f:11},
        colors: ['green','purple','white'],
        ingredients: [
          '6oz FRESH sea bass',
          '2 cups arugula',
          '1 cup cucumber (diced)',
          '1 cup blueberries',
          'Fresh mint',
          '2 tbsp EVOO',
          'Lemon juice'
        ],
        steps: [
          'Grill sea bass 3min per side',
          'Toss arugula with cucumber, EVOO, lemon',
          'Plate arugula salad',
          'Top with sea bass and blueberries',
          'Garnish with fresh mint'
        ],
        time: '10 min',
        why: 'All low-histamine. Cucumber = cooling. Mint = cooling + antihistamine. Arugula = quercetin'
      },
      {
        id: 'soph_b4',
        name: 'Tilapia Tropical Bowl',
        quick: 'Fresh Tilapia 6oz, Kale, Mango, Coconut',
        macros: {p:42, o:1000, poly:150, f:12},
        colors: ['green','yellow','white'],
        ingredients: [
          '6oz FRESH tilapia',
          '2 cups kale',
          '½ cup fresh mango (diced)',
          '¼ cup coconut flakes',
          'Coconut oil',
          'Lime juice',
          'Fresh cilantro'
        ],
        steps: [
          'Pan-cook tilapia in coconut oil 3min per side',
          'Massage kale with lime juice',
          'Dice fresh mango',
          'Plate kale, tilapia, mango',
          'Top with coconut and cilantro'
        ],
        time: '12 min',
        why: 'Tilapia = mild low-histamine fish. Mango = vitamin C. Cilantro = antihistamine herb'
      },
      {
        id: 'soph_b5',
        name: 'Halibut Green Bowl',
        quick: 'Fresh Halibut 6oz, Kale, Cucumber, Green Apple',
        macros: {p:46, o:1500, poly:190, f:12},
        colors: ['green','yellow'],
        ingredients: [
          '6oz FRESH halibut',
          '2 cups kale',
          '1 cup cucumber slices',
          '1 green apple (sliced)',
          'Fresh mint',
          'EVOO',
          'Lemon'
        ],
        steps: [
          'Bake halibut 400°F for 10min',
          'Massage kale with EVOO and lemon',
          'Slice cucumber and apple thin',
          'Plate kale, cucumber, apple',
          'Top with halibut and fresh mint'
        ],
        time: '12 min',
        why: 'Maximum cooling ingredients. Apple = quercetin. Cucumber = hydration. Mint = cooling'
      }
    ],
    
    lunch: [
      {
        id: 'soph_l1',
        name: 'Fresh Chicken Quinoa Bowl',
        quick: 'Fresh Chicken 6oz, Quinoa, Arugula, Beets, Fresh Herbs',
        macros: {p:50, o:2000, poly:180, f:16},
        colors: ['green','white','yellow','red'],
        ingredients: [
          '6oz FRESH chicken breast (cooked today)',
          '1 cup quinoa',
          '2 cups arugula',
          '1 cup roasted beets',
          'Fresh basil and cilantro',
          'Cucumber (½ cup)',
          '2 tbsp EVOO',
          'Lemon juice'
        ],
        steps: [
          'Grill chicken 5min per side',
          'Cook quinoa, mix with dehydrated pulp',
          'Massage arugula with EVOO and lemon',
          'Dice cucumber',
          'Plate quinoa, arugula, beets, cucumber',
          'Top with chicken and fresh herbs'
        ],
        time: '15 min',
        why: 'FRESH chicken only (<24h). Basil/cilantro = antihistamine. Cucumber = cooling'
      },
      {
        id: 'soph_l2',
        name: 'Halibut Power Salad',
        quick: 'Fresh Halibut 6oz, Arugula, Apple, Beets, Pomegranate',
        macros: {p:48, o:1500, poly:200, f:15},
        colors: ['green','yellow','red','purple'],
        ingredients: [
          '6oz FRESH halibut',
          '2 cups arugula',
          '1 green apple (sliced)',
          '1 cup roasted beets',
          '¼ cup pomegranate seeds',
          '2 tbsp EVOO',
          'Fresh thyme',
          'Lemon'
        ],
        steps: [
          'Pan-sear halibut 3min per side',
          'Toss arugula with EVOO and lemon',
          'Slice apple thin',
          'Plate arugula, beets, apple',
          'Top with halibut and pomegranate',
          'Garnish with fresh thyme'
        ],
        time: '12 min',
        why: 'Apple = quercetin. Pomegranate = punicalagin. Thyme = antihistamine herb'
      },
      {
        id: 'soph_l3',
        name: 'Turkey Fresh Herb Bowl',
        quick: 'Fresh Turkey 6oz, Quinoa, Kale, Cucumber, Basil',
        macros: {p:52, o:1800, poly:170, f:17},
        colors: ['green','white'],
        ingredients: [
          '6oz FRESH turkey breast',
          '1 cup quinoa',
          '2 cups kale',
          '1 cup cucumber (diced)',
          'Fresh basil (large handful)',
          'Fresh mint',
          'EVOO',
          'Lime juice'
        ],
        steps: [
          'Grill turkey 6min per side',
          'Cook quinoa with dehydrated herb pulp',
          'Massage kale until tender',
          'Chop cucumber and fresh herbs',
          'Mix quinoa, kale, cucumber',
          'Top with turkey and herbs'
        ],
        time: '18 min',
        why: 'Turkey = low-histamine protein. Basil/mint = antihistamine. Cucumber = cooling'
      },
      {
        id: 'soph_l4',
        name: 'Cod Cooling Bowl',
        quick: 'Fresh Cod 6oz, White Rice, Cucumber, Celery, Mint',
        macros: {p:46, o:1200, poly:160, f:14},
        colors: ['green','white'],
        ingredients: [
          '6oz FRESH cod',
          '1 cup white rice',
          '1 cup cucumber (sliced)',
          '½ cup celery (diced)',
          'Fresh mint (large handful)',
          'Coconut oil',
          'Lime juice'
        ],
        steps: [
          'Steam cod 8min until flaky',
          'Cook white rice',
          'Chop cucumber and celery thin',
          'Mix rice with cucumber and celery',
          'Top with cod',
          'Garnish with fresh mint'
        ],
        time: '15 min',
        why: 'Maximum cooling. Celery = apigenin (mast cell stabilizer). Mint = cooling + antihistamine'
      },
      {
        id: 'soph_l5',
        name: 'Chicken Arugula Power',
        quick: 'Fresh Chicken 6oz, Arugula, Apple, Walnuts, Lemon',
        macros: {p:51, o:2200, poly:185, f:16},
        colors: ['green','yellow','white'],
        ingredients: [
          '6oz FRESH chicken breast',
          '2 cups arugula',
          '1 green apple (diced)',
          '1oz walnuts',
          '2 tbsp EVOO',
          'Fresh parsley',
          'Lemon juice',
          'Garlic (1 clove, minced)'
        ],
        steps: [
          'Grill chicken with garlic 5min per side',
          'Massage arugula with EVOO and lemon',
          'Dice apple',
          'Chop walnuts',
          'Toss arugula with apple and walnuts',
          'Top with sliced chicken and parsley'
        ],
        time: '14 min',
        why: 'Apple = quercetin (antihistamine). Walnuts = omega-3. Parsley = vitamin C'
      }
    ],
    
    dinner: [
      {
        id: 'soph_d1',
        name: 'Halibut Zen Bowl',
        quick: 'Fresh Halibut 6oz, White Rice, Broccoli, Zucchini, Basil',
        macros: {p:50, o:2000, poly:150, f:14},
        colors: ['green','white'],
        ingredients: [
          '6oz FRESH halibut',
          '1 cup white rice',
          '2 cups broccoli florets',
          '1 cup zucchini (sliced)',
          'Fresh basil (large handful)',
          'Fresh garlic (3 cloves)',
          'Coconut oil',
          'Lemon'
        ],
        steps: [
          'Steam broccoli and zucchini 8min',
          'Cook white rice',
          'Pan-sear halibut 3min per side',
          'Sauté garlic in coconut oil, toss with veggies',
          'Mix rice with dehydrated herb pulp',
          'Plate rice, veggies, halibut, top with basil'
        ],
        time: '18 min',
        why: 'Zucchini = cooling vegetable. Broccoli = vitamin C. Basil = antihistamine'
      },
      {
        id: 'soph_d2',
        name: 'Turkey Herb Medley',
        quick: 'Fresh Turkey 6oz, Quinoa, Kale, Cucumber, Fresh Herbs',
        macros: {p:52, o:1800, poly:160, f:15},
        colors: ['green','white'],
        ingredients: [
          '6oz FRESH turkey breast',
          '1 cup quinoa',
          '2 cups kale',
          '1 cup cucumber',
          'Fresh thyme, basil, cilantro',
          'EVOO',
          'Garlic',
          'Lemon'
        ],
        steps: [
          'Roast turkey 400°F for 20min',
          'Cook quinoa',
          'Steam kale 5min',
          'Dice cucumber',
          'Mix quinoa with kale and cucumber',
          'Slice turkey, top with fresh herbs'
        ],
        time: '25 min',
        why: 'Turkey = low-histamine. Multiple fresh herbs = antihistamine compounds. Cucumber = cooling'
      },
      {
        id: 'soph_d3',
        name: 'Cod Asian Bowl',
        quick: 'Fresh Cod 6oz, White Rice, Bok Choy, Ginger, Mint',
        macros: {p:48, o:1200, poly:140, f:14},
        colors: ['green','white'],
        ingredients: [
          '6oz FRESH cod',
          '1 cup white rice',
          '2 cups bok choy',
          'Fresh ginger (1 tbsp grated)',
          'Fresh mint',
          'Coconut aminos',
          'Sesame seeds',
          'Garlic'
        ],
        steps: [
          'Steam cod 8min',
          'Cook white rice',
          'Sauté ginger and garlic, add bok choy 5min',
          'Mix rice with bok choy',
          'Top with cod',
          'Garnish with mint and sesame'
        ],
        time: '15 min',
        why: 'Ginger = antihistamine. Bok choy = cruciferous. Mint = cooling. All low-histamine'
      },
      {
        id: 'soph_d4',
        name: 'Chicken Cooling Plate',
        quick: 'Fresh Chicken 6oz, White Rice, Cucumber, Celery, Parsley',
        macros: {p:50, o:2000, poly:155, f:13},
        colors: ['green','white'],
        ingredients: [
          '6oz FRESH chicken breast',
          '1 cup white rice',
          '1 cup cucumber (diced)',
          '1 cup celery (diced)',
          'Fresh parsley (large handful)',
          'Coconut oil',
          'Lemon juice',
          'Garlic'
        ],
        steps: [
          'Grill chicken 5min per side',
          'Cook white rice',
          'Dice cucumber and celery',
          'Mix rice with cucumber and celery',
          'Slice chicken',
          'Top with fresh parsley and lemon juice'
        ],
        time: '15 min',
        why: 'Maximum cooling. Celery = apigenin. Parsley = vitamin C + antihistamine. Cucumber = hydration'
      },
      {
        id: 'soph_d5',
        name: 'Sea Bass Herb Garden',
        quick: 'Fresh Sea Bass 6oz, Quinoa, Broccoli, Mixed Fresh Herbs',
        macros: {p:48, o:1600, poly:165, f:16},
        colors: ['green','white'],
        ingredients: [
          '6oz FRESH sea bass',
          '1 cup quinoa',
          '2 cups broccoli',
          'Fresh basil, cilantro, thyme, mint',
          'EVOO',
          'Garlic (3 cloves)',
          'Lemon zest'
        ],
        steps: [
          'Grill sea bass 3min per side',
          'Cook quinoa with dehydrated herb pulp',
          'Steam broccoli 8min',
          'Chop all fresh herbs',
          'Plate quinoa and broccoli',
          'Top with sea bass and herb mixture'
        ],
        time: '16 min',
        why: 'Multiple antihistamine herbs. Broccoli = vitamin C. Sea bass = low-histamine omega-3'
      }
    ]
  }
}


const TOKENS = { 'jermaine': 'WLIGFPFJQY73G43BY7CK7H6UJXPQ7N5Y', 'sophia': '4QSDWYJJUZFHRWRH727NCK7WH4COQJF4' };
const API_KEY = "AIzaSyBtqgUcbq5uVGFZ5nHPDyhthLDii7uRNrg";

const USERS = {
    jermaine: { name: "Jermaine", age: 42, condition: "HIGH LP(A)", goals: { pro: 180, omega3: 4000, poly: 600, fib: 45, z2: 45, z5: 25, cal: 800 } },
    sophia: { name: "Sophia", age: 38, condition: "HIGH ANA", goals: { pro: 130, omega3: 4000, poly: 600, fib: 45, z2: 60, z5: 15, cal: 600 } }
};

const PROTOCOL = [
    { id:'sunrise', time:'6:00', title:'Morning Activation', desc:'15min outdoor walk + cold shower', colors:[], macros:{p:0,o:0}, why:'Circadian reset reduces cortisol (ANA trigger) + cold activates brown fat (anti-inflammatory)' },
    { id:'hydrate', time:'6:30', title:'Hydration', desc:'Sea Moss (2 tbsp) + Lemon + Celtic Salt', colors:['green'], macros:{p:1,o:0,poly:50}, why:'Trace minerals support endothelium + electrolytes for VO2max training' },
    { id:'breakfast', time:'7:30', title:'Omega Breakfast', desc:'Wild Salmon 6oz, Avocado ½, Blueberries 1c, Walnuts 1oz, Spinach 2c, Turmeric milk', colors:['orange','purple','green','white'], macros:{p:50,o:2800,poly:220,f:12}, why:'Omega-3 lowers Lp(a) oxidation. Curcumin blocks NF-κB (ANA pathway). Polyphenols reduce arterial inflammation' },
    { id:'train', time:'9:00', title:'Partner Training', desc:'JER: 4x4min VO2max @95%HR. SOPH: Yoga flow during rest', colors:[], macros:{p:0,o:0}, why:'VO2max = arterial stiffness (Lp(a) protection). Yoga = mobility + cortisol reduction (autoimmune control)' },
    { id:'post', time:'10:00', title:'Recovery', desc:'Tart Cherry 8oz + Collagen 20g + Creatine 5g', colors:['red','purple'], macros:{p:20,o:0,poly:180}, why:'Anthocyanins cut CRP 25%. Collagen protects joints (autoimmune). Creatine for ATP' },
    { id:'lunch', time:'1:00', title:'Mediterranean Bowl', desc:'Sardines 2 cans, Quinoa 1c, Arugula 2c, Beets 1c, Olives 10, EVOO 2tbsp, Pomegranate', colors:['red','green','white','purple'], macros:{p:55,o:3500,poly:250,f:14}, why:'Sardines = max EPA/DHA for ApoB. Beets = arterial flex. Polyphenols block IL-6 (ANA)' },
    { id:'snack', time:'4:00', title:'Anti-Inflam Snack', desc:'Dark Choc 85% (2sq) + Matcha + Brazil Nuts (3)', colors:['green','white'], macros:{p:5,o:200,poly:180}, why:'Cocoa = endothelial function. Selenium modulates autoimmune. EGCG anti-inflam' },
    { id:'dinner', time:'6:30', title:'Omega Dinner', desc:'Wild Mackerel 8oz, Sweet Potato 1, Broccoli 2c, Garlic 3 cloves, Ginger 1tbsp, Turmeric', colors:['orange','green','white','yellow'], macros:{p:60,o:4200,poly:200,f:16}, why:'Mackerel 4x omega-3 vs salmon. Sulforaphane = Nrf2 (anti-inflam). Ginger blocks COX-2' },
    { id:'evening', time:'9:00', title:'Wind-Down', desc:'Magnesium 400mg + Ashwagandha 300mg + Tart Cherry + Blue blockers', colors:[], macros:{p:0,o:0}, why:'Mag lowers CRP. Ashwa cuts cortisol 28%. Melatonin for deep sleep = inflammation control' }
];

class CenturionCore {
    constructor() {
        this.user = localStorage.getItem('centurion_user') || 'jermaine';
        this.history = []; this.currentIndex = 0; this.checked = {}; this.bios = {};
        this.init();
    }
    async init() { this.loadLocalData(); this.updateUI(); await this.fetchData(); this.renderBio(); }
    loadLocalData() {
        this.checked = JSON.parse(localStorage.getItem(`c_checked_${this.user}`)) || {};
        this.bios = JSON.parse(localStorage.getItem(`c_bios_${this.user}`)) || {};
    }
    switchUser(u) {
        if(u === this.user) return;
        this.user = u; localStorage.setItem('centurion_user', u); this.wipeDashboard();
        document.querySelectorAll('.u-badge').forEach(b => b.classList.remove('active'));
        document.getElementById(`btn-${u}`).classList.add('active');
        this.history = []; this.currentIndex = 0; this.loadLocalData(); this.renderBio(); this.fetchData();
    }
    setText(id, val) { const el = document.getElementById(id); if(el) el.innerText = val; }
    wipeDashboard() {
        this.setText('dayGrade', "--"); this.setText('sleepVal', "--"); this.setText('deepVal', "--");
        this.setText('remVal', "--"); this.setText('rhrVal', "--"); this.setText('bioDisplay', "--");
        document.getElementById('timelineList').innerHTML = ""; document.getElementById('macroList').innerHTML = "";
        document.getElementById('rainbowTrack').innerHTML = ""; this.setText('rainbowScore', "0%");
        this.setText('statusMsg', "SWITCHING..."); 
        document.querySelectorAll('circle.orb-fg').forEach(el => el.style.strokeDashoffset = 145);
        document.querySelectorAll('path.heart-fg').forEach(el => el.style.strokeDashoffset = 100);
    }
    updateUI() {
        document.querySelectorAll('.u-badge').forEach(b => b.classList.remove('active'));
        document.getElementById(`btn-${this.user}`).classList.add('active');
        this.setText('userLabel', `USER: ${USERS[this.user].name.toUpperCase()}`);
    }
    async fetchData() {
        const bar = document.getElementById('ouraBar'); bar.innerText = "SYNCING...";
        const d = new Date(); d.setDate(d.getDate() + 1); const end = d.toISOString().split('T')[0];
        d.setDate(d.getDate() - 8); const start = d.toISOString().split('T')[0]; const ts = Date.now();
        try {
            const [sRes, rRes, aRes] = await Promise.all([
                fetch(`https://corsproxy.io/?${encodeURIComponent(`https://api.ouraring.com/v2/usercollection/sleep?start_date=${start}&end_date=${end}&t=${ts}`)}`, { headers: { 'Authorization': `Bearer ${TOKENS[this.user]}` }, cache: 'no-store' }),
                fetch(`https://corsproxy.io/?${encodeURIComponent(`https://api.ouraring.com/v2/usercollection/daily_readiness?start_date=${start}&end_date=${end}&t=${ts}`)}`, { headers: { 'Authorization': `Bearer ${TOKENS[this.user]}` }, cache: 'no-store' }),
                fetch(`https://corsproxy.io/?${encodeURIComponent(`https://api.ouraring.com/v2/usercollection/daily_activity?start_date=${start}&end_date=${end}&t=${ts}`)}`, { headers: { 'Authorization': `Bearer ${TOKENS[this.user]}` }, cache: 'no-store' })
            ]);
            if(!sRes.ok) throw new Error("API Error");
            const sJson = await sRes.json(), rJson = await rRes.json(), aJson = await aRes.json();
            let raw = sJson.data ? sJson.data.map(s => {
                const r = rJson.data?.find(x => x.day === s.day);
                const a = aJson.data?.find(x => x.day === s.day);
                return { date: s.day, score: r?.score || 0, totalSec: s.total_sleep_duration, deepSec: s.deep_sleep_duration,
                    remSec: s.rem_sleep_duration, rhr: r?.contributors?.resting_heart_rate || '-',
                    cal: a?.active_calories || 0, high: (a?.high_activity_time || 0)/60, med: (a?.medium_activity_time || 0)/60 };
            }).sort((a,b) => b.date.localeCompare(a.date)) : [];
            this.history = raw.filter(d => d.score > 0 || d.totalSec > 0);
            if(this.history.length > 0) { this.currentIndex = 0; bar.innerText = "UPDATED"; this.render(); }
            else { bar.innerText = "EMPTY"; this.renderEmpty(); }
        } catch(e) { bar.innerText = `ERR: ${e.message}`; console.error(e); }
    }
    changeDate(dir) {
        if(!this.history.length) return;
        const n = this.currentIndex - dir;
        if(n >= 0 && n < this.history.length) { this.currentIndex = n; this.render(); }
    }
    render() {
        if(!this.history.length) return this.renderEmpty();
        const d = this.history[this.currentIndex], h = Math.floor(d.totalSec/3600), m = Math.round((d.totalSec%3600)/60);
        this.setText('dateDisplay', d.date); this.setText('sleepVal', `${h}h ${m}m`);
        this.setText('deepVal', Math.round(d.deepSec/60)+"m"); this.setText('remVal', Math.round(d.remSec/60)+"m");
        this.setText('rhrVal', d.rhr); const g = USERS[this.user].goals;
        this.setText('z2Val', Math.round(d.med)); this.setText('z5Val', Math.round(d.high)); this.setText('calVal', d.cal);
        const uh = (id,val,goal) => { const e = document.getElementById(id); if(e) e.style.strokeDashoffset = 100-(Math.min(val/goal,1)*100); };
        uh('z2Heart', d.med, g.z2); uh('z5Heart', d.high, g.z5); uh('calHeart', d.cal, g.cal);
        const c = d.score >= 80 ? '#ccff00' : d.score >= 60 ? '#FFD60A' : '#ff453a';
        document.querySelector('.tactical-box').style.borderLeftColor = c;
        const u = USERS[this.user], s = d.score >= 85 ? `PEAK - ${u.condition} MANAGED` : d.score < 70 ? `RECOVERY - ${u.condition} RISK` : `${u.condition} PROTOCOL`;
        this.setText('statusMsg', s); this.renderGrade(d.score, h);
        document.getElementById('sleepOrb').style.strokeDashoffset = 145-(Math.min(d.totalSec/3600,9)/9)*145;
        document.getElementById('deepOrb').style.strokeDashoffset = 145-(Math.min(d.deepSec/3600,2)/2)*145;
        document.getElementById('remOrb').style.strokeDashoffset = 145-(Math.min(d.remSec/3600,2)/2)*145;
        this.renderComplex(d.date); this.renderBio();
    }
    renderEmpty() { this.setText('dateDisplay', "NO DATA"); this.setText('statusMsg', "SYNC"); this.wipeDashboard(); this.renderBio(); }
    renderGrade(sc, sl) {
        let gr = 'C', co = '#ff453a';
        if(sc >= 85 && sl >= 7) { gr = 'S'; co = '#ccff00'; }
        else if(sc >= 80 && sl >= 6.5) { gr = 'A'; co = '#00f0ff'; }
        else if(sc >= 70) { gr = 'B'; co = '#FFD60A'; }
        this.setText('dayGrade', gr); document.getElementById('dayGrade').style.color = co;
        document.querySelector('.grade-box').style.borderColor = co;
    }
    renderComplex(dk) {
        const done = this.checked[dk] || [], g = USERS[this.user].goals;
        let tot = {p:0,o:0,poly:0,f:0}, cols = new Set(), html = '';
        PROTOCOL.forEach(t => {
            const chk = done.includes(t.id);
            if(chk) { tot.p += t.macros.p||0; tot.o += t.macros.o||0; tot.poly += t.macros.poly||0; tot.f += t.macros.f||0; t.colors?.forEach(c => cols.add(c)); }
            html += `<div class="time-slot"><div class="ts-time">${t.time}</div><div class="ts-card ${chk?'checked':''}" onclick="centurion.toggleTask('${t.id}')">
                <div class="ts-title">${t.title}</div><div class="ts-desc">${t.desc}</div>
                ${t.why?`<div class="ts-why">WHY: ${t.why}</div>`:''}
                <div class="check-btn">${chk?'✓':''}</div></div></div>`;
        });
        document.getElementById('timelineList').innerHTML = html;
        const orb = (l,v,go,co) => `<div class="orb-card"><div class="orb-container"><svg class="orb-svg"><circle class="orb-bg" cx="25" cy="25" r="20"></circle>
            <circle class="orb-fg" cx="25" cy="25" r="20" style="stroke:${co}; stroke-dashoffset:${145-(Math.min(v/go,1)*145)}"></circle></svg>
            <div class="orb-val-box"><div class="orb-val">${v}</div></div></div><div class="orb-label">${l}</div></div>`;
        document.getElementById('macroList').innerHTML = orb('PROTEIN',tot.p,g.pro,'#fff')+orb('OMEGA-3',tot.o,g.omega3,'#00d4ff')+orb('POLY',tot.poly,g.poly,'#bf5af2')+orb('FIBER',tot.f,g.fib,'#30d158');
        this.setText('rainbowScore', Math.round(cols.size/6*100)+"%");
        const cb = {red:'#ff453a',orange:'#ff9f0a',yellow:'#ffd60a',green:'#30d158',purple:'#bf5af2',white:'#fff'};
        document.getElementById('rainbowTrack').innerHTML = ['red','orange','yellow','green','purple','white'].map(c => 
            `<div class="rainbow-seg" style="background:${cb[c]}; width:${cols.has(c)?'16.66%':'0%'}"></div>`).join('');
    }
    toggleTask(id) {
        if(!this.history.length) return;
        const dk = this.history[this.currentIndex].date;
        if(!this.checked[dk]) this.checked[dk] = [];
        const i = this.checked[dk].indexOf(id);
        i > -1 ? this.checked[dk].splice(i,1) : this.checked[dk].push(id);
        localStorage.setItem(`c_checked_${this.user}`, JSON.stringify(this.checked));
        this.renderComplex(dk);
    }
    async runAI() {
        if(!this.history.length) return;
        const d = this.history[this.currentIndex], ui = document.getElementById('aiOutput'), u = USERS[this.user];
        const p = `Coach ${u.name} (${u.condition}). Sleep ${(d.totalSec/3600).toFixed(1)}h, Score ${d.score}, Z2 ${Math.round(d.med)}min, Z5 ${Math.round(d.high)}min. ${u.condition==='HIGH LP(A)'?'ApoB via omega-3, VO2max for arteries':'ANA via anti-inflam, mobility'}. 1 action TODAY.`;
        ui.innerText = "Analyzing...";
        for(let m of ['gemini-1.5-flash-8b','gemini-2.0-flash-exp']) {
            try {
                const r = await fetch(`https://generativelanguage.googleapis.com/v1beta/models/${m}:generateContent?key=${API_KEY}`, {
                    method:'POST', headers:{'Content-Type':'application/json'}, body:JSON.stringify({contents:[{parts:[{text:p}]}]})
                });
                if(r.ok) { const j = await r.json(); if(j.candidates) { ui.innerText = j.candidates[0].content.parts[0].text; return; } }
            } catch(e) {}
        }
        ui.innerText = d.score >= 80 ? `${u.condition} managed. Execute VO2max.` : `Recovery. Z2 only.`;
    }
    openBio() {
        ['vo2','apob','lpa','ana','crp'].forEach(k => document.getElementById(`in-${k}`).value = this.bios[k]||'');
        document.getElementById('bioModal').classList.add('active');
    }
    closeBio() { document.getElementById('bioModal').classList.remove('active'); }
    saveBio() {
        this.bios = { vo2: document.getElementById('in-vo2').value, apob: document.getElementById('in-apob').value,
            lpa: document.getElementById('in-lpa').value, ana: document.getElementById('in-ana').value, crp: document.getElementById('in-crp').value };
        localStorage.setItem(`c_bios_${this.user}`, JSON.stringify(this.bios));
        this.closeBio(); this.renderBio();
    }
    renderBio() {
        const u = USERS[this.user]; let t = u.condition;
        if(u.condition === 'HIGH LP(A)' && this.bios.lpa) {
            t += ` • Lp(a): ${this.bios.lpa}`;
            document.querySelector('.tac-label').innerHTML = `USER: ${u.name.toUpperCase()} <span class="health-badge badge-lpa">LP(A)</span>`;
        } else if(u.condition === 'HIGH ANA' && this.bios.ana) {
            t += ` • ANA: ${this.bios.ana}`;
            document.querySelector('.tac-label').innerHTML = `USER: ${u.name.toUpperCase()} <span class="health-badge badge-ana">ANA</span>`;
        }
        if(this.bios.apob) t += ` • ApoB: ${this.bios.apob}`;
        if(this.bios.crp) t += ` • CRP: ${this.bios.crp}`;
        this.setText('bioDisplay', t);
    }
}
const centurion = new CenturionCore();
</script>

</body>
</html>