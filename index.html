<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no">
    <title>The Centurion | v15.3 SYNERGY</title>
    <link href="https://fonts.googleapis.com/css2?family=JetBrains+Mono:wght@400;700&family=Inter:wght@300;400;600;800;900&display=swap" rel="stylesheet">
    <style>
        :root {
            --bg: #000000; --panel: #0a0a0a; --border: #222; --acid: #ccff00; --cyan: #00f0ff;
            --gold: #FFD60A; --alert: #ff453a; --purple: #bf5af2; --text: #ffffff; --muted: #666;
            --font-ui: 'Inter', sans-serif; --font-data: 'JetBrains Mono', monospace;
        }
        * { box-sizing: border-box; -webkit-tap-highlight-color: transparent; }
        body { margin: 0; padding: 0 0 120px 0; background: var(--bg); color: var(--text); font-family: var(--font-ui); min-height: 100vh; background-image: radial-gradient(circle at top right, #111 0%, #000 70%); }

        .hud-header { padding: 15px 16px; background: rgba(0,0,0,0.95); position: sticky; top: 0; z-index: 100; border-bottom: 1px solid var(--border); }
        .top-bar { display: flex; justify-content: space-between; align-items: center; margin-bottom: 10px; }
        .app-name { font-size: 0.6rem; font-weight: 900; letter-spacing: 2px; color: var(--muted); }
        .user-switch { display: flex; gap: 4px; background: #222; padding: 2px; border-radius: 20px; }
        .u-badge { padding: 6px 14px; border-radius: 16px; font-size: 0.6rem; font-weight: 700; color: #666; background: transparent; border: none; cursor: pointer; transition: all 0.2s; }
        .u-badge.active { background: var(--text); color: #000; }
        .bio-btn { background: rgba(255,255,255,0.1); border: 1px solid var(--border); color: var(--muted); padding: 4px 8px; border-radius: 8px; font-size: 0.55rem; font-weight: 700; cursor: pointer; margin-right: 10px; }
        .date-nav { display: flex; justify-content: center; align-items: center; gap: 20px; font-family: var(--font-data); font-size: 0.8rem; font-weight: 700; color: #fff; padding-top: 10px; border-top: 1px solid #222; margin-top: 10px; }
        .nav-btn { background: transparent; border: 1px solid var(--border); color: var(--gold); padding: 8px 20px; border-radius: 4px; cursor: pointer; font-size: 0.8rem; font-weight: 900; }
        .date-display { min-width: 120px; text-align: center; letter-spacing: 1px; color: var(--acid); }
        
        .hero-section { padding: 20px 16px; display: flex; align-items: center; justify-content: space-between; }
        .grade-box { position: relative; width: 90px; height: 90px; display: flex; align-items: center; justify-content: center; border: 4px solid var(--border); border-radius: 50%; }
        .grade-val { font-family: var(--font-data); font-size: 2.5rem; font-weight: 900; color: #fff; }
        .grade-label { position: absolute; bottom: -20px; font-size: 0.5rem; font-weight: 700; color: var(--muted); }
        .tactical-box { flex: 1; margin-left: 20px; border-left: 3px solid var(--acid); padding: 10px; background: linear-gradient(90deg, rgba(255,255,255,0.03) 0%, transparent 100%); }
        .tac-label { font-size: 0.55rem; color: var(--acid); font-weight: 900; letter-spacing: 1px; margin-bottom: 4px; text-transform: uppercase; }
        .tac-cmd { font-size: 0.8rem; font-weight: 700; color: #fff; line-height: 1.3; }
        .tac-meta { font-family: var(--font-data); font-size: 0.55rem; color: var(--muted); margin-top: 4px; }
        
        .health-badge { display: inline-block; padding: 3px 8px; border-radius: 4px; font-size: 0.5rem; font-weight: 900; letter-spacing: 0.5px; margin-left: 8px; }
        .badge-lpa { background: rgba(255,69,58,0.2); border: 1px solid var(--alert); color: var(--alert); }
        .badge-ana { background: rgba(255,165,0,0.2); border: 1px solid #ff9f0a; color: #ff9f0a; }
        
        .section-header { display: flex; justify-content: space-between; align-items: center; margin: 25px 16px 10px; }
        .section-label { font-size: 0.55rem; font-weight: 900; color: var(--muted); letter-spacing: 1px; text-transform: uppercase; }
        .grid-3 { display: grid; grid-template-columns: 1fr 1fr 1fr; gap: 8px; padding: 0 16px; margin-bottom: 10px; }
        .grid-4 { display: grid; grid-template-columns: 1fr 1fr 1fr 1fr; gap: 8px; padding: 0 16px; margin-bottom: 10px; }
        
        .orb-card { background: var(--panel); border: 1px solid var(--border); border-radius: 12px; padding: 10px 5px; display: flex; flex-direction: column; align-items: center; position: relative; }
        .orb-container { width: 50px; height: 50px; position: relative; display: flex; align-items: center; justify-content: center; margin-bottom: 5px; }
        .orb-svg { transform: rotate(-90deg); width: 100%; height: 100%; }
        .orb-bg { fill: none; stroke: #222; stroke-width: 4; }
        .orb-fg { fill: none; stroke: var(--cyan); stroke-width: 4; stroke-dasharray: 145; stroke-dashoffset: 145; transition: stroke-dashoffset 1s ease; stroke-linecap: round; }
        
        .heart-svg { width: 100%; height: 100%; overflow: visible; }
        .heart-bg { fill: none; stroke: #222; stroke-width: 2; }
        .heart-fg { fill: none; stroke: var(--alert); stroke-width: 2; stroke-dasharray: 100; stroke-dashoffset: 100; transition: stroke-dashoffset 1s ease; }
        .beating { animation: heartbeat 1.5s infinite; transform-origin: center; }
        @keyframes heartbeat { 0% { transform: scale(1); } 15% { transform: scale(1.15); } 30% { transform: scale(1); } 45% { transform: scale(1.15); } 60% { transform: scale(1); } }
        
        .orb-val-box { position: absolute; text-align: center; }
        .orb-val { font-family: var(--font-data); font-size: 0.7rem; font-weight: 700; color: #fff; }
        .orb-label { font-size: 0.45rem; font-weight: 700; color: var(--muted); letter-spacing: 1px; text-transform: uppercase; margin-top: 4px; }
        
        .rainbow-container { padding: 0 16px; margin-bottom: 20px; }
        .rainbow-track { height: 6px; background: #222; border-radius: 3px; display: flex; overflow: hidden; margin-top: 8px; }
        .rainbow-seg { height: 100%; width: 0%; transition: width 0.5s ease; }
        .rainbow-meta { display: flex; justify-content: space-between; font-size: 0.55rem; color: #888; margin-top: 4px; }
        
        .timeline-container { padding: 0 16px; margin-bottom: 40px; }
        .time-slot { display: flex; gap: 12px; margin-bottom: 15px; position: relative; }
        .ts-time { width: 45px; font-family: var(--font-data); font-size: 0.7rem; color: var(--muted); text-align: right; padding-top: 5px; }
        .ts-card { flex: 1; background: var(--panel); border: 1px solid var(--border); border-radius: 12px; padding: 12px; position: relative; cursor: pointer; transition: all 0.2s; }
        .ts-title { font-size: 0.8rem; font-weight: 700; color: #fff; margin-bottom: 2px; }
        .ts-desc { font-size: 0.6rem; color: #888; line-height: 1.3; }
        .ts-why { font-size: 0.55rem; color: #666; margin-top: 4px; font-style: italic; line-height: 1.2; border-left: 2px solid var(--gold); padding-left: 8px; margin-top: 6px; }
        .check-btn { 
            position: absolute; 
            top: 8px; 
            right: 8px; 
            width: 32px; 
            height: 32px; 
            border-radius: 50%; 
            border: 2px solid #666; 
            background: rgba(255,255,255,0.05); 
            display: flex; 
            align-items: center; 
            justify-content: center; 
            font-weight: 800; 
            font-size: 0.9rem; 
            color: #000; 
            cursor: pointer;
            transition: all 0.15s;
            padding: 10px;
            z-index: 20;
            -webkit-tap-highlight-color: transparent;
            touch-action: manipulation;
        }
        .check-btn:active {
            transform: scale(0.95);
            background: rgba(204,255,0,0.2);
        }
        .check-btn:hover {
            border-color: var(--acid);
            background: rgba(204,255,0,0.1);
        }
        .ts-card.checked { border-color: var(--acid); background: rgba(204,255,0,0.05); }
        .ts-card.checked .check-btn { 
            background: var(--acid); 
            border-color: var(--acid); 
            border-width: 2px;
        }
        
        .meal-clickable { 
            cursor: pointer; 
            color: var(--acid) !important;
            transition: all 0.2s; 
        }
        .meal-clickable:hover { 
            color: #fff !important;
            text-decoration: underline;
        }
        
        .ai-section { padding: 16px; margin-bottom: 80px; }
        .ai-card { background: #080808; border: 1px solid #333; padding: 15px; border-radius: 12px; position: relative; }
        .ai-btn { width: 100%; padding: 12px; background: var(--acid); color: #000; font-weight: 900; border: none; border-radius: 6px; cursor: pointer; font-size: 0.7rem; }
        
        .sync-footer { position: fixed; bottom: 0; left: 0; width: 100%; background: #000; padding: 12px 16px; border-top: 1px solid var(--border); display: flex; justify-content: space-between; align-items: center; font-family: var(--font-data); font-size: 0.6rem; color: #555; z-index: 200; }
        .pulse { animation: pulse 2s infinite; display: inline-block; width: 6px; height: 6px; background: var(--acid); border-radius: 50%; margin-right: 6px; }
        @keyframes pulse { 0% { opacity: 1; } 50% { opacity: 0.3; } }
        
        .modal { display: none; position: fixed; top: 0; left: 0; width: 100%; height: 100%; background: rgba(0,0,0,0.95); z-index: 2000; padding: 20px; overflow-y: auto; }
        .modal.active { display: block; }
        .modal-content { background: var(--panel); border: 1px solid var(--acid); border-radius: 16px; padding: 20px; margin-top: 40px; max-height: 80vh; overflow-y: auto; }
        .input-group { margin-bottom: 15px; }
        .input-group label { display: block; font-size: 0.6rem; color: #888; margin-bottom: 5px; text-transform: uppercase; }
        .input-group input { width: 100%; background: #111; border: 1px solid #333; padding: 12px; color: #fff; font-family: var(--font-data); border-radius: 6px; }
        .save-btn { width: 100%; padding: 15px; background: var(--acid); color: #000; font-weight: 900; border: none; border-radius: 8px; cursor: pointer; }

        /* Cooking Modal Styles */
        .cooking-modal { 
            display: none; 
            position: fixed; 
            top: 0; 
            left: 0; 
            width: 100%; 
            height: 100%; 
            background: var(--bg); 
            z-index: 9999; 
            overflow-y: auto; 
            padding-bottom: 100px;
        }
        .cooking-modal.active { display: block; }
        .cooking-header { 
            padding: 20px 15px; 
            background: rgba(0,0,0,0.98); 
            border-bottom: 1px solid #222; 
            position: sticky; 
            top: 0; 
            z-index: 100; 
        }
        .back-btn { 
            background: #222; 
            border: none; 
            color: var(--acid); 
            padding: 8px 16px; 
            border-radius: 8px; 
            font-size: 0.7rem; 
            font-weight: 700; 
            cursor: pointer; 
            margin-bottom: 12px; 
        }
        .cook-title { 
            font-size: 1.2rem; 
            font-weight: 900; 
            color: #fff; 
            margin: 0 0 8px; 
        }
        .cook-meta { 
            display: flex; 
            gap: 15px; 
            font-size: 0.7rem; 
            color: #888; 
        }
        .macro-grid-cook { 
            display: grid; 
            grid-template-columns: repeat(3, 1fr); 
            gap: 10px; 
            padding: 20px 15px; 
            background: #0a0a0a; 
        }
        .macro-card-cook { 
            background: #000; 
            border: 1px solid #333; 
            border-radius: 12px; 
            padding: 15px 10px; 
            text-align: center; 
        }
        .macro-val-cook { 
            font-family: var(--font-data); 
            font-size: 1rem; 
            font-weight: 900; 
            color: var(--acid); 
        }
        .macro-lab-cook { 
            font-size: 0.5rem; 
            color: #666; 
            font-weight: 700; 
            margin-top: 4px; 
            text-transform: uppercase; 
        }
        .cook-section { 
            padding: 20px 15px; 
            border-bottom: 1px solid #111; 
        }
        .cook-sec-title { 
            font-size: 0.7rem; 
            font-weight: 900; 
            color: var(--acid); 
            margin: 0 0 15px; 
            text-transform: uppercase; 
        }
        .ing-list { 
            background: #0a0a0a; 
            border: 1px solid #222; 
            border-radius: 8px; 
            padding: 12px; 
        }
        .ing-item { 
            font-size: 0.75rem; 
            color: #ccc; 
            padding: 10px 0; 
            border-bottom: 1px solid #1a1a1a; 
        }
        .ing-item:last-child { border-bottom: none; }
        .step-list { 
            background: #0a0a0a; 
            border: 1px solid #222; 
            border-radius: 8px; 
            padding: 12px; 
        }
        .step-item { 
            display: flex; 
            gap: 15px; 
            padding: 15px 0; 
            border-bottom: 1px solid #1a1a1a; 
        }
        .step-item:last-child { border-bottom: none; }
        .step-num { 
            min-width: 36px; 
            height: 36px; 
            background: var(--acid); 
            color: #000; 
            border-radius: 50%; 
            display: flex; 
            align-items: center; 
            justify-content: center; 
            font-weight: 900; 
            font-size: 0.85rem; 
            flex-shrink: 0; 
        }
        .step-txt { 
            flex: 1; 
            font-size: 0.75rem; 
            color: #ccc; 
            line-height: 1.6; 
            padding-top: 6px; 
        }
        .tip-list { 
            background: rgba(204,255,0,0.05); 
            border: 1px solid rgba(204,255,0,0.2); 
            border-radius: 8px; 
            padding: 15px; 
        }
        .tip-item { 
            font-size: 0.7rem; 
            color: #ccc; 
            line-height: 1.6; 
            margin-bottom: 10px; 
        }
        .tip-item:last-child { margin-bottom: 0; }
        .why-box { 
            background: rgba(0,240,255,0.05); 
            border: 1px solid rgba(0,240,255,0.2); 
            border-radius: 8px; 
            padding: 15px; 
            font-size: 0.75rem; 
            color: #ccc; 
            line-height: 1.6; 
            font-style: italic; 
        }
        .cook-footer { 
            position: fixed; 
            bottom: 0; 
            left: 0; 
            width: 100%; 
            padding: 15px; 
            background: rgba(0,0,0,0.98); 
            border-top: 1px solid #222; 
            z-index: 200; 
        }
        .done-btn { 
            width: 100%; 
            padding: 15px; 
            background: var(--acid); 
            color: #000; 
            border: none; 
            border-radius: 8px; 
            font-size: 0.8rem; 
            font-weight: 900; 
            cursor: pointer; 
            margin-bottom: 8px;
        }
        .done-btn:last-child {
            margin-bottom: 0;
        }
        .change-meal-btn {
            background: #222; 
            color: var(--acid); 
            border: 1px solid var(--acid);
        }

        .bio-row {
            display: grid;
            grid-template-columns: 1fr 1fr;
            gap: 8px;
            margin-bottom: 12px;
        }
        .bio-col {
            display: flex;
            flex-direction: column;
        }
        .bio-col label {
            font-size: 0.6rem;
            color: #888;
            text-transform: uppercase;
            margin-bottom: 4px;
            font-weight: 700;
        }
        .target-box {
            background: rgba(255,255,255,0.03);
            border: 1px solid #333;
            border-radius: 6px;
            padding: 10px;
            font-family: var(--font-data);
            font-size: 0.75rem;
            color: #00d4ff;
            text-align: center;
        }
        .actual-input {
            background: var(--panel);
            border: 1px solid var(--border);
            color: #fff;
            padding: 10px;
            border-radius: 6px;
            font-size: 0.85rem;
            font-family: var(--font-data);
        }
        .actual-input:focus {
            outline: none;
            border-color: var(--acid);
        }
        .meal-dropdown {
    width: 100%;
    padding: 15px;
    background: #222;
    color: var(--acid);
    border: 1px solid var(--acid);
    border-radius: 8px;
    font-size: 0.8rem;
    font-weight: 700;
    font-family: var(--font-ui);
    margin-bottom: 8px;
    cursor: pointer;
}

.meal-dropdown:focus {
    outline: none;
    border-color: var(--cyan);
}
/* iOS-Style Picker */
.picker-overlay {
    position: fixed;
    top: 0;
    left: 0;
    width: 100%;
    height: 100%;
    background: rgba(0,0,0,0.5);
    z-index: 10000;
    display: flex;
    align-items: flex-end;
    animation: fadeIn 0.3s ease;
}

@keyframes fadeIn {
    from { opacity: 0; }
    to { opacity: 1; }
}

.picker-container {
    width: 100%;
    background: #1c1c1e;
    border-radius: 20px 20px 0 0;
    animation: slideUp 0.3s ease;
}

@keyframes slideUp {
    from { transform: translateY(100%); }
    to { transform: translateY(0); }
}

.picker-header {
    display: flex;
    justify-content: space-between;
    align-items: center;
    padding: 16px 20px;
    border-bottom: 1px solid #38383a;
}

.picker-title {
    font-size: 0.9rem;
    font-weight: 600;
    color: #fff;
    flex: 1;
    text-align: center;
}

.picker-cancel,
.picker-done {
    background: none;
    border: none;
    color: var(--cyan);
    font-size: 0.85rem;
    font-weight: 600;
    padding: 8px 12px;
    cursor: pointer;
}

.picker-done {
    color: var(--acid);
}

.picker-wheel {
    height: 280px;
    overflow-y: scroll;
    -webkit-overflow-scrolling: touch;
    scroll-snap-type: y mandatory;
    padding: 0;  /* ← Remove padding */
    position: relative;
}

.picker-option:first-child {
    margin-top: 110px;
}

.picker-option:last-child {
    margin-bottom: 110px;
}


/* Fade effect at top and bottom */
.picker-wheel::before,
.picker-wheel::after {
    content: '';
    position: absolute;
    display: block;
    left: 0;
    right: 0;
    height: 80px;
    z-index: 2;
    pointer-events: none;
}

.picker-wheel::before {
    top: 0;
    background: linear-gradient(to bottom, #1c1c1e 0%, #1c1c1e 30%, transparent 100%);
}

.picker-wheel::after {
    bottom: 0;
    background: linear-gradient(to top, #1c1c1e 0%, #1c1c1e 30%, transparent 100%);
}

.picker-option {
    padding: 0;  /* Remove all padding */
    height: 60px;
    line-height: 60px;  /* Match height for vertical centering */
    font-size: 0.85rem;
    color: #888;
    text-align: center;
    transition: all 0.15s ease;
    cursor: pointer;
    -webkit-tap-highlight-color: transparent;
    font-weight: 500;
    scroll-snap-align: center;
    overflow: hidden;
    white-space: nowrap;  /* Prevent wrapping for now */
    text-overflow: ellipsis;  /* Add ... if too long */
}

.picker-option.selected {
    color: #ccff00;
    font-weight: 800;
    font-size: 1rem;
    background: rgba(204,255,0,0.15);
    border-radius: 8px;
}

    </style>
</head>
<body>
    <div class="hud-header">
        <div class="top-bar">
            <div class="app-name">CENTURION v15.3 SYNERGY</div>
            <div style="display:flex; gap:10px;">
                <button onclick="centurion.openBio()" class="bio-btn">BIO</button>
                <div class="user-switch">
                    <button id="btn-jermaine" class="u-badge active" onclick="centurion.switchUser('jermaine')">JER</button>
                    <button id="btn-sophia" class="u-badge" onclick="centurion.switchUser('sophia')">SOPH</button>
                </div>
            </div>
        </div>
        <div class="date-nav">
            <button class="nav-btn" onclick="centurion.changeDate(-1)">◀</button>
            <span class="date-display" id="dateDisplay">LOADING...</span>
            <button class="nav-btn" onclick="centurion.changeDate(1)">▶</button>
        </div>
    </div>

    <div id="dashboard">
        <div class="hero-section">
            <div class="grade-box">
                <div class="grade-val" id="dayGrade">--</div>
                <div class="grade-label">DAY GRADE</div>
            </div>
            <div class="tactical-box">
                <div class="tac-label" id="userLabel">USER: --</div>
                <div class="tac-cmd" id="statusMsg">INITIALIZING...</div>
                <div class="tac-meta" id="bioDisplay">--</div>
            </div>
        </div>

        <div class="section-header"><span class="section-label">SLEEP ARCHITECTURE</span></div>
        <div class="grid-3">
            <div class="orb-card">
                <div class="orb-container"><svg class="orb-svg"><circle class="orb-bg" cx="25" cy="25" r="20"></circle><circle class="orb-fg" id="sleepOrb" cx="25" cy="25" r="20" style="stroke:#bf5af2"></circle></svg><div class="orb-val-box"><div class="orb-val" id="sleepVal">--</div></div></div>
                <div class="orb-label">TOTAL</div>
            </div>
            <div class="orb-card">
                <div class="orb-container"><svg class="orb-svg"><circle class="orb-bg" cx="25" cy="25" r="20"></circle><circle class="orb-fg" id="deepOrb" cx="25" cy="25" r="20" style="stroke:#007aff"></circle></svg><div class="orb-val-box"><div class="orb-val" id="deepVal">--</div></div></div>
                <div class="orb-label">DEEP</div>
            </div>
            <div class="orb-card">
                <div class="orb-container"><svg class="orb-svg"><circle class="orb-bg" cx="25" cy="25" r="20"></circle><circle class="orb-fg" id="remOrb" cx="25" cy="25" r="20" style="stroke:#bf5af2"></circle></svg><div class="orb-val-box"><div class="orb-val" id="remVal">--</div></div></div>
                <div class="orb-label">REM</div>
            </div>
        </div>

        <div class="section-header"><span class="section-label">CARDIO STATUS</span></div>
        <div class="grid-4">
            <div class="orb-card">
                <div class="orb-container">
                    <svg class="heart-svg beating" viewBox="0 0 24 24"><path class="heart-bg" d="M12 21.35l-1.45-1.32C5.4 15.36 2 12.28 2 8.5 2 5.42 4.42 3 7.5 3c1.74 0 3.41.81 4.5 2.09C13.09 3.81 14.76 3 16.5 3 19.58 3 22 5.42 22 8.5c0 3.78-3.4 6.86-8.55 11.54L12 21.35z" style="stroke:#ff453a; fill:rgba(255,69,58,0.2);"></path></svg>
                    <div class="orb-val-box"><div class="orb-val" id="rhrVal">--</div></div>
                </div>
                <div class="orb-label">RHR</div>
            </div>
            <div class="orb-card">
                <div class="orb-container">
                    <svg class="heart-svg" viewBox="0 0 24 24"><path class="heart-bg" d="M12 21.35l-1.45-1.32C5.4 15.36 2 12.28 2 8.5 2 5.42 4.42 3 7.5 3c1.74 0 3.41.81 4.5 2.09C13.09 3.81 14.76 3 16.5 3 19.58 3 22 5.42 22 8.5c0 3.78-3.4 6.86-8.55 11.54L12 21.35z"></path><path class="heart-fg" id="z2Heart" pathLength="100" d="M12 21.35l-1.45-1.32C5.4 15.36 2 12.28 2 8.5 2 5.42 4.42 3 7.5 3c1.74 0 3.41.81 4.5 2.09C13.09 3.81 14.76 3 16.5 3 19.58 3 22 5.42 22 8.5c0 3.78-3.4 6.86-8.55 11.54L12 21.35z" style="stroke:#00f0ff"></path></svg>
                    <div class="orb-val-box"><div class="orb-val" id="z2Val">--</div></div>
                </div>
                <div class="orb-label">Z2</div>
            </div>
            <div class="orb-card">
                <div class="orb-container">
                    <svg class="heart-svg" viewBox="0 0 24 24"><path class="heart-bg" d="M12 21.35l-1.45-1.32C5.4 15.36 2 12.28 2 8.5 2 5.42 4.42 3 7.5 3c1.74 0 3.41.81 4.5 2.09C13.09 3.81 14.76 3 16.5 3 19.58 3 22 5.42 22 8.5c0 3.78-3.4 6.86-8.55 11.54L12 21.35z"></path><path class="heart-fg" id="z5Heart" pathLength="100" d="M12 21.35l-1.45-1.32C5.4 15.36 2 12.28 2 8.5 2 5.42 4.42 3 7.5 3c1.74 0 3.41.81 4.5 2.09C13.09 3.81 14.76 3 16.5 3 19.58 3 22 5.42 22 8.5c0 3.78-3.4 6.86-8.55 11.54L12 21.35z" style="stroke:#FFD60A"></path></svg>
                    <div class="orb-val-box"><div class="orb-val" id="z5Val">--</div></div>
                </div>
                <div class="orb-label">Z5</div>
            </div>
            <div class="orb-card">
                <div class="orb-container">
                    <svg class="heart-svg" viewBox="0 0 24 24"><path class="heart-bg" d="M12 21.35l-1.45-1.32C5.4 15.36 2 12.28 2 8.5 2 5.42 4.42 3 7.5 3c1.74 0 3.41.81 4.5 2.09C13.09 3.81 14.76 3 16.5 3 19.58 3 22 5.42 22 8.5c0 3.78-3.4 6.86-8.55 11.54L12 21.35z"></path><path class="heart-fg" id="calHeart" pathLength="100" d="M12 21.35l-1.45-1.32C5.4 15.36 2 12.28 2 8.5 2 5.42 4.42 3 7.5 3c1.74 0 3.41.81 4.5 2.09C13.09 3.81 14.76 3 16.5 3 19.58 3 22 5.42 22 8.5c0 3.78-3.4 6.86-8.55 11.54L12 21.35z" style="stroke:#fff"></path></svg>
                    <div class="orb-val-box"><div class="orb-val" id="calVal">--</div></div>
                </div>
                <div class="orb-label">CAL</div>
            </div>
        </div>

        <div class="section-header"><span class="section-label">PHYTONUTRIENT DIVERSITY</span></div>
        <div class="rainbow-container">
            <div style="display:flex; justify-content:space-between; font-size:0.6rem; color:#fff; font-weight:700;">
                <span>RAINBOW SCORE</span>
                <span id="rainbowScore">0%</span>
            </div>
            <div class="rainbow-track" id="rainbowTrack"></div>
            <div class="rainbow-meta">Anti-inflammatory + ApoB reduction</div>
        </div>

        <div class="section-label" style="margin-left:16px;">SYNERGY PROTOCOL</div>
        <div class="timeline-container" id="timelineList"></div>

        <div class="section-label" style="margin-left:16px;">MACRO TOTALS</div>
        <div class="grid-4" id="macroList"></div>

        <div class="section-header">
            <div class="section-label">CALORIES</div>
        </div>
        <div class="grid-3" id="calorieGrid">
            <!-- Will be populated by JavaScript -->
        </div>

        <div class="ai-section">
            <div class="ai-card">
                <div style="color:#00f0ff; font-weight:900; font-size:0.7rem; margin-bottom:5px;">GEMINI COACH</div>
                <div id="aiOutput" style="font-size:0.7rem; line-height:1.5; color:#ddd; min-height:20px; margin-bottom:15px;">Ready.</div>
                <button class="ai-btn" onclick="centurion.runAI()">GENERATE COACHING</button>
            </div>
        </div>
    </div>

    <div id="bioModal" class="modal">
        <div class="modal-content">
            <div style="display:flex;justify-content:space-between;margin-bottom:20px;position:sticky;top:0;background:#0a0a0a;padding:10px 0;z-index:10;">
                <span style="color:#ccff00;font-weight:900;font-size:0.8rem;">BIOMARKER TRACKING</span>
                <span onclick="centurion.closeBio()" style="color:#666;cursor:pointer;font-size:1.5rem;">✕</span>
            </div>
            
            <div style="font-size:0.6rem;color:#888;margin-bottom:10px;text-transform:uppercase;font-weight:700;letter-spacing:1px;">Cardiovascular</div>
            <div class="input-group"><label>Lab Date</label><input id="in-cardio-date" type="date" style="color:#fff;"></div>
            
            <div class="bio-row">
                <div class="bio-col">
                    <label>Target</label>
                    <div class="target-box">&lt;80 mg/dL</div>
                </div>
                <div class="bio-col">
                    <label>ApoB (Actual)</label>
                    <input id="in-apob" type="number" class="actual-input" placeholder="Enter value">
                </div>
            </div>
            
            <div class="bio-row">
                <div class="bio-col">
                    <label>Target</label>
                    <div class="target-box">&lt;75 nmol/L</div>
                </div>
                <div class="bio-col">
                    <label>Lp(a) (Actual)</label>
                    <input id="in-lpa" type="number" class="actual-input" placeholder="Enter value">
                </div>
            </div>
            
            <div class="bio-row">
                <div class="bio-col">
                    <label>Target</label>
                    <div class="target-box">&lt;100 mg/dL</div>
                </div>
                <div class="bio-col">
                    <label>LDL-C (Actual)</label>
                    <input id="in-ldl" type="number" class="actual-input" placeholder="Enter value">
                </div>
            </div>

            <div style="font-size:0.6rem;color:#888;margin:20px 0 10px;text-transform:uppercase;font-weight:700;letter-spacing:1px;">Body Composition (InBody)</div>
            <div class="input-group"><label>InBody Test Date</label><input id="in-inbody-date" type="date" style="color:#fff;"></div>
            
            <div class="bio-row">
                <div class="bio-col">
                    <label>Target</label>
                    <div class="target-box">200-220 lbs</div>
                </div>
                <div class="bio-col">
                    <label>Weight (Actual)</label>
                    <input id="in-weight" type="number" step="0.1" class="actual-input" placeholder="Enter lbs">
                </div>
            </div>

            <div class="bio-row">
                <div class="bio-col">
                    <label>Target</label>
                    <div class="target-box">2000-2200 kcal</div>
                </div>
                <div class="bio-col">
                    <label>BMR (Actual)</label>
                    <input id="in-bmr" type="number" class="actual-input" placeholder="Enter kcal">
                </div>
            </div>
            
            <button class="save-btn" onclick="centurion.saveBio()">SAVE BIOMARKERS</button>
        </div>
    </div>

    <div class="sync-footer">
        <div><span class="pulse"></span><span id="ouraBar">INIT</span></div>
        <div onclick="centurion.fetchData()" style="cursor:pointer">SYNC</div>
    </div>

    <div id="cookingPage" class="cooking-modal"></div>

    <script>
// GLOBAL RECIPE DATABASE - 53 MEALS TOTAL (14 breakfast, 20 lunch, 19 dinner)
const RECIPE_DB = {
    breakfast: [
        // Fish-based breakfasts (4)
        {title:'Omega Breakfast',time:'15min',servings:1,macros:{protein:58,omega3:3500,poly:220,fiber:12,calories:680},ingredients:['8oz wild salmon','2 eggs','2 cups kale','1 cup blueberries','1oz walnuts','½ avocado','1 tsp EVOO','Salt, pepper'],steps:['Heat EVOO in pan','Season salmon','Cook salmon 4min per side','Scramble eggs separately','Massage kale 2min','Plate kale as base','Add salmon and eggs','Top with berries, nuts'],tips:['Buy wild-caught salmon','Massage kale until bright green','Don\'t overcook salmon'],why:'Salmon = 3500mg omega-3 to lower Lp(a). Eggs = choline. Walnuts = plant omega-3.'},
        
        {title:'Sardine Power Bowl',time:'10min',servings:1,macros:{protein:52,omega3:4500,poly:180,fiber:14,calories:620},ingredients:['2 cans wild sardines','3 eggs','2 cups spinach','1 cup cherry tomatoes','¼ red onion','2 tbsp EVOO','Lemon','Garlic'],steps:['Boil eggs 8min, peel','Sauté spinach with garlic','Halve tomatoes','Drain sardines','Plate spinach, add sardines','Top with eggs, tomatoes, onion','Dress with EVOO and lemon'],tips:['Choose sardines in water or EVOO','Spinach wilts fast - watch it','Cold eggs peel easier'],why:'Sardines = 4500mg omega-3 (highest of any food). Eggs = complete protein. Spinach = folate for homocysteine.'},
        
        {title:'Smoked Trout Hash',time:'18min',servings:1,macros:{protein:54,omega3:3200,poly:190,fiber:16,calories:640},ingredients:['6oz smoked trout','2 eggs','1 sweet potato','1 cup Brussels sprouts','½ red bell pepper','2 cloves garlic','2 tbsp EVOO','Dill'],steps:['Dice sweet potato small','Sauté sweet potato 10min','Add Brussels sprouts, cook 5min','Add bell pepper and garlic','Create wells, crack eggs','Cover until eggs set','Flake trout on top','Garnish with dill'],tips:['Smaller dice = faster cooking','Don\'t overcook eggs','Smoked trout is pre-cooked'],why:'Trout = 3200mg omega-3. Sweet potato = beta-carotene. Brussels sprouts = sulforaphane (Nrf2 activation).'},
        
        {title:'Mackerel Scramble',time:'12min',servings:1,macros:{protein:56,omega3:4800,poly:200,fiber:10,calories:660},ingredients:['1 can mackerel','4 eggs','1 cup arugula','½ avocado','1 cup mushrooms','Cherry tomatoes','2 tbsp EVOO','Turmeric'],steps:['Sauté mushrooms 5min','Drain mackerel, flake','Whisk eggs with turmeric','Scramble eggs with mackerel','Wilt arugula in pan','Plate with avocado and tomatoes'],tips:['Mackerel has 4x omega-3 vs salmon','Add turmeric to eggs for color','Fresh black pepper enhances turmeric'],why:'Mackerel = 4800mg omega-3 (absolute maximum). Turmeric = curcumin. Mushrooms = ergothioneine (longevity).'},
        
        // Sophia's Favorites - Oatmeal variations (3)
        {title:'Sophia\'s Omega Oatmeal ⭐',time:'10min',servings:1,macros:{protein:48,omega3:8200,poly:240,fiber:18,calories:580},ingredients:['1 cup steel-cut oats','2 scoops pea protein','3 tbsp ground flaxseed','2 tbsp hemp hearts','1 cup mixed berries','1 tbsp almond butter','Cinnamon','Almond milk'],steps:['Cook oats in almond milk 10min','Stir in pea protein','Top with flaxseed, hemp hearts','Add berries and almond butter','Sprinkle cinnamon'],tips:['Cook oats night before for quick morning','Pea protein mixes in easily','Fresh or frozen berries work'],why:'Flax = 6400mg omega-3. Pea protein = complete amino acids. Steel-cut oats = low glycemic. Sophia\'s favorite!'},
        
        {title:'Eggs & Oatmeal Combo',time:'12min',servings:1,macros:{protein:52,omega3:7800,poly:220,fiber:16,calories:640},ingredients:['½ cup steel-cut oats','2 tbsp ground flaxseed','3 eggs','1 cup spinach','½ avocado','Berries','Walnuts','EVOO'],steps:['Cook oats','Scramble eggs with spinach','Plate oatmeal with flax, berries, walnuts','Serve eggs on side with avocado'],tips:['Sweet + savory combination','Prep oats night before','Works great for weekend brunch'],why:'Best of both worlds. Flax omega-3 + egg choline. Sophia loves this combo!'},
        
        {title:'Savory Oatmeal Bowl',time:'15min',servings:1,macros:{protein:46,omega3:6400,poly:200,fiber:18,calories:620},ingredients:['1 cup steel-cut oats','3 tbsp ground flaxseed','2 eggs','1 cup kale','Mushrooms','Nutritional yeast','EVOO','Garlic','Black pepper'],steps:['Cook oats in vegetable broth','Sauté mushrooms and kale','Soft-boil eggs','Mix flaxseed into oats','Top with vegetables and eggs','Sprinkle nutritional yeast'],tips:['Savory twist on oatmeal','Nutritional yeast adds B12','Top with EVOO for richness'],why:'Flax = 6400mg omega-3. Savory oats are trending. Kale = vitamin K. Sophia enjoys variety!'},
        
        // Sophia's Favorites - Toast (1)
        {title:'Smoked Salmon Avocado Toast ⭐',time:'12min',servings:1,macros:{protein:54,omega3:3400,poly:200,fiber:14,calories:680},ingredients:['6oz smoked salmon','2 slices sprouted grain bread','1 avocado','2 eggs','Capers','Red onion','Lemon','Dill'],steps:['Toast bread','Mash avocado with lemon','Spread avocado on toast','Top with smoked salmon','Poach eggs 3min','Place eggs on salmon','Garnish capers, onion, dill'],tips:['Use Ezekiel bread for fiber','Fresh dill is key','Don\'t overcook eggs'],why:'Salmon = 3400mg omega-3. Avocado = monounsaturated fat. Sophia\'s go-to breakfast!'},
        
        // Plant-based high omega-3 (4)
        {title:'Flax Protein Parfait',time:'5min',servings:1,macros:{protein:48,omega3:8600,poly:240,fiber:18,calories:580},ingredients:['2 scoops pea protein','¼ cup ground flaxseed','1 cup Greek yogurt','1 cup mixed berries','2 tbsp hemp hearts','1 tbsp cacao nibs','Almond milk'],steps:['Layer yogurt in bowl','Mix in pea protein','Top with ground flax','Add berries, hemp hearts, cacao','Drizzle almond milk if needed'],tips:['Grind flax fresh for max omega-3','Pea protein > whey for this','Frozen berries work great'],why:'Flax = 8600mg omega-3 plant-based. Pea protein = complete. Greek yogurt = probiotics.'},
        
        {title:'Tofu Scramble Supreme',time:'12min',servings:1,macros:{protein:44,omega3:2800,poly:200,fiber:10,calories:580},ingredients:['14oz extra-firm tofu','2 cups spinach','1 cup mushrooms','Nutritional yeast','Turmeric','Black salt (kala namak)','2 tbsp ground flaxseed','EVOO','Garlic'],steps:['Press tofu, crumble','Sauté garlic in EVOO','Add mushrooms, cook 5min','Add crumbled tofu','Season with turmeric, black salt','Add spinach, wilt','Top with nutritional yeast and flax'],tips:['Black salt gives eggy flavor','Press tofu well for texture','Turmeric for color and health'],why:'Tofu = complete protein. Flax = omega-3. Black salt mimics egg taste. Turmeric = anti-inflammatory.'},
        
        {title:'Crispy Tofu & Kale Bowl',time:'20min',servings:1,macros:{protein:46,omega3:3400,poly:220,fiber:14,calories:640},ingredients:['14oz extra-firm tofu','2 cups kale','1 cup quinoa','2 tbsp ground flaxseed','2 tbsp hemp hearts','½ avocado','Tahini sauce','Sesame seeds'],steps:['Cook quinoa','Press and cube tofu','Bake tofu 20min at 400°F','Massage kale','Assemble bowl: quinoa, kale','Top with crispy tofu','Add flax, hemp, avocado','Drizzle tahini, sprinkle sesame'],tips:['Press tofu 30min for crispiest','Toss tofu in cornstarch before baking','Massage kale until tender'],why:'Tofu = complete protein. Flax + hemp = 3400mg omega-3. Quinoa = fiber. Tahini = calcium.'},
        
        {title:'Avocado Toast (Plant-Based)',time:'8min',servings:1,macros:{protein:42,omega3:8600,poly:260,fiber:18,calories:620},ingredients:['2 slices sprouted grain bread','1 avocado','3 tbsp ground flaxseed','2 tbsp hemp hearts','1oz walnuts','Cherry tomatoes','Nutritional yeast','Lemon','Red pepper flakes'],steps:['Toast bread','Mash avocado with lemon','Mix in ground flaxseed','Spread on toast','Top with hemp hearts, walnuts','Add sliced tomatoes','Sprinkle nutritional yeast','Season with red pepper flakes'],tips:['Grind flax fresh','Mix flax into avocado for creaminess','Sprouted bread is lower glycemic'],why:'Flax = 6400mg omega-3. Hemp + walnuts = 2200mg more. Avocado = monounsaturated fat. 100% plant-based!'},
        
        // NEW ADDITIONS
        {title:'Protein Pancakes',time:'15min',servings:1,macros:{protein:52,omega3:6400,poly:180,fiber:14,calories:620},ingredients:['2 scoops pea protein','3 tbsp ground flaxseed','2 eggs','½ cup oats','1 banana','Cinnamon','Almond milk','Greek yogurt (topping)','Berries','Maple syrup'],steps:['Blend oats into flour','Mix protein, flax, oat flour, cinnamon','Mash banana, add eggs, almond milk','Combine wet and dry','Heat griddle medium','Pour ¼ cup batter per pancake','Cook 2min per side','Stack and top with Greek yogurt, berries','Drizzle maple syrup'],tips:['Don\'t overmix batter - lumps are OK','Medium heat prevents burning','Flax adds omega-3 + helps bind','Make extra and freeze'],why:'Pea protein = complete amino acids. Flax = 6400mg omega-3. Oats = fiber + slow carbs. Banana = potassium. Perfect post-workout breakfast!'},

        {title:'PB Protein Shake',time:'5min',servings:1,macros:{protein:54,omega3:7200,poly:200,fiber:16,calories:680},ingredients:['2 scoops pea protein','3 tbsp ground flaxseed','2 tbsp natural peanut butter','1 banana','1 cup spinach','1 cup almond milk','Ice','Cinnamon','Optional: cacao nibs'],steps:['Add almond milk to blender','Add spinach (blends invisible)','Add banana, peanut butter','Add pea protein and flax','Add ice and cinnamon','Blend until smooth','Top with cacao nibs if desired'],tips:['Freeze banana for thicker shake','Spinach is tasteless but adds nutrients','Natural peanut butter only (no sugar)','Blend spinach first for smooth texture'],why:'Pea protein = 54g complete protein. Flax = 7200mg omega-3. Peanut butter = healthy fats + satiety. Spinach = folate. Quick, easy, nutrient-dense!'}
    ],
    
    lunch: [
        // NEW ADDITION
        {title:'Salmon Pesto Pasta',time:'20min',servings:1,macros:{protein:56,omega3:4200,poly:280,fiber:12,calories:740},ingredients:['6oz wild salmon','6oz chickpea pasta','Fresh basil pesto','Cherry tomatoes','Garlic','2 tbsp pine nuts','Parmesan','EVOO','Lemon','Arugula'],steps:['Cook chickpea pasta al dente','Season salmon','Pan-sear salmon 4min per side','Halve cherry tomatoes','Sauté garlic and tomatoes','Toss pasta with pesto','Flake salmon into pasta','Add arugula (wilts from heat)','Top with pine nuts, parmesan, lemon'],tips:['Chickpea pasta = high protein','Make pesto fresh if possible','Don\'t overcook salmon','Arugula adds peppery flavor'],why:'Salmon = 4200mg omega-3. Chickpea pasta = 14g protein per serving. Basil pesto = polyphenols. Pine nuts = additional healthy fats. High protein pasta dish!'},
        
        // Sophia's Favorites (6)
        {title:'Wild Salmon Poke Bowl ⭐',time:'15min',servings:1,macros:{protein:56,omega3:5200,poly:240,fiber:18,calories:720},ingredients:['8oz wild salmon (sushi-grade)','1 cup brown rice','1 cup edamame','1 avocado','Cucumber','Seaweed','Sesame seeds','Tamari','Ginger','Sriracha','Lime'],steps:['Cook brown rice','Cube raw salmon','Marinate in tamari, ginger, sesame','Steam edamame','Slice cucumber and avocado','Assemble bowl: rice base','Add salmon, edamame, cucumber','Top with avocado, seaweed, sesame','Drizzle sriracha, lime'],tips:['Must use sushi-grade salmon','Keep salmon cold until serving','Marinate only 5min','Fresh ginger is essential'],why:'Salmon = 5200mg omega-3. Edamame = plant protein. Seaweed = iodine. This is Sophia\'s #1 favorite!'},
        
        {title:'Chipotle Bowl (Bison) ⭐',time:'18min',servings:1,macros:{protein:58,omega3:2800,poly:200,fiber:20,calories:740},ingredients:['6oz bison (93% lean)','1 cup brown rice','Black beans','Fajita peppers','Romaine','Tomato salsa','Greek yogurt','Avocado','Lime','Cilantro','2 tbsp ground flaxseed'],steps:['Cook rice','Season bison with cumin, paprika','Grill bison 4min per side','Sauté peppers','Warm black beans','Chop romaine','Build bowl: rice, beans, bison','Top with peppers, salsa, yogurt','Add avocado, cilantro, lime','Sprinkle flaxseed on top'],tips:['Bison cooks fast - don\'t overcook','Greek yogurt > sour cream','Fresh salsa is best','Sophia\'s chipotle recreation!'],why:'Bison = lean protein, lower TMAO than beef. Flax = omega-3 boost. Greek yogurt = probiotics. Sophia\'s craving solved!'},
        
        {title:'Chipotle Bowl (Tofu) ⭐',time:'20min',servings:1,macros:{protein:46,omega3:3200,poly:220,fiber:22,calories:680},ingredients:['14oz extra-firm tofu','1 cup brown rice','Black beans','Fajita peppers','Romaine','Tomato salsa','Guacamole','Lime','Cilantro','2 tbsp ground flaxseed','Cumin','Paprika'],steps:['Cook rice','Press tofu, cube','Toss tofu with cumin, paprika','Bake tofu 25min at 400°F','Sauté peppers','Warm beans','Build bowl: rice, beans, crispy tofu','Top with peppers, salsa, guacamole','Add cilantro, lime','Mix in flaxseed'],tips:['Press tofu 30min','Crispy tofu is key','Guacamole > plain avocado','Plant-based chipotle option!'],why:'Tofu = complete protein. Flax = 3200mg omega-3. Black beans = fiber + resistant starch. Sophia\'s plant option!'},
        
        {title:'White Fish Ceviche ⭐',time:'15min',servings:1,macros:{protein:52,omega3:3200,poly:240,fiber:14,calories:640},ingredients:['8oz white fish (halibut, sea bass, or mahi)','Lime juice (6 limes)','Lemon juice (2 lemons)','Red onion','Jalapeño','Cilantro','Tomatoes','Cucumber','Avocado','Radishes','EVOO','Salt'],steps:['Dice fish into small cubes','Cover with lime and lemon juice','Refrigerate 20min (fish "cooks" in acid)','Dice all vegetables','Drain most citrus juice','Mix fish with vegetables','Add EVOO, salt','Serve with avocado on side'],tips:['Must use FRESH sushi-grade fish','Citrus "cooks" the fish','Don\'t over-marinate (gets mushy)','This is YOUR signature dish!'],why:'White fish = lean protein + omega-3. Citrus = vitamin C. Fresh vegetables = fiber. Your famous ceviche recipe!'},
        
        {title:'Salmon Ceviche ⭐',time:'15min',servings:1,macros:{protein:54,omega3:4800,poly:260,fiber:16,calories:700},ingredients:['8oz wild salmon (sushi-grade)','Lime juice (6 limes)','Lemon juice (2 lemons)','Red onion','Jalapeño','Cilantro','Cherry tomatoes','Cucumber','Avocado','Mango (optional)','EVOO','Salt'],steps:['Dice salmon into cubes','Cover with lime and lemon juice','Refrigerate 15min','Dice vegetables and mango','Drain most citrus','Mix salmon with vegetables','Add EVOO, salt','Top with avocado and cilantro'],tips:['Salmon version of your classic','Mango adds sweetness','Less marinate time than white fish','Sophia loves this variation!'],why:'Salmon = 4800mg omega-3. Citrus marinade = vitamin C. Avocado = healthy fat. Ceviche perfection!'},
        
        {title:'Bone Broth Pho (Salmon) ⭐',time:'15min',servings:1,macros:{protein:56,omega3:4200,poly:200,fiber:12,calories:680},ingredients:['32oz bone broth','6oz wild salmon','Rice noodles','Bok choy','Bean sprouts','Fresh basil','Cilantro','Lime','Jalapeño','Ginger','Star anise','Fish sauce'],steps:['Heat bone broth with ginger, star anise','Cook rice noodles separately','Slice salmon thin','Blanch bok choy','Pour hot broth over noodles','Add bok choy and raw salmon (cooks in broth)','Top with bean sprouts, herbs','Squeeze lime, add jalapeño'],tips:['Bone broth is the secret','Very hot broth cooks salmon','Fresh herbs are essential','Sophia\'s comfort food!'],why:'Bone broth = collagen + minerals. Salmon = 4200mg omega-3. Herbs = antioxidants. Vietnamese-inspired healing bowl!'},
        
        // Fish-based lunches (4)
        {title:'Mediterranean Bowl',time:'12min',servings:1,macros:{protein:55,omega3:4200,poly:250,fiber:18,calories:720},ingredients:['6oz mackerel','1 cup quinoa','2 cups arugula','1 cup beets','10 olives','2 tbsp EVOO','¼ cup pomegranate','Lemon, garlic'],steps:['Cook quinoa','Season mackerel','Grill mackerel 3min per side','Massage arugula with EVOO/lemon','Bowl: quinoa base','Add arugula','Add beets','Top with mackerel','Garnish olives & pomegranate'],tips:['Mackerel has 4x omega-3 vs salmon','Roast beets ahead','High-quality EVOO'],why:'Mackerel = 4200mg omega-3. Beets = nitrates. EVOO = polyphenols.'},
        
        {title:'Wild Salmon Buddha Bowl',time:'20min',servings:1,macros:{protein:52,omega3:3600,poly:220,fiber:16,calories:680},ingredients:['6oz wild salmon','1 cup brown rice','2 cups kale','1 cup edamame','½ cup red cabbage','1 carrot','2 tbsp tahini','Lemon','Ginger'],steps:['Cook brown rice','Steam edamame 5min','Massage kale with salt','Grate carrot','Bake salmon 15min at 400°F','Make tahini dressing (tahini, lemon, ginger)','Assemble bowl','Drizzle dressing'],tips:['Bake salmon with skin on','Massage kale until tender','Thin tahini with water'],why:'Salmon = 3600mg omega-3. Edamame = complete plant protein. Tahini = calcium + selenium.'},
        
        {title:'Sardine Salad Supreme',time:'8min',servings:1,macros:{protein:48,omega3:4400,poly:260,fiber:14,calories:640},ingredients:['2 cans sardines','4 cups mixed greens','1 cup cherry tomatoes','1 cucumber','¼ red onion','2 tbsp hemp hearts','2 tbsp EVOO','Red wine vinegar','Dijon mustard'],steps:['Wash and dry greens','Halve tomatoes','Slice cucumber','Dice onion','Drain sardines','Make dressing (EVOO, vinegar, Dijon)','Toss salad','Top with sardines and hemp hearts'],tips:['Pat sardines dry','Fresh greens are key','Make dressing in jar and shake'],why:'Sardines = 4400mg omega-3 + calcium. Hemp hearts = plant omega-3. Greens = folate for methylation.'},
        
        {title:'Anchovy Power Pasta',time:'18min',servings:1,macros:{protein:50,omega3:3800,poly:280,fiber:12,calories:720},ingredients:['4oz anchovies','6oz whole grain pasta','3 cups broccoli rabe','6 cloves garlic','Red pepper flakes','3 tbsp EVOO','Lemon zest','Parmesan'],steps:['Boil pasta','Blanch broccoli rabe 2min','Sauté garlic in EVOO','Add anchovies (they dissolve)','Add pepper flakes','Toss pasta with anchovy sauce','Add broccoli rabe','Top with lemon zest and parmesan'],tips:['Anchovies melt into sauce','Don\'t overcook broccoli rabe','Save pasta water for sauce'],why:'Anchovies = 3800mg omega-3. Broccoli rabe = sulforaphane. Garlic = allicin (cardiovascular protection).'},
        
        // Plant-based + legume lunches (5)
        {title:'Chickpea "Tuna" Salad',time:'10min',servings:1,macros:{protein:42,omega3:3800,poly:240,fiber:18,calories:620},ingredients:['1 can chickpeas','1 can sardines (optional)','Celery','Red onion','Dijon mustard','Greek yogurt','2 tbsp ground flaxseed','Dill','Lemon','Mixed greens'],steps:['Mash chickpeas with fork','Dice celery and onion','Mix with mustard, yogurt, flax','Add dill and lemon','Option: mix in drained sardines','Serve over mixed greens'],tips:['Can be plant-based or add sardines','Greek yogurt > mayo','Flax adds omega-3 + texture','Great for meal prep'],why:'Chickpeas = protein + fiber. Sardines (optional) = 3800mg omega-3. Flax = plant omega-3. Versatile recipe!'},
        
        {title:'Mediterranean Lentil Salad',time:'15min',servings:1,macros:{protein:38,omega3:2800,poly:220,fiber:20,calories:580},ingredients:['1 cup cooked lentils','Cucumber','Cherry tomatoes','Red onion','Kalamata olives','Feta cheese','2 tbsp ground flaxseed','EVOO','Red wine vinegar','Fresh oregano'],steps:['Cook lentils if needed','Dice all vegetables','Combine lentils and vegetables','Add olives and feta','Whisk EVOO, vinegar, oregano','Toss salad','Top with ground flaxseed'],tips:['Use French green lentils - hold shape better','Make big batch for week','Feta is optional for plant-based','Gets better overnight'],why:'Lentils = protein + fiber + resistant starch. Flax = 2800mg omega-3. EVOO = polyphenols. Mediterranean diet staple!'},
        
        {title:'Red Lentil Curry',time:'25min',servings:1,macros:{protein:36,omega3:2400,poly:200,fiber:18,calories:620},ingredients:['1 cup red lentils','1 can coconut milk','2 cups spinach','Tomatoes','Curry powder','Turmeric','Ginger','Garlic','2 tbsp ground flaxseed','Brown rice','Cilantro'],steps:['Cook rice','Sauté garlic, ginger, spices','Add lentils and coconut milk','Simmer 20min until thick','Add spinach, wilt','Stir in flaxseed','Serve over rice','Top with cilantro'],tips:['Red lentils cook fast','Full-fat coconut milk','Add more water if too thick','Make double batch - freezes well'],why:'Lentils = plant protein + fiber. Coconut = MCTs. Turmeric = anti-inflammatory. Flax = omega-3 boost.'},
        
        {title:'Black Bean & Sweet Potato Tacos',time:'20min',servings:1,macros:{protein:34,omega3:2200,poly:180,fiber:22,calories:620},ingredients:['1 can black beans','1 sweet potato','Corn tortillas','Purple cabbage slaw','Avocado','Greek yogurt','Lime','Cilantro','2 tbsp ground flaxseed','Cumin','Paprika'],steps:['Roast cubed sweet potato 20min','Warm black beans with spices','Make cabbage slaw','Warm tortillas','Assemble: beans, sweet potato','Top with slaw, avocado, yogurt','Sprinkle flaxseed','Squeeze lime, add cilantro'],tips:['Roast sweet potato until caramelized','Fresh cabbage slaw is key','Greek yogurt > sour cream','Flax adds omega-3'],why:'Black beans = protein + resistant starch. Sweet potato = beta-carotene. Flax = 2200mg omega-3. Fiber-rich!'},
        
        {title:'White Bean & Kale Soup',time:'20min',servings:1,macros:{protein:32,omega3:1800,poly:160,fiber:18,calories:540},ingredients:['1 can white beans','3 cups kale','Vegetable broth','Tomatoes','Garlic','Fresh rosemary','2 tbsp ground flaxseed','EVOO','Parmesan','Lemon'],steps:['Sauté garlic in EVOO','Add rosemary','Add broth and tomatoes','Add white beans','Simmer 10min','Add kale, cook 5min','Stir in flaxseed','Top with parmesan and lemon'],tips:['Great Northern or cannellini beans','Don\'t overcook kale','Add flax at end','Freezes beautifully'],why:'White beans = protein + fiber. Kale = vitamin K. Flax = omega-3. Rosemary = antioxidants. Comforting and healthy!'},
        
        // Tofu + Bone Broth variations (4)
        {title:'Bone Broth Pho (Tofu) ⭐',time:'15min',servings:1,macros:{protein:44,omega3:2800,poly:200,fiber:14,calories:620},ingredients:['32oz bone broth','14oz extra-firm tofu','Rice noodles','Bok choy','Bean sprouts','Fresh basil','Cilantro','Lime','Jalapeño','Ginger','Star anise','Tamari','2 tbsp ground flaxseed'],steps:['Heat bone broth with ginger, star anise','Cook rice noodles','Press and cube tofu','Blanch bok choy','Pour hot broth over noodles','Add bok choy and tofu','Top with bean sprouts, herbs, flax','Squeeze lime, add jalapeño'],tips:['Bone broth = collagen even with tofu','Can pan-fry tofu first for texture','Fresh herbs make it','Sophia loves this version too!'],why:'Bone broth = collagen + minerals. Tofu = complete protein. Flax = omega-3. Herbs = antioxidants. Best of both worlds!'},
        
        {title:'Bone Broth Pho (Shrimp)',time:'12min',servings:1,macros:{protein:48,omega3:1800,poly:180,fiber:10,calories:580},ingredients:['32oz bone broth','8oz shrimp','Rice noodles','Bok choy','Bean sprouts','Fresh basil','Cilantro','Lime','Jalapeño','Ginger','Star anise','Fish sauce'],steps:['Heat bone broth with ginger, star anise','Cook rice noodles','Blanch bok choy','Pour hot broth over noodles','Add bok choy and raw shrimp (cooks in broth)','Top with bean sprouts, herbs','Squeeze lime, add jalapeño'],tips:['Shrimp cooks in 2min in hot broth','Limit shrimp to 1x/week max','Bone broth is the star','Quick and delicious'],why:'Bone broth = collagen. Shrimp = lean protein. Herbs = antioxidants. Vietnamese-inspired. Limit to 1x/week!'},
        
        {title:'Tofu Banh Mi Bowl',time:'18min',servings:1,macros:{protein:42,omega3:3200,poly:220,fiber:16,calories:640},ingredients:['14oz extra-firm tofu','Brown rice','Pickled carrots & daikon','Cucumber','Jalapeño','Cilantro','Sriracha','2 tbsp ground flaxseed','Tamari','Lime'],steps:['Cook rice','Press tofu, slice','Marinate tofu in tamari','Bake tofu 25min at 400°F','Quick-pickle carrots (vinegar, sugar)','Slice cucumber and jalapeño','Build bowl: rice, crispy tofu','Top with pickled veggies, cucumber','Add cilantro, flax, sriracha, lime'],tips:['Press tofu well','Quick pickles in 10min','Sriracha is essential','Vietnamese flavors without bread'],why:'Tofu = complete protein. Flax = 3200mg omega-3. Pickled vegetables = probiotics. Banh mi as a bowl!'}
    ],
    
    dinner: [
        // NEW ADDITIONS
        {title:'Whole Branzino',time:'25min',servings:1,macros:{protein:58,omega3:3800,poly:220,fiber:14,calories:720},ingredients:['1 whole branzino (Mediterranean sea bass)','Fresh herbs (parsley, thyme, oregano)','Lemon slices','Garlic cloves','EVOO','Roasted vegetables (fennel, tomatoes, olives)','Arugula','White wine','Salt, pepper'],steps:['Preheat oven 425°F','Score fish skin 3 times each side','Stuff cavity with herbs, lemon, garlic','Drizzle EVOO, season salt/pepper','Roast fennel and tomatoes with olives','Place fish on vegetables','Add splash of white wine','Roast 20min until flesh is opaque','Serve over arugula bed','Drizzle pan juices'],tips:['Ask fishmonger to clean and scale','Skin should be crispy','Eyes turn white when done','Meat should flake easily','Mediterranean classic'],why:'Branzino = 3800mg omega-3, lean protein. Whole fish = collagen from bones. Fennel = fiber. Mediterranean diet staple. Restaurant-quality at home!'},

        {title:'Bison Bolognese Pasta',time:'35min',servings:1,macros:{protein:62,omega3:2800,poly:240,fiber:18,calories:780},ingredients:['6oz ground bison','6oz chickpea pasta','Crushed tomatoes','Onion','Carrots','Celery','Garlic','Red wine','2 tbsp ground flaxseed','Fresh basil','Parmesan','EVOO'],steps:['Dice onion, carrots, celery (soffritto)','Sauté soffritto in EVOO until soft','Add ground bison, brown','Add garlic','Deglaze with red wine','Add crushed tomatoes','Simmer 25min','Cook chickpea pasta','Stir flax into sauce','Toss pasta with bolognese','Top with basil and parmesan'],tips:['Soffritto is the flavor base','Low simmer for rich sauce','Bison is leaner than beef','Chickpea pasta holds up to sauce','Make double batch - freezes well'],why:'Bison = lean protein, lower TMAO than beef. Chickpea pasta = extra protein + fiber. Flax = 2800mg omega-3 boost. Vegetables = nutrients. Hearty, satisfying, high-protein!'},
        
        // Fish dinners (5)
        {title:'Omega Dinner',time:'35min',servings:1,macros:{protein:60,omega3:4000,poly:200,fiber:16,calories:750},ingredients:['8oz salmon','1 sweet potato','2 cups broccoli','1 cup Brussels sprouts','Fresh herbs','2 tbsp EVOO','Garlic','Turmeric powder','Salt, pepper'],steps:['Preheat oven 400°F','Wrap sweet potato in foil','Roast 30min','Steam vegetables 8min','Season salmon with turmeric','Pan-sear 4min per side','Sauté garlic in EVOO','Toss vegetables','Plate together','Top with herbs'],tips:['Japanese sweet potatoes','Keep vegetables bright green','Fresh herbs > dried'],why:'Omega-3 fights inflammation. Cruciferous = sulforaphane. Sweet potato = beta-carotene.'},
        
        {title:'Mackerel Curry',time:'30min',servings:1,macros:{protein:58,omega3:4600,poly:280,fiber:18,calories:780},ingredients:['8oz mackerel','1 can coconut milk','2 cups cauliflower','1 cup green beans','1 sweet potato','Curry paste','Turmeric','Ginger','Garlic','Lime'],steps:['Dice sweet potato','Sauté curry paste, turmeric, ginger','Add coconut milk','Simmer sweet potato 15min','Add cauliflower and green beans','Cook 10min','Add mackerel last 5min','Finish with lime'],tips:['Don\'t overcook mackerel','Full-fat coconut milk','Fresh ginger is key'],why:'Mackerel = 4600mg omega-3. Coconut = MCTs. Turmeric + black pepper = 2000% more curcumin absorption.'},
        
        {title:'Trout Almondine',time:'25min',servings:1,macros:{protein:56,omega3:3400,poly:240,fiber:14,calories:720},ingredients:['2 rainbow trout fillets','½ cup sliced almonds','2 cups asparagus','1 cup wild rice','Fresh parsley','Lemon','3 tbsp butter','Garlic','Capers'],steps:['Cook wild rice','Trim asparagus','Toast almonds in dry pan','Sauté garlic in butter','Add capers','Pan-fry trout 4min per side','Roast asparagus 12min at 425°F','Plate with almond-caper butter'],tips:['Pat trout very dry','Watch almonds - they burn fast','Save caper brine for dressing'],why:'Trout = 3400mg omega-3. Almonds = vitamin E (antioxidant). Asparagus = glutathione precursor.'},
        
        {title:'Sardine Shakshuka',time:'28min',servings:1,macros:{protein:52,omega3:4200,poly:300,fiber:16,calories:680},ingredients:['2 cans sardines','4 eggs','1 can crushed tomatoes','1 red bell pepper','1 yellow onion','3 cloves garlic','Cumin','Paprika','Cayenne','Feta','Parsley','EVOO'],steps:['Sauté onion and pepper','Add garlic and spices','Add crushed tomatoes','Simmer 15min','Make 4 wells','Crack eggs into wells','Add drained sardines','Cover until eggs set','Top with feta and parsley'],tips:['Don\'t stir after adding eggs','Low heat for eggs','Serve with crusty bread'],why:'Sardines = 4200mg omega-3 + calcium. Eggs = choline. Tomatoes = lycopene (cardiovascular protection).'},
        
        {title:'Black Cod Miso',time:'40min',servings:1,macros:{protein:54,omega3:3800,poly:220,fiber:12,calories:740},ingredients:['8oz black cod','3 tbsp white miso','2 tbsp mirin','1 tbsp sake','Ginger','2 cups bok choy','1 cup shiitake','Soba noodles','Sesame oil','Scallions'],steps:['Marinate cod (miso, mirin, sake, ginger) 30min','Cook soba noodles','Sauté shiitake in sesame oil','Blanch bok choy','Broil cod 8min','Assemble bowl: noodles, vegetables','Top with miso cod','Garnish scallions'],tips:['Marinate cod overnight for best flavor','Watch broiler - miso burns','Black cod = butterfish'],why:'Black cod = 3800mg omega-3 (richest white fish). Miso = probiotics. Shiitake = immune support (beta-glucans).'},
        
        // Bison dinners (5)
        {title:'Bison & Broccoli Bowl',time:'18min',servings:1,macros:{protein:56,omega3:2800,poly:200,fiber:16,calories:720},ingredients:['6oz bison (93% lean)','3 cups broccoli','1 cup quinoa','2 tbsp ground flaxseed','Ginger','Garlic','Tamari','Sesame oil','Sesame seeds'],steps:['Cook quinoa','Slice bison thin','Stir-fry broccoli in sesame oil','Add ginger, garlic','Add bison, cook 3min','Add tamari','Serve over quinoa','Top with flax and sesame seeds'],tips:['Bison cooks fast','High heat for stir-fry','Flax adds omega-3 boost'],why:'Bison = lean protein, lower TMAO than beef. Broccoli = sulforaphane. Flax = 2800mg omega-3.'},
        
        {title:'Mediterranean Bison Meatballs',time:'30min',servings:1,macros:{protein:54,omega3:3200,poly:240,fiber:14,calories:700},ingredients:['6oz ground bison','Zucchini noodles','Tomato sauce','Fresh basil','2 tbsp ground flaxseed','Garlic','EVOO','Parmesan','Pine nuts'],steps:['Mix bison with flax, garlic','Form small meatballs','Bake 20min at 400°F','Spiralize zucchini','Heat tomato sauce','Add meatballs to sauce','Toss zucchini noodles','Top with basil, parmesan, pine nuts'],tips:['Flax binds the meatballs','Don\'t overmix','Zucchini noodles = low-carb'],why:'Bison = lean protein. Flax = 3200mg omega-3. Zucchini = low-carb vegetables. Mediterranean twist!'},
        
        {title:'Bison Chili with Greens',time:'35min',servings:1,macros:{protein:52,omega3:2400,poly:220,fiber:22,calories:680},ingredients:['6oz ground bison','1 can black beans','1 can kidney beans','Tomatoes','Kale','Onion','Garlic','Chili powder','Cumin','2 tbsp ground flaxseed','Greek yogurt'],steps:['Brown bison','Add onion, garlic, spices','Add beans and tomatoes','Simmer 25min','Add chopped kale last 5min','Stir in flaxseed','Top with Greek yogurt'],tips:['Kale adds nutrition','Flax thickens chili','Greek yogurt cools spice','Make big batch - freezes well'],why:'Bison = lean protein. Beans = fiber + resistant starch. Kale = vitamin K. Flax = omega-3 boost.'},
        
        {title:'Bison Lettuce Wraps',time:'15min',servings:1,macros:{protein:54,omega3:3600,poly:240,fiber:12,calories:660},ingredients:['6oz ground bison','Butter lettuce','Water chestnuts','Shiitake mushrooms','Ginger','Garlic','Tamari','2 tbsp ground flaxseed','Hoisin sauce','Scallions','Sesame seeds'],steps:['Dice mushrooms and water chestnuts','Sauté ginger, garlic','Add bison, cook through','Add mushrooms, water chestnuts','Season with tamari, hoisin','Stir in flaxseed','Serve in lettuce cups','Top with scallions, sesame'],tips:['Butter lettuce is best','Water chestnuts add crunch','Fresh ginger essential','Low-carb and delicious'],why:'Bison = lean protein. Shiitake = immune support. Flax = 3600mg omega-3. Lettuce wraps = low-carb!'},
        
        {title:'Bison & Sweet Potato Hash',time:'25min',servings:1,macros:{protein:52,omega3:2200,poly:180,fiber:18,calories:700},ingredients:['6oz ground bison','2 cups sweet potato','Brussels sprouts','Bell peppers','Onion','2 tbsp ground flaxseed','Paprika','Cumin','Fried eggs (2)','EVOO'],steps:['Dice sweet potato small','Sauté sweet potato 12min','Add Brussels sprouts, peppers, onion','Cook until tender','Add bison, cook through','Season with paprika, cumin','Stir in flaxseed','Top with fried eggs'],tips:['Smaller dice = faster cooking','Get sweet potato crispy','Fried eggs on top are key','One-pan dinner'],why:'Bison = lean protein. Sweet potato = beta-carotene. Brussels sprouts = sulforaphane. Flax = omega-3. Hearty and satisfying!'},
        
        // Plant-based dinners (3)
        {title:'Miso-Glazed Tofu',time:'30min',servings:1,macros:{protein:42,omega3:2200,poly:200,fiber:14,calories:620},ingredients:['14oz extra-firm tofu','3 tbsp white miso','2 tbsp mirin','Bok choy','Shiitake mushrooms','Brown rice','2 tbsp ground flaxseed','Sesame oil','Scallions'],steps:['Press tofu, slice thick','Marinate in miso mixture 20min','Cook rice','Broil tofu 8min','Sauté mushrooms in sesame oil','Steam bok choy','Serve tofu over rice with vegetables','Sprinkle flax and scallions'],tips:['Press tofu well','Watch broiler - miso burns','Marinate longer for more flavor'],why:'Tofu = complete protein. Miso = probiotics. Flax = omega-3. Shiitake = immune support.'},
        
        {title:'Red Lentil Curry',time:'25min',servings:1,macros:{protein:36,omega3:2400,poly:200,fiber:18,calories:620},ingredients:['1 cup red lentils','1 can coconut milk','2 cups spinach','Tomatoes','Curry powder','Turmeric','Ginger','Garlic','2 tbsp ground flaxseed','Brown rice','Cilantro'],steps:['Cook rice','Sauté garlic, ginger, spices','Add lentils and coconut milk','Simmer 20min until thick','Add spinach, wilt','Stir in flaxseed','Serve over rice','Top with cilantro'],tips:['Red lentils cook fast','Full-fat coconut milk','Add more water if too thick','Make double batch'],why:'Lentils = plant protein + fiber. Coconut = MCTs. Turmeric = anti-inflammatory. Flax = omega-3 boost.'},
        
        {title:'White Bean & Kale Stew',time:'25min',servings:1,macros:{protein:34,omega3:1800,poly:180,fiber:20,calories:580},ingredients:['1 can white beans','3 cups kale','Vegetable broth','Tomatoes','Garlic','Fresh rosemary','2 tbsp ground flaxseed','EVOO','Parmesan','Lemon','Crusty bread'],steps:['Sauté garlic in EVOO','Add rosemary','Add broth and tomatoes','Add white beans','Simmer 15min','Add kale, cook 5min','Stir in flaxseed','Top with parmesan and lemon','Serve with crusty bread'],tips:['Great Northern or cannellini beans','Don\'t overcook kale','Add flax at end','Comforting winter dinner'],why:'White beans = protein + fiber. Kale = vitamin K. Flax = omega-3. Rosemary = antioxidants.'},
        
        // Shellfish dinners (4) - Limit to 1x/week for shrimp
        {title:'Steamed Mussels in Tomato',time:'20min',servings:1,macros:{protein:48,omega3:1400,poly:180,fiber:12,calories:620},ingredients:['2 lbs mussels','Cherry tomatoes','White wine','Garlic','EVOO','Fresh basil','Red pepper flakes','Lemon','Crusty bread'],steps:['Clean and debeard mussels','Sauté garlic in EVOO','Add tomatoes, cook until soft','Add wine','Add mussels','Cover 5min until opened','Discard unopened mussels','Top with basil, lemon','Serve with crusty bread'],tips:['Buy live mussels','Discard any that don\'t open','Soak up sauce with bread','Quick weeknight dinner'],why:'Mussels = lean protein + omega-3. Very low mercury. Tomatoes = lycopene. EVOO = polyphenols. Budget-friendly!'},
        
        {title:'Pan-Seared Scallops with Kale',time:'18min',servings:1,macros:{protein:52,omega3:2400,poly:200,fiber:16,calories:680},ingredients:['12oz scallops','3 cups kale','2 tbsp ground flaxseed','Garlic','Lemon','White wine','Butter','EVOO'],steps:['Pat scallops very dry','Season with salt, pepper','Massage kale','Sear scallops 2min per side','Remove scallops','Sauté garlic in same pan','Add kale, wilt','Deglaze with wine and lemon','Add flax','Plate kale, top with scallops'],tips:['Dry scallops = good sear','Very hot pan','Don\'t move scallops','Kale as a bed'],why:'Scallops = lean protein + omega-3. Very low mercury. Kale = vitamin K. Flax = omega-3 boost. Restaurant-quality!'},
        
        {title:'Grilled Scallops with Arugula',time:'15min',servings:1,macros:{protein:54,omega3:3400,poly:240,fiber:14,calories:700},ingredients:['12oz scallops','4 cups arugula','Cherry tomatoes','3 tbsp ground flaxseed','Balsamic vinegar','EVOO','Lemon','Parmesan shavings'],steps:['Pat scallops dry','Grill scallops 2min per side','Toss arugula with EVOO, balsamic','Halve cherry tomatoes','Plate arugula salad','Top with hot scallops','Sprinkle flax and parmesan','Squeeze lemon'],tips:['Scallops cook fast','Arugula has peppery flavor','Flax adds omega-3 + texture','Light and fresh'],why:'Scallops = lean protein + omega-3. Arugula = nitrates. Flax = 3400mg omega-3. Balsamic = polyphenols.'},
        
        {title:'Shrimp Tacos with Greek Yogurt Sauce ⭐',time:'15min',servings:1,macros:{protein:50,omega3:2600,poly:220,fiber:14,calories:660},ingredients:['8oz shrimp','Corn tortillas','Purple cabbage slaw','Avocado','Greek yogurt','Lime','Cilantro','2 tbsp ground flaxseed','Cumin','Paprika','Chipotle'],steps:['Season shrimp with cumin, paprika','Grill shrimp 2min per side','Make slaw with cabbage, lime','Make sauce: yogurt, lime, chipotle','Warm tortillas','Assemble: shrimp, slaw, avocado','Drizzle yogurt sauce','Sprinkle flax and cilantro'],tips:['Don\'t overcook shrimp','Fresh cabbage slaw is key','Greek yogurt > sour cream','Sophia\'s favorite! Limit to 1x/week'],why:'Shrimp = lean protein. Flax = 2600mg omega-3. Greek yogurt = probiotics. Limit to 1x/week due to cholesterol!'}
    ]
};

html += '<div class="picker-header">';
html += '<button class="picker-cancel" onclick="centurion.closeMealPicker()">Cancel</button>';
html += '<div class="picker-title">Select Meal</div>';
html += '<button class="picker-done" onclick="centurion.confirmMealPicker(\''+id+'\')">Done</button>'; // ← Back to Done
html += '</div>';

const TOKENS = { 'jermaine': 'WLIGFPFJQY73G43BY7CK7H6UJXPQ7N5Y', 'sophia': '4QSDWYJJUZFHRWRH727NCK7WH4COQJF4' };
const API_KEY = "AIzaSyBtqgUcbq5uVGFZ5nHPDyhthLDii7uRNrg";

const USERS = {
    jermaine: { 
        name: "Jermaine", 
        age: 42, 
        condition: "HIGH LP(A)", 
        goals: { 
            pro: 172, omega3: 12000, poly: 800, fib: 50, 
            z2: 180, z5: 20, strength: 3, water: 140, 
            cal: 2300, calBurn: 400
        },
        defaultBios: {
            apob: '114',
            lpa: '178',
            ldl: '118',
            weight: '217.1',
            bmr: '2057',
            cardioDate: '2026-01-06',
            inbodyDate: '2025-12-23'
        }
    },
    sophia: { 
        name: "Sophia", 
        age: 38, 
        condition: "HIGH ANA", 
        goals: { 
            pro: 130, omega3: 4000, poly: 600, fib: 45, 
            z2: 60, z5: 15, cal: 600 
        } 
    }
};

const PROTOCOL = [
    {id:'sunrise',time:'6:00',title:'Morning Activation',desc:'15min walk + cold shower',colors:[],macros:{p:0,o:0},calBurn:60,why:'Circadian reset + brown fat activation'},
    {id:'hydrate',time:'6:30',title:'Hydration Start',desc:'32oz water + Celtic salt + lemon',colors:['yellow'],macros:{p:0,o:0},why:'Kidney flushing. Electrolytes for training'},
    {id:'breakfast',time:'7:30',title:'Breakfast 👆',desc:'Rotating omega-3 rich meals',colors:['orange','purple','green'],macros:{p:54,o:4000,poly:220,f:14,cal:640},clickable:true,why:'High omega-3 to start the day'},
    {id:'train',time:'9:00',title:'Training',desc:'JER: 4x4 VO2max | SOPH: Yoga flow',colors:[],macros:{p:0,o:0},calBurn:350,why:'VO2max = arterial health. Yoga = cortisol control'},
    {id:'lunch',time:'1:00',title:'Lunch 👆',desc:'Strategic protein rotation',colors:['red','green','white','purple'],macros:{p:52,o:3800,poly:240,f:16,cal:680},clickable:true,why:'Midday protein and omega-3'},
    {id:'snack',time:'4:00',title:'Polyphenol Snack',desc:'Dark chocolate 85%, matcha, apple',colors:['green','yellow'],macros:{p:5,o:0,poly:180,cal:200},why:'Cocoa = endothelial function. EGCG. Quercetin'},
    {id:'dinner',time:'6:30',title:'Dinner 👆',desc:'Complete protein with vegetables',colors:['orange','green','white'],macros:{p:56,o:3600,poly:200,f:16,cal:720},clickable:true,why:'Evening nutrition optimization'},
    {id:'evening',time:'9:00',title:'Wind-Down',desc:'Magnesium 400mg + Ashwagandha + Blue blockers',colors:[],macros:{p:0,o:0},calBurn:60,why:'Mag lowers CRP. Ashwa cuts cortisol 28%'}
];


class CenturionCore {
    constructor() {
        this.user = localStorage.getItem('centurion_user') || 'jermaine';
        this.history = []; 
        this.currentIndex = 0; 
        this.checked = {}; 
        this.bios = {};
        this.currentMeals = JSON.parse(localStorage.getItem('currentMeals')) || {breakfast:0,lunch:0,dinner:0};
        this.RECIPES = RECIPE_DB;
        this.init();
    }
    showDebug(id) {
    const info = {
        id: id,
        currentMeals: this.currentMeals,
        recipesExist: !!this.RECIPES,
        recipeKeys: this.RECIPES ? Object.keys(this.RECIPES) : 'NO RECIPES',
        breakfastExists: !!this.RECIPES?.breakfast,
        breakfastLength: this.RECIPES?.breakfast?.length || 0,
        currentIndex: this.currentMeals[id] || 0
    }
    
    alert(JSON.stringify(info, null, 2));
}

    async init() { 
        this.loadLocalData(); 
        this.updateUI(); 
        await this.fetchData(); 
        this.renderBio(); 
    }
    
    loadLocalData() {
        this.checked = JSON.parse(localStorage.getItem(`c_checked_${this.user}`)) || {};
        this.bios = JSON.parse(localStorage.getItem(`c_bios_${this.user}`)) || {};
        
        // Load default bios if none exist for this user
        const u = USERS[this.user];
        if(u.defaultBios && Object.keys(this.bios).length === 0) {
            this.bios = {...u.defaultBios};
            localStorage.setItem(`c_bios_${this.user}`, JSON.stringify(this.bios));
        }
    }
    
    switchUser(u) {
        if(u === this.user) return;
        this.user = u; 
        localStorage.setItem('centurion_user', u); 
        this.wipeDashboard();
        document.querySelectorAll('.u-badge').forEach(b => b.classList.remove('active'));
        document.getElementById(`btn-${u}`).classList.add('active');
        this.history = []; 
        this.currentIndex = 0; 
        this.loadLocalData(); 
        this.renderBio();
        this.fetchData();
    }
    
    setText(id, val) { 
        const el = document.getElementById(id); 
        if(el) el.innerText = val; 
    }
    
    wipeDashboard() {
        this.setText('dayGrade', "--"); 
        this.setText('sleepVal', "--"); 
        this.setText('deepVal', "--");
        this.setText('remVal', "--"); 
        this.setText('rhrVal', "--"); 
        this.setText('bioDisplay', "--");
        document.getElementById('timelineList').innerHTML = ""; 
        document.getElementById('macroList').innerHTML = "";
        document.getElementById('calorieGrid').innerHTML = "";
        document.getElementById('rainbowTrack').innerHTML = ""; 
        this.setText('rainbowScore', "0%");
        this.setText('statusMsg', "SWITCHING..."); 
        document.querySelectorAll('circle.orb-fg').forEach(el => el.style.strokeDashoffset = 145);
        document.querySelectorAll('path.heart-fg').forEach(el => el.style.strokeDashoffset = 100);
    }
    
    updateUI() {
        document.querySelectorAll('.u-badge').forEach(b => b.classList.remove('active'));
        document.getElementById(`btn-${this.user}`).classList.add('active');
        this.setText('userLabel', `USER: ${USERS[this.user].name.toUpperCase()}`);
    }
    
    async fetchData() {
        const bar = document.getElementById('ouraBar'); 
        bar.innerText = "SYNCING...";
        const d = new Date(); 
        d.setDate(d.getDate() + 1); 
        const end = d.toISOString().split('T')[0];
        d.setDate(d.getDate() - 8); 
        const start = d.toISOString().split('T')[0]; 
        const ts = Date.now();
        
        try {
            const [sRes, rRes, aRes] = await Promise.all([
                fetch(`https://corsproxy.io/?${encodeURIComponent(`https://api.ouraring.com/v2/usercollection/sleep?start_date=${start}&end_date=${end}&t=${ts}`)}`, { headers: { 'Authorization': `Bearer ${TOKENS[this.user]}` }, cache: 'no-store' }),
                fetch(`https://corsproxy.io/?${encodeURIComponent(`https://api.ouraring.com/v2/usercollection/daily_readiness?start_date=${start}&end_date=${end}&t=${ts}`)}`, { headers: { 'Authorization': `Bearer ${TOKENS[this.user]}` }, cache: 'no-store' }),
                fetch(`https://corsproxy.io/?${encodeURIComponent(`https://api.ouraring.com/v2/usercollection/daily_activity?start_date=${start}&end_date=${end}&t=${ts}`)}`, { headers: { 'Authorization': `Bearer ${TOKENS[this.user]}` }, cache: 'no-store' })
            ]);
            
            if(!sRes.ok) throw new Error("API Error");
            
            const sJson = await sRes.json(), rJson = await rRes.json(), aJson = await aRes.json();
            let raw = sJson.data ? sJson.data.map(s => {
                const r = rJson.data?.find(x => x.day === s.day);
                const a = aJson.data?.find(x => x.day === s.day);
                return { 
                    date: s.day, 
                    score: r?.score || 0, 
                    totalSec: s.total_sleep_duration, 
                    deepSec: s.deep_sleep_duration,
                    remSec: s.rem_sleep_duration, 
                    rhr: r?.contributors?.resting_heart_rate || '-',
                    cal: a?.active_calories || 0, 
                    high: (a?.high_activity_time || 0)/60, 
                    med: (a?.medium_activity_time || 0)/60 
                };
            }).sort((a,b) => b.date.localeCompare(a.date)) : [];
            
            this.history = raw.filter(d => d.score > 0 || d.totalSec > 0);
            if(this.history.length > 0) { 
                this.currentIndex = 0; 
                bar.innerText = "UPDATED"; 
                this.render(); 
            } else { 
                bar.innerText = "EMPTY"; 
                this.renderEmpty(); 
            }
        } catch(e) { 
            bar.innerText = `ERR: ${e.message}`; 
            console.error(e); 
        }
    }
    
    changeDate(dir) {
        if(!this.history.length) return;
        const n = this.currentIndex - dir;
        if(n >= 0 && n < this.history.length) { 
            this.currentIndex = n; 
            this.render(); 
        }
    }
    
    render() {
        if(!this.history.length) return this.renderEmpty();
        const d = this.history[this.currentIndex];
        const h = Math.floor(d.totalSec/3600);
        const m = Math.round((d.totalSec%3600)/60);
        
        this.setText('dateDisplay', d.date); 
        this.setText('sleepVal', `${h}h ${m}m`);
        this.setText('deepVal', Math.round(d.deepSec/60)+"m"); 
        this.setText('remVal', Math.round(d.remSec/60)+"m");
        this.setText('rhrVal', d.rhr); 
        
        const g = USERS[this.user].goals;
        this.setText('z2Val', Math.round(d.med)); 
        this.setText('z5Val', Math.round(d.high)); 
        this.setText('calVal', d.cal);
        
        const uh = (id,val,goal) => { 
            const e = document.getElementById(id); 
            if(e) e.style.strokeDashoffset = 100-(Math.min(val/goal,1)*100); 
        };
        uh('z2Heart', d.med, g.z2); 
        uh('z5Heart', d.high, g.z5); 
        uh('calHeart', d.cal, g.calBurn||400);
        
        const c = d.score >= 80 ? '#ccff00' : d.score >= 60 ? '#FFD60A' : '#ff453a';
        document.querySelector('.tactical-box').style.borderLeftColor = c;
        
        const u = USERS[this.user];
        const s = d.score >= 85 ? `PEAK - ${u.condition} MANAGED` : d.score < 70 ? `RECOVERY - ${u.condition} RISK` : `${u.condition} PROTOCOL`;
        this.setText('statusMsg', s); 
        this.renderGrade(d.score, h);
        
        document.getElementById('sleepOrb').style.strokeDashoffset = 145-(Math.min(d.totalSec/3600,9)/9)*145;
        document.getElementById('deepOrb').style.strokeDashoffset = 145-(Math.min(d.deepSec/3600,2)/2)*145;
        document.getElementById('remOrb').style.strokeDashoffset = 145-(Math.min(d.remSec/3600,2)/2)*145;
        
        this.renderComplex(d.date); 
        this.renderBio();
    }
    
    renderEmpty() { 
        this.setText('dateDisplay', "NO DATA"); 
        this.setText('statusMsg', "SYNC"); 
        this.wipeDashboard(); 
        this.renderBio(); 
    }
    
    renderGrade(sc, sl) {
        let gr = 'C', co = '#ff453a';
        if(sc >= 85 && sl >= 7) { gr = 'S'; co = '#ccff00'; }
        else if(sc >= 80 && sl >= 6.5) { gr = 'A'; co = '#00f0ff'; }
        else if(sc >= 70) { gr = 'B'; co = '#FFD60A'; }
        this.setText('dayGrade', gr); 
        document.getElementById('dayGrade').style.color = co;
        document.querySelector('.grade-box').style.borderColor = co;
    }
    
    renderComplex(dk) {
        const done = this.checked[dk] || [];
        const g = USERS[this.user].goals;
        let tot = {p:0,o:0,poly:0,f:0,cal:0,burn:0};
        let cols = new Set();
        let html = '';
        
        PROTOCOL.forEach(t => {
            const chk = done.includes(t.id);
            if(chk) { 
                tot.p += t.macros.p||0; 
                tot.o += t.macros.o||0; 
                tot.poly += t.macros.poly||0; 
                tot.f += t.macros.f||0;
                tot.cal += t.macros.cal||0;
                tot.burn += t.calBurn||0;
                t.colors?.forEach(c => cols.add(c)); 
            }
            
            const clickHandler = t.clickable ? `onclick="event.stopPropagation(); centurion.showCooking('${t.id}');"` : '';
            
            html += `<div class="time-slot"><div class="ts-time">${t.time}</div><div class="ts-card ${chk?'checked':''}">
                <div class="ts-title ${t.clickable?'meal-clickable':''}" ${clickHandler}>
                    ${t.title}
                </div>
                <div class="ts-desc">${t.desc}</div>
                ${t.why?`<div class="ts-why">WHY: ${t.why}</div>`:''}
                <div class="check-btn" onclick="event.stopPropagation(); centurion.toggleTask('${t.id}');">${chk?'✓':''}</div>
            </div></div>`;
        });
        
        document.getElementById('timelineList').innerHTML = html;
        
        const orb = (l,v,go,co) => `<div class="orb-card"><div class="orb-container"><svg class="orb-svg"><circle class="orb-bg" cx="25" cy="25" r="20"></circle>
            <circle class="orb-fg" cx="25" cy="25" r="20" style="stroke:${co}; stroke-dashoffset:${145-(Math.min(v/go,1)*145)}"></circle></svg>
            <div class="orb-val-box"><div class="orb-val">${v}</div></div></div><div class="orb-label">${l}</div></div>`;
        
        document.getElementById('macroList').innerHTML = 
            orb('PROTEIN',tot.p,g.pro,'#fff')+
            orb('OMEGA-3',tot.o,g.omega3,'#00d4ff')+
            orb('POLY',tot.poly,g.poly,'#bf5af2')+
            orb('FIBER',tot.f,g.fib,'#30d158');
        
        // CALORIES SECTION - RESTORED
        const currentDay = this.history[this.currentIndex];
        const activeBurn = currentDay?.cal || 0;
        const bmr = parseInt(this.bios.bmr) || 2057;
        const totalBurn = bmr + activeBurn;
        tot.net = tot.cal - totalBurn;
        
        const netGoal = g.cal - bmr - (g.calBurn || 400);
        const totalBurnGoal = bmr + (g.calBurn || 400);
        
        document.getElementById('calorieGrid').innerHTML = 
            orb('INTAKE',tot.cal,g.cal,'#FFD60A') +
            orb('TOTAL BURN',totalBurn,totalBurnGoal,'#ff453a') +
            orb('NET',tot.net,netGoal,'#30d158');
        
        this.setText('rainbowScore', Math.round(cols.size/6*100)+"%");
        const cb = {red:'#ff453a',orange:'#ff9f0a',yellow:'#ffd60a',green:'#30d158',purple:'#bf5af2',white:'#fff'};
        document.getElementById('rainbowTrack').innerHTML = ['red','orange','yellow','green','purple','white'].map(c => 
            `<div class="rainbow-seg" style="background:${cb[c]}; width:${cols.has(c)?'16.66%':'0%'}"></div>`).join('');
    }
    
    toggleTask(id) {
        if(!this.history.length) return;
        const dk = this.history[this.currentIndex].date;
        if(!this.checked[dk]) this.checked[dk] = [];
        const i = this.checked[dk].indexOf(id);
        i > -1 ? this.checked[dk].splice(i,1) : this.checked[dk].push(id);
        localStorage.setItem(`c_checked_${this.user}`, JSON.stringify(this.checked));
        this.renderComplex(dk);
    }
    
    showCooking(id) {
    let idx = this.currentMeals[id] || 0;
    const recipes = this.RECIPES[id];
    
    if(!recipes || !recipes.length) {
        alert('ERROR: No recipes found for: ' + id);
        return;
    }
    
    // FIX: Reset index if it's out of bounds - THIS IS THE KEY LINE
    if(idx >= recipes.length) {
        idx = 0;
        this.currentMeals[id] = 0;
        localStorage.setItem('currentMeals', JSON.stringify(this.currentMeals));
    }
    
    const r = recipes[idx];
    
    if(!r) {
        alert('Recipe not found at index: ' + idx + '. Resetting to 0.');
        this.currentMeals[id] = 0;
        localStorage.setItem('currentMeals', JSON.stringify(this.currentMeals));
        return;
    }
    
    // ... rest of function

    
    let html = '<div class="cooking-header">';
    html += '<button class="back-btn" onclick="centurion.closeCooking()">← BACK</button>';
    html += '<h1 class="cook-title">' + r.title + '</h1>';
    html += '<div class="cook-meta">';
    html += '<span>⏱️ ' + r.time + '</span>';
    html += '<span>🍽️ ' + r.servings + ' serving</span>';
    html += '</div>';
    html += '</div>';
    
    html += '<div class="macro-grid-cook">';
    html += '<div class="macro-card-cook"><div class="macro-val-cook">' + r.macros.protein + 'g</div><div class="macro-lab-cook">PROTEIN</div></div>';
    html += '<div class="macro-card-cook"><div class="macro-val-cook">' + r.macros.omega3 + 'mg</div><div class="macro-lab-cook">OMEGA-3</div></div>';
    html += '<div class="macro-card-cook"><div class="macro-val-cook">' + r.macros.poly + 'mg</div><div class="macro-lab-cook">POLYPHENOLS</div></div>';
    html += '<div class="macro-card-cook"><div class="macro-val-cook">' + r.macros.fiber + 'g</div><div class="macro-lab-cook">FIBER</div></div>';
    html += '<div class="macro-card-cook"><div class="macro-val-cook">' + r.macros.calories + '</div><div class="macro-lab-cook">CALORIES</div></div>';
    html += '</div>';
    
    html += '<div class="cook-section"><h2 class="cook-sec-title">🛒 INGREDIENTS</h2><div class="ing-list">';
    r.ingredients.forEach(ing => html += '<div class="ing-item">• ' + ing + '</div>');
    html += '</div></div>';
    
    html += '<div class="cook-section"><h2 class="cook-sec-title">👨‍🍳 STEPS</h2><div class="step-list">';
    r.steps.forEach((step, i) => html += '<div class="step-item"><div class="step-num">' + (i+1) + '</div><div class="step-txt">' + step + '</div></div>');
    html += '</div></div>';
    
    html += '<div class="cook-section"><h2 class="cook-sec-title">💡 TIPS</h2><div class="tip-list">';
    r.tips.forEach(tip => html += '<div class="tip-item">✓ ' + tip + '</div>');
    html += '</div></div>';
    
    html += '<div class="cook-section"><h2 class="cook-sec-title">🎯 WHY IT WORKS</h2><div class="why-box">' + r.why + '</div></div>';
    
    html += '<div class="cook-footer">';
    html += '<button class="done-btn change-meal-btn" onclick="centurion.openMealPicker(\''+id+'\')">🔄 CHANGE MEAL</button>';
    html += '<button class="done-btn" onclick="centurion.closeCooking()">✓ DONE COOKING</button>';
    html += '</div>';
    
    document.getElementById('cookingPage').innerHTML = html;
    document.getElementById('cookingPage').classList.add('active');
    document.body.style.overflow = 'hidden';
}
openMealPicker(id) {
    const recipes = this.RECIPES[id];
    const currentIdx = this.currentMeals[id] || 0;
    
    let html = '<div class="picker-overlay" onclick="centurion.closeMealPicker()">';
    html += '<div class="picker-container" onclick="event.stopPropagation()">';
html += '<div class="picker-header">';
html += '<button class="picker-cancel" onclick="centurion.closeMealPicker()">Cancel</button>';
html += '<div class="picker-title">Select Meal</div>';
html += '<button class="picker-done" onclick="centurion.debugPicker()">DEBUG</button>'; // Changed this
html += '</div>';

    html += '<div class="picker-wheel" id="pickerWheel" data-meal-id="'+id+'">';
    
    recipes.forEach((recipe, i) => {
        const selected = i === currentIdx ? 'selected' : '';
        html += `<div class="picker-option ${selected}" data-index="${i}">${recipe.title}</div>`;
    });
    
    html += '</div></div></div>';
    
    document.body.insertAdjacentHTML('beforeend', html);
    
    const wheel = document.getElementById('pickerWheel');
    
    setTimeout(() => {
        const selectedOption = wheel.querySelector('.picker-option.selected');
        if(selectedOption) {
            selectedOption.scrollIntoView({block: 'center', behavior: 'instant'});
        }
    }, 150);
    
    wheel.addEventListener('scroll', () => {
        this.updatePickerSelection();
    });
}

updatePickerSelection() {
    const wheel = document.getElementById('pickerWheel');
    if(!wheel) return;
    
    const wheelRect = wheel.getBoundingClientRect();
    const centerY = wheelRect.top + wheelRect.height / 2;
    
    const options = wheel.querySelectorAll('.picker-option');
    let closestOption = null;
    let closestDistance = Infinity;
    
    options.forEach(option => {
        const rect = option.getBoundingClientRect();
        const optionCenterY = rect.top + rect.height / 2;
        const distance = Math.abs(centerY - optionCenterY);
        
        if(distance < closestDistance) {
            closestDistance = distance;
            closestOption = option;
        }
    });
    
    // Remove all selected classes
    options.forEach(opt => opt.classList.remove('selected'));
    
    // Add selected class to closest option
    if(closestOption) {
        closestOption.classList.add('selected');
    }
}


confirmMealPicker(id) {
    const selectedElement = document.querySelector('.picker-option.selected');
    if(selectedElement) {
        const newIndex = parseInt(selectedElement.getAttribute('data-index'));
        this.currentMeals[id] = newIndex;
        localStorage.setItem('currentMeals', JSON.stringify(this.currentMeals));
    }
    this.closeMealPicker();
    this.closeCooking();
    this.showCooking(id);
}

closeMealPicker() {
    const picker = document.querySelector('.picker-overlay');
    if(picker) picker.remove();
}

selectMeal(id, newIndex) {
    this.currentMeals[id] = parseInt(newIndex);
    localStorage.setItem('currentMeals', JSON.stringify(this.currentMeals));
    this.closeCooking();
    this.showCooking(id);
}
    
    changeMeal(id) {
        const recipes = this.RECIPES[id];
        this.currentMeals[id] = (this.currentMeals[id] + 1) % recipes.length;
        localStorage.setItem('currentMeals', JSON.stringify(this.currentMeals));
        this.closeCooking();
        this.showCooking(id);
    }
    
    closeCooking() {
        document.getElementById('cookingPage').classList.remove('active');
        document.body.style.overflow = 'auto';
    }
    
    async runAI() {
        if(!this.history.length) return;
        const d = this.history[this.currentIndex];
        const ui = document.getElementById('aiOutput');
        const u = USERS[this.user];
        const p = `Coach ${u.name} (${u.condition}). Sleep ${(d.totalSec/3600).toFixed(1)}h, Score ${d.score}, Z2 ${Math.round(d.med)}min, Z5 ${Math.round(d.high)}min. ${u.condition==='HIGH LP(A)'?'ApoB via omega-3, VO2max for arteries':'ANA via anti-inflam, mobility'}. 1 action TODAY.`;
        
        ui.innerText = "Analyzing...";
        
        for(let m of ['gemini-1.5-flash-8b','gemini-2.0-flash-exp']) {
            try {
                const r = await fetch(`https://generativelanguage.googleapis.com/v1beta/models/${m}:generateContent?key=${API_KEY}`, {
                    method:'POST', 
                    headers:{'Content-Type':'application/json'}, 
                    body:JSON.stringify({contents:[{parts:[{text:p}]}]})
                });
                if(r.ok) { 
                    const j = await r.json(); 
                    if(j.candidates) { 
                        ui.innerText = j.candidates[0].content.parts[0].text; 
                        return; 
                    } 
                }
            } catch(e) {}
        }
        
        ui.innerText = d.score >= 80 ? `${u.condition} managed. Execute VO2max.` : `Recovery. Z2 only.`;
    }
    
    openBio() {
        ['apob','lpa','ldl','weight','bmr'].forEach(k => {
            const el = document.getElementById(`in-${k}`);
            if(el) el.value = this.bios[k]||'';
        });
        ['cardio','inbody'].forEach(k => {
            const el = document.getElementById(`in-${k}-date`);
            if(el) el.value = this.bios[k+'Date']||'';
        });
        
        document.getElementById('bioModal').classList.add('active');
    }
    
    closeBio() { 
        document.getElementById('bioModal').classList.remove('active'); 
    }
    
    saveBio() {
        this.bios = { 
            apob: document.getElementById('in-apob').value,
            lpa: document.getElementById('in-lpa').value,
            ldl: document.getElementById('in-ldl').value,
            weight: document.getElementById('in-weight').value,
            bmr: document.getElementById('in-bmr').value,
            cardioDate: document.getElementById('in-cardio-date').value,
            inbodyDate: document.getElementById('in-inbody-date').value
        };
        localStorage.setItem(`c_bios_${this.user}`, JSON.stringify(this.bios));
        this.closeBio(); 
        this.renderBio();
    }
    
    renderBio() {
        const u = USERS[this.user]; 
        let t = u.condition;
        
        if(u.condition === 'HIGH LP(A)') {
            document.querySelector('.tac-label').innerHTML = `USER: ${u.name.toUpperCase()} <span class="health-badge badge-lpa">LP(A)</span>`;
            if(this.bios.lpa) t += ` • Lp(a): ${this.bios.lpa}`;
        } else if(u.condition === 'HIGH ANA') {
            document.querySelector('.tac-label').innerHTML = `USER: ${u.name.toUpperCase()} <span class="health-badge badge-ana">ANA</span>`;
        }
        
        if(this.bios.apob) t += ` • ApoB: ${this.bios.apob}`;
        
        this.setText('bioDisplay', t);
    }
}

const centurion = new CenturionCore();
    </script>
</body>
</html>
