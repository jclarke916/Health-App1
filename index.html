<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no">
    <title>The Centurion | v10022 RAW LINK</title>
    <link href="https://fonts.googleapis.com/css2?family=JetBrains+Mono:wght@400;700&family=Inter:wght@300;400;600;800;900&display=swap" rel="stylesheet">
    <style>
        :root { --bg: #000; --panel: #111; --border: #333; --acid: #ccff00; --cyan: #00f0ff; --alert: #ff453a; --text: #fff; --font: 'JetBrains Mono', monospace; }
        * { box-sizing: border-box; }
        body { margin: 0; padding: 20px; background: var(--bg); color: var(--text); font-family: var(--font); }

        .debug-panel { border: 1px solid var(--border); padding: 15px; border-radius: 8px; margin-bottom: 20px; }
        .btn-row { display: flex; gap: 10px; margin-bottom: 15px; }
        .btn { flex: 1; padding: 12px; background: var(--acid); color: #000; border: none; font-weight: 700; cursor: pointer; border-radius: 4px; }
        .btn:active { opacity: 0.8; }
        
        .output-box { 
            background: #000; border: 1px solid #333; padding: 10px; 
            height: 200px; overflow-y: auto; font-size: 0.7rem; color: #aaa; 
            white-space: pre-wrap; margin-bottom: 10px;
        }
        .status-ok { color: var(--acid); }
        .status-err { color: var(--alert); }

        /* OURA UI HIDDEN/MINIMIZED FOR DIAGNOSTICS */
        .oura-summary { font-size: 0.8rem; color: #666; margin-top: 20px; border-top: 1px solid #333; padding-top: 10px; }
    </style>
</head>
<body>

    <h2 style="color:var(--muted); font-size:0.8rem; text-transform:uppercase;">System Diagnostic v10022</h2>

    <div class="debug-panel">
        <div class="btn-row">
            <button class="btn" onclick="centurion.checkPermissions()">1. CHECK PERMISSIONS</button>
            <button class="btn" onclick="centurion.testGeneration()" style="background:var(--cyan);">2. TEST GENERATION</button>
        </div>
        <div style="margin-bottom:5px; font-size:0.6rem; color:#666;">RAW SERVER RESPONSE:</div>
        <div id="debug-output" class="output-box">Waiting for command...</div>
    </div>

    <div class="oura-summary">
        <div>OURA STATUS: <span id="oura-status">...</span></div>
        <div id="dayContent"></div>
    </div>

<script>
// ==========================================
// V10022: RAW DEBUGGER
// ==========================================

const TOKENS = { 'jermaine': 'WLIGFPFJQY73G43BY7CK7H6UJXPQ7N5Y', 'sophia': '4QSDWYJJUZFHRWRH727NCK7WH4COQJF4' };
const GEMINI_API_KEY = "AIzaSyBtqgUcbq5uVGFZ5nHPDyhthLDii7uRNrg"; 

function getDateKey(d) { return d.toISOString().split('T')[0]; }

class CenturionCore {
    constructor() {
        this.user = 'jermaine';
        this.cache = JSON.parse(localStorage.getItem(`centurion_oura_cache_${this.user}`)) || { history: [] };
        this.init();
    }

    init() {
        this.fetchOuraData();
    }

    log(msg, isError = false) {
        const box = document.getElementById('debug-output');
        const color = isError ? 'var(--alert)' : 'var(--acid)';
        const time = new Date().toLocaleTimeString();
        box.innerHTML = `<div style="color:${color}">[${time}] ${msg}</div>\n` + box.innerHTML;
    }

    // --- TEST 1: LIST MODELS (Does the key work?) ---
    async checkPermissions() {
        this.log("Checking API Permissions...");
        try {
            const url = `https://generativelanguage.googleapis.com/v1beta/models?key=${GEMINI_API_KEY}`;
            const res = await fetch(url);
            const data = await res.json();

            if (data.error) {
                this.log(`❌ GOOGLE ERROR:\n${JSON.stringify(data.error, null, 2)}`, true);
            } else if (data.models) {
                // Filter for "generateContent" models
                const usable = data.models.filter(m => m.supportedGenerationMethods.includes("generateContent"));
                const names = usable.map(m => m.name.replace("models/", "")).join(", ");
                this.log(`✅ SUCCESS! Key is Active.\nAllowed Models: ${names}`);
            } else {
                this.log("❌ UNKNOWN RESPONSE (No models found)", true);
            }
        } catch (e) {
            this.log(`❌ NETWORK ERROR: ${e.message}`, true);
        }
    }

    // --- TEST 2: GENERATE CONTENT (Can we speak?) ---
    async testGeneration() {
        this.log("Attempting Generation (gemini-1.5-flash)...");
        try {
            const url = `https://generativelanguage.googleapis.com/v1beta/models/gemini-1.5-flash:generateContent?key=${GEMINI_API_KEY}`;
            const res = await fetch(url, {
                method: "POST",
                headers: { "Content-Type": "application/json" },
                body: JSON.stringify({ contents: [{ parts: [{ text: "Respond with 'SYSTEM ONLINE'." }] }] })
            });

            const data = await res.json();

            if (data.error) {
                this.log(`❌ GENERATION FAILED:\n${JSON.stringify(data.error, null, 2)}`, true);
            } else if (data.candidates) {
                const text = data.candidates[0].content.parts[0].text;
                this.log(`✅ RESPONSE RECEIVED:\n"${text}"`);
            }
        } catch (e) {
            this.log(`❌ NETWORK ERROR: ${e.message}`, true);
        }
    }

    async fetchOuraData() {
        const token = TOKENS[this.user];
        const endD = new Date(); 
        const startD = new Date(); startD.setDate(endD.getDate() - 7);
        const range = `start_date=${getDateKey(startD)}&end_date=${getDateKey(endD)}`;
        
        document.getElementById('oura-status').innerText = "Syncing...";
        
        try {
            const [rRes, dsRes] = await Promise.all([
                fetch(`https://corsproxy.io/?${encodeURIComponent(`https://api.ouraring.com/v2/usercollection/daily_readiness?${range}`)}`, { headers: { 'Authorization': `Bearer ${token}` } }),
                fetch(`https://corsproxy.io/?${encodeURIComponent(`https://api.ouraring.com/v2/usercollection/daily_sleep?${range}`)}`, { headers: { 'Authorization': `Bearer ${token}` } })
            ]);
            
            const rData = await rRes.json();
            
            if(rData.data) {
                document.getElementById('oura-status').innerText = "✅ CONNECTED (Data Ready)";
                // We keep the logic simple here, just proving connectivity
            }
        } catch(e) { 
            document.getElementById('oura-status').innerText = "❌ ERROR";
        }
    }
}

const centurion = new CenturionCore();
</script>
</body>
</html>