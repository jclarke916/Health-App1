<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no">
    <title>The Centurion | v3000.0 Bio-Engine</title>
    <link href="https://fonts.googleapis.com/css2?family=JetBrains+Mono:wght@400;700&family=Inter:wght@300;400;600;800;900&display=swap" rel="stylesheet">
    <style>
        :root {
            --bg-deep: #050505;
            --bg-card: rgba(20, 20, 20, 0.6);
            --border: rgba(255, 255, 255, 0.08);
            --gold: #FFD60A;
            --acid: #ccff00;
            --alert: #ff3b30;
            --blue: #0A84FF;
            --text-main: #ffffff;
            --text-muted: #666666;
            --font-ui: 'Inter', sans-serif;
            --font-data: 'JetBrains Mono', monospace;
        }

        * { box-sizing: border-box; -webkit-tap-highlight-color: transparent; }
        body { margin: 0; padding: 20px 16px 40px; background: var(--bg-deep); color: var(--text-main); font-family: var(--font-ui); min-height: 100vh; background-image: radial-gradient(circle at top right, #111 0%, #000 60%); }

        /* HEADER & HUD */
        .hud-header { display: flex; justify-content: space-between; align-items: center; margin-bottom: 25px; border-bottom: 1px solid var(--border); padding-bottom: 15px; }
        .app-name { font-size: 0.7rem; font-weight: 900; letter-spacing: 2px; color: var(--text-muted); }
        .user-switch { display: flex; gap: 5px; background: #111; padding: 3px; border-radius: 20px; border: 1px solid var(--border); }
        .u-btn { padding: 6px 16px; border-radius: 16px; font-size: 0.65rem; font-weight: 700; color: #555; background: transparent; border: none; cursor: pointer; transition: all 0.3s; }
        .u-btn.active { background: var(--gold); color: #000; box-shadow: 0 0 15px rgba(255, 214, 10, 0.2); }

        /* SYSTEM STATUS BAR */
        .system-status { margin-bottom: 20px; text-align: center; position: relative; }
        .status-label { font-size: 0.6rem; color: var(--text-muted); letter-spacing: 2px; margin-bottom: 5px; text-transform: uppercase; }
        .status-value { font-family: var(--font-data); font-size: 2.2rem; font-weight: 700; letter-spacing: -1px; text-transform: uppercase; text-shadow: 0 0 20px rgba(255,255,255,0.1); }
        .status-sub { font-size: 0.75rem; color: var(--gold); margin-top: 5px; font-family: var(--font-data); }
        
        /* CARDS */
        .module { background: var(--bg-card); border: 1px solid var(--border); border-radius: 16px; padding: 20px; margin-bottom: 12px; backdrop-filter: blur(20px); position: relative; overflow: hidden; }
        .module::before { content: ''; position: absolute; top: 0; left: 0; width: 2px; height: 100%; background: var(--border); }
        
        .mod-header { display: flex; justify-content: space-between; align-items: flex-end; margin-bottom: 15px; }
        .mod-title { font-size: 0.65rem; font-weight: 800; letter-spacing: 1px; color: var(--text-muted); text-transform: uppercase; }
        .mod-data-lg { font-family: var(--font-data); font-size: 1.4rem; font-weight: 700; color: #fff; }
        
        /* DIRECTIVE ENGINE (The "Brain") */
        .directive-box { border-left: 2px solid var(--gold); background: linear-gradient(90deg, rgba(255, 214, 10, 0.05) 0%, transparent 100%); }
        .directive-text { font-size: 0.9rem; font-weight: 600; line-height: 1.5; margin-bottom: 8px; }
        .mechanism-tag { display: inline-block; font-family: var(--font-data); font-size: 0.6rem; color: var(--gold); background: rgba(255, 214, 10, 0.1); padding: 4px 8px; border-radius: 4px; border: 1px solid rgba(255, 214, 10, 0.2); }

        /* DATA GRID */
        .data-grid { display: grid; grid-template-columns: 1fr 1fr; gap: 8px; margin-top: 15px; }
        .data-point { background: rgba(255,255,255,0.02); padding: 10px; border-radius: 8px; }
        .dp-label { font-size: 0.55rem; color: var(--text-muted); text-transform: uppercase; display: block; margin-bottom: 4px; }
        .dp-val { font-family: var(--font-data); font-size: 0.9rem; font-weight: 700; }
        .trend-good { color: var(--acid); }
        .trend-bad { color: var(--alert); }

        /* ACTION BUTTON (Autopilot) */
        .autopilot-btn { width: 100%; background: var(--gold); color: #000; border: none; padding: 16px; border-radius: 12px; font-weight: 800; font-size: 0.8rem; letter-spacing: 1px; cursor: pointer; text-transform: uppercase; margin-top: 10px; display: flex; justify-content: space-between; align-items: center; }
        .autopilot-btn:active { transform: scale(0.98); opacity: 0.9; }

        /* MODAL */
        .modal { display: none; position: fixed; top: 0; left: 0; width: 100%; height: 100%; background: rgba(0,0,0,0.9); z-index: 100; align-items: center; justify-content: center; backdrop-filter: blur(10px); }
        .modal-content { background: #111; padding: 30px; border-radius: 20px; border: 1px solid var(--border); width: 90%; max-width: 400px; text-align: center; }
    </style>
</head>
<body>

    <div class="hud-header">
        <div class="app-name">CENTURION v3000</div>
        <div class="user-switch">
            <button id="btn-J" class="u-btn active" onclick="engine.switchUser('J')">JERMAINE</button>
            <button id="btn-S" class="u-btn" onclick="engine.switchUser('S')">SOPHIA</button>
        </div>
    </div>

    <div class="system-status">
        <div class="status-label">BIO-ENGINE STATUS</div>
        <div id="status-display" class="status-value">CALCULATING...</div>
        <div id="status-sub" class="status-sub">Awaiting Oura Handshake</div>
    </div>

    <div class="module directive-box">
        <div class="mod-header">
            <div class="mod-title">DAILY PRIME DIRECTIVE</div>
            <div id="oura-score" class="mod-data-lg">--</div>
        </div>
        <div id="prime-directive" class="directive-text">
            Initializing Intelligence Core...
        </div>
        <div id="mechanism-display" class="mechanism-tag">Syncing Biomarkers</div>
    </div>

    <div class="module">
        <div class="mod-header">
            <div class="mod-title">NUTRITION PROTOCOL</div>
            <div style="font-size:0.6rem; color:var(--text-muted)">TARGET</div>
        </div>
        <div id="nutrition-prescription" style="font-size:0.85rem; line-height:1.6; margin-bottom:15px;">
            Loading Metabolic Data...
        </div>
        <div class="data-grid">
            <div class="data-point">
                <span class="dp-label">PROTEIN TARGET</span>
                <span id="target-protein" class="dp-val">--</span>
            </div>
            <div class="data-point">
                <span class="dp-label">FIBER BUFFER</span>
                <span id="target-fiber" class="dp-val">--</span>
            </div>
        </div>
        <button class="autopilot-btn" onclick="engine.adhereProtocol()">
            <span>CONFIRM ADHERENCE</span>
            <span>➔</span>
        </button>
    </div>

    <div class="module">
        <div class="mod-header">
            <div class="mod-title">CRITICAL WATCHLIST</div>
            <div style="font-size:0.6rem; color:var(--text-muted)">LIVE LABS</div>
        </div>
        <div id="biomarker-grid" class="data-grid" style="grid-template-columns: 1fr 1fr 1fr;">
            </div>
    </div>

    <div style="text-align: center; margin-top: 30px;">
        <div id="oura-status" style="font-family: var(--font-data); font-size: 0.6rem; color: var(--text-muted); cursor: pointer;" onclick="engine.forceSync()">
            [ SYSTEM IDLE - TAP TO SYNC ]
        </div>
    </div>

<script>
/**
 * THE CENTURION BIO-ENGINE v3000.0
 * Logic: Cross-references Oura Daily Data with Static Biomarkers to generate prescriptive outputs.
 */

const TOKENS = {
    'J': 'WLIGFPFJQY73G43BY7CK7H6UJXPQ7N5Y',
    'S': '4QSDWYJJUZFHRWRH727NCK7WH4COQJF4'
};

// 1. STATIC BIO-DATA (The "Hard" Science)
const BIO_DATA = {
    'J': {
        name: "Jermaine",
        focus: "LIPID_OXIDATION", // Key goal: Lower ApoB
        labs: { apob: 95, hba1c: 5.4, testosterone: 650, ferritin: 120 },
        goals: { apob: 60 },
        macros: { pro: 180, carb: 200, fat: 80, fiber: 40 },
        protocols: {
            high_readiness: {
                focus: "ZONE 5 / VO2 MAX",
                meal: "Wild Salmon + Lentils",
                mechanism: "High intensity oxidizes lipids; Omega-3s improve endothelial function.",
                juice: "Beet Vitality (Nitric Oxide)"
            },
            low_readiness: {
                focus: "ACTIVE RECOVERY / ZONE 2",
                meal: "White Fish + Leafy Greens",
                mechanism: "Low oxidative stress meal to prevent cortisol spikes.",
                juice: "Green Longevity (Alkalizing)"
            }
        }
    },
    'S': {
        name: "Sophia",
        focus: "IMMUNE_MODULATION", // Key goal: Lower ANA/Inflammation
        labs: { ana: 320, ferritin: 75, hba1c: 5.6, vitaminD: 38 },
        goals: { ana: 40 },
        macros: { pro: 120, carb: 150, fat: 60, fiber: 35 },
        protocols: {
            high_readiness: {
                focus: "STRENGTH / HYPERTROPHY",
                meal: "Bison + Sweet Potato",
                mechanism: "Muscle tissue acts as a glucose sink to lower HbA1c.",
                juice: "Orange Immune (Vit C + Iron)"
            },
            low_readiness: {
                focus: "YOGA / PARASYMPATHETIC",
                meal: "Turmeric Ginger Soup + Bone Broth",
                mechanism: "Downregulate cytokine production (IL-6) to lower ANA.",
                juice: "Green Longevity (Gut Health)"
            }
        }
    }
};

class BioEngine {
    constructor() {
        this.user = localStorage.getItem('centurion_user') || 'J';
        this.ouraCache = JSON.parse(localStorage.getItem(`oura_cache_${this.user}`)) || null;
        this.init();
    }

    init() {
        this.updateUI();
        // Auto-sync on load if cache is old (>4 hours) or empty
        if (!this.ouraCache || (Date.now() - this.ouraCache.timestamp > 14400000)) {
            this.forceSync();
        } else {
            this.renderEngine();
        }
    }

    switchUser(uid) {
        this.user = uid;
        localStorage.setItem('centurion_user', uid);
        this.ouraCache = JSON.parse(localStorage.getItem(`oura_cache_${uid}`)) || null;
        
        // Reset UI visuals
        document.querySelectorAll('.u-btn').forEach(b => b.classList.remove('active'));
        document.getElementById(`btn-${uid}`).classList.add('active');
        
        document.getElementById('status-display').innerText = "SWITCHING...";
        document.getElementById('status-sub').style.color = "#666";
        
        this.forceSync();
    }

    async forceSync() {
        const token = TOKENS[this.user];
        const statusEl = document.getElementById('oura-status');
        const mainStatus = document.getElementById('status-display');
        
        statusEl.innerText = "[ ESTABLISHING HANDSHAKE... ]";
        statusEl.style.color = "var(--gold)";
        mainStatus.style.opacity = "0.5";

        const today = new Date().toISOString().split('T')[0];
        const oneWeekAgo = new Date(Date.now() - 7 * 86400000).toISOString().split('T')[0];

        try {
            // 1. Fetch Readiness
            const rRes = await fetch(`https://corsproxy.io/?${encodeURIComponent(`https://api.ouraring.com/v2/usercollection/daily_readiness?start_date=${oneWeekAgo}&end_date=${today}`)}`, {
                headers: { 'Authorization': `Bearer ${token}` }
            });
            const rData = await rRes.json();

            // 2. Fetch Activity
            const aRes = await fetch(`https://corsproxy.io/?${encodeURIComponent(`https://api.ouraring.com/v2/usercollection/daily_activity?start_date=${oneWeekAgo}&end_date=${today}`)}`, {
                headers: { 'Authorization': `Bearer ${token}` }
            });
            const aData = await aRes.json();

            if (rData.data && rData.data.length > 0) {
                // Store cleanest data point (most recent)
                const latestR = rData.data[rData.data.length - 1];
                const latestA = aData.data[aData.data.length - 1]; // Activity might lag, simplistic match

                this.ouraCache = {
                    score: latestR.score,
                    activity: latestA ? latestA.active_calories : 0,
                    timestamp: Date.now()
                };
                
                localStorage.setItem(`oura_cache_${this.user}`, JSON.stringify(this.ouraCache));
                statusEl.innerText = `[ SYNC COMPLETE: ${new Date().toLocaleTimeString()} ]`;
                statusEl.style.color = "var(--text-muted)";
                mainStatus.style.opacity = "1";
                this.renderEngine();
            } else {
                throw new Error("No Data");
            }

        } catch (e) {
            console.error(e);
            statusEl.innerText = "[ SYNC FAILED - USING OFFLINE PROTOCOL ]";
            statusEl.style.color = "var(--alert)";
            // Fallback for demo if API fails
            this.ouraCache = { score: 82, activity: 450, timestamp: Date.now() }; 
            this.renderEngine();
        }
    }

    // THE BRAIN: Calculates the daily prescription
    renderEngine() {
        const u = BIO_DATA[this.user];
        const score = this.ouraCache.score;
        const isHighPerf = score >= 75;
        
        // 1. SYSTEM STATUS CALCULATION
        const statusEl = document.getElementById('status-display');
        const subEl = document.getElementById('status-sub');
        const boxEl = document.querySelector('.directive-box');

        if (isHighPerf) {
            statusEl.innerText = "ANABOLIC PRIME";
            statusEl.style.color = "var(--acid)";
            subEl.innerText = `Readiness ${score}% • ${u.focus} ENABLED`;
            subEl.style.color = "var(--acid)";
            boxEl.style.borderLeftColor = "var(--acid)";
        } else {
            statusEl.innerText = "SYSTEM REPAIR";
            statusEl.style.color = "var(--gold)";
            subEl.innerText = `Readiness ${score}% • Cytokine Management Mode`;
            subEl.style.color = "var(--gold)";
            boxEl.style.borderLeftColor = "var(--gold)";
        }

        document.getElementById('oura-score').innerText = score;

        // 2. PRIME DIRECTIVE GENERATION
        const protocol = isHighPerf ? u.protocols.high_readiness : u.protocols.low_readiness;
        document.getElementById('prime-directive').innerHTML = `
            Priority: <strong>${protocol.focus}</strong><br>
            <span style="font-size:0.8rem; color:#aaa">Biomarker Target: ${this.user === 'J' ? 'ApoB < 60' : 'ANA < 40'}</span>
        `;
        document.getElementById('mechanism-display').innerText = "MECH: " + protocol.mechanism;

        // 3. NUTRITION PRESCRIPTION
        const nutHtml = `
            <strong>Rx: ${protocol.meal}</strong><br>
            <span style="color:var(--text-muted)">+ ${protocol.juice}</span><br>
            <span style="font-size:0.75rem; color:var(--text-muted); margin-top:5px; display:block;">
                ${this.user === 'J' ? 'Reason: Fiber binds bile acids to lower LDL.' : 'Reason: Anti-oxidants reduce auto-antibody production.'}
            </span>
        `;
        document.getElementById('nutrition-prescription').innerHTML = nutHtml;
        document.getElementById('target-protein').innerText = u.macros.pro + "g";
        document.getElementById('target-fiber').innerText = u.macros.fiber + "g";

        // 4. BIOMARKER WATCHLIST (Dynamic Grid)
        let bioHtml = '';
        const labs = u.labs;
        for (const [key, val] of Object.entries(labs)) {
            let statusClass = "trend-good";
            // Simple logic for demo: High ApoB/ANA is bad
            if ((key === 'apob' && val > 80) || (key === 'ana' && val > 100)) statusClass = "trend-bad";
            
            bioHtml += `
                <div class="data-point" style="border-left: 2px solid ${statusClass === 'trend-bad' ? 'var(--alert)' : 'var(--border)'}">
                    <span class="dp-label">${key}</span>
                    <span class="dp-val ${statusClass}">${val}</span>
                </div>
            `;
        }
        document.getElementById('biomarker-grid').innerHTML = bioHtml;
    }

    updateUI() {
        document.querySelectorAll('.u-btn').forEach(b => b.classList.remove('active'));
        document.getElementById(`btn-${this.user}`).classList.add('active');
    }

    adhereProtocol() {
        const btn = document.querySelector('.autopilot-btn');
        const originalContent = btn.innerHTML;
        btn.style.background = "var(--acid)";
        btn.innerHTML = "<span>PROTOCOL LOGGED</span><span>✓</span>";
        
        // Visual feedback
        setTimeout(() => {
            btn.style.background = "var(--gold)";
            btn.innerHTML = originalContent;
        }, 2000);
    }
}

// Initialize Engine
const engine = new BioEngine();

</script>
</body>
</html>