<!DOCTYPE html>
<html lang="en">
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width,initial-scale=1.0,maximum-scale=1.0,user-scalable=no">
<title>Centurion v17.24 BIO-ENGINEER</title>
<style>
/* --- CORE STYLES --- */
:root { --bg:#050505; --panel:#121212; --border:#222; --acid:#ccff00; --cyan:#00f0ff; --purple:#bf5af2; --alert:#ff453a; --text:#fff; }
*{box-sizing:border-box;margin:0;padding:0}
body{background:var(--bg);color:var(--text);font-family:-apple-system, BlinkMacSystemFont, "Segoe UI", Roboto, Helvetica, Arial, sans-serif; padding-bottom:120px; -webkit-tap-highlight-color: transparent;}
.header{background:rgba(10,10,10,0.95);padding:15px;border-bottom:1px solid #333;position:sticky;top:0;z-index:100;backdrop-filter:blur(10px);}

/* CONTROLS */
.user-switch{display:flex;gap:8px;background:#1a1a1a;padding:4px;border-radius:24px;margin-bottom:10px; border:1px solid #333;}
.user-switch button{flex:1;padding:10px;border:none;background:transparent;color:#666;border-radius:20px;cursor:pointer;font-weight:800;font-size:0.75rem;transition:all 0.3s; letter-spacing:1px;}
.user-switch button.active{background:var(--acid);color:#000;box-shadow:0 0 15px rgba(204,255,0,0.4); text-shadow:none;}
.date-nav{display:flex;justify-content:space-between;align-items:center;margin-top:10px;background:#000;border:1px solid #333;border-radius:10px;padding:6px}
.nav-btn{background:transparent;border:none;color:var(--cyan);padding:5px 20px;font-size:1.2rem;cursor:pointer; text-shadow:0 0 8px rgba(0,240,255,0.6);}
#dateLabel{flex:1;text-align:center;color:#fff;font-weight:700;font-size:0.9rem;font-family:monospace; letter-spacing:1px;}
.bio-btn{position:absolute;right:15px;top:15px;background:rgba(255,255,255,0.05);color:var(--acid);border:1px solid var(--acid);padding:6px 12px;border-radius:6px;font-size:0.6rem;font-weight:900;cursor:pointer; box-shadow:0 0 5px rgba(204,255,0,0.2);}

/* HERO */
.hero{padding:25px 15px;display:flex;gap:15px;align-items:center;}
.dual-score{display:flex;gap:15px;align-items:center}
.score-box{border:2px solid #333;border-radius:50%;display:flex;flex-direction:column;align-items:center;justify-content:center;position:relative;background:#000;}
.score-box.small{width:70px;height:70px;}
.score-box.primary{width:90px;height:90px;border-width:3px;background:radial-gradient(circle,rgba(204,255,0,0.08) 0%,transparent 70%); border-color:var(--acid); box-shadow:0 0 25px rgba(204,255,0,0.2);}
.score-val{font-size:1.4rem;font-weight:900;line-height:1; color:#fff;}
.score-val.longevity{font-size:2.2rem;background:linear-gradient(135deg,var(--acid) 0%,var(--cyan) 100%);-webkit-background-clip:text;-webkit-text-fill-color:transparent; filter:drop-shadow(0 0 8px rgba(204,255,0,0.6));}
.score-label{font-size:0.45rem;color:#666;text-transform:uppercase;margin-top:4px;font-weight:800;letter-spacing:1px;}

/* ALERTS */
.alert{margin:0 15px 20px;padding:15px;border-radius:10px;text-align:center;font-weight:800;display:none;font-size:0.75rem;text-transform:uppercase;letter-spacing:1px; line-height:1.4;}
.alert.show{display:block;animation:pulse 3s infinite}
.alert-warning{background:rgba(255,214,10,0.15); border:1px solid #FFD60A; color:#FFD60A; box-shadow:0 0 15px rgba(255,214,10,0.1);}
.alert-protein{background:rgba(0,240,255,0.15); border:1px solid var(--cyan); color:var(--cyan); box-shadow:0 0 15px rgba(0,240,255,0.1);}
.alert-love{background:linear-gradient(135deg, #b00b69 0%, #52057b 100%); color:#fff; border:1px solid #ff69b4; text-shadow:0 1px 2px rgba(0,0,0,0.5); box-shadow:0 0 20px rgba(255,105,180,0.3);}
@keyframes pulse{0%{opacity:1}50%{opacity:0.8}100%{opacity:1}}

/* SECTIONS */
.section-header{padding:15px;font-size:0.65rem;font-weight:900;color:#888;letter-spacing:1.5px;text-transform:uppercase;margin-top:10px; display:flex; align-items:center; gap:10px;}
.section-header::after { content:''; height:1px; background:#333; flex:1; }

.grid-3{display:grid;grid-template-columns:1fr 1fr 1fr;gap:10px;padding:0 15px;margin-bottom:20px}
.grid-4{display:grid;grid-template-columns:1fr 1fr 1fr 1fr;gap:10px;padding:0 15px;margin-bottom:20px}

/* ORBS - HIGH CONTRAST NEON */
.orb-card{background:linear-gradient(145deg, #111 0%, #080808 100%); border:1px solid #222; border-radius:14px; padding:15px 5px; display:flex; flex-direction:column; align-items:center; transition:transform 0.1s;}
.orb-card:active{transform:scale(0.96);}
.orb-container{width:55px;height:55px;position:relative;display:flex;align-items:center;justify-content:center;margin-bottom:8px}
.orb-svg{transform:rotate(-90deg);width:100%;height:100%}
.orb-bg{fill:none;stroke:#1a1a1a;stroke-width:5;}
.orb-fg{fill:none;stroke-width:5;stroke-dasharray:145;stroke-dashoffset:145;transition:stroke-dashoffset 1s cubic-bezier(0.4, 0, 0.2, 1); stroke-linecap:round; filter:drop-shadow(0 0 4px currentColor);}

/* LEGIBILITY FIX */
.orb-val-box{position:absolute; top:0; left:0; width:100%; height:100%; display:flex; align-items:center; justify-content:center;}
.orb-val{font-family:'Courier New', monospace; font-size:0.75rem; font-weight:900; color:#fff; text-shadow:0 0 4px #000, 0 0 4px #000; letter-spacing:-0.5px; z-index:2;}
.orb-label{font-size:0.45rem;font-weight:800;color:#666;text-transform:uppercase;letter-spacing:0.5px}

/* HEARTS */
.heart-svg { width: 100%; height: 100%; overflow: visible; }
.heart-bg { fill: none; stroke: #1a1a1a; stroke-width: 2.5; }
.heart-fg { fill: none; stroke-width: 2.5; stroke-dasharray: 100; stroke-dashoffset: 100; transition: stroke-dashoffset 1s ease; filter:drop-shadow(0 0 3px currentColor); }
.beating { animation: heartbeat 1.5s infinite; transform-origin: center; }
@keyframes heartbeat { 0% { transform: scale(1); } 15% { transform: scale(1.1); } 30% { transform: scale(1); } 45% { transform: scale(1.1); } 60% { transform: scale(1); } }

/* RAINBOW */
.rainbow-container{padding:0 15px;margin-bottom:20px}
.rainbow-header{display:flex;justify-content:space-between;align-items:center;margin-bottom:10px}
.rainbow-title{font-size:0.65rem;font-weight:900;color:#ccc;letter-spacing:1px}
.rainbow-score{font-size:0.9rem;font-weight:900;color:var(--acid);font-family:monospace; text-shadow:0 0 10px rgba(204,255,0,0.3);}
.rainbow-track{height:10px;background:#111;border-radius:5px;display:flex;overflow:hidden;border:1px solid #333}
.rainbow-seg{height:100%;width:0%;transition:width 0.5s ease; box-shadow:inset 0 0 5px rgba(0,0,0,0.5);}
.rainbow-suggestion{font-size:0.65rem;color:var(--acid);margin-top:10px;font-weight:700;padding:10px;background:rgba(204,255,0,0.05);border-radius:8px;border:1px solid rgba(204,255,0,0.2); text-align:right;}

/* TIMELINE */
.timeline{padding:0 15px;margin-bottom:40px}
.task{display:flex;gap:12px;margin-bottom:15px;min-height:60px}
.task-time{width:45px;color:#666;font-size:0.7rem;padding-top:15px;text-align:right;font-family:monospace;font-weight:bold}
.task-card{flex:1;background:linear-gradient(180deg, #111 0%, #0d0d0d 100%);border:1px solid #333;border-radius:12px;padding:15px;position:relative;transition:all 0.2s; display:flex; justify-content:space-between; align-items:center;}
.task-card:active{transform:scale(0.98);background:#1a1a1a}
.task-card.checked{border-color:var(--acid);background:rgba(204,255,0,0.03); box-shadow:0 0 15px rgba(204,255,0,0.05);}
.task-card.auto-detected{border-color:var(--cyan);background:rgba(0,240,255,0.03);}
.task-info { flex:1; }
.task-title{font-weight:900;font-size:0.85rem;margin-bottom:5px;color:#fff}
.task-desc{font-size:0.7rem;color:#888;line-height:1.4}
.workout-badge{display:inline-block;background:var(--cyan);color:#000;padding:2px 6px;border-radius:4px;font-size:0.5rem;font-weight:900;margin-left:5px; vertical-align:middle; box-shadow:0 0 5px var(--cyan);}
.chevron { font-size:1.5rem; color:#333; margin-left:15px; font-weight:900; transition:color 0.2s;}
.task-card:active .chevron { color:var(--acid); }
.check-btn{width:40px;height:40px;display:flex;align-items:center;justify-content:center;cursor:pointer;margin-left:5px;}
.check-circle{width:26px;height:26px;border:2px solid #555;border-radius:50%;background:rgba(0,0,0,0.5);display:flex;align-items:center;justify-content:center;font-weight:900;font-size:1rem;color:transparent;transition:all 0.2s}
.task-card.checked .check-circle{background:var(--acid);border-color:var(--acid);color:#000; box-shadow:0 0 10px var(--acid);}

/* RECIPE DEEP DIVE MODAL */
.modal-overlay{position:fixed;top:0;left:0;width:100%;height:100%;background:rgba(0,0,0,0.95);z-index:500;display:none;overflow-y:auto;backdrop-filter:blur(8px);}
.modal-overlay.show{display:block}
.modal-content{width:100%;min-height:100vh;background:#050505;padding-bottom:120px;}
.modal-header{padding:20px;border-bottom:1px solid #222;display:flex;justify-content:space-between;align-items:center;position:sticky;top:0;background:rgba(5,5,5,0.95);z-index:10;}
.modal-title{font-size:1rem;font-weight:900;color:var(--acid);text-transform:uppercase;letter-spacing:1px; max-width:85%;}
.modal-close{background:transparent;border:none;color:#fff;font-size:2rem;cursor:pointer;line-height:1}
.modal-body{padding:20px;}

/* RECIPE STYLES */
.recipe-hero { margin-bottom:25px; }
.recipe-title { font-size:1.6rem; font-weight:900; line-height:1.1; margin-bottom:10px; color:#fff; }
.recipe-stats { display:flex; gap:20px; font-size:0.85rem; color:#888; font-weight:700; font-family:monospace; }

.macro-grid { display:grid; grid-template-columns: repeat(4, 1fr); gap:10px; margin-bottom:25px; }
.macro-stat { background:#111; border:1px solid #333; padding:12px 5px; border-radius:10px; text-align:center; }
.m-val { font-size:1.1rem; font-weight:900; color:#fff; font-family:monospace; }
.m-lbl { font-size:0.5rem; color:var(--acid); text-transform:uppercase; margin-top:4px; font-weight:900; }

.section-label { font-size:0.75rem; color:var(--cyan); font-weight:900; margin:25px 0 15px; text-transform:uppercase; letter-spacing:1px; border-bottom:2px solid #222; padding-bottom:5px; display:inline-block;}

/* UPDATED LIST STYLES */
.ing-item { color:#ccc; font-size:0.9rem; border-bottom:1px solid #1a1a1a; padding:10px 0; display:flex; align-items:center; }
.ing-item::before { content:'â€¢'; color:var(--acid); font-weight:bold; margin-right:10px; font-size:1.2rem; }

.step-item { display:flex; gap:15px; font-size:0.9rem; color:#ddd; line-height:1.6; margin-bottom:15px; background:#111; padding:15px; border-radius:10px; border:1px solid #222; }
.step-num { color:#000; background:var(--acid); font-weight:900; font-family:monospace; min-width:24px; height:24px; display:flex; align-items:center; justify-content:center; border-radius:50%; font-size:0.8rem; margin-top:2px; }

.synergy-box { background:linear-gradient(135deg, rgba(0,240,255,0.05) 0%, rgba(0,0,0,0) 100%); border:1px solid rgba(0,240,255,0.3); padding:20px; border-radius:12px; margin-bottom:20px; position:relative; overflow:hidden; }
.syn-title { color:var(--cyan); font-weight:900; font-size:0.75rem; text-transform:uppercase; margin-bottom:8px; letter-spacing:1px; }
.syn-text { color:#ccc; font-size:0.9rem; font-style:italic; line-height:1.5; }

.abs-alert{background:rgba(255,69,58,0.1);border:1px solid var(--alert);padding:15px;border-radius:10px;margin-bottom:15px;font-size:0.8rem;color:#fff;line-height:1.4; display:flex; align-items:center; gap:12px;}
.abs-boost{background:rgba(48,209,88,0.15);border:1px solid #30d158;padding:15px;border-radius:10px;margin-bottom:15px;font-size:0.8rem;color:#fff;line-height:1.4; display:flex; align-items:center; gap:12px;}

.select-btn { width:100%; background:var(--acid); color:#000; padding:18px; border:none; border-radius:12px; font-weight:900; font-size:1rem; cursor:pointer; margin-top:10px; text-transform:uppercase; box-shadow:0 0 20px rgba(204,255,0,0.3); transition:transform 0.1s; position:fixed; bottom:20px; left:20px; width:calc(100% - 40px); z-index:20;}
.select-btn:active { transform:scale(0.98); }

/* MENU LIST - REDESIGNED WITH RIGHT ALIGNMENT */
.menu-item { padding:20px; border-bottom:1px solid #222; cursor:pointer; display:flex; justify-content:space-between; align-items:center; transition:background 0.2s; background:linear-gradient(90deg, #111 0%, #0d0d0d 100%); margin-bottom:1px; }
.menu-item:active { background:#1a1a1a; }
.menu-left { flex:1; }
.menu-right { display:flex; gap:8px; align-items:center; justify-content:flex-end; min-width:80px; }
.menu-name { font-size:1rem; font-weight:800; color:#fff; margin-bottom:6px; letter-spacing:0.5px; }
.menu-meta { font-size:0.7rem; color:#888; font-family:monospace; margin-bottom:0px; display:flex; gap:10px;}
.menu-badges { display:flex; gap:6px; flex-wrap:wrap; margin-top:6px; }
.badge { font-size:0.6rem; padding:4px 8px; border-radius:6px; font-weight:900; text-transform:uppercase; letter-spacing:0.5px; white-space:nowrap; }
.badge.boost { background:rgba(48,209,88,0.15); color:#30d158; border:1px solid #30d158; }
.badge.block { background:rgba(255,69,58,0.15); color:#ff453a; border:1px solid #ff453a; }
.badge.omega { background:rgba(0,240,255,0.15); color:var(--cyan); border:1px solid var(--cyan); }
.badge.nitric { background:rgba(255, 69, 58, 0.2); color:#ff453a; border:1px solid #ff453a; }
.badge.gut { background:rgba(191, 90, 242, 0.2); color:var(--purple); border:1px solid var(--purple); }
.badge.thyroid { background:rgba(255, 214, 10, 0.2); color:#FFD60A; border:1px solid #FFD60A; }
.menu-arrow { color:#333; font-size:1.5rem; font-weight:900; margin-left:10px;}

.footer{position:fixed;bottom:0;left:0;width:100%;background:#000;padding:12px 15px;border-top:1px solid #333;display:flex;justify-content:space-between;align-items:center;z-index:90}
.sync-status{font-size:0.6rem;color:#666;font-family:monospace}
.sync-btn{background:var(--acid);color:#000;border:none;padding:8px 16px;border-radius:6px;cursor:pointer;font-weight:900;font-size:0.7rem}
</style>
</head>
<body>

<div class="header">
    <div class="user-switch">
        <button id="btn-jermaine" class="active" onclick="if(window.app)app.switchUser('jermaine')">JERMAINE</button>
        <button id="btn-sophia" onclick="if(window.app)app.switchUser('sophia')">SOPHIA</button>
    </div>
    <div class="date-nav">
        <button class="nav-btn" onclick="if(window.app)app.changeDate(-1)">â—€</button>
        <span id="dateLabel">LOADING...</span>
        <button class="nav-btn" onclick="if(window.app)app.changeDate(1)">â–¶</button>
    </div>
    <button class="bio-btn" onclick="if(window.app)app.openBio()">BIO</button>
</div>

<div id="alertBanner" class="alert"></div>

<div class="hero">
    <div class="dual-score">
        <div class="score-box small">
            <div class="score-val" id="dayGrade">--</div>
            <div class="score-label">TODAY</div>
        </div>
        <div class="score-box primary">
            <div class="score-val longevity" id="longevityScore">--</div>
            <div class="score-label">LONGEVITY</div>
            <div class="score-max">/120</div>
        </div>
    </div>
    <div class="status" id="statusMsg">INITIALIZING...</div>
</div>

<div class="section-header">SLEEP ARCHITECTURE</div>
<div class="grid-3">
    <div class="orb-card"><div class="orb-container"><svg class="orb-svg"><circle class="orb-bg" cx="25" cy="25" r="21"></circle><circle class="orb-fg" id="sleepOrb" cx="25" cy="25" r="21" style="stroke:#bf5af2"></circle></svg><div class="orb-val-box"><div class="orb-val" id="sleepVal">--</div></div></div><div class="orb-label" style="color:#bf5af2">TOTAL</div></div>
    <div class="orb-card"><div class="orb-container"><svg class="orb-svg"><circle class="orb-bg" cx="25" cy="25" r="21"></circle><circle class="orb-fg" id="deepOrb" cx="25" cy="25" r="21" style="stroke:#007aff"></circle></svg><div class="orb-val-box"><div class="orb-val" id="deepVal">--</div></div></div><div class="orb-label" style="color:#007aff">DEEP</div></div>
    <div class="orb-card"><div class="orb-container"><svg class="orb-svg"><circle class="orb-bg" cx="25" cy="25" r="21"></circle><circle class="orb-fg" id="remOrb" cx="25" cy="25" r="21" style="stroke:#bf5af2"></circle></svg><div class="orb-val-box"><div class="orb-val" id="remVal">--</div></div></div><div class="orb-label" style="color:#bf5af2">REM</div></div>
</div>

<div class="section-header">FUEL (NUTRITION)</div>
<div class="grid-4">
    <div class="orb-card"><div class="orb-container"><svg class="orb-svg"><circle class="orb-bg" cx="25" cy="25" r="21"></circle><circle class="orb-fg" id="proteinOrb" cx="25" cy="25" r="21" style="stroke:#fff"></circle></svg><div class="orb-val-box"><div class="orb-val" id="proteinVal">0</div></div></div><div class="orb-label" style="color:#fff">PROTEIN</div></div>
    <div class="orb-card"><div class="orb-container"><svg class="orb-svg"><circle class="orb-bg" cx="25" cy="25" r="21"></circle><circle class="orb-fg" id="omega3Orb" cx="25" cy="25" r="21" style="stroke:#00d4ff"></circle></svg><div class="orb-val-box"><div class="orb-val" id="omega3Val">0</div></div></div><div class="orb-label" style="color:#00d4ff">OMEGA-3</div></div>
    <div class="orb-card"><div class="orb-container"><svg class="orb-svg"><circle class="orb-bg" cx="25" cy="25" r="21"></circle><circle class="orb-fg" id="fiberOrb" cx="25" cy="25" r="21" style="stroke:#30d158"></circle></svg><div class="orb-val-box"><div class="orb-val" id="fiberVal">0</div></div></div><div class="orb-label" style="color:#30d158">FIBER</div></div>
    <div class="orb-card"><div class="orb-container"><svg class="orb-svg"><circle class="orb-bg" cx="25" cy="25" r="21"></circle><circle class="orb-fg" id="calorieOrb" cx="25" cy="25" r="21" style="stroke:#FFD60A"></circle></svg><div class="orb-val-box"><div class="orb-val" id="calorieVal">0</div></div></div><div class="orb-label" style="color:#FFD60A">CALORIES</div></div>
</div>

<div class="section-header">ENGINE (CARDIO)</div>
<div class="grid-4">
    <div class="orb-card">
        <div class="orb-container"><svg class="heart-svg beating" viewBox="0 0 24 24"><path class="heart-bg" d="M12 21.35l-1.45-1.32C5.4 15.36 2 12.28 2 8.5 2 5.42 4.42 3 7.5 3c1.74 0 3.41.81 4.5 2.09C13.09 3.81 14.76 3 16.5 3 19.58 3 22 5.42 22 8.5c0 3.78-3.4 6.86-8.55 11.54L12 21.35z" style="stroke:#ff453a; fill:rgba(255,69,58,0.2);"></path></svg><div class="orb-val-box"><div class="orb-val" id="rhrVal">--</div></div></div>
        <div class="orb-label" style="color:#ff453a">RHR</div>
    </div>
    <div class="orb-card">
        <div class="orb-container"><svg class="heart-svg" viewBox="0 0 24 24"><path class="heart-bg" d="M12 21.35l-1.45-1.32C5.4 15.36 2 12.28 2 8.5 2 5.42 4.42 3 7.5 3c1.74 0 3.41.81 4.5 2.09C13.09 3.81 14.76 3 16.5 3 19.58 3 22 5.42 22 8.5c0 3.78-3.4 6.86-8.55 11.54L12 21.35z"></path><path class="heart-fg" id="z2Heart" pathLength="100" d="M12 21.35l-1.45-1.32C5.4 15.36 2 12.28 2 8.5 2 5.42 4.42 3 7.5 3c1.74 0 3.41.81 4.5 2.09C13.09 3.81 14.76 3 16.5 3 19.58 3 22 5.42 22 8.5c0 3.78-3.4 6.86-8.55 11.54L12 21.35z" style="stroke:#00f0ff"></path></svg><div class="orb-val-box"><div class="orb-val" id="z2Val">0</div></div></div>
        <div class="orb-label" style="color:#00f0ff">ZONE 2</div>
    </div>
    <div class="orb-card">
        <div class="orb-container"><svg class="heart-svg" viewBox="0 0 24 24"><path class="heart-bg" d="M12 21.35l-1.45-1.32C5.4 15.36 2 12.28 2 8.5 2 5.42 4.42 3 7.5 3c1.74 0 3.41.81 4.5 2.09C13.09 3.81 14.76 3 16.5 3 19.58 3 22 5.42 22 8.5c0 3.78-3.4 6.86-8.55 11.54L12 21.35z"></path><path class="heart-fg" id="z5Heart" pathLength="100" d="M12 21.35l-1.45-1.32C5.4 15.36 2 12.28 2 8.5 2 5.42 4.42 3 7.5 3c1.74 0 3.41.81 4.5 2.09C13.09 3.81 14.76 3 16.5 3 19.58 3 22 5.42 22 8.5c0 3.78-3.4 6.86-8.55 11.54L12 21.35z" style="stroke:#ff453a"></path></svg><div class="orb-val-box"><div class="orb-val" id="z5Val">0</div></div></div>
        <div class="orb-label" style="color:#ff453a">ZONE 5</div>
    </div>
    <div class="orb-card">
        <div class="orb-container"><svg class="heart-svg" viewBox="0 0 24 24"><path class="heart-bg" d="M12 21.35l-1.45-1.32C5.4 15.36 2 12.28 2 8.5 2 5.42 4.42 3 7.5 3c1.74 0 3.41.81 4.5 2.09C13.09 3.81 14.76 3 16.5 3 19.58 3 22 5.42 22 8.5c0 3.78-3.4 6.86-8.55 11.54L12 21.35z"></path><path class="heart-fg" id="calHeart" pathLength="100" d="M12 21.35l-1.45-1.32C5.4 15.36 2 12.28 2 8.5 2 5.42 4.42 3 7.5 3c1.74 0 3.41.81 4.5 2.09C13.09 3.81 14.76 3 16.5 3 19.58 3 22 5.42 22 8.5c0 3.78-3.4 6.86-8.55 11.54L12 21.35z" style="stroke:#FFD60A"></path></svg><div class="orb-val-box"><div class="orb-val" id="calVal">0</div></div></div>
        <div class="orb-label" style="color:#FFD60A">BURN</div>
    </div>
</div>

<div class="section-header">PHYTONUTRIENT DIVERSITY ðŸŒˆ</div>
<div class="rainbow-container">
    <div class="rainbow-header"><div class="rainbow-title">RAINBOW SCORE</div><div class="rainbow-score" id="rainbowScore">0%</div></div>
    <div class="rainbow-track" id="rainbowTrack"></div>
    <div id="rainbowSuggestion" class="rainbow-suggestion" style="display:none"></div>
</div>

<div class="section-header">SYNERGY PROTOCOL ðŸ”„ AUTO-DETECT</div>
<div class="timeline" id="timeline"></div>

<div class="modal-overlay" id="mainModal">
    <div class="modal-content">
        <div class="modal-header">
            <div class="modal-title" id="modalTitle">TITLE</div>
            <button class="modal-close" onclick="app.closeModal()">Ã—</button>
        </div>
        <div class="modal-body" id="modalBody"></div>
    </div>
</div>

<div class="footer">
    <span class="sync-status" id="syncStatus">INIT</span>
    <button class="sync-btn" onclick="if(window.app)app.sync()">ðŸ”„ SYNC</button>
</div>

<script>
// --- CONFIGURATION ---
const USERS = {
    jermaine: {
        name: "Jermaine",
        dob: "1983-01-13",
        goals: { protein: 172, omega3: 12000, fiber: 50, water: 140, weightTarget: 210, heightInches: 70, z2: 45, z5: 20, calBurn: 500 },
        defaultBios: { bmr: '2057', apob: '114', lpa: '178', weight: '217.1', hscrp: '0.4', hba1c: '5.4' }
    },
    sophia: {
        name: "Sophia",
        dob: "1987-01-25",
        goals: { protein: 130, omega3: 4000, fiber: 35, water: 100, weightTarget: 140, heightInches: 64, z2: 30, z5: 15, calBurn: 350 },
        defaultBios: { bmr: '1450', apob: '70', lpa: '20', weight: '148', hscrp: '0.5', hba1c: '5.2' }
    }
};

// GLOBAL RECIPE DATABASE - RESTORED FULL LIST
const MEAL_DATABASE = {
    breakfast: [
        {title:"Omega Breakfast",time:"15min",servings:1,macros:{p:58,o:3500,poly:220,f:12,cal:680},ingredients:["8oz wild salmon","2 eggs","2 cups kale","1 cup blueberries","1oz walnuts","Â½ avocado","1 tsp EVOO","Salt, pepper"],steps:["Heat EVOO in pan","Season salmon","Cook salmon 4min per side","Scramble eggs separately","Massage kale 2min","Plate kale as base","Add salmon and eggs","Top with berries, nuts"],tips:["Buy wild-caught salmon","Massage kale until bright green","Don't overcook salmon"],why:"Salmon = 3500mg omega-3 to lower Lp(a). Eggs = choline. Walnuts = plant omega-3.",colors:['orange','purple','green']},
        {title:"Sophia's Sea Moss Oatmeal â­",time:"10min",servings:1,macros:{p:48,o:8200,poly:240,f:18,cal:580},ingredients:["1 cup steel-cut oats","2 scoops pea protein","1 tbsp Sea Moss Gel","3 tbsp ground flaxseed","2 tbsp hemp hearts","1 cup mixed berries","1 tbsp almond butter","Homemade Oat Milk"],steps:["Cook oats in Oat Milk 10min","Stir in pea protein and Sea Moss Gel","Top with flaxseed, hemp hearts","Add berries and almond butter","Sprinkle cinnamon"],tips:["Sea Moss thickens the oats nicely","Add extra Oat Milk if too thick","Flax + Sea Moss = Gut Healing"],why:"Sea Moss = 92 minerals + thyroid support. Flax = 6400mg omega-3. Ideal for ANA inflammation control.",colors:['purple','white']},
        {title:"PB Sea Moss Power Shake",time:"5min",servings:1,macros:{p:54,o:7200,poly:200,f:16,cal:680},ingredients:["2 scoops pea protein","1 tbsp Sea Moss Gel","3 tbsp ground flaxseed","2 tbsp peanut butter","1 banana","1 cup spinach","Homemade Oat Milk","Ice"],steps:["Add Oat Milk to blender","Add spinach (blends invisible)","Add banana, PB, Sea Moss","Add pea protein and flax","Add ice and cinnamon","Blend until smooth"],tips:["Sea Moss adds creaminess without taste","Freeze banana for texture","Blend spinach first"],why:"Sea Moss supports mucus membranes. Pea protein = 54g complete protein. Fast & nutrient dense.",colors:['green','white']},
        {title:"Smoked Trout Hash",time:"18min",servings:1,macros:{p:54,o:3200,poly:190,f:16,cal:640},ingredients:["6oz smoked trout","2 eggs","1 sweet potato","1 cup Brussels sprouts","Â½ red bell pepper","2 cloves garlic","2 tbsp EVOO","Dill"],steps:["Dice sweet potato small","SautÃ© sweet potato 10min","Add Brussels sprouts, cook 5min","Add bell pepper and garlic","Create wells, crack eggs","Cover until eggs set","Flake trout on top","Garnish with dill"],tips:["Smaller dice = faster cooking","Don't overcook eggs","Smoked trout is pre-cooked"],why:"Trout = 3200mg omega-3. Sweet potato = beta-carotene. Brussels sprouts = sulforaphane (Nrf2 activation).",colors:['orange','green']},
        {title:"Mackerel Scramble",time:"12min",servings:1,macros:{p:56,o:4800,poly:200,f:10,cal:660},ingredients:["1 can mackerel","4 eggs","1 cup arugula","Â½ avocado","1 cup mushrooms","Cherry tomatoes","2 tbsp EVOO","Turmeric"],steps:["SautÃ© mushrooms 5min","Drain mackerel, flake","Whisk eggs with turmeric","Scramble eggs with mackerel","Wilt arugula in pan","Plate with avocado and tomatoes"],tips:["Mackerel has 4x omega-3 vs salmon","Add turmeric to eggs for color","Fresh black pepper enhances turmeric"],why:"Mackerel = 4800mg omega-3 (absolute maximum). Turmeric = curcumin. Mushrooms = ergothioneine (longevity).",colors:['yellow','green']},
        {title:"Eggs & Oatmeal Combo",time:"12min",servings:1,macros:{p:52,o:7800,poly:220,f:16,cal:640},ingredients:["Â½ cup steel-cut oats","2 tbsp ground flaxseed","1 tbsp Sea Moss Gel","3 eggs","1 cup spinach","Â½ avocado","Berries","Homemade Oat Milk"],steps:["Cook oats with Sea Moss","Scramble eggs with spinach","Plate oatmeal with flax, berries","Serve eggs on side with avocado"],tips:["Sea Moss gel melts right in","Prep oats night before","Works great for weekend brunch"],why:"Best of both worlds. Flax omega-3 + egg choline. Sea Moss minerals.",colors:['green','white']},
        {title:"Savory Oatmeal Bowl",time:"15min",servings:1,macros:{p:46,o:6400,poly:200,f:18,cal:620},ingredients:["1 cup steel-cut oats","3 tbsp ground flaxseed","2 eggs","1 cup kale","Mushrooms","Nutritional yeast","EVOO","Garlic","Black pepper"],steps:["Cook oats in vegetable broth","SautÃ© mushrooms and kale","Soft-boil eggs","Mix flaxseed into oats","Top with vegetables and eggs","Sprinkle nutritional yeast"],tips:["Savory twist on oatmeal","Nutritional yeast adds B12","Top with EVOO for richness"],why:"Flax = 6400mg omega-3. Savory oats are trending. Kale = vitamin K. Sophia enjoys variety!",colors:['yellow','green']},
        {title:"Smoked Salmon Avocado Toast â­",time:"12min",servings:1,macros:{p:54,o:3400,poly:200,f:14,cal:680},ingredients:["6oz smoked salmon","2 slices sprouted grain bread","1 avocado","2 eggs","Capers","Red onion","Lemon","Dill"],steps:["Toast bread","Mash avocado with lemon","Spread avocado on toast","Top with smoked salmon","Poach eggs 3min","Place eggs on salmon","Garnish capers, onion, dill"],tips:["Use Ezekiel bread for fiber","Fresh dill is key","Don't overcook eggs"],why:"Salmon = 3400mg omega-3. Avocado = monounsaturated fat. Sophia's go-to breakfast!",colors:['orange','green']},
        {title:"Flax Protein Parfait",time:"5min",servings:1,macros:{p:48,o:8600,poly:240,f:18,cal:580},ingredients:["2 scoops pea protein","Â¼ cup ground flaxseed","1 cup Greek yogurt","1 cup mixed berries","2 tbsp hemp hearts","1 tbsp cacao nibs","Homemade Oat Milk"],steps:["Layer yogurt in bowl","Mix in pea protein","Top with ground flax","Add berries, hemp hearts, cacao","Drizzle Oat Milk if needed"],tips:["Grind flax fresh for max omega-3","Pea protein > whey for this","Frozen berries work great"],why:"Flax = 8600mg omega-3 plant-based. Pea protein = complete. Greek yogurt = probiotics.",colors:['white','purple']},
        {title:"Tofu Scramble Supreme",time:"12min",servings:1,macros:{p:44,o:2800,poly:200,f:10,cal:580},ingredients:["14oz extra-firm tofu","2 cups spinach","1 cup mushrooms","Nutritional yeast","Turmeric","Black salt (kala namak)","2 tbsp ground flaxseed","EVOO","Garlic"],steps:["Press tofu, crumble","SautÃ© garlic in EVOO","Add mushrooms, cook 5min","Add crumbled tofu","Season with turmeric, black salt","Add spinach, wilt","Top with nutritional yeast and flax"],tips:["Black salt gives eggy flavor","Press tofu well for texture","Turmeric for color and health"],why:"Tofu = complete protein. Flax = omega-3. Black salt mimics egg taste. Turmeric = anti-inflammatory.",colors:['yellow','green','white']},
        {title:"Crispy Tofu & Kale Bowl",time:"20min",servings:1,macros:{p:46,o:3400,poly:220,f:14,cal:640},ingredients:["14oz extra-firm tofu","2 cups kale","1 cup quinoa","2 tbsp ground flaxseed","2 tbsp hemp hearts","Â½ avocado","Tahini sauce","Sesame seeds"],steps:["Cook quinoa","Press and cube tofu","Bake tofu 20min at 400Â°F","Massage kale","Assemble bowl: quinoa, kale","Top with crispy tofu","Add flax, hemp, avocado","Drizzle tahini, sprinkle sesame"],tips:["Press tofu 30min for crispiest","Toss tofu in cornstarch before baking","Massage kale until tender"],why:"Tofu = complete protein. Flax + hemp = 3400mg omega-3. Quinoa = fiber. Tahini = calcium.",colors:['green','white']},
        {title:"Avocado Toast (Plant-Based)",time:"8min",servings:1,macros:{p:42,o:8600,poly:260,f:18,cal:620},ingredients:["2 slices sprouted grain bread","1 avocado","3 tbsp ground flaxseed","2 tbsp hemp hearts","1oz walnuts","Cherry tomatoes","Nutritional yeast","Lemon","Red pepper flakes"],steps:["Toast bread","Mash avocado with lemon","Mix in ground flaxseed","Spread on toast","Top with hemp hearts, walnuts","Add sliced tomatoes","Sprinkle nutritional yeast","Season with red pepper flakes"],tips:["Grind flax fresh","Mix flax into avocado for creaminess","Sprouted bread is lower glycemic"],why:"Flax = 6400mg omega-3. Hemp + walnuts = 2200mg more. Avocado = monounsaturated fat. 100% plant-based!",colors:['green','red']},
        {title:"Protein Pancakes",time:"15min",servings:1,macros:{p:52,o:6400,poly:180,f:14,cal:620},ingredients:["2 scoops pea protein","3 tbsp ground flaxseed","2 eggs","Â½ cup oats","1 banana","Cinnamon","Homemade Oat Milk","Greek yogurt (topping)","Berries","Maple syrup"],steps:["Blend oats into flour","Mix protein, flax, oat flour, cinnamon","Mash banana, add eggs, Oat Milk","Combine wet and dry","Heat griddle medium","Pour Â¼ cup batter per pancake","Cook 2min per side","Stack and top with Greek yogurt, berries","Drizzle maple syrup"],tips:["Don't overmix batter - lumps are OK","Medium heat prevents burning","Flax adds omega-3 + helps bind","Make extra and freeze"],why:"Pea protein = complete amino acids. Flax = 6400mg omega-3. Oats = fiber + slow carbs. Banana = potassium. Perfect post-workout breakfast!",colors:['purple','white']}
    ],

    juices: [
        {title:"The Red Pipe Clearer (Jermaine) â­",time:"10min",servings:1,macros:{p:2,o:0,poly:600,f:1,cal:110},ingredients:["2 medium beets (raw)","3 carrots","1 inch ginger","1/2 lemon (peeled)","1/2 green apple","Dash of cayenne"],steps:["Wash all produce thoroughly","Cut beets and carrots to fit chute","Juice beets, then ginger, then carrots","Finish with lemon and apple","Stir in dash of cayenne"],tips:["Beets stain! Wash immediately","Ginger skin can stay on","Drink within 20 mins for max enzymes"],why:"Beets = Nitric Oxide powerhouse (dilates arteries, improves flow for Lp(a) management). Ginger = anti-inflammatory.",colors:['red','orange']},
        {title:"The ANA Green Soother (Sophia) â­",time:"10min",servings:1,macros:{p:2,o:0,poly:550,f:1,cal:90},ingredients:["1 bunch celery","1 cucumber","2 inches turmeric root","1 inch ginger","1/2 lemon","Parsley bunch"],steps:["Juice turmeric and ginger first","Follow with parsley","Juice cucumber and celery (high water pushes herbs through)","Finish with lemon","Add black pepper to activate turmeric"],tips:["Add black pepper is crucial for turmeric absorption","Celery is high sodium (natural)","Very hydrating"],why:"Turmeric/Ginger = Top tier anti-inflammatory for ANA. Celery = Gut lining repair. Parsley = Heavy metal detox.",colors:['green','yellow']},
        {title:"Longevity Gold Elixir",time:"5min",servings:1,macros:{p:1,o:0,poly:400,f:0,cal:60},ingredients:["3 oranges (peeled)","1 tbsp Sea Moss Gel (stirred in)","1 inch turmeric","Black pepper","1 tsp Manuka honey"],steps:["Juice the oranges and turmeric","Pour into glass","Stir in Sea Moss Gel vigorousy","Add honey and black pepper"],tips:["Don't juice the Sea Moss, stir it in","Vitamin C boosts immunity","Great pre-workout"],why:"Citrus Vitamin C + Sea Moss minerals. Turmeric for inflammation. Manuka for antibacterial.",colors:['orange','yellow']},
        {title:"Homemade Kombucha Flight",time:"0min",servings:1,macros:{p:0,o:0,poly:200,f:0,cal:35},ingredients:["16oz Homemade Kombucha","Ice","Lemon slice","Mint sprig"],steps:["Pour chilled kombucha over ice","Garnish with fresh mint and lemon","Enjoy slowly"],tips:["Home brew has more active cultures","Watch sugar content in 2nd ferment","Drink through straw to protect enamel"],why:"Potent probiotics for gut microbiome diversity. Microbiome health is directly linked to autoimmune regulation (ANA).",colors:['yellow']}
    ],

    snack: [
        {title:"Savory Pulp Crackers (Zero Waste)",time:"10min (+8hr)",servings:4,macros:{p:6,o:1200,poly:150,f:12,cal:140},ingredients:["2 cups veggie pulp (beet/carrot/celery)","1/2 cup ground flaxseed","1/4 cup chia seeds","1/2 cup water","1 tsp garlic powder","1 tsp dried rosemary","Sea salt"],steps:["Mix pulp, seeds, and spices in a bowl","Stir in water until a dough forms","Spread thin (1/8 inch) on dehydrator sheets","Dehydrate at 115Â°F for 8 hours or until crisp","Break into chips"],tips:["Score with a knife before drying for clean shapes","Great with the hummus","Keeps for weeks in airtight jar"],why:"Massive fiber hit binds to cholesterol (Lp(a)). Rosemary is neuroprotective. Zero waste.",colors:['brown']},
        {title:"Citrus Ginger Pulp Chews",time:"10min (+6hr)",servings:4,macros:{p:3,o:200,poly:100,f:8,cal:110},ingredients:["1 cup fruit pulp (apple/lemon/ginger)","1/2 cup almond flour","1/4 cup shredded coconut","2 tbsp honey/maple","1 tsp cinnamon"],steps:["Combine all ingredients (mixture should be sticky)","Press into small molds or drop spoonfuls on sheet","Dehydrate at 115Â°F for 6-8 hours","Texture should be chewy like a macaroon"],tips:["Uses the pulp from the Longevity Elixir","If too wet, add more almond flour","Ginger bite intensifies when dried"],why:"Coconut MCTs for energy. Soluble fiber regulates blood sugar. Ginger for gut motility.",colors:['orange','white']},
        {title:"Dark Chocolate Oatmeal Balls",time:"10min",servings:2,macros:{p:10,o:300,poly:200,f:5,cal:210},ingredients:["1.5 cups rolled oats","1/2 cup dark chocolate chips (85%)","1/2 cup almond butter","1/3 cup maple syrup","1 scoop chocolate protein","1 tsp vanilla extract","Pinch of sea salt"],steps:["Mix oats, protein, and salt","Stir in almond butter, syrup, vanilla","Fold in chocolate chips","Roll into 1-inch balls","Chill 15 mins to set"],tips:["Use 85% chocolate for less sugar","Almond butter is lower inflammation than peanut","Great with coffee"],why:"Oats = beta-glucan (lowers LDL). Dark chocolate = flavonols for blood flow.",colors:['brown']},
        {title:"Centurion Protein Balls (PB)",time:"15min",servings:2,macros:{p:12,o:800,poly:120,f:4,cal:220},ingredients:["1 cup oats","1/2 cup peanut butter","1/3 cup honey","2 scoops protein powder","2 tbsp ground flax","1 tbsp chia seeds","Dark chocolate chips"],steps:["Mix all ingredients in a bowl","Roll into 1-inch balls","Refrigerate for 20 mins to set"],tips:["Wet hands slightly to prevent sticking","Store in freezer for longevity","Add splash of oat milk if too dry"],why:"Quick protein hit + omega-3 from flax/chia. Perfect pre/post workout.",colors:['brown']},
        {title:"Hummus & Carrots",time:"0min",servings:1,macros:{p:4,o:0,poly:100,f:6,cal:150},ingredients:["1/2 cup Hummus","2 Carrots (sliced)","Paprika dust","Drizzle EVOO"],steps:["Slice carrots into sticks","Scoop hummus into bowl","Dust with paprika and drizzle olive oil"],tips:["Add cucumber for more volume","Paprika adds antioxidants","EVOO boosts absorption"],why:"Fiber rich carb with healthy fats. Sustained energy release.",colors:['orange','white']},
        {title:"Beef Jerky (Grass-Fed)",time:"0min",servings:1,macros:{p:12,o:0,poly:0,f:0,cal:80},ingredients:["1oz Beef Jerky (Grass-fed)"],steps:["Open and enjoy"],tips:["Look for sugar-free options","Grass-fed has better lipid profile","Chewing aids satiety signaling"],why:"Pure bioavailable protein. Zero prep. convenient.",colors:['brown']},
        {title:"Roasted Seaweed Snacks",time:"0min",servings:1,macros:{p:1,o:100,poly:50,f:1,cal:30},ingredients:["1 pack Roasted Seaweed sheets"],steps:["Eat straight from pack"],tips:["Check oil source (olive/avocado best)","Satisfies salty cravings","Low calorie volume"],why:"Iodine powerhouse for thyroid health. Trace minerals.",colors:['green']},
        {title:"Omega Nut Mix",time:"0min",servings:1,macros:{p:6,o:2500,poly:180,f:4,cal:180},ingredients:["1oz Walnuts","1oz Brazil Nuts","1oz Almonds","Pumpkin seeds","Dried Goji berries"],steps:["Combine nuts in a small bowl","Enjoy!"],tips:["Brazil nuts = Selenium (limit to 2/day)","Walnuts = King of Omega-3","Goji = antioxidants"],why:"Walnuts essential for lowering Lp(a). Selenium supports thyroid function.",colors:['brown']}
    ],

    lunch: [
        {title:"Ahi Poke Bowl (Classic)",time:"15min",servings:1,macros:{p:45,o:1200,poly:200,f:8,cal:520},ingredients:["6oz fresh ahi tuna","1 cup brown rice (cooled)","1/4 cup diced cucumber","1/4 cup diced mango","1 tbsp sesame oil","1 tbsp soy sauce/tamari","Green onions","Sesame seeds","Seaweed salad"],steps:["Cube the ahi tuna into bite-sized pieces","In a bowl, toss tuna with soy sauce and sesame oil","Place cooled brown rice in serving bowl","Top with marinated tuna","Add cucumber, mango, and seaweed","Garnish with green onions and seeds"],tips:["Tuna must be sushi-grade","Keep everything cold","Mango adds natural sweetness"],why:"Ahi = lean protein & selenium. Seaweed = iodine for thyroid. Sesame = lignans.",colors:['red','green','yellow']},
        {title:"Ahi Pepperfin Style",time:"10min",servings:1,macros:{p:42,o:1000,poly:250,f:4,cal:380},ingredients:["6oz fresh ahi tuna (sliced thin)","1 jalapeÃ±o (thinly sliced)","2 tbsp ponzu sauce","1 tsp sesame oil","Sesame seeds","Microgreens or cilantro","Lemon wedge"],steps:["Slice tuna into thin sashimi-style strips","Arrange flat on a plate","Place a jalapeÃ±o slice on each piece of fish","Drizzle ponzu sauce and sesame oil over top","Sprinkle sesame seeds generously","Squeeze lemon juice just before eating"],tips:["Chill plate in freezer beforehand for best texture","Remove jalapeÃ±o seeds for less heat","Use sharpest knife possible"],why:"Pure high-quality protein. JalapeÃ±o = capsaicin (metabolism). Ponzu = lighter than soy.",colors:['red','green']},
        {title:"Salmon Pesto Pasta",time:"20min",servings:1,macros:{p:56,o:4200,poly:280,f:12,cal:740},ingredients:["6oz wild salmon","6oz chickpea pasta","Fresh basil pesto","Cherry tomatoes","Garlic","2 tbsp pine nuts","Parmesan","EVOO","Lemon","Arugula"],steps:["Cook chickpea pasta al dente","Season salmon","Pan-sear salmon 4min per side","Halve cherry tomatoes","SautÃ© garlic and tomatoes","Toss pasta with pesto","Flake salmon into pasta","Add arugula (wilts from heat)","Top with pine nuts, parmesan, lemon"],tips:["Chickpea pasta = high protein","Make pesto fresh if possible","Don't overcook salmon","Arugula adds peppery flavor"],why:"Salmon = 4200mg omega-3. Chickpea pasta = 14g protein per serving. Basil pesto = polyphenols. Pine nuts = additional healthy fats. High protein pasta dish!",colors:['pink','green','red']},
        {title:"Wild Salmon Poke Bowl â­",time:"15min",servings:1,macros:{p:56,o:5200,poly:240,f:18,cal:720},ingredients:["8oz wild salmon (sushi-grade)","1 cup brown rice","1 cup edamame","1 avocado","Cucumber","Seaweed","Sesame seeds","Tamari","Ginger","Sriracha","Lime"],steps:["Cook brown rice","Cube raw salmon","Marinate in tamari, ginger, sesame","Steam edamame","Slice cucumber and avocado","Assemble bowl: rice base","Add salmon, edamame, cucumber","Top with avocado, seaweed, sesame","Drizzle sriracha, lime"],tips:["Must use sushi-grade salmon","Keep salmon cold until serving","Marinate only 5min","Fresh ginger is essential"],why:"Salmon = 5200mg omega-3. Edamame = plant protein. Seaweed = iodine. This is Sophia's #1 favorite!",colors:['orange','green']},
        {title:"Chipotle Bowl (Bison) â­",time:"18min",servings:1,macros:{p:58,o:2800,poly:200,f:20,cal:740},ingredients:["6oz bison (93% lean)","1 cup brown rice","Black beans","Fajita peppers","Romaine","Tomato salsa","Greek yogurt","Avocado","Lime","Cilantro","2 tbsp ground flaxseed"],steps:["Cook rice","Season bison with cumin, paprika","Grill bison 4min per side","SautÃ© peppers","Warm black beans","Chop romaine","Build bowl: rice, beans, bison","Top with peppers, salsa, yogurt","Add avocado, cilantro, lime","Sprinkle flaxseed on top"],tips:["Bison cooks fast - don't overcook","Greek yogurt > sour cream","Fresh salsa is best","Sophia's chipotle recreation!"],why:"Bison = lean protein, lower TMAO than beef. Flax = omega-3 boost. Greek yogurt = probiotics. Sophia's craving solved!",colors:['brown','black','green','red']},
        {title:"Chipotle Bowl (Tofu) â­",time:"20min",servings:1,macros:{p:46,o:3200,poly:220,f:22,cal:680},ingredients:["14oz extra-firm tofu","1 cup brown rice","Black beans","Fajita peppers","Romaine","Tomato salsa","Guacamole","Lime","Cilantro","2 tbsp ground flaxseed","Cumin","Paprika"],steps:["Cook rice","Press tofu, cube","Toss tofu with cumin, paprika","Bake tofu 25min at 400Â°F","SautÃ© peppers","Warm beans","Build bowl: rice, beans, crispy tofu","Top with peppers, salsa, guacamole","Add cilantro, lime","Mix in flaxseed"],tips:["Press tofu 30min","Crispy tofu is key","Guacamole > plain avocado","Plant-based chipotle option!"],why:"Tofu = complete protein. Flax = 3200mg omega-3. Black beans = fiber + resistant starch. Sophia's plant option!",colors:['white','black','green']},
        {title:"Mediterranean Quinoa Salad",time:"15min",servings:1,macros:{p:22,o:1200,poly:350,f:14,cal:580},ingredients:["1 cup cooked quinoa","1 cup cucumber","1/2 cup cherry tomatoes","1/4 cup kalamata olives","1/4 red onion","2 tbsp parsley","2 tbsp feta cheese","2 tbsp EVOO","Lemon juice"],steps:["Cook quinoa and let cool","Chop cucumber, tomatoes, onion","Combine all ingredients in a bowl","Whisk EVOO and lemon juice","Toss salad with dressing","Top with feta and parsley"],tips:["Rinse quinoa before cooking","Cool quinoa prevents soggy salad","Add chickpeas for extra protein"],why:"Quinoa = complete protein. EVOO = polyphenols. Parsley = apigenin (CD38 inhibitor).",colors:['white','green','red','black']},
        {title:"Lentil Soup with Kale",time:"30min",servings:2,macros:{p:24,o:800,poly:280,f:18,cal:450},ingredients:["1 cup dry lentils","4 cups vegetable broth","1 onion","2 carrots","2 celery stalks","2 cups kale","2 cloves garlic","1 tsp thyme","1 tbsp EVOO"],steps:["SautÃ© onion, carrots, celery in EVOO","Add garlic and thyme","Add lentils and broth","Simmer 25 mins until lentils tender","Stir in kale until wilted","Season with salt and pepper"],tips:["Soak lentils to reduce cooking time","Freeze extras for meal prep","Add splash of vinegar at end"],why:"Lentils = high fiber/protein. Kale = nutrient density. Garlic = immune support.",colors:['brown','green','orange']},
        {title:"Chicken & Avocado Wrap",time:"10min",servings:1,macros:{p:35,o:500,poly:120,f:8,cal:520},ingredients:["1 whole wheat tortilla","4oz cooked chicken breast","1/2 avocado","1/2 cup spinach","1/4 cup shredded carrots","1 tbsp hummus","Dash of hot sauce"],steps:["Warm tortilla slightly","Spread hummus","Layer spinach and carrots","Add sliced chicken and avocado","Drizzle hot sauce","Roll up tightly"],tips:["Use rotisserie chicken for speed","Warm tortilla won't crack","Greek yogurt can sub for hummus"],why:"Chicken = lean protein. Avocado = monounsaturated fats. Whole wheat = fiber.",colors:['green','white']},
        {title:"Tuna NiÃ§oise Salad",time:"15min",servings:1,macros:{p:42,o:1500,poly:220,f:10,cal:560},ingredients:["1 can tuna in water","2 cups mixed greens","1 hard-boiled egg","1/2 cup green beans (steamed)","1/4 cup olives","1 small potato (boiled)","Vinaigrette dressing"],steps:["Drain tuna","Arrange greens on plate","Top with tuna, egg halves, beans","Add olives and sliced potato","Drizzle with vinaigrette"],tips:["Use high-quality tuna","Prep eggs/potatoes ahead","Traditional French protein salad"],why:"Tuna = omega-3. Egg = choline. Resistant starch from cooled potato.",colors:['green','white','black']},
        {title:"Turkey Burger & Sweet Potato",time:"20min",servings:1,macros:{p:38,o:300,poly:150,f:8,cal:580},ingredients:["5oz turkey patty","1 whole wheat bun","Lettuce, tomato, onion","1 small sweet potato","1 tsp EVOO","Paprika"],steps:["Slice sweet potato into wedges","Toss with EVOO/paprika, air fry 15min","Grill turkey patty 5min/side","Toast bun","Assemble burger with toppings"],tips:["Don't overmix turkey meat","Sweet potato needs high heat","Add avocado to burger for fats"],why:"Turkey = lean protein. Sweet potato = beta-carotene. Whole grains = fiber.",colors:['white','orange','green']},
        {title:"Chickpea Curry (Quick)",time:"20min",servings:2,macros:{p:18,o:400,poly:320,f:14,cal:480},ingredients:["1 can chickpeas","1 cup coconut milk (light)","1 tbsp red curry paste","1 cup spinach","1/2 cup bell pepper","1/2 onion","Basmati rice"],steps:["SautÃ© onion and peppers","Add curry paste, cook 1 min","Add coconut milk and chickpeas","Simmer 10 mins","Stir in spinach","Serve over rice"],tips:["Rinse chickpeas well","Adjust paste for spice level","Frozen spinach works too"],why:"Chickpeas = fiber/protein. Turmeric in paste = anti-inflammatory.",colors:['yellow','green','white']},
        {title:"Bison Taco Salad",time:"15min",servings:1,macros:{p:45,o:800,poly:200,f:12,cal:620},ingredients:["5oz ground bison","2 cups romaine","1/2 cup black beans","1/4 cup salsa","1/4 avocado","1 tbsp greek yogurt","Cumin, chili powder"],steps:["Brown bison with spices","Drain fat","Assemble lettuce base","Top with meat, beans, salsa","Add avocado and yogurt dollop"],tips:["Bison cooks faster than beef","Greek yogurt mimics sour cream","Cumin aids digestion"],why:"Bison = nutrient dense red meat. Beans = soluble fiber.",colors:['brown','black','green','red']},
        {title:"Edamame & Quinoa Bowl",time:"15min",servings:1,macros:{p:24,o:1800,poly:260,f:12,cal:540},ingredients:["1 cup cooked quinoa","1 cup shelled edamame","1/2 cup shredded purple cabbage","1 carrot (shredded)","Ginger soy dressing","Sesame seeds"],steps:["Warm quinoa and edamame","Toss with cabbage and carrot","Drizzle dressing","Top with sesame seeds"],tips:["Buy frozen shelled edamame","Purple cabbage = anthocyanins","Great cold or warm"],why:"Edamame = soy protein. Purple cabbage = antioxidants.",colors:['green','purple','orange']},
        {title:"Smoked Salmon Bagel (Open)",time:"5min",servings:1,macros:{p:32,o:2800,poly:100,f:6,cal:480},ingredients:["1 whole grain bagel","4oz smoked salmon","2 tbsp cream cheese","Capers","Red onion","Dill","Cucumber slices"],steps:["Toast bagel","Spread cream cheese","Layer salmon","Top with capers, onion, dill","Serve cucumber on side"],tips:["Open face saves carbs","High quality salmon matters","Rinse capers to reduce sodium"],why:"Salmon = omega-3. Whole grain = fiber.",colors:['orange','white','green']},
        {title:"Leftover Roast Chicken Salad",time:"10min",servings:1,macros:{p:40,o:600,poly:180,f:8,cal:520},ingredients:["5oz roast chicken (cold)","2 cups arugula","1/2 apple (diced)","1/4 cup walnuts","Celery","Yogurt dressing"],steps:["Chop chicken and celery","Toss with arugula and apple","Add walnuts","Mix with yogurt dressing"],tips:["Great use of leftovers","Apple adds crunch/sweetness","Walnuts = omega-3"],why:"Chicken = protein. Walnuts = ALA omega-3. Apple = quercetin.",colors:['white','green','brown']},
        {title:"Tempeh Reuben Bowl",time:"15min",servings:1,macros:{p:28,o:1200,poly:240,f:16,cal:560},ingredients:["6oz tempeh strips","1/2 cup sauerkraut","1 slice swiss cheese","Rye croutons","Thousand island dressing (light)","Mixed greens"],steps:["Pan fry tempeh strips","Melt cheese on tempeh","Place over greens","Add kraut and croutons","Drizzle dressing"],tips:["Fermented kraut = probiotics","Tempeh is firmer than tofu","Rye flavor is classic"],why:"Tempeh/Kraut = gut health powerhouse.",colors:['brown','green']},
        {title:"Shrimp & Asparagus Stir Fry",time:"15min",servings:1,macros:{p:35,o:800,poly:160,f:8,cal:450},ingredients:["6oz shrimp","1 bunch asparagus","Garlic","Ginger","Soy sauce","Sesame oil","Cauliflower rice"],steps:["SautÃ© garlic/ginger in oil","Add asparagus, stir fry 3min","Add shrimp, cook until pink","Add soy sauce","Serve over cauli rice"],tips:["Don't overcook shrimp (rubbery)","Cauli rice keeps it light","Fresh ginger is best"],why:"Shrimp = astaxanthin. Asparagus = prebiotic. Low carb option.",colors:['pink','green','white']},
        {title:"Turkey Club Wrap",time:"10min",servings:1,macros:{p:38,o:400,poly:100,f:6,cal:540},ingredients:["1 large tortilla","4oz turkey breast","2 slices turkey bacon","Lettuce","Tomato","Mayo (light)"],steps:["Cook bacon until crisp","Spread mayo on wrap","Layer turkey, bacon, veg","Roll tightly and slice"],tips:["Turkey bacon cuts fat","Bibb lettuce is softest","Toothpicks hold it together"],why:"High protein lunch standard.",colors:['white','green','red']},
        {title:"Bean & Cheese Burrito (Healthy)",time:"10min",servings:1,macros:{p:22,o:200,poly:180,f:14,cal:580},ingredients:["1 large whole wheat tortilla","1/2 cup refried beans (vegetarian)","1/4 cup cheddar","Salsa","Spinach","Greek yogurt"],steps:["Spread beans on tortilla","Add cheese and salsa","Add spinach","Roll and heat in pan","Dip in yogurt"],tips:["Vegetarian beans usually fat-free","Crisping the tortilla adds texture","Spinach hides easily inside"],why:"Beans = fiber/protein combo. Whole wheat = sustained energy.",colors:['brown','green','white']},
        {title:"Cottage Cheese & Fruit Bowl",time:"5min",servings:1,macros:{p:28,o:200,poly:250,f:8,cal:380},ingredients:["1 cup cottage cheese","1 cup pineapple/melon","2 tbsp sunflower seeds","Mint leaves"],steps:["Scoop cottage cheese","Top with fruit","Sprinkle seeds","Garnish with mint"],tips:["Good culture cottage cheese has probiotics","Sunflower seeds add crunch","High volume low calorie"],why:"Casein protein (slow digest). Fruit = vitamins.",colors:['white','yellow']},
        {title:"Zucchini Noodles with Meat Sauce",time:"20min",servings:1,macros:{p:35,o:600,poly:220,f:10,cal:480},ingredients:["2 zucchini (spiralized)","5oz lean ground beef","1 cup marinara sauce","Parmesan","Garlic"],steps:["Brown beef with garlic","Add marinara, simmer","SautÃ© zoodles 2 mins separate","Top zoodles with sauce","Sprinkle parm"],tips:["Salt zoodles to draw out water","Don't cook zoodles in sauce (soggy)","Lean beef cuts saturated fat"],why:"Low carb pasta alternative. Lycopene in sauce.",colors:['red','green']}
    ],

    dinner: [
        {title:"Seafood Cioppino â­",time:"40min",servings:2,macros:{p:42,o:1800,poly:320,f:8,cal:480},ingredients:["1/2lb white fish (cod/halibut)","1/2lb mussels or shrimp","1 can crushed tomatoes","1 cup seafood broth","1/2 onion","1 fennel bulb","2 cloves garlic","1/2 cup dry white wine","Parsley"],steps:["SautÃ© onion, fennel, garlic","Add wine, reduce by half","Add broth and tomatoes, simmer 20 min","Add fish/shellfish, cover 5-7 min","Serve hot with parsley"],tips:["Don't stir too much after adding fish","Fennel adds classic anise flavor","Great for longevity"],why:"Tomato lycopene + Omega-3s. Fennel digestion support.",colors:['white','red','green']},
        {title:"Herb Crusted Cod",time:"20min",servings:1,macros:{p:52,o:2800,poly:150,f:10,cal:580},ingredients:["8oz wild cod","Â½ cup almond flour","1 egg","Parsley","Dill","Lemon zest","Asparagus","1 tbsp EVOO"],steps:["Mix almond flour, herbs, zest","Dip cod in egg, then flour","Pan fry 4min per side in EVOO","Steam asparagus","Plate with lemon wedges"],tips:["Almond flour adds healthy fat","Don't flip fish too early","Fresh herbs make the difference"],why:"Cod = lean protein. Almonds = Vitamin E. Asparagus = prebiotic fiber.",colors:['white','green']},
        {title:"Grass-Fed Steak & Sprouts",time:"25min",servings:1,macros:{p:60,o:1200,poly:180,f:14,cal:720},ingredients:["8oz grass-fed sirloin","2 cups Brussels sprouts","Â½ sweet potato","Garlic","Rosemary","Balsamic vinegar","1 tbsp EVOO"],steps:["Halve sprouts, toss in balsamic","Roast sprouts and potato 20min at 400Â°F","Sear steak 3min per side","Rest steak 5min","Slice against grain"],tips:["Grass-fed has 5x omega-3 of grain-fed","Resting steak is crucial","Crispy sprouts need high heat"],why:"Grass-fed beef = CLA and Omega-3. Brussels = sulforaphane. Sweet potato = potassium.",colors:['red','green','orange']},
        {title:"Mediterranean Chicken",time:"25min",servings:1,macros:{p:55,o:800,poly:240,f:12,cal:640},ingredients:["8oz chicken breast","1 cup quinoa","Cucumber","Cherry tomatoes","Kalamata olives","Feta cheese","Oregano","Olive oil"],steps:["Cook quinoa","Grill chicken with oregano","Chop veg","Mix quinoa, veg, olives","Top with sliced chicken and feta","Drizzle olive oil"],tips:["Marinate chicken 10min","Authentic Greek feta is sheep/goat","Fresh oregano is best"],why:"Chicken = lean complete protein. Olives = hydroxytyrosol (potent antioxidant). Quinoa = complete plant protein.",colors:['white','black','red']},
        {title:"Tempeh Stir Fry (Plant)",time:"15min",servings:1,macros:{p:42,o:2200,poly:190,f:18,cal:580},ingredients:["8oz tempeh","Broccoli","Bell peppers","Snap peas","Ginger","Garlic","Tamari","Sesame oil","Brown rice"],steps:["Steam tempeh 5min (removes bitterness)","Cube and sautÃ© in sesame oil","Add veggies, ginger, garlic","Add splash of water to steam veg","Finish with tamari","Serve over rice"],tips:["Steaming tempeh first is pro tip","High heat for wok hei flavor","Don't overcook veggies"],why:"Tempeh = fermented soy (gut health). Ginger = anti-inflammatory. Broccoli = sulforaphane.",colors:['brown','green','red']},
        {title:"Sheet Pan Salmon & Veggies",time:"20min",servings:1,macros:{p:45,o:3200,poly:200,f:10,cal:620},ingredients:["6oz salmon fillet","1 cup broccoli florets","1 cup bell peppers","1 tbsp olive oil","Lemon slices","Dill","Garlic powder"],steps:["Preheat oven to 400Â°F","Toss veggies in oil and spices","Place salmon and veggies on pan","Top salmon with lemon/dill","Roast 15-18 mins"],tips:["Easy cleanup","Salmon is done when flakes easily","Veggies get nice char"],why:"Salmon = omega-3. One pan meal. Broccoli = detox support.",colors:['orange','green','red']},
        {title:"Turkey Chili",time:"35min",servings:2,macros:{p:35,o:400,poly:250,f:15,cal:500},ingredients:["1lb ground turkey","1 can kidney beans","1 can diced tomatoes","1 onion","1 bell pepper","Chili powder","Cumin","Garlic"],steps:["Brown turkey with onion/garlic","Add peppers and spices","Add tomatoes and beans","Simmer 20 mins","Serve warm"],tips:["Better the next day","Top with avocado","Lean comfort food"],why:"Turkey = lean protein. Beans = fiber. Tomatoes = lycopene.",colors:['brown','red']},
        {title:"Shrimp Scampi with Zoodles",time:"15min",servings:1,macros:{p:30,o:600,poly:120,f:6,cal:420},ingredients:["6oz shrimp","2 zucchini (spiralized)","2 tbsp butter/ghee","3 cloves garlic","Lemon juice","Parsley","Red pepper flakes"],steps:["SautÃ© garlic in butter","Add shrimp, cook pink","Add lemon and flakes","Toss in zoodles for 1 min","Garnish parsley"],tips:["Zoodles cook very fast","Ghee adds buttery flavor without burning","Low carb classic"],why:"Shrimp = iodine/selenium. Zucchini = low cal volume.",colors:['pink','green','white']},
        {title:"Lamb Kofta Bowl",time:"25min",servings:1,macros:{p:40,o:900,poly:180,f:10,cal:680},ingredients:["6oz ground lamb","1 tsp cumin/coriander","Cucumber yogurt sauce","Tomatoes","Onion","Mixed greens","Pita"],steps:["Mix lamb with spices","Form small oblong patties","Grill or pan fry 8 mins","Assemble bowl with greens","Top with kofta and sauce"],tips:["Lamb has distinct flavor","Don't overwork meat","Fresh mint in yogurt is great"],why:"Lamb = zinc/iron. Fermented yogurt = gut health.",colors:['brown','green','white','red']},
        {title:"Pesto Chicken Zoodles",time:"15min",servings:1,macros:{p:45,o:500,poly:200,f:8,cal:550},ingredients:["6oz chicken breast","2 zucchini","1/4 cup basil pesto","Cherry tomatoes","Parmesan"],steps:["Cook chicken pieces","Spiralize zucchini","Toss chicken and zoodles with pesto","Add halved tomatoes","Warm through"],tips:["Pesto contains nuts (usually)","Cherry tomatoes add pop of acid","Quick weeknight meal"],why:"Basil = anti-bacterial. Chicken = protein base.",colors:['green','white','red']},
        {title:"Seared Scallops & Risotto",time:"30min",servings:1,macros:{p:35,o:700,poly:100,f:4,cal:580},ingredients:["6oz sea scallops","1/2 cup arborio rice","2 cups broth","White wine (splash)","Parmesan","Peas","Butter"],steps:["Cook risotto (ladle broth slowly)","Stir in peas/parm","Sear scallops in hot butter (2 min/side)","Serve scallops atop risotto"],tips:["Dry scallops thoroughly before searing","Pan must be screaming hot","Don't crowd the pan"],why:"Scallops = B12/magnesium. Peas = plant protein.",colors:['white','green']},
        {title:"Chicken Stir Fry",time:"15min",servings:1,macros:{p:40,o:300,poly:150,f:8,cal:520},ingredients:["6oz chicken breast","Broccoli","Snap peas","Carrots","Soy sauce","Ginger/Garlic","Sesame oil"],steps:["Slice chicken thin","Stir fry chicken","Remove, stir fry veg","Combine with sauce","Simmer 1 min"],tips:["High heat is key","Prep all veg before starting","Cashews add nice crunch"],why:"Lean protein + fiber rich veg.",colors:['white','green','orange']},
        {title:"Baked Cod with Salsa",time:"20min",servings:1,macros:{p:45,o:2000,poly:180,f:8,cal:480},ingredients:["8oz cod fillet","1/2 cup salsa","1/4 avocado","Cilantro","Lime","Asparagus side"],steps:["Place cod in baking dish","Top with salsa","Bake 400Â°F for 15 min","Top with avocado/cilantro","Serve with steamed asparagus"],tips:["Simplest fish recipe","Prevents dry fish","Low fat high protein"],why:"Cod = low calorie protein source.",colors:['white','red','green']},
        {title:"Beef Bolognese (Zoodles)",time:"40min",servings:2,macros:{p:35,o:500,poly:250,f:10,cal:550},ingredients:["1lb ground beef","1 jar marinara (no sugar)","1 onion","2 carrots","Celery","Zucchini noodles"],steps:["Brown beef","Add chopped veg, cook 5 min","Add sauce, simmer 20 min","Serve over raw or lightly sautÃ©ed zoodles"],tips:["Simmering builds flavor","Grate carrots to hide them","Freezes well"],why:"Beef = iron. Tomato sauce = lycopene.",colors:['red','green']},
        {title:"Sesame Crusted Tuna",time:"15min",servings:1,macros:{p:45,o:2500,poly:150,f:6,cal:580},ingredients:["6oz tuna steak","Sesame seeds","Soy sauce","Wasabi","Cucumber salad side"],steps:["Press tuna into seeds","Sear 1 min per side (rare)","Slice thin","Serve with dipping sauce and cucumber"],tips:["Sushi grade tuna needed for rare","Don't overcook or it gets dry","Press seeds firmly"],why:"Tuna = selenium. Sesame = lignans.",colors:['red','white','green']},
        {title:"Stuffed Bell Peppers",time:"45min",servings:2,macros:{p:30,o:400,poly:200,f:12,cal:500},ingredients:["2 large bell peppers","1/2lb ground turkey","1 cup cooked quinoa","Tomato sauce","Italian seasoning","Cheese (optional)"],steps:["Cut tops off peppers","Mix turkey, quinoa, sauce, spices","Stuff peppers","Bake 375Â°F for 35-40 min"],tips:["Par-boil peppers for softer texture","Use colored peppers for antioxidants","Meal prep favorite"],why:"Peppers = Vitamin C. Turkey = lean protein.",colors:['red','green','brown']},
        {title:"Egg Roll in a Bowl",time:"15min",servings:1,macros:{p:35,o:600,poly:200,f:10,cal:480},ingredients:["1/2lb ground pork/turkey","1 bag coleslaw mix","Ginger","Garlic","Soy sauce","Sriracha","Green onions"],steps:["Brown meat","Add slaw mix, ginger, garlic","SautÃ© until wilted","Stir in soy/sriracha","Top with green onions"],tips:["Crack an egg in for extra richness","Sesame oil finishes it well","Keto friendly"],why:"Cabbage = cruciferous benefits. High volume meal.",colors:['white','green']},
        {title:"Lemon Garlic Shrimp",time:"15min",servings:1,macros:{p:30,o:500,poly:100,f:4,cal:380},ingredients:["8oz shrimp","2 tbsp butter","3 cloves garlic","Lemon juice","Parsley","Green beans"],steps:["Steam green beans","SautÃ© garlic in butter","Cook shrimp","Finish with lemon/parsley","Plate together"],tips:["Classic flavor combo","Don't burn garlic","Light dinner"],why:"Shrimp = high protein low fat.",colors:['pink','green','white']},
        {title:"Meatballs & Marinara",time:"30min",servings:2,macros:{p:32,o:400,poly:200,f:8,cal:550},ingredients:["1lb ground beef","1 egg","1/4 cup almond flour","Italian herbs","Marinara sauce","Spinach side"],steps:["Mix meat, egg, flour, herbs","Roll balls","Bake 400Â°F 20 min","Simmer in sauce 5 min","Serve with wilted spinach"],tips:["Don't overmix meat","Baking is cleaner than frying","Almond flour keeps them gluten free"],why:"Beef = B12/Zinc. Spinach = folate.",colors:['red','green']},
        {title:"Curry Chicken Salad",time:"10min",servings:1,macros:{p:40,o:800,poly:180,f:8,cal:560},ingredients:["5oz cooked chicken","Greek yogurt","Curry powder","Grapes/Raisins","Cashews","Celery"],steps:["Chop chicken","Mix yogurt and curry powder","Combine all","Serve in lettuce cups"],tips:["Yogurt subs for mayo","Sweet/savory combo","Good cold lunch/dinner"],why:"Curry = turmeric anti-inflammatory. Yogurt = probiotics.",colors:['yellow','green']}
    ]
};

const BASE_PROTOCOL = [
    { id: 'sunrise', time: '06:00', title: 'Morning Walk', desc: '15min walk + cold shower', macros: { p: 0, o: 0, f: 0, cal: 0 }, colors: [], calBurn: 60 },
    { id: 'breakfast', time: '07:30', title: 'Breakfast', desc: 'Tap to select meal', macros: { p: 0, o: 0, f: 0, cal: 0 }, colors: [], calBurn: 0, clickable: true, mealSlot: 'breakfast' },
    { id: 'juice', time: '08:30', title: 'Fresh Juice/Elixir', desc: 'Tap to select juice', macros: { p: 0, o: 0, f: 0, cal: 0 }, colors: [], calBurn: 0, clickable: true, mealSlot: 'juices' },
    { id: 'train', time: '09:00', title: 'Training', desc: 'Auto-detected from Oura', macros: { p: 0, o: 0, f: 0, cal: 0 }, colors: [], calBurn: 0, clickable: false, autoDetect: true },
    { id: 'lunch', time: '13:00', title: 'Lunch', desc: 'Tap to select meal', macros: { p: 0, o: 0, f: 0, cal: 0 }, colors: [], calBurn: 0, clickable: true, mealSlot: 'lunch' },
    { id: 'snack', time: '15:30', title: 'Longevity Snack', desc: 'Tap to select snack', macros: { p: 0, o: 0, f: 0, cal: 0 }, colors: [], calBurn: 0, clickable: true, mealSlot: 'snack' },
    { id: 'dinner', time: '18:30', title: 'Dinner', desc: 'Tap to select meal', macros: { p: 0, o: 0, f: 0, cal: 0 }, colors: [], calBurn: 0, clickable: true, mealSlot: 'dinner' },
    { id: 'evening', time: '21:00', title: 'Wind Down', desc: 'Chamomile tea + stretch', macros: { p: 0, o: 0, f: 0, cal: 0 }, colors: ['purple'], calBurn: 0 }
];

const TOKENS = { jermaine: 'WLIGFPFJQY73G43BY7CK7H6UJXPQ7N5Y', sophia: '4QSDWYJJUZFHRWRH727NCK7WH4COQJF4' };

const LONGEVITY_MARKERS = {
    apob: { weight: 15, optimal: 80, threshold: 130, direction: 'lower' },
    lpa: { weight: 15, optimal: 30, threshold: 150, direction: 'lower' },
    rhr: { weight: 10, optimal: 50, threshold: 75, direction: 'lower' },
    sleepScore: { weight: 10, optimal: 85, threshold: 60, direction: 'higher' }
};

const RAINBOW_COLORS = {
    red: { hex: '#ff453a', examples: 'Tomatoes, Beets' },
    orange: { hex: '#ff9f0a', examples: 'Carrots, Salmon' },
    yellow: { hex: '#ffd60a', examples: 'Lemon, Turmeric' },
    green: { hex: '#30d158', examples: 'Kale, Spinach' },
    purple: { hex: '#bf5af2', examples: 'Blueberries' },
    white: { hex: '#fff', examples: 'Garlic, Onion' },
    brown: { hex: '#A0522D', examples: 'Nuts, Seeds' },
    pink: { hex: '#FF69B4', examples: 'Shrimp, Salmon' },
    black: { hex: '#333', examples: 'Olives, Beans' }
};

const ABSORPTION_RULES = {
    blockers: {
        calcium_iron: { warning: "Calcium blocks iron absorption", check: (ing) => (ing.includes('salmon') && ing.includes('yogurt')) },
        phytates: { warning: "Phytates block mineral uptake", check: (ing) => (ing.includes('oats') || ing.includes('beans')) }
    },
    boosters: {
        vitc_iron: { boost: "Vit C boosts Iron 3x", check: (ing) => (ing.includes('spinach') && ing.includes('citrus')) },
        fat_omega: { boost: "Fat helps Omega-3 absorb", check: (ing) => (ing.includes('salmon') && ing.includes('avocado')) }
    }
};

const WORKOUT_TYPES = { strength_training: 'Strength', cycling: 'Cycling', running: 'Running', walking: 'Walking', swimming: 'Swim', other: 'Workout' };

// --- APP CLASS ---
class CenturionApp {
    constructor() {
        console.log('ðŸš€ Init v17.23 FULL-MENU');
        // FORCE RESET FOR NEW DB
        const CURRENT_VER = '17.23.0';
        const savedVer = localStorage.getItem('centurion_version');
        if(savedVer !== CURRENT_VER) { localStorage.clear(); localStorage.setItem('centurion_version', CURRENT_VER); }

        this.user = localStorage.getItem('centurion_user') || 'jermaine';
        this.history = [];
        this.currentIndex = 0;
        this.currentDateStr = new Date().toLocaleDateString('en-CA');
        this.checked = {};
        this.meals = {};
        this.bios = {};
        this.protocol = [];
        
        this.loadUserData();
        this.setPlaceholderData();
        this.render();
        this.fetchOuraData();
    }

    loadUserData() {
        try {
            const savedChecked = localStorage.getItem(`c_checked_${this.user}`);
            this.checked = savedChecked ? JSON.parse(savedChecked) : {};
            const savedMeals = localStorage.getItem(`c_meals_${this.user}`);
            this.meals = savedMeals ? JSON.parse(savedMeals) : {};
            const savedBios = localStorage.getItem(`c_bios_${this.user}`);
            this.bios = savedBios ? JSON.parse(savedBios) : USERS[this.user].defaultBios;
        } catch(e) { this.checked = {}; this.meals = {}; }
    }

    saveUserData() {
        localStorage.setItem(`c_checked_${this.user}`, JSON.stringify(this.checked));
        localStorage.setItem(`c_meals_${this.user}`, JSON.stringify(this.meals));
        localStorage.setItem(`c_bios_${this.user}`, JSON.stringify(this.bios));
    }

    setPlaceholderData() {
        this.history = [{ date: this.currentDateStr, score: 0, totalSec: 0, deepSec: 0, remSec: 0, rhr: '-', cal: 0, high: 0, med: 0, workouts: [] }];
        this.currentIndex = 0;
    }

    async fetchOuraData() {
        this.setText('syncStatus', 'SYNCING...');
        try {
            const end = new Date(); end.setDate(end.getDate() + 1);
            const start = new Date(); start.setDate(start.getDate() - 10);
            const startStr = start.toISOString().split('T')[0];
            const endStr = end.toISOString().split('T')[0];
            const token = TOKENS[this.user];
            const [s, w, a, r] = await Promise.all([
                fetch(`https://corsproxy.io/?${encodeURIComponent(`https://api.ouraring.com/v2/usercollection/sleep?start_date=${startStr}&end_date=${endStr}`)}`, { headers: { 'Authorization': `Bearer ${token}` } }),
                fetch(`https://corsproxy.io/?${encodeURIComponent(`https://api.ouraring.com/v2/usercollection/workout?start_date=${startStr}&end_date=${endStr}`)}`, { headers: { 'Authorization': `Bearer ${token}` } }),
                fetch(`https://corsproxy.io/?${encodeURIComponent(`https://api.ouraring.com/v2/usercollection/daily_activity?start_date=${startStr}&end_date=${endStr}`)}`, { headers: { 'Authorization': `Bearer ${token}` } }),
                fetch(`https://corsproxy.io/?${encodeURIComponent(`https://api.ouraring.com/v2/usercollection/daily_readiness?start_date=${startStr}&end_date=${endStr}`)}`, { headers: { 'Authorization': `Bearer ${token}` } })
            ]);
            if (!s.ok) throw new Error('API failed');
            const [sD, wD, aD, rD] = await Promise.all([s.json(), w.json(), a.json(), r.json()]);
            this.processData(sD.data || [], wD.data || [], aD.data || [], rD.data || []);
            this.setText('syncStatus', 'SYNCED âœ“');
            this.render();
        } catch (error) {
            console.error('Sync failed: ' + error);
            this.setText('syncStatus', 'OFFLINE');
            this.render();
        }
    }

    processData(sleepData, workoutData, activityData, readinessData) {
        const dataMap = new Map();
        const getDay = (date) => {
            if(!dataMap.has(date)) { dataMap.set(date, { date: date, score: 0, totalSec: 0, deepSec: 0, remSec: 0, rhr: '-', cal: 0, high: 0, med: 0, workouts: [] }); }
            return dataMap.get(date);
        };
        sleepData.forEach(s => {
            const d = getDay(s.day);
            d.totalSec += s.total_sleep_duration || 0;
            d.deepSec += s.deep_sleep_duration || 0;
            d.remSec += s.rem_sleep_duration || 0;
            if (s.score && s.score > d.score) d.score = s.score;
        });
        readinessData.forEach(r => { const d = getDay(r.day); if (r.contributors?.resting_heart_rate) d.rhr = r.contributors.resting_heart_rate; });
        workoutData.forEach(w => {
            const d = getDay(w.day);
            const dateObj = new Date(w.start_datetime);
            const timeStr = dateObj.toLocaleTimeString('en-US', { hour: 'numeric', minute: '2-digit', hour12: false });
            d.workouts.push({ type: w.activity || 'other', intensity: w.intensity || 'moderate', calories: w.calories || 300, time: timeStr, start: w.start_datetime });
        });
        activityData.forEach(a => { const d = getDay(a.day); d.cal = a.active_calories || 0; d.high = (a.high_activity_time || 0)/60; d.med = (a.medium_activity_time || 0)/60; });
        this.history = Array.from(dataMap.values()).sort((a, b) => b.date.localeCompare(a.date));
        this.currentIndex = this.history.findIndex(h => h.date === this.currentDateStr);
        if (this.currentIndex === -1) { this.history.unshift({ date: this.currentDateStr, score: 0, totalSec: 0, deepSec: 0, remSec: 0, rhr: '-', cal: 0, high: 0, med: 0, workouts: [] }); this.currentIndex = 0; }
    }

    changeDate(direction) {
        const newIndex = this.currentIndex - direction;
        if (newIndex >= 0 && newIndex < this.history.length) { this.currentIndex = newIndex; this.currentDateStr = this.history[newIndex].date; this.render(); }
    }

    switchUser(newUser) {
        if (newUser === this.user) return;
        document.querySelectorAll('.user-switch button').forEach(b => b.classList.remove('active'));
        document.getElementById(`btn-${newUser}`).classList.add('active');
        this.user = newUser; localStorage.setItem('centurion_user', newUser);
        this.history = []; this.loadUserData(); this.setPlaceholderData(); this.render(); this.fetchOuraData();
    }

    toggleTask(taskId) {
        const dateKey = this.history[this.currentIndex].date;
        if (!this.checked[dateKey]) this.checked[dateKey] = [];
        const index = this.checked[dateKey].indexOf(taskId);
        if (index === -1) this.checked[dateKey].push(taskId); else this.checked[dateKey].splice(index, 1);
        this.saveUserData();
        this.render();
    }

    // --- MODAL & LOGIC ---
    openBio() {
        const modalBody = document.getElementById('modalBody');
        this.setText('modalTitle', 'BIOMETRICS');
        let html = '';
        ['apob','lpa','ldl','hscrp','glucose','hba1c','weight','bmr'].forEach(f => {
            html += `<div class="bio-row"><div class="bio-group"><label>${f.toUpperCase()}</label><input class="bio-input" id="bio-${f}" type="number" value="${this.bios[f] || ''}"></div></div>`;
        });
        html += `<button class="save-btn" onclick="app.saveBio()">SAVE BIOMETRICS</button>`;
        modalBody.innerHTML = html;
        document.getElementById('mainModal').classList.add('show');
    }

    saveBio() {
        ['apob','lpa','ldl','hscrp','glucose','hba1c','weight','bmr'].forEach(f => { const el = document.getElementById(`bio-${f}`); if(el) this.bios[f] = el.value; });
        this.saveUserData(); this.closeModal(); this.render();
    }

    openMealPicker(mealSlot) {
        const modalBody = document.getElementById('modalBody');
        const slotName = mealSlot.charAt(0).toUpperCase() + mealSlot.slice(1);
        this.setText('modalTitle', slotName + ' MENU');
        const meals = MEAL_DATABASE[mealSlot] || [];
        let html = '';
        meals.forEach((meal, index) => {
            const title = meal.title || meal.name || "Meal";
            const colorDots = (meal.colors || []).map(c => `<span class="color-dot" style="background:${RAINBOW_COLORS[c].hex}"></span>`).join('');
            
            // MENU BADGES
            let badges = '';
            const ingString = (meal.ingredients||[]).join(' ').toLowerCase();
            if(ingString.includes('salmon') && (ingString.includes('avocado') || ingString.includes('oil'))) badges += `<span class="badge boost">Î©-3</span>`;
            if(ingString.includes('bison') && ingString.includes('peppers')) badges += `<span class="badge boost">IRON+</span>`;
            
            html += `<div class="menu-item" onclick="app.showRecipe('${mealSlot}', ${index})">
                <div class="menu-left">
                    <div class="menu-name">${title}</div>
                    <div class="menu-meta">P:${meal.macros.p}g â€¢ Î©3:${meal.macros.o}mg â€¢ F:${meal.macros.f}g</div>
                    <div class="menu-badges">${colorDots}</div>
                </div>
                <div class="menu-right">
                    ${badges}
                    <div class="menu-arrow">â€º</div>
                </div>
            </div>`;
        });
        modalBody.innerHTML = html;
        document.getElementById('mainModal').classList.add('show');
    }

    showRecipe(mealSlot, index) {
        const meal = MEAL_DATABASE[mealSlot][index];
        const modalBody = document.getElementById('modalBody');
        
        let ingredientsHTML = '';
        (meal.ingredients||[]).forEach(ing => ingredientsHTML += `<div class="ing-item">${ing}</div>`);
        
        let stepsHTML = '';
        (meal.steps||[]).forEach((step, i) => stepsHTML += `<div class="step-item"><span class="step-num">${i+1}</span> <span class="step-desc">${step}</span></div>`);
        
        // SYNERGY CHECK IN DETAIL
        let synergyHTML = '';
        const ingString = (meal.ingredients||[]).join(' ').toLowerCase();
        
        // MASTER SYNERGY LOGIC
        if((ingString.includes('bison') || ingString.includes('steak')) && (ingString.includes('peppers') || ingString.includes('citrus') || ingString.includes('lemon'))) synergyHTML += `<div class="abs-boost">ðŸš€ <strong>IRON SUPER-CHARGE:</strong> Vitamin C boosts Heme Iron absorption.</div>`;
        
        if(ingString.includes('salmon') && ingString.includes('yogurt')) synergyHTML += `<div class="abs-alert">âš ï¸ <strong>BLOCKER ALERT:</strong> Calcium in Yogurt blocks Iron absorption.</div>`;
        
        if(ingString.includes('salmon') && (ingString.includes('avocado') || ingString.includes('oil'))) synergyHTML += `<div class="abs-boost">ðŸ¥‘ <strong>FAT SOLUBLE UNLOCK:</strong> Healthy fats increase Omega-3 bioavailability.</div>`;
        
        if(ingString.includes('turmeric') && !ingString.includes('pepper')) synergyHTML += `<div class="abs-alert">âš ï¸ Add Black Pepper to activate Turmeric!</div>`;
        
        if(ingString.includes('tomato') && (ingString.includes('cooked') || ingString.includes('simmer'))) synergyHTML += `<div class="abs-boost">ðŸ… <strong>LYCOPENE ACTIVATION:</strong> Cooking tomatoes releases powerful antioxidants.</div>`;
        
        if(ingString.includes('kale') || ingString.includes('broccoli') || ingString.includes('sprouts')) synergyHTML += `<div class="abs-boost">ðŸ¥¦ <strong>SULFORAPHANE:</strong> Chewing activates potent detox enzymes.</div>`;
        
        if(ingString.includes('beet')) synergyHTML += `<div class="abs-boost">âš¡ <strong>NITRIC OXIDE:</strong> Beets dilate blood vessels for better flow.</div>`;
        
        if(ingString.includes('sea moss') && ingString.includes('flax')) synergyHTML += `<div class="abs-boost">ðŸ›¡ï¸ <strong>THYROID SHIELD:</strong> Iodine + Omega-3 synergy.</div>`;

        let html = `
            <div class="recipe-hero">
                <div class="recipe-title">${meal.title}</div>
                <div class="recipe-stats">
                    <span>â±ï¸ ${meal.time}</span>
                    <span>ðŸ½ï¸ ${meal.servings} serving</span>
                </div>
            </div>
            
            <div class="macro-grid">
                <div class="macro-stat"><div class="m-val">${meal.macros.p}</div><div class="m-lbl">PRO</div></div>
                <div class="macro-stat"><div class="m-val">${meal.macros.o}</div><div class="m-lbl">Î©-3</div></div>
                <div class="macro-stat"><div class="m-val">${meal.macros.f}</div><div class="m-lbl">FIBER</div></div>
                <div class="macro-stat"><div class="m-val">${meal.macros.cal}</div><div class="m-lbl">CAL</div></div>
            </div>

            ${synergyHTML}

            <div class="synergy-box">
                <div class="syn-title">LONGEVITY SCIENCE</div>
                <div class="syn-text">${meal.why || "High nutrient density meal selected for inflammation control."}</div>
            </div>

            <div class="section-label">INGREDIENTS</div>
            <div class="ing-list">${ingredientsHTML}</div>

            <div class="section-label">PREPARATION</div>
            <div class="step-list">${stepsHTML}</div>

            <button class="select-btn" onclick="app.selectMeal('${mealSlot}', ${index})">LOG THIS MEAL</button>
        `;
        
        this.setText('modalTitle', 'RECIPE DETAILS');
        modalBody.innerHTML = html;
    }

    closeModal() { document.getElementById('mainModal').classList.remove('show'); }

    selectMeal(mealSlot, mealIndex) {
        const dateKey = this.history[this.currentIndex].date;
        if (!this.meals[dateKey]) this.meals[dateKey] = {};
        this.meals[dateKey][mealSlot] = mealIndex;
        this.saveUserData();
        this.closeModal();
        this.render();
    }

    // --- CALCULATORS ---
    calculateSleepDebt() {
        const today = new Date().toLocaleDateString('en-CA');
        const last7Days = this.history.filter(day => day.date !== today && day.totalSec > 0).slice(0, 7);
        if (last7Days.length === 0) return 0;
        let totalDebt = 0;
        last7Days.forEach(day => {
            const actual = day.totalSec / 3600;
            const deficit = 8 - actual;
            if (deficit > 0) totalDebt += deficit;
        });
        return totalDebt;
    }

    calculateMacros() {
        const dateKey = this.history[this.currentIndex].date;
        const checked = this.checked[dateKey] || [];
        let totals = { protein: 0, omega3: 0, fiber: 0, calories: 0, burn: 0 };
        this.protocol.forEach(task => {
            if (checked.includes(task.id)) {
                totals.protein += task.macros.p || 0;
                totals.omega3 += task.macros.o || 0;
                totals.fiber += task.macros.f || 0;
                totals.calories += task.macros.cal || 0;
                totals.burn += task.calBurn || 0;
            }
        });
        return totals;
    }

    calculateRainbow() {
        const dateKey = this.history[this.currentIndex].date;
        const checked = this.checked[dateKey] || [];
        let colors = new Set();
        this.protocol.forEach(task => { if (checked.includes(task.id) && task.colors) task.colors.forEach(c => colors.add(c)); });
        return colors;
    }

    calculateGrade(score) {
        if(score >= 95) return { letter: 'S+', color: '#00ff00' };
        if(score >= 90) return { letter: 'S', color: '#ccff00' };
        if(score >= 85) return { letter: 'A+', color: '#00f0ff' };
        if(score >= 80) return { letter: 'A', color: '#00d4ff' };
        if(score >= 70) return { letter: 'B', color: '#FFD60A' };
        return { letter: 'C', color: '#ff453a' };
    }

    // --- RENDER ---
    renderGrade(score) {
        const grade = this.calculateGrade(score);
        this.setText('dayGrade', grade.letter);
        const el = document.getElementById('dayGrade');
        if(el) el.style.color = grade.color;
    }

    render() {
        try {
            if (!this.history || this.history.length === 0) return;
            this.protocol = JSON.parse(JSON.stringify(BASE_PROTOCOL));
            const dateKey = this.history[this.currentIndex].date;
            const day = this.history[this.currentIndex];
            const goals = USERS[this.user].goals;

            let selectedMeals = this.meals[dateKey] || {};
            this.protocol.forEach(task => {
                if (task.mealSlot && selectedMeals[task.mealSlot] !== undefined) {
                    const dbSlot = MEAL_DATABASE[task.mealSlot];
                    if(dbSlot && dbSlot[selectedMeals[task.mealSlot]]) {
                         const meal = dbSlot[selectedMeals[task.mealSlot]];
                         task.title = meal.title || meal.name; 
                         task.desc = `P:${meal.macros.p} F:${meal.macros.f||0} Î©3:${meal.macros.o}`;
                         task.macros = meal.macros;
                         task.colors = meal.colors;
                    } else { task.desc = "Select meal"; }
                }
            });
            
            if (day.workouts && day.workouts.length > 0) {
                this.protocol = this.protocol.filter(t => t.id !== 'train');
                day.workouts.forEach((w, i) => {
                    const dateObj = new Date(w.start);
                    const displayTime = dateObj.toLocaleTimeString('en-US', {hour: 'numeric', minute:'2-digit'});
                    this.protocol.push({
                        id: `workout-${i}`, time: w.time, displayTime: displayTime,
                        title: `${WORKOUT_TYPES[w.type] || 'Workout'} ðŸ”„`,
                        desc: `${w.calories} cal â€¢ Auto-detected`, macros: {p:0,o:0,f:0,cal:0}, colors: [], calBurn: w.calories, autoDetected: true
                    });
                    const checked = this.checked[dateKey] || [];
                    if (!checked.includes(`workout-${i}`)) { checked.push(`workout-${i}`); this.checked[dateKey] = checked; }
                });
                this.protocol.sort((a, b) => a.time.localeCompare(b.time));
                this.saveUserData();
            }

            const sleepHours = (day.totalSec || 0) / 3600;
            const dayScore = Math.min(100, Math.round((sleepHours / 8) * 100));
            this.renderGrade(dayScore); 
            this.setText('dateLabel', day.date);
            
            const macros = this.calculateMacros();
            const bmr = parseInt(this.bios.bmr) || 2057;
            const totalBurn = bmr + macros.burn;
            
            // COLOR FIX: Pass active color to update function
            const updateOrb = (id, val, goal, activeColor) => {
                const el = document.getElementById(id);
                if(el) {
                   const pct = Math.min(val/goal, 1);
                   el.style.strokeDashoffset = 145 - (pct * 145);
                   el.style.stroke = activeColor; // FORCE COLOR
                }
            };
            const updateHeart = (id, val, goal) => {
                 const el = document.getElementById(id);
                 if(el) el.style.strokeDashoffset = 100 - (Math.min(val/goal, 1) * 100);
            };

            this.setText('sleepVal', `${Math.floor(sleepHours)}h ${Math.round((day.totalSec%3600)/60)}m`);
            this.setText('deepVal', `${Math.round((day.deepSec||0)/60)}m`);
            this.setText('remVal', `${Math.round((day.remSec||0)/60)}m`);
            updateOrb('sleepOrb', sleepHours, 8, '#bf5af2');
            updateOrb('deepOrb', (day.deepSec||0)/60, 90, '#007aff');
            updateOrb('remOrb', (day.remSec||0)/60, 90, '#bf5af2');

            // FUEL - PASSING COLORS EXPLICITLY
            this.setText('proteinVal', macros.protein); updateOrb('proteinOrb', macros.protein, goals.protein, '#fff');
            this.setText('omega3Val', Math.round(macros.omega3/1000)+'g'); updateOrb('omega3Orb', macros.omega3, goals.omega3, '#00d4ff');
            this.setText('fiberVal', macros.fiber); updateOrb('fiberOrb', macros.fiber, goals.fiber, '#30d158');
            this.setText('calorieVal', macros.calories); updateOrb('calorieOrb', macros.calories, 2500, '#FFD60A');

            this.setText('rhrVal', day.rhr); 
            this.setText('z2Val', Math.round(day.med||0)); updateHeart('z2Heart', day.med||0, goals.z2||45);
            this.setText('z5Val', Math.round(day.high||0)); updateHeart('z5Heart', day.high||0, goals.z5||20);
            this.setText('calVal', Math.round(day.cal||0)); updateHeart('calHeart', day.cal||0, goals.calBurn||500);

            const userDob = USERS[this.user].dob;
            if(userDob) {
                const [y, m, d] = userDob.split('-').map(Number);
                const today = new Date();
                if(today.getMonth()+1 === m && today.getDate() === d) {
                     const age = today.getFullYear() - y;
                     const banner = document.getElementById('alertBanner');
                     if (this.user === 'sophia' && m === 1 && d === 25) {
                         banner.className = 'alert alert-love show';
                         banner.innerHTML = `ðŸŽ‚ <strong>HAPPY BIRTHDAY SOPHIA!</strong> ðŸŽ‰<br><br>I love you so much. You inspire me every single day.<br>Let's crush 39 together. â¤ï¸ - Jermaine`;
                     } else {
                         banner.className = 'alert alert-protein show';
                         banner.innerText = `ðŸŽ‚ HAPPY ${age}TH BIRTHDAY ${USERS[this.user].name.toUpperCase()}! ðŸŽ‰`;
                     }
                     this.setText('statusMsg', 'CELEBRATION MODE ðŸŽ‚');
                } else {
                     this.renderStatus(sleepHours);
                }
            } else {
                 this.renderStatus(sleepHours);
            }
            this.renderRainbow();
            this.renderTimeline(dateKey);
        } catch (e) { console.error('Render Error: ' + e); }
    }

    renderRainbow() {
        const colors = this.calculateRainbow();
        const score = Math.round((colors.size / 6) * 100);
        this.setText('rainbowScore', score + '%');
        let html = '';
        ['red', 'orange', 'yellow', 'green', 'purple', 'white'].forEach(c => {
            const width = colors.has(c) ? 16.66 : 0;
            const hex = RAINBOW_COLORS[c] ? RAINBOW_COLORS[c].hex : '#999';
            html += `<div class="rainbow-seg" style="background:${hex}; width:${width}%"></div>`;
        });
        document.getElementById('rainbowTrack').innerHTML = html;
        const sugg = document.getElementById('rainbowSuggestion');
        if(colors.size < 6 && colors.size > 0) {
            const missing = ['red', 'orange', 'yellow', 'green', 'purple', 'white'].find(c => !colors.has(c));
            sugg.innerText = `Tip: Add ${missing.toUpperCase()} foods!`;
            sugg.style.display = 'block';
        } else { sugg.style.display = 'none'; }
    }

    renderStatus(sleepHours) {
        const debt = this.calculateSleepDebt();
        const banner = document.getElementById('alertBanner');
        let status = '';
        if (debt > 7) {
            status = `âš ï¸ SLEEP DEBT: ${debt.toFixed(1)}h`;
            banner.className = 'alert alert-warning show';
            banner.innerText = "FORCED RECOVERY: Sleep Debt Critical";
        } else if (sleepHours >= 7) {
            status = "âœ… OPTIMAL READY";
            banner.className = 'alert';
        } else {
            status = "âš ï¸ CAUTION";
            banner.className = 'alert';
        }
        this.setText('statusMsg', status);
    }

    renderTimeline(dateKey) {
        const checked = this.checked[dateKey] || [];
        let html = '';
        this.protocol.forEach(task => {
            const isChecked = checked.includes(task.id);
            const clickAction = task.clickable ? `onclick="app.openMealPicker('${task.mealSlot}')"` : '';
            const cardClass = `task-card ${isChecked ? 'checked' : ''} ${task.clickable ? 'clickable' : ''} ${task.autoDetected ? 'auto-detected' : ''}`;
            const chevron = task.clickable ? `<span class="chevron">â€º</span>` : '';
            const timeDisplay = task.displayTime || task.time;
            html += `<div class="task">
                <div class="task-time">${timeDisplay}</div>
                <div class="${cardClass}" ${clickAction}>
                    <div class="task-info">
                        <div class="task-title">${task.title} ${task.autoDetected ? '<span class="workout-badge">AUTO</span>' : ''}</div>
                        <div class="task-desc">${task.desc}</div>
                    </div>
                    ${chevron}
                    ${!task.autoDetected ? `<div class="check-btn" onclick="event.stopPropagation(); app.toggleTask('${task.id}')"><div class="check-circle">${isChecked ? 'âœ“' : ''}</div></div>` : ''}
                </div>
            </div>`;
        });
        document.getElementById('timeline').innerHTML = html;
    }

    setText(id, text) { const el = document.getElementById(id); if (el) el.innerText = text; }
    sync() { this.fetchOuraData(); }
}

let app;
window.onload = () => { app = new CenturionApp(); window.app = app; };
</script>
</body>
</html>