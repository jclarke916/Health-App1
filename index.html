<!DOCTYPE html>

<html lang="en">
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width,initial-scale=1.0,maximum-scale=1.0,user-scalable=no">
<title>Centurion v23 - Complete Oura Synergy</title>
<style>
:root{--bg:#0a0a0c;--panel:#141418;--panel-elevated:#1a1a20;--border:rgba(255,255,255,0.08);--acid:#c8ff00;--cyan:#00d4ff;--purple:#a855f7;--alert:#ff4757;--orange:#ff9500;--success:#34d399;--text:#fff;--text-secondary:rgba(255,255,255,0.6);--text-tertiary:rgba(255,255,255,0.4)}
*{box-sizing:border-box;margin:0;padding:0}
body{background:var(--bg);color:var(--text);font-family:-apple-system,BlinkMacSystemFont,sans-serif;padding-bottom:140px;min-height:100vh;-webkit-tap-highlight-color:transparent;background-image:radial-gradient(ellipse at 20% 0%,rgba(200,255,0,0.03) 0%,transparent 50%),radial-gradient(ellipse at 80% 100%,rgba(0,212,255,0.03) 0%,transparent 50%)}
.header{background:rgba(10,10,12,0.95);padding:16px 20px;border-bottom:1px solid var(--border);position:sticky;top:0;z-index:100;backdrop-filter:blur(20px)}
.user-switch{display:flex;gap:8px;background:var(--panel);padding:4px;border-radius:16px;margin-bottom:12px;border:1px solid var(--border)}
.user-switch button{flex:1;padding:10px;border:none;background:transparent;color:var(--text-tertiary);border-radius:12px;cursor:pointer;font-weight:700;font-size:0.7rem;letter-spacing:1px;transition:all 0.3s}
.user-switch button.active{background:linear-gradient(135deg,#c8ff00,#00d4ff);color:#000;box-shadow:0 4px 20px rgba(200,255,0,0.3)}
.date-nav{display:flex;justify-content:space-between;align-items:center;background:var(--panel);border:1px solid var(--border);border-radius:14px;padding:8px 12px}
.nav-btn{background:transparent;border:none;color:var(--cyan);padding:8px 16px;font-size:1.1rem;cursor:pointer}
#dateLabel{flex:1;text-align:center;font-weight:600;font-size:0.85rem}
.bio-btn{background:linear-gradient(135deg,#c8ff00,#00d4ff);color:#000;border:none;padding:10px 16px;border-radius:10px;font-size:0.65rem;font-weight:800;cursor:pointer}
.section-header{padding:20px 20px 12px;font-size:0.65rem;font-weight:700;color:var(--text-tertiary);letter-spacing:2px;text-transform:uppercase;display:flex;align-items:center;gap:12px;cursor:pointer;-webkit-tap-highlight-color:transparent;user-select:none}
.section-header::after{content:'';height:1px;background:var(--border);flex:1}
.section-chevron{font-size:0.7rem;color:var(--text-tertiary);transition:transform 0.3s ease;margin-left:auto;flex-shrink:0}
.section-header.collapsed .section-chevron{transform:rotate(-90deg)}
.section-body{overflow:hidden;transition:max-height 0.4s ease,opacity 0.3s ease;opacity:1;max-height:2000px}
.section-body.collapsed{max-height:0!important;opacity:0;margin:0;padding-top:0;padding-bottom:0}
.section-summary{display:none;font-size:0.65rem;color:var(--text-secondary);margin-left:4px;font-weight:600}
.section-header.collapsed .section-summary{display:inline}
.recovery-battery{background:var(--panel);border:1px solid var(--border);border-radius:20px;padding:20px;margin:20px;position:relative;overflow:hidden}
.recovery-battery::before{content:'';position:absolute;top:0;left:0;right:0;height:3px;background:linear-gradient(90deg,#4facfe,#00f2fe)}
.battery-header{display:flex;justify-content:space-between;align-items:center;margin-bottom:16px}
.battery-title{font-size:0.7rem;font-weight:700;color:var(--text-secondary);letter-spacing:1.5px}
.battery-score{font-size:2.5rem;font-weight:800;background:linear-gradient(135deg,#4facfe,#00f2fe);-webkit-background-clip:text;-webkit-text-fill-color:transparent}
.battery-bar{height:12px;background:var(--panel-elevated);border-radius:6px;overflow:hidden;margin-bottom:12px}
.battery-fill{height:100%;background:linear-gradient(90deg,#4facfe,#00f2fe);border-radius:6px;transition:width 1s;box-shadow:0 0 20px rgba(79,172,254,0.4)}
.battery-components{display:grid;grid-template-columns:repeat(4,1fr);gap:8px}
.battery-component{text-align:center;padding:8px;background:var(--panel-elevated);border-radius:8px}
.bc-value{font-size:0.9rem;font-weight:700}
.bc-label{font-size:0.5rem;color:var(--text-tertiary);text-transform:uppercase;margin-top:2px}
.bc-trend{font-size:0.55rem;margin-top:2px}
.battery-detail-row{display:flex;justify-content:space-between;padding:10px 4px 0;border-top:1px solid var(--border);margin-top:10px}
.battery-detail{text-align:center;flex:1}
.bd-label{display:block;font-size:0.45rem;color:var(--text-tertiary);text-transform:uppercase;letter-spacing:0.5px}
.bd-value{display:block;font-size:0.75rem;font-weight:700;margin-top:2px}
.trend-up{color:var(--success)}
.trend-down{color:var(--alert)}
.grid-4{display:grid;grid-template-columns:repeat(4,1fr);gap:10px;padding:0 20px;margin-bottom:20px}
.grid-3{display:grid;grid-template-columns:repeat(3,1fr);gap:12px;padding:0 20px;margin-bottom:20px}
.orb-card{background:var(--panel);border:1px solid var(--border);border-radius:16px;padding:16px 8px 12px;display:flex;flex-direction:column;align-items:center;transition:transform 0.2s}
.orb-card:active{transform:scale(0.97)}
.orb-card.alert{border-color:var(--alert);background:rgba(255,71,87,0.1)}
.orb-card.warning{border-color:var(--orange);background:rgba(255,149,0,0.1)}
.orb-card.optimal{border-color:var(--success);background:rgba(52,211,153,0.1)}
.orb-container{width:52px;height:52px;position:relative;margin-bottom:8px}
.orb-svg{transform:rotate(-90deg);width:100%;height:100%;position:absolute}
.orb-bg{fill:none;stroke:var(--panel-elevated);stroke-width:5}
.orb-fg{fill:none;stroke-width:5;stroke-dasharray:138;stroke-dashoffset:138;transition:stroke-dashoffset 1s;stroke-linecap:round;filter:drop-shadow(0 0 6px currentColor)}
.orb-val-box{position:absolute;top:50%;left:50%;transform:translate(-50%,-50%);text-align:center}
.orb-val{font-size:0.75rem;font-weight:800;line-height:1}
.orb-label{font-size:0.5rem;font-weight:700;color:var(--text-secondary);text-transform:uppercase}
.score-row{display:flex;gap:12px;justify-content:center;padding:20px}
.score-orb{flex:0 0 90px;height:90px;position:relative;display:flex;flex-direction:column;align-items:center;justify-content:center;cursor:pointer}
.score-orb svg{position:absolute;width:100%;height:100%;transform:rotate(-90deg)}
.score-orb-bg{fill:none;stroke:var(--panel-elevated);stroke-width:6}
.score-orb-fg{fill:none;stroke-width:6;stroke-linecap:round;stroke-dasharray:251;stroke-dashoffset:251;transition:stroke-dashoffset 1.5s;filter:drop-shadow(0 0 8px currentColor)}
.score-orb-value{font-size:1.6rem;font-weight:800;z-index:1}
.score-orb-label{font-size:0.45rem;color:var(--text-tertiary);text-transform:uppercase;z-index:1}
.score-orb.primary{flex:0 0 110px;height:110px}
.score-orb.primary .score-orb-value{font-size:2.2rem;background:linear-gradient(135deg,#c8ff00,#00d4ff);-webkit-background-clip:text;-webkit-text-fill-color:transparent}
.score-orb-badge{position:absolute;bottom:-6px;background:var(--panel);border:1px solid var(--border);padding:2px 6px;border-radius:8px;font-size:0.4rem;color:var(--cyan);font-weight:700}
.status-container{margin:0 20px 20px;padding:16px;background:var(--panel);border:1px solid var(--border);border-radius:14px;border-left:3px solid var(--acid)}
.status-label{font-size:0.6rem;color:var(--text-tertiary);text-transform:uppercase;letter-spacing:1px;margin-bottom:4px}
.status-msg{font-size:0.85rem;font-weight:600;line-height:1.4}
.insight-card{background:var(--panel);border:1px solid var(--border);border-radius:14px;padding:16px;margin:0 20px 16px}
.insight-card.warning{border-left:3px solid var(--orange)}
.insight-card.alert{border-left:3px solid var(--alert)}
.insight-header{display:flex;align-items:center;gap:10px;margin-bottom:8px}
.insight-icon{font-size:1.2rem}
.insight-title{font-size:0.8rem;font-weight:700}
.insight-body{font-size:0.75rem;color:var(--text-secondary);line-height:1.5}
.insight-action{margin-top:10px;padding:10px;background:rgba(200,255,0,0.1);border-radius:8px;font-size:0.7rem;color:var(--acid);font-weight:600}
.heart-container{width:52px;height:52px;position:relative;margin-bottom:8px}
.heart-svg{width:100%;height:100%}
.heart-bg{fill:none;stroke:var(--panel-elevated);stroke-width:2}
.heart-fg{fill:none;stroke-width:2.5;stroke-dasharray:100;stroke-dashoffset:100;transition:stroke-dashoffset 1s;filter:drop-shadow(0 0 4px currentColor)}
.beating{animation:heartbeat 1.5s infinite}
@keyframes heartbeat{0%,100%{transform:scale(1)}15%{transform:scale(1.08)}30%{transform:scale(1)}45%{transform:scale(1.08)}}
.water-container,.rainbow-container{padding:0 20px;margin-bottom:20px}
.water-header,.rainbow-header{display:flex;justify-content:space-between;align-items:center;margin-bottom:10px}
.water-title,.rainbow-title{font-size:0.7rem;font-weight:700;color:var(--text-secondary)}
.water-score{font-size:1rem;font-weight:800;color:var(--cyan)}
.rainbow-score{font-size:1rem;font-weight:800;color:var(--acid)}
.water-track{height:12px;background:var(--panel);border-radius:6px;overflow:hidden;border:1px solid var(--border);cursor:pointer}
.water-fill{height:100%;background:linear-gradient(90deg,#00d4ff,#0088ff);border-radius:6px;transition:width 0.3s}
.rainbow-track{height:12px;background:var(--panel);border-radius:6px;display:flex;overflow:hidden;border:1px solid var(--border)}
.rainbow-seg{height:100%;transition:width 0.5s}
.timeline{padding:0 20px 40px}
.task{display:flex;gap:12px;margin-bottom:14px}
.task-time{width:50px;color:var(--text-tertiary);font-size:0.7rem;padding-top:16px;text-align:right;font-weight:600}
.task-card{flex:1;background:var(--panel);border:1px solid var(--border);border-radius:14px;padding:16px;display:flex;justify-content:space-between;align-items:center;transition:all 0.2s}
.task-card:active{transform:scale(0.98)}
.task-card.checked{border-color:var(--acid);background:rgba(200,255,0,0.05)}
.task-card.auto-detected{border-color:var(--cyan);background:rgba(0,212,255,0.05)}
.task-card.hrv-adjusted{border-color:var(--orange);background:rgba(255,149,0,0.05)}
.task-card.recovery{border-color:var(--purple);background:rgba(168,85,247,0.05)}
.task-card.facial{border-color:var(--cyan);background:rgba(0,212,255,0.08)}
.task-card.workout-rec{border-color:var(--orange);background:rgba(255,149,0,0.06);border-style:dashed}
.task-card.ai-filled .task-title::after{content:' âœ¨';font-size:0.65rem}
.task-card.optional{border-style:dashed;border-color:#444;opacity:0.7}
.task-info{flex:1}
.task-title{font-weight:700;font-size:0.85rem;margin-bottom:4px}
.task-desc{font-size:0.7rem;color:var(--text-secondary)}
.chevron{font-size:1.3rem;color:var(--text-tertiary);margin-left:12px}
.check-btn{width:40px;height:40px;display:flex;align-items:center;justify-content:center;cursor:pointer}
.check-circle{width:28px;height:28px;border:2px solid var(--border);border-radius:50%;background:var(--panel-elevated);display:flex;align-items:center;justify-content:center;font-weight:800;color:transparent;transition:all 0.2s}
.task-card.checked .check-circle{background:var(--acid);border-color:var(--acid);color:#000;box-shadow:0 0 15px var(--acid)}
.modal-overlay{position:fixed;top:0;left:0;width:100%;height:100%;background:rgba(0,0,0,0.95);z-index:500;display:none;overflow-y:auto;backdrop-filter:blur(10px)}
.modal-overlay.show{display:block}
.modal-content{width:100%;min-height:100vh;background:var(--bg);padding-bottom:100px}
.modal-header{padding:20px;border-bottom:1px solid var(--border);display:flex;justify-content:space-between;align-items:center;position:sticky;top:0;background:rgba(10,10,12,0.95);backdrop-filter:blur(20px);z-index:10}
.modal-title{font-size:1rem;font-weight:800;color:var(--acid);text-transform:uppercase;letter-spacing:1px}
.modal-close{background:transparent;border:none;color:var(--text);font-size:2rem;cursor:pointer;padding:8px}
.modal-body{padding:20px}
.menu-item{padding:18px;background:var(--panel);border:1px solid var(--border);border-radius:12px;margin-bottom:8px;cursor:pointer;display:flex;justify-content:space-between;align-items:center}
.menu-item:active{background:var(--panel-elevated)}
.menu-name{font-size:0.95rem;font-weight:700;margin-bottom:4px}
.menu-meta{font-size:0.7rem;color:var(--text-secondary)}
.menu-arrow{color:var(--text-tertiary);font-size:1.3rem}
.recipe-hero{margin-bottom:25px;text-align:center}
.recipe-title{font-size:1.6rem;font-weight:900;line-height:1.2;margin-bottom:8px}
.recipe-stats{font-size:0.85rem;color:var(--text-secondary);font-weight:700}
.macro-grid{display:grid;grid-template-columns:repeat(4,1fr);gap:10px;margin-bottom:25px}
.macro-stat{background:var(--panel);border:1px solid var(--border);padding:12px 5px;border-radius:10px;text-align:center}
.m-val{font-size:1.1rem;font-weight:900;line-height:1}
.m-lbl{font-size:0.5rem;color:var(--acid);text-transform:uppercase;margin-top:6px;font-weight:900}
.synergy-box{background:linear-gradient(135deg,rgba(0,212,255,0.08) 0%,rgba(0,0,0,0) 100%);border:1px solid rgba(0,212,255,0.3);padding:20px;border-radius:12px;margin-bottom:25px}
.syn-title{color:var(--cyan);font-weight:900;font-size:0.75rem;text-transform:uppercase;margin-bottom:10px}
.syn-text{color:#ccc;font-size:0.95rem;font-style:italic;line-height:1.6}
.ing-item{color:#ccc;font-size:0.9rem;border-bottom:1px solid var(--border);padding:12px 0;display:flex;align-items:center;cursor:pointer;transition:all 0.2s;-webkit-tap-highlight-color:transparent}
.ing-item:active{background:rgba(255,255,255,0.03)}
.ing-item::before{content:'â€¢';color:var(--acid);font-weight:bold;margin-right:12px;font-size:1.3rem}
.ing-item.removed{opacity:0.35;text-decoration:line-through;color:#666}
.ing-item.removed::before{content:'âœ•';color:var(--alert)}
.ing-hint{text-align:center;font-size:0.6rem;color:var(--text-tertiary);margin-top:6px;margin-bottom:12px}
.step-item{display:flex;gap:15px;font-size:0.9rem;color:#ddd;line-height:1.6;margin-bottom:15px;background:var(--panel);padding:15px;border-radius:10px;border:1px solid var(--border)}
.footer{position:fixed;bottom:0;left:0;width:100%;background:rgba(10,10,12,0.95);backdrop-filter:blur(20px);padding:14px 20px;border-top:1px solid var(--border);display:flex;justify-content:space-between;align-items:center;z-index:90}
.sync-status{font-size:0.65rem;color:var(--text-tertiary)}
.sync-btn{background:linear-gradient(135deg,#c8ff00,#00d4ff);color:#000;border:none;padding:10px 20px;border-radius:10px;font-weight:700;font-size:0.75rem;cursor:pointer}
</style>
</head>
<body>

<div class="header">
<div class="user-switch">
<button id="btn-jermaine" onclick="app.switchUser('jermaine')">JERMAINE</button>
<button id="btn-sophia" onclick="app.switchUser('sophia')">SOPHIA</button>
</div>
<div class="date-nav">
<button class="nav-btn" onclick="app.changeDate(-1)">â—€</button>
<span id="dateLabel">LOADING...</span>
<button class="nav-btn" onclick="app.changeDate(1)">â–¶</button>
<button class="bio-btn" onclick="app.openBio()">BIO</button>
<button class="bio-btn" onclick="app.showSynergyDashboard()" style="background:var(--purple);margin-left:6px">ðŸ’‘</button>
</div>
</div>

<!-- v22 RECOVERY BATTERY -->

<div class="recovery-battery">
<div class="battery-header">
<div class="battery-title">âš¡ RECOVERY BATTERY</div>
<div class="battery-score" id="batteryScore">--</div>
</div>
<div class="battery-bar"><div class="battery-fill" id="batteryFill" style="width:0%"></div></div>
<div class="battery-components">
<div class="battery-component" id="hrvCard"><div class="bc-value" id="bcHrv" style="color:var(--purple)">--</div><div class="bc-label">HRV (ms)</div><div class="bc-trend" id="bcHrvTrend"></div></div>
<div class="battery-component"><div class="bc-value" id="bcSleep">--</div><div class="bc-label">SLEEP</div><div class="bc-trend" id="bcSleepTrend"></div></div>
<div class="battery-component"><div class="bc-value" id="bcReadiness">--</div><div class="bc-label">READY</div><div class="bc-trend" id="bcReadinessTrend"></div></div>
<div class="battery-component"><div class="bc-value" id="bcStrain">--</div><div class="bc-label">STRAIN</div><div class="bc-trend" id="bcStrainTrend"></div></div>
</div>
<div class="battery-detail-row">
<div class="battery-detail"><span class="bd-label">DEEP</span><span class="bd-value" id="deepVal">--</span></div>
<div class="battery-detail"><span class="bd-label">REM</span><span class="bd-value" id="remVal">--</span></div>
<div class="battery-detail"><span class="bd-label">TEMP</span><span class="bd-value" id="tempVal">+0.0Â°</span></div>
<div class="battery-detail"><span class="bd-label">RESP</span><span class="bd-value" id="respVal">--</span></div>
<div class="battery-detail"><span class="bd-label">DEBT</span><span class="bd-value" id="sleepDebtValue">0h</span></div>
</div>
</div>

<div class="score-row">
<div class="score-orb" onclick="app.showWeeklySummary()">
<svg viewBox="0 0 100 100"><circle class="score-orb-bg" cx="50" cy="50" r="40"/><circle class="score-orb-fg" id="dayScoreOrb" cx="50" cy="50" r="40" style="stroke:var(--cyan)"/></svg>
<div class="score-orb-value" id="dayGrade">--</div>
<div class="score-orb-label">TODAY</div>
</div>
<div class="score-orb primary" onclick="app.showWeeklySummary()">
<svg viewBox="0 0 100 100"><circle class="score-orb-bg" cx="50" cy="50" r="40"/><circle class="score-orb-fg" id="longevityOrb" cx="50" cy="50" r="40" style="stroke:var(--acid)"/></svg>
<div class="score-orb-value" id="longevityScore">--</div>
<div class="score-orb-label">LONGEVITY</div>
<div class="score-orb-badge">7-DAY AVG</div>
</div>
<div class="score-orb">
<svg viewBox="0 0 100 100"><circle class="score-orb-bg" cx="50" cy="50" r="40"/><circle class="score-orb-fg" id="streakOrb" cx="50" cy="50" r="40" style="stroke:var(--acid)"/></svg>
<div class="score-orb-value" id="streakCount" style="color:var(--acid)">0</div>
<div class="score-orb-label">STREAK</div>
</div>
</div>

<div class="status-container">
<div class="status-label">ðŸ§  AI PROTOCOL ADVISOR</div>
<div class="status-msg" id="statusMsg">ANALYZING...</div>
</div>

<div id="insightContainer"></div>

<div class="section-header" onclick="app.toggleSection(this)">FUEL (NUTRITION)<span class="section-summary" id="fuelSummary"></span><span class="section-chevron">â–¼</span></div>
<div class="section-body" id="fuelBody">
<div class="grid-4">
<div class="orb-card"><div class="orb-container"><svg class="orb-svg" viewBox="0 0 50 50"><circle class="orb-bg" cx="25" cy="25" r="22"/><circle class="orb-fg" id="proteinOrb" cx="25" cy="25" r="22" style="stroke:#fff"/></svg><div class="orb-val-box"><div class="orb-val" id="proteinVal">0</div></div></div><div class="orb-label">PROTEIN</div></div>
<div class="orb-card"><div class="orb-container"><svg class="orb-svg" viewBox="0 0 50 50"><circle class="orb-bg" cx="25" cy="25" r="22"/><circle class="orb-fg" id="omega3Orb" cx="25" cy="25" r="22" style="stroke:var(--cyan)"/></svg><div class="orb-val-box"><div class="orb-val" id="omega3Val">0</div></div></div><div class="orb-label" style="color:var(--cyan)">OMEGA-3</div></div>
<div class="orb-card"><div class="orb-container"><svg class="orb-svg" viewBox="0 0 50 50"><circle class="orb-bg" cx="25" cy="25" r="22"/><circle class="orb-fg" id="fiberOrb" cx="25" cy="25" r="22" style="stroke:var(--success)"/></svg><div class="orb-val-box"><div class="orb-val" id="fiberVal">0</div></div></div><div class="orb-label" style="color:var(--success)">FIBER</div></div>
<div class="orb-card"><div class="orb-container"><svg class="orb-svg" viewBox="0 0 50 50"><circle class="orb-bg" cx="25" cy="25" r="22"/><circle class="orb-fg" id="polyphenolOrb" cx="25" cy="25" r="22" style="stroke:var(--purple)"/></svg><div class="orb-val-box"><div class="orb-val" id="polyphenolVal">0</div></div></div><div class="orb-label" style="color:var(--purple)">POLYPHENOL</div></div>
</div>
</div>

<!-- v21 METABOLISM -->

<div class="section-header" onclick="app.toggleSection(this)">METABOLISM (BALANCE)<span class="section-summary" id="metabSummary"></span><span class="section-chevron">â–¼</span></div>
<div class="section-body" id="metabBody">
<div class="grid-4">
<div class="orb-card"><div class="orb-container"><svg class="orb-svg" viewBox="0 0 50 50"><circle class="orb-bg" cx="25" cy="25" r="22"/><circle class="orb-fg" id="balanceOrb" cx="25" cy="25" r="22" style="stroke:var(--success)"/></svg><div class="orb-val-box"><div class="orb-val" id="balanceVal">--</div></div></div><div class="orb-label" style="color:var(--success)" id="balanceLabel">BALANCE</div></div>
<div class="orb-card"><div style="text-align:center"><div style="font-size:0.5rem;color:var(--text-tertiary);margin-bottom:4px">EATEN</div><div style="font-size:1.2rem;font-weight:900;color:var(--success)" id="eatenVal">0</div></div><div class="orb-label" style="color:var(--success)">CALORIES</div></div>
<div class="orb-card"><div style="text-align:center"><div style="font-size:0.5rem;color:var(--text-tertiary);margin-bottom:4px">BURNED</div><div style="font-size:1.2rem;font-weight:900;color:var(--alert)" id="burnedVal">0</div></div><div class="orb-label" style="color:var(--alert)">TOTAL</div></div>
<div class="orb-card"><div style="text-align:center"><div style="font-size:0.5rem;color:var(--text-tertiary);margin-bottom:4px">BMR</div><div style="font-size:1.2rem;font-weight:900;color:var(--orange)" id="bmrVal">2000</div></div><div class="orb-label" style="color:var(--orange)">BASE</div></div>
</div>
</div>

<!-- v21 VASCULAR -->

<div class="section-header" onclick="app.toggleSection(this)">VASCULAR (AGING)<span class="section-summary" id="vascSummary"></span><span class="section-chevron">â–¼</span></div>
<div class="section-body" id="vascBody">
<div class="grid-3">
<div class="orb-card"><div style="text-align:center"><div style="font-size:0.5rem;color:var(--text-tertiary);margin-bottom:4px">VASCULAR</div><div style="font-size:1.4rem;font-weight:900;color:var(--alert)" id="vascularAge">--</div></div><div class="orb-label" style="color:var(--alert)">AGE</div></div>
<div class="orb-card"><div style="text-align:center"><div style="font-size:0.5rem;color:var(--text-tertiary);margin-bottom:4px">DIFFERENCE</div><div style="font-size:1.4rem;font-weight:900;color:var(--success)" id="ageDiff">--</div></div><div class="orb-label" style="color:var(--success)" id="ageDiffLabel">YOUNGER</div></div>
<div class="orb-card"><div style="text-align:center"><div style="font-size:0.5rem;color:var(--text-tertiary);margin-bottom:4px">TREND</div><div style="font-size:1.4rem;font-weight:900;color:var(--orange)" id="vascularTrend">--</div></div><div class="orb-label" style="color:var(--orange)">7-DAY</div></div>
</div>
</div>

<div class="section-header" onclick="app.toggleSection(this)">ENGINE (CARDIO)<span class="section-summary" id="cardioSummary"></span><span class="section-chevron">â–¼</span></div>
<div class="section-body" id="cardioBody">
<div class="grid-4">
<div class="orb-card"><div class="heart-container"><svg class="heart-svg beating" viewBox="0 0 24 24"><path class="heart-bg" d="M12 21.35l-1.45-1.32C5.4 15.36 2 12.28 2 8.5 2 5.42 4.42 3 7.5 3c1.74 0 3.41.81 4.5 2.09C13.09 3.81 14.76 3 16.5 3 19.58 3 22 5.42 22 8.5c0 3.78-3.4 6.86-8.55 11.54L12 21.35z"/><path class="heart-fg" style="stroke:var(--alert);stroke-dasharray:none;stroke-dashoffset:0" d="M12 21.35l-1.45-1.32C5.4 15.36 2 12.28 2 8.5 2 5.42 4.42 3 7.5 3c1.74 0 3.41.81 4.5 2.09C13.09 3.81 14.76 3 16.5 3 19.58 3 22 5.42 22 8.5c0 3.78-3.4 6.86-8.55 11.54L12 21.35z"/></svg><div class="orb-val-box"><div class="orb-val" id="rhrVal" style="color:var(--alert)">--</div></div></div><div class="orb-label" style="color:var(--alert)">RHR</div></div>
<div class="orb-card"><div class="heart-container"><svg class="heart-svg" viewBox="0 0 24 24"><path class="heart-bg" d="M12 21.35l-1.45-1.32C5.4 15.36 2 12.28 2 8.5 2 5.42 4.42 3 7.5 3c1.74 0 3.41.81 4.5 2.09C13.09 3.81 14.76 3 16.5 3 19.58 3 22 5.42 22 8.5c0 3.78-3.4 6.86-8.55 11.54L12 21.35z"/><path class="heart-fg" id="z2Heart" pathLength="100" style="stroke:var(--cyan)" d="M12 21.35l-1.45-1.32C5.4 15.36 2 12.28 2 8.5 2 5.42 4.42 3 7.5 3c1.74 0 3.41.81 4.5 2.09C13.09 3.81 14.76 3 16.5 3 19.58 3 22 5.42 22 8.5c0 3.78-3.4 6.86-8.55 11.54L12 21.35z"/></svg><div class="orb-val-box"><div class="orb-val" id="z2Val" style="color:var(--cyan)">0</div></div></div><div class="orb-label" style="color:var(--cyan)">ZONE 2</div></div>
<div class="orb-card" id="z5Card"><div class="heart-container"><svg class="heart-svg" viewBox="0 0 24 24"><path class="heart-bg" d="M12 21.35l-1.45-1.32C5.4 15.36 2 12.28 2 8.5 2 5.42 4.42 3 7.5 3c1.74 0 3.41.81 4.5 2.09C13.09 3.81 14.76 3 16.5 3 19.58 3 22 5.42 22 8.5c0 3.78-3.4 6.86-8.55 11.54L12 21.35z"/><path class="heart-fg" id="z5Heart" pathLength="100" style="stroke:var(--alert)" d="M12 21.35l-1.45-1.32C5.4 15.36 2 12.28 2 8.5 2 5.42 4.42 3 7.5 3c1.74 0 3.41.81 4.5 2.09C13.09 3.81 14.76 3 16.5 3 19.58 3 22 5.42 22 8.5c0 3.78-3.4 6.86-8.55 11.54L12 21.35z"/></svg><div class="orb-val-box"><div class="orb-val" id="z5Val" style="color:var(--alert)">0</div></div></div><div class="orb-label" style="color:var(--alert)" id="z5Label">ZONE 5</div></div>
<div class="orb-card"><div class="heart-container"><svg class="heart-svg" viewBox="0 0 24 24"><path class="heart-bg" d="M12 21.35l-1.45-1.32C5.4 15.36 2 12.28 2 8.5 2 5.42 4.42 3 7.5 3c1.74 0 3.41.81 4.5 2.09C13.09 3.81 14.76 3 16.5 3 19.58 3 22 5.42 22 8.5c0 3.78-3.4 6.86-8.55 11.54L12 21.35z"/><path class="heart-fg" id="calHeart" pathLength="100" style="stroke:var(--orange)" d="M12 21.35l-1.45-1.32C5.4 15.36 2 12.28 2 8.5 2 5.42 4.42 3 7.5 3c1.74 0 3.41.81 4.5 2.09C13.09 3.81 14.76 3 16.5 3 19.58 3 22 5.42 22 8.5c0 3.78-3.4 6.86-8.55 11.54L12 21.35z"/></svg><div class="orb-val-box"><div class="orb-val" id="calVal" style="color:var(--orange)">0</div></div></div><div class="orb-label" style="color:var(--orange)">BURN</div></div>
</div>
</div>

<div class="section-header" onclick="app.toggleSection(this)">HYDRATION ðŸ’§<span class="section-summary" id="hydroSummary"></span><span class="section-chevron">â–¼</span></div>
<div class="section-body" id="hydroBody">
<div class="water-container">
<div class="water-header"><div class="water-title">WATER INTAKE</div><div class="water-score" id="waterScore">0 / 140 oz</div></div>
<div class="water-track" onclick="app.addWater()"><div class="water-fill" id="waterFill"></div></div>
<div style="text-align:center;margin-top:8px;font-size:0.65rem;color:var(--text-tertiary)">Tap bar to add 8oz glass</div>
</div>
</div>

<div class="section-header" onclick="app.toggleSection(this)">PHYTONUTRIENT ðŸŒˆ<span class="section-summary" id="rainbowSummaryText"></span><span class="section-chevron">â–¼</span></div>
<div class="section-body" id="rainbowBody">
<div class="rainbow-container">
<div class="rainbow-header"><div class="rainbow-title">RAINBOW SCORE</div><div class="rainbow-score" id="rainbowScore">0%</div></div>
<div class="rainbow-track" id="rainbowTrack"></div>
</div>
</div>

<div class="section-header" onclick="app.toggleSection(this)">SYNERGY PROTOCOL<span class="section-chevron">â–¼</span></div>
<div class="section-body" id="protocolBody">
<div class="timeline" id="timeline"></div>
</div>

<div class="modal-overlay" id="mainModal">
<div class="modal-content">
<div class="modal-header"><div class="modal-title" id="modalTitle">MENU</div><button class="modal-close" onclick="app.closeModal()">Ã—</button></div>
<div class="modal-body" id="modalBody"></div>
</div>
</div>

<div class="footer">
<span class="sync-status" id="syncStatus">INIT</span>
<button class="sync-btn" onclick="app.sync()">ðŸ”„ SYNC</button>
</div>

<script>
// ============================================================================
// PLACEHOLDER: MEALS DATABASE WILL BE INJECTED HERE
// ============================================================================
const MEALS={
breakfast:[
{title:"Greek Yogurt & Berries",time:"5min",servings:1,macros:{p:20,o:4100,f:13,cal:310,poly:250},ingredients:["1 cup Greek Yogurt","1/2 cup Mixed Berries","1 tbsp Honey","1 tbsp Walnuts","1 tbsp Ground Flaxseed","1 tbsp Chia Seeds"],steps:["Scoop yogurt into bowl","Top with berries and walnuts","Drizzle with honey"],why:"Probiotics + Antioxidants. Quick high protein start. Flax+Chia add Î©3+fiber for Lp(a).",colors:['white','purple','brown'],suggestedBeverage:"Green Tea (Sencha)"},
{title:"Omega Breakfast",time:"15min",servings:1,macros:{p:58,o:3500,f:12,cal:680,poly:450},ingredients:["8oz Wild Salmon","2 Eggs","2 cups Kale","1 cup Blueberries","1 tsp EVOO"],steps:["Heat EVOO in pan","Season salmon with salt/pepper","Sear salmon 4min per side","Scramble eggs separately","Massage kale for 2min","Plate kale as base","Top with salmon, eggs, and berries"],why:"Salmon + Eggs = Choline/Omega-3 synergy for brain health.",colors:['orange','purple','green'],suggestedBeverage:"Lemon Ginger Water"},
{title:"Sophia's Sea Moss Oatmeal",time:"10min",servings:1,macros:{p:48,o:8200,f:18,cal:580,poly:300},ingredients:["1 cup Oats","1 tbsp Sea Moss","3 tbsp Flaxseed","Pea Protein","Berries"],steps:["Cook oats in water or oat milk","Stir in Sea Moss gel and protein","Top with ground flax and berries"],why:"Sea Moss minerals support thyroid. Flax lowers Lp(a).",colors:['purple','white']},
{title:"PB Sea Moss Power Shake",time:"5min",servings:1,macros:{p:55,o:7200,f:18,cal:780,poly:150},ingredients:["Pea Protein","Sea Moss","Flaxseed","PB","1 Banana","Spinach","Oat Milk"],steps:["Add all ingredients to blender","Blend with Oat Milk until smooth"],why:"Sea Moss supports mucus membranes. Pea protein = 54g complete. Banana = potassium + natural sweetness + prebiotic fiber.",colors:['green','white','yellow']},
{title:"Smoked Trout Hash",time:"18min",servings:1,macros:{p:54,o:3200,f:16,cal:640,poly:100},ingredients:["6oz Trout","2 Eggs","1 Sweet Potato","Brussels Sprouts","Garlic"],steps:["Dice sweet potato and saute","Add sprouts and garlic","Crack eggs into wells","Cover until eggs set","Top with flaked trout"],why:"Trout is lower mercury than tuna. Sprouts = Sulforaphane.",colors:['orange','green']},
{title:"Savory Turmeric Oats",time:"12min",servings:1,macros:{p:20,o:1200,f:12,cal:450,poly:250},ingredients:["1 cup Oats","Turmeric","Black Pepper","Spinach","Poached Egg"],steps:["Cook oats with turmeric/pepper","Stir in spinach","Top with egg"],why:"Turmeric + Pepper = 2000% absorption boost.",colors:['yellow','green']},
{title:"Mackerel Scramble",time:"12min",servings:1,macros:{p:56,o:4800,f:10,cal:660,poly:250},ingredients:["mackerel","eggs","arugula","turmeric"],steps:["Whisk eggs with turmeric","Scramble with mackerel","Serve over wilted arugula"],why:"Mackerel is highest Omega-3 fish. Turmeric reduces inflammation.",colors:['yellow','green']},
{title:"Smoked Salmon Avocado Toast",time:"12min",servings:1,macros:{p:54,o:3400,f:14,cal:680,poly:200},ingredients:["smoked salmon","sprouted grain bread","avocado","eggs","1 tbsp EVOO drizzle","Fresh Dill + Capers"],steps:["Toast bread","Mash avocado","Top with salmon and poached egg"],why:"Sprouted grains easier to digest. Salmon + Avocado = healthy fats.",colors:['orange','green']},
{title:"Flax Protein Parfait",time:"5min",servings:1,macros:{p:48,o:8600,f:22,cal:620,poly:300},ingredients:["pea protein","flaxseed","greek yogurt","berries","1/2 cup Mixed Berries","1 tsp Turmeric"],steps:["Mix yogurt and protein","Layer with flax and berries"],why:"Flax is highest plant source of ALA. Yogurt = probiotics.",colors:['white','purple','purple']},
{title:"Tofu Scramble Supreme",time:"12min",servings:1,macros:{p:50,o:2800,f:16,cal:720,poly:310},ingredients:["tofu","spinach","mushrooms","turmeric","1 tbsp EVOO","Fresh Turmeric + Black Pepper","2 slices Sprouted Grain Toast","1/2 cup Fresh Raspberries"],steps:["Crumble tofu","Saut\u00e9 with veggies and spices","Toast sprouted bread","Plate scramble with toast and raspberries on the side"],why:"Soy protein lowers cholesterol. Turmeric/Pepper combo = 2000% curcumin absorption. Sprouted grain toast = more bioavailable nutrients + 6g fiber per 2 slices. Raspberries = 4g fiber + ellagic acid (potent anti-inflammatory).",colors:['yellow','green','white','red']},
{title:"Protein Pancakes",time:"15min",servings:1,macros:{p:52,o:6400,f:14,cal:660,poly:250},ingredients:["pea protein","flaxseed","oats","berries","1/2 cup Blueberries","Drizzle Raw Honey"],steps:["Blend batter ingredients","Cook on griddle","Top with berries"],why:"High protein start to day. Oats = soluble fiber.",colors:['purple','white','purple']},
{title:"Eggs & Oatmeal Combo",time:"12min",servings:1,macros:{p:52,o:7800,f:16,cal:670,poly:250},ingredients:["\u00bd cup steel-cut oats","2 tbsp ground flaxseed","1 tbsp Sea Moss Gel","3 eggs","1 cup spinach","\u00bd avocado","Berries","1/2 cup Blueberries","1 tsp Cinnamon"],steps:["Cook oats with Sea Moss","Scramble eggs with spinach","Plate oatmeal with flax, berries","Serve eggs on side with avocado"],why:"Best of both worlds. Flax omega-3 + egg choline. Sea Moss minerals.",colors:['green','white','purple']},
{title:"Power Berry Smoothie",time:"5min",servings:1,macros:{p:58,o:8400,f:18,cal:680,poly:400},ingredients:["1 scoop Pea Protein","2 tbsp Ground Flaxseed","2 tbsp Hemp Seeds","1 cup Greek Yogurt","2 tbsp Peanut Butter","1 cup Mixed Berries","1 cup Oat Milk","1 tsp Vanilla Extract"],steps:["Add all ingredients to blender","Blend on high for 60 seconds","Pour into glass","Optional: top with extra berries"],why:"Triple protein stack (pea + yogurt + peanut). Flax + Hemp = massive omega-3 hit. Berries = antioxidants.",colors:['purple','brown','white']},
{title:"Sea Moss Berry Smoothie",time:"5min",servings:1,macros:{p:36,o:4200,f:14,cal:520,poly:350},ingredients:["1 cup Mixed Berries","1 tbsp Sea Moss Gel","2 tbsp Ground Flaxseed","1 scoop Pea Protein","1 tbsp Peanut Butter Powder","1 cup Oat Milk","1/2 Banana","Handful Spinach"],steps:["Add all ingredients to blender","Blend until smooth","Pour into glass"],why:"Sea Moss = 92 minerals for thyroid. Berries = polyphenols. Flax = omega-3 ALA. Pea + peanut protein stack. Oat milk adds beta-glucan for ApoB reduction.",colors:['purple','green']},
{title:"Pressed Juice Power Bowl",time:"10min",servings:1,macros:{p:45,o:2800,f:18,cal:620,poly:300},ingredients:["1 Pressed Juice Acai Base","1 scoop Pea Protein","2 tbsp Ground Flaxseed","2 tbsp Hemp Hearts","1/2 cup Granola","1/2 cup Mixed Berries","1/2 Banana","1 tbsp Almond Butter"],steps:["Blend acai base with protein and flaxseed","Pour into bowl","Top with granola, berries, banana","Drizzle with almond butter","Sprinkle hemp hearts"],why:"Acai = antioxidant powerhouse. Protein keeps you full. Flax + Hemp = omega-3 stack. Perfect post-workout recovery.",colors:['purple','brown']},
{title:"Simple Avocado Toast",time:"5min",servings:1,macros:{p:22,o:1200,f:14,cal:420,poly:150},ingredients:["1 slice Sprouted Grain Bread","1/2 Avocado","Sea Salt","Black Pepper","Red Pepper Flakes","2 Eggs","1 tbsp Hemp Hearts","1 tbsp EVOO","Everything Bagel Seasoning"],steps:["Toast bread until golden","Mash avocado with fork","Spread on toast","Season with salt, pepper, red pepper flakes"],why:"Monounsaturated fats + potassium from avocado. Sprouted bread easier to digest. Quick anti-inflammatory breakfast.",colors:['green','brown','yellow'],suggestedBeverage:"Golden Milk (Hot)"},
{title:"Loaded Salmon Avocado Toast",time:"6min",servings:1,macros:{p:32,o:3800,f:14,cal:480,poly:100},ingredients:["1 slice Sprouted Grain Bread","1/2 Avocado","3oz Smoked Salmon","1 tbsp Hemp Hearts","1 tbsp Ground Flaxseed","Lemon","Everything Bagel Seasoning"],steps:["Toast bread until golden","Mash avocado, spread on toast","Layer smoked salmon on top","Sprinkle hemp hearts and flaxseed","Squeeze lemon, add seasoning"],why:"Triple omega-3 stack: salmon DHA/EPA + hemp ALA + flax ALA. Avocado monounsaturated fats boost absorption. Complete protein from salmon.",colors:['pink','green','brown'],suggestedBeverage:"Golden Milk (Hot)"},
{title:"Egg White Zucchini Scramble",time:"10min",servings:1,macros:{p:24,o:1800,f:10,cal:290,poly:200},ingredients:["6 Egg Whites","1 cup Diced Zucchini","1/2 cup Diced Bell Peppers","1 tsp Olive Oil","Garlic Powder","Salt","Pepper","1 tbsp Ground Flaxseed","1 tbsp EVOO","Fresh Herbs"],steps:["Heat olive oil in pan","Saut\u00e9 diced zucchini and bell peppers until tender","Whisk egg whites with seasonings","Pour egg whites over veggies","Scramble until cooked through"],why:"Pure lean protein from egg whites. Zucchini + bell peppers add fiber + vitamin C. Low calorie, high volume breakfast.",colors:['white','green','red']},
{title:"Spinach Tofu Scramble",time:"12min",servings:1,macros:{p:22,o:800,f:9,cal:300,poly:140},ingredients:["8oz Firm Tofu","2 cups Spinach","1/2 cup Diced Bell Peppers","1/2 Onion","Turmeric","Nutritional Yeast","Garlic","Olive Oil"],steps:["Crumble tofu into chunks","Saut\u00e9 onion, garlic, and bell peppers","Add crumbled tofu with turmeric","Fold in fresh spinach","Season with nutritional yeast"],why:"Complete plant protein from tofu. Turmeric = anti-inflammatory. Bell peppers = vitamin C. Nutritional yeast = B vitamins. Spinach = iron + folate.",colors:['yellow','green','red']},
{title:"Chicken & Veggie Breakfast Bowl",time:"15min",servings:1,macros:{p:54,o:600,f:16,cal:520,poly:110},ingredients:["6oz Grilled Chicken Breast","1/2 cup Black Beans","1 cup Broccoli","1 cup Bell Peppers","2 Eggs","Sweet Potato","Avocado"],steps:["Dice and roast sweet potato","Steam broccoli and peppers","Warm black beans","Slice pre-cooked chicken","Scramble eggs","Combine all in bowl","Top with sliced avocado"],why:"Savory breakfast with complete protein. Black beans add 8g fiber + resistant starch. Sweet potato = complex carbs for sustained energy. Veggies = fiber + phytonutrients.",colors:['brown','green','orange','yellow','black']},
{title:"The ApoB Destroyer",time:"10min",servings:1,macros:{p:38,o:5200,f:24,cal:520,poly:180},ingredients:["1/2 cup Steel Cut Oats","1 tbsp Psyllium Husk","2 tbsp Ground Flaxseed","1 scoop Pea Protein","1 tbsp Chia Seeds","1/2 cup Blueberries","1 tbsp Almond Butter","Cinnamon"],steps:["Cook steel cut oats","Stir in psyllium husk while hot (thickens fast)","Mix in flax and chia seeds","Stir in pea protein","Top with blueberries and almond butter","Dust with cinnamon"],why:"Triple soluble fiber stack: Psyllium (4g soluble fiber binds bile acids forcing liver to pull LDL from blood), oat beta-glucan (3g = clinically proven -5-10% LDL), flax lignans. This single meal delivers ~12g soluble fiber â€” the #1 dietary tool for ApoB reduction.",colors:['brown','purple','white']},
{title:"Huevos Rancheros",time:"15min",servings:1,macros:{p:42,o:2400,f:18,cal:520,poly:200},ingredients:["1 cup Egg Whites","1 cup Black Beans","1 cup Zucchini (diced)","1 cup Yellow Squash (diced)","1/2 block Firm Tofu (crumbled)","2 cups Spinach","2 tbsp Ground Flaxseed","2 tbsp Hemp Hearts","1/2 cup Red Salsa","1 tsp Turmeric","1/2 tsp Black Pepper","1 tbsp EVOO"],steps:["Heat EVOO in large skillet","SautÃ© zucchini and squash until tender","Add crumbled tofu and spinach, cook until wilted","Add turmeric and black pepper, stir through","Push veggies aside, scramble egg whites","Warm black beans with salsa in separate pan","Plate beans and salsa, top with egg white and veggie scramble","Sprinkle flaxseed and hemp hearts on top"],why:"Loaded anti-inflammatory breakfast. Turmeric + black pepper = 2000% curcumin absorption. Black beans = 15g soluble fiber binding bile acids for ApoB. Flax lignans + hemp hearts add omega-3 ALA + complete plant protein. Tofu isoflavones lower LDL. Zucchini and squash add bulk with minimal calories.",colors:['yellow','green','black','red']}
],
lunch:[
{title:"Double Chicken Chipotle Bowl",time:"15min",servings:1,macros:{p:68,o:800,f:12,cal:720,poly:200},ingredients:["8oz Grilled Chicken","Brown Rice","Black Beans","Pico de Gallo","Shredded Lettuce","Chipotle Sauce","Lime"],steps:["Grill seasoned chicken breast","Warm brown rice and black beans","Build bowl with rice base","Add beans, grilled chicken","Top with pico, lettuce, sauce","Squeeze lime over top"],why:"Maximum protein + fiber combo. Black beans = resistant starch for gut health. Chipotle peppers = capsaicin metabolism boost.",colors:['brown','black','green','red']},
{title:"Classic Bison Burger",time:"20min",servings:1,macros:{p:42,o:2000,f:12,cal:600,poly:180},ingredients:["6oz Ground Bison","1 Whole Wheat Bun","Lettuce/Tomato/Onion","1 tsp Mustard","Side Green Salad","1 tbsp Ground Flaxseed (in patty)","Arugula + Tomato","1 tbsp EVOO aioli"],steps:["Form bison patty (don't overwork)","Grill or pan sear 3-4 mins/side (Medium Rare)","Toast bun lightly","Assemble with fresh veggies","Serve with side salad"],why:"Bison = Lower TMAO & inflammation than beef. High Heme Iron.",colors:['brown','green','red','red']},
{title:"Ahi Poke Bowl",time:"15min",servings:1,macros:{p:53,o:1600,f:16,cal:620,poly:150},ingredients:["6oz Ahi Tuna","Brown Rice","1 cup Edamame","Cucumber","Mango","Seaweed","Sesame Oil"],steps:["Cube raw tuna","Toss in sesame oil and soy","Cook edamame for 3 mins","Plate over brown rice","Add edamame","Top with tuna, sliced veg and mango"],why:"Raw fish preserves delicate Omega-3s. Seaweed = Iodine. Edamame adds 8g fiber + plant protein + isoflavones.",colors:['red','green','yellow']},
{title:"Turkey Club Wrap",time:"10min",servings:1,macros:{p:38,o:2000,f:10,cal:590,poly:150},ingredients:["1 large tortilla","4oz turkey breast","2 slices turkey bacon","Lettuce","Tomato","Mayo (light)","1 tbsp Ground Flaxseed","Spinach + Tomato","EVOO drizzle"],steps:["Cook bacon until crisp","Spread mayo on wrap","Layer turkey, bacon, veg","Roll tightly and slice"],why:"High protein lunch standard.",colors:['white','green','red','red']},
{title:"Bean & Cheese Burrito",time:"10min",servings:1,macros:{p:22,o:1800,f:18,cal:620,poly:150},ingredients:["1 large whole wheat tortilla","1/2 cup refried beans (vegetarian)","1/4 cup cheddar","Salsa","Spinach","Greek yogurt","1 tbsp Ground Flaxseed","Fresh Cilantro + Lime","Pico de Gallo"],steps:["Spread beans on tortilla","Add cheese and salsa","Add spinach","Roll and heat in pan","Dip in yogurt"],why:"Beans = fiber/protein combo. Whole wheat = sustained energy.",colors:['brown','green','white','red']},
{title:"Zoodles & Shrimp",time:"15min",servings:1,macros:{p:35,o:1600,f:8,cal:450,poly:200},ingredients:["Zucchini","Shrimp","Garlic","Lemon","Olive Oil","1 tbsp EVOO","Fresh Basil + Parsley","1 tbsp Hemp Hearts"],steps:["Spiralize zucchini","Saute shrimp with garlic","Toss zoodles in pan for 1 min"],why:"Low carb, high nutrient density.",colors:['green','pink']},
{title:"Cottage Cheese Bowl",time:"5min",servings:1,macros:{p:30,o:4300,f:14,cal:420,poly:250},ingredients:["Cottage Cheese","Pineapple","Walnuts","Chia Seeds","1 tbsp Chia Seeds","1/2 cup Berries","1 tbsp Ground Flaxseed"],steps:["Scoop cheese into bowl","Top with fruit and nuts"],why:"Casein protein creates slow release amino acids.",colors:['white','yellow','purple']},
{title:"Salmon Pesto Pasta",time:"20min",servings:1,macros:{p:56,o:4200,f:12,cal:740,poly:250},ingredients:["6oz Salmon","Chickpea Pasta","Pesto","Tomatoes","Arugula","Fresh Basil Pesto (EVOO base)","Lemon Zest"],steps:["Boil chickpea pasta","Sear salmon separately","Toss pasta with pesto","Combine salmon and pasta","Top with tomatoes"],why:"Chickpea pasta = high fiber/protein. Pesto = polyphenols.",colors:['pink','green','red']},
{title:"Chipotle Bowl (Bison)",time:"18min",servings:1,macros:{p:58,o:2800,f:20,cal:740,poly:200},ingredients:["6oz Bison","Brown Rice","Black Beans","Peppers","Guacamole","Fresh Cilantro + Lime","1 tbsp EVOO"],steps:["Brown bison in pan","Warm black beans","Build bowl with rice base","Top with meat, beans, peppers","Add guacamole"],why:"Bison = nutrient dense red meat. Beans = soluble fiber.",colors:['brown','black','green','red']},
{title:"Chipotle Bowl (Tofu)",time:"20min",servings:1,macros:{p:46,o:3200,f:22,cal:680,poly:200},ingredients:["tofu","brown rice","black beans","peppers","Fresh Cilantro + Lime","1 tbsp EVOO"],steps:["Season and bake tofu","Assemble bowl with beans and rice"],why:"Plant-based complete protein. High fiber.",colors:['white','black','green']},
{title:"Mediterranean Quinoa Salad",time:"15min",servings:1,macros:{p:22,o:2200,f:18,cal:630,poly:250},ingredients:["quinoa","cucumber","tomatoes","olives","feta","1 tbsp EVOO dressing","Fresh Parsley + Mint","1 tbsp Hemp Hearts"],steps:["Mix cooked quinoa with chopped veg","Add olives and feta","Drizzle with olive oil"],why:"Mediterranean diet gold standard. Olives = healthy fats.",colors:['white','green','red','black']},
{title:"Lentil Soup with Kale",time:"30min",servings:2,macros:{p:24,o:800,f:22,cal:500,poly:250},ingredients:["lentils","kale","carrots","celery","1 tbsp EVOO finish","Turmeric + Black Pepper","Fresh Parsley"],steps:["Simmer lentils with veg","Add kale at end to wilt"],why:"High fiber lowers cholesterol. Kale = nutrient density.",colors:['brown','green','orange','yellow']},
{title:"Turkey Burger & Sweet Potato",time:"20min",servings:1,macros:{p:38,o:1900,f:12,cal:630,poly:180},ingredients:["turkey","sweet potato","lettuce","tomato","1 tbsp Ground Flaxseed (in patty)","Arugula","1 tbsp EVOO"],steps:["Grill turkey burger","Roast sweet potato wedges","Serve with salad"],why:"Lean protein. Sweet potato = Vitamin A.",colors:['white','orange','green']},
{title:"Chickpea Curry (Quick)",time:"20min",servings:2,macros:{p:22,o:1400,f:18,cal:540,poly:250},ingredients:["1 can chickpeas","1 cup coconut milk (light)","1 tbsp red curry paste","1 cup spinach","1/2 cup bell pepper","1/2 onion","Basmati rice","Turmeric + Black Pepper","1 tbsp EVOO","Fresh Cilantro","1 tbsp Hemp Hearts"],steps:["Saut\u00e9 onion and peppers","Add curry paste, cook 1 min","Add coconut milk and chickpeas","Simmer 10 mins","Stir in spinach","Serve over rice"],why:"Chickpeas = fiber/protein. Turmeric in paste = anti-inflammatory.",colors:['yellow','green','white','yellow']},
{title:"Bison Taco Salad",time:"15min",servings:1,macros:{p:45,o:800,f:12,cal:620,poly:180},ingredients:["5oz ground bison","2 cups romaine","1/2 cup black beans","1/4 cup salsa","1/4 avocado","1 tbsp greek yogurt","Cumin, chili powder","1 tbsp EVOO dressing","Fresh Cilantro + Lime"],steps:["Brown bison with spices","Drain fat","Assemble lettuce base","Top with meat, beans, salsa","Add avocado and yogurt dollop"],why:"Bison = nutrient dense red meat. Beans = soluble fiber.",colors:['brown','black','green','red']},
{title:"Edamame & Quinoa Bowl",time:"15min",servings:1,macros:{p:24,o:1800,f:12,cal:540,poly:200},ingredients:["1 cup cooked quinoa","1 cup shelled edamame","1/2 cup shredded purple cabbage","1 carrot (shredded)","Ginger soy dressing","Sesame seeds","1 tbsp EVOO","Turmeric Tahini Dressing","Fresh Herbs"],steps:["Warm quinoa and edamame","Toss with cabbage and carrot","Drizzle dressing","Top with sesame seeds"],why:"Edamame = soy protein. Purple cabbage = antioxidants.",colors:['green','purple','orange','yellow']},
{title:"Smoked Salmon Bagel (Open)",time:"5min",servings:1,macros:{p:32,o:2800,f:6,cal:480,poly:180},ingredients:["1 whole grain bagel","4oz smoked salmon","2 tbsp cream cheese","Capers","Red onion","Dill","Cucumber slices","Capers + Red Onion","1 tbsp EVOO","Fresh Dill"],steps:["Toast bagel","Spread cream cheese","Layer salmon","Top with capers, onion, dill","Serve cucumber on side"],why:"Salmon = omega-3. Whole grain = fiber.",colors:['orange','white','green']},
{title:"Leftover Roast Chicken Salad",time:"10min",servings:1,macros:{p:40,o:3100,f:12,cal:580,poly:200},ingredients:["5oz roast chicken (cold)","2 cups arugula","1/2 apple (diced)","1/4 cup walnuts","Celery","Yogurt dressing","1 tbsp EVOO vinaigrette","1 tbsp Walnuts","Fresh Herbs"],steps:["Chop chicken and celery","Toss with arugula and apple","Add walnuts","Mix with yogurt dressing"],why:"Chicken = protein. Walnuts = ALA omega-3. Apple = quercetin.",colors:['white','green','brown']},
{title:"Tempeh Reuben Bowl",time:"15min",servings:1,macros:{p:28,o:1200,f:16,cal:560,poly:200},ingredients:["6oz tempeh strips","1/2 cup sauerkraut","1 slice swiss cheese","Rye croutons","Thousand island dressing (light)","Mixed greens","1 tbsp EVOO","Sauerkraut (probiotic)","Fresh Herbs"],steps:["Pan fry tempeh strips","Melt cheese on tempeh","Place over greens","Add kraut and croutons","Drizzle dressing"],why:"Tempeh/Kraut = gut health powerhouse.",colors:['brown','green']},
{title:"Shrimp & Asparagus Stir Fry",time:"15min",servings:1,macros:{p:40,o:1200,f:16,cal:520,poly:150},ingredients:["6oz shrimp","1 bunch asparagus","1 cup edamame","Garlic","Ginger","Soy sauce","Sesame oil","Cauliflower rice"],steps:["Saut\u00e9 garlic/ginger in oil","Add asparagus and edamame, stir fry 3min","Add shrimp, cook until pink","Add soy sauce","Serve over cauli rice"],why:"Shrimp = astaxanthin. Asparagus = prebiotic. Edamame adds plant protein + 8g fiber boost.",colors:['pink','green','white']},
{title:"Turkey Club (Sourdough)",time:"10min",servings:1,macros:{p:40,o:500,f:10,cal:590,poly:150},ingredients:["Sliced Turkey","Sourdough Bread","Avocado","Tomato","Lettuce","1 tbsp EVOO","Arugula + Tomato"],steps:["Toast sourdough","Layer turkey and veg","Add mashed avocado"],why:"Sourdough is fermented/low glycemic. Turkey = lean protein.",colors:['white','red','green','red']},
{title:"Costco Cauliflower Pizza",time:"25min",servings:2,macros:{p:36,o:1200,f:12,cal:640,poly:200},ingredients:["1 Costco Cauliflower Pizza Crust","1 cup Marinara Sauce","2 cups Mozzarella","Toppings: Peppers, Mushrooms, Onions","Italian Herbs","Side Salad","Side Arugula Salad w/ EVOO","1 tbsp Hemp Hearts"],steps:["Preheat oven to 425\u00b0F","Spread marinara on cauliflower crust","Add mozzarella and toppings","Sprinkle with herbs","Bake 18-20 mins until cheese bubbles","Serve with side salad"],why:"Cauliflower crust = lower carb, higher fiber. Costco convenience meets nutrition.",colors:['white','red','green']},
{title:"Bone Broth Pho",time:"15min",servings:1,macros:{p:50,o:1000,f:16,cal:520,poly:100},ingredients:["3 cups Bone Broth (beef or chicken)","6oz Sliced Beef or Chicken","Rice Noodles","1 cup Edamame","Bean Sprouts","Fresh Basil","Cilantro","Lime","Jalape\u00f1o","Hoisin","Sriracha"],steps:["Heat bone broth to boiling","Cook rice noodles according to package","Add edamame to broth for 3 mins","Add sliced meat to hot broth (cooks in 2min)","Drain noodles, add to bowl","Pour hot broth, meat, and edamame over noodles","Top with sprouts, herbs, lime, jalape\u00f1o","Add hoisin and sriracha to taste"],why:"Bone broth = collagen, glycine, minerals for gut/joint health. Edamame adds 8g fiber + plant protein boost. High protein, anti-inflammatory.",colors:['brown','white','green']},
{title:"Belgian Mussels & Frites",time:"20min",servings:1,macros:{p:44,o:1400,f:14,cal:620,poly:80},ingredients:["2lbs Mussels (cleaned)","1 cup White Wine","1/2 cup White Beans","3 cloves Garlic","Shallots","Fresh Thyme","Butter","Parsley","Lemon","Sweet Potato Fries","Side Salad"],steps:["Saut\u00e9 shallots and garlic in butter","Add white wine, white beans and thyme, bring to boil","Add mussels, cover and steam 5-7 mins until open","Discard any unopened mussels","Finish with parsley and lemon","Serve with baked sweet potato fries and salad"],why:"Mussels = zinc, iron, B12, omega-3. White beans add 8g fiber. Sweet potato = vitamin A. High protein, low calorie.",colors:['black','orange','green','white']},
{title:"Chicken Caesar Salad",time:"15min",servings:1,macros:{p:45,o:400,f:6,cal:480,poly:80},ingredients:["6oz Grilled Chicken Breast","2 cups Romaine Lettuce","2 tbsp Caesar Dressing","2 tbsp Parmesan Cheese","Whole Grain Croutons","Lemon Wedge"],steps:["Chop romaine lettuce","Grill or slice pre-cooked chicken","Toss lettuce with Caesar dressing","Top with chicken, parmesan, croutons","Squeeze lemon over top"],why:"Classic high-protein option. Romaine = vitamin K for bone health. Grilled chicken = lean complete protein.",colors:['green','white','brown']},
{title:"Fish Taco",time:"20min",servings:1,macros:{p:38,o:2200,f:10,cal:520,poly:100},ingredients:["6oz White Fish (cod/mahi)","2 Corn Tortillas","1/2 cup Shredded Cabbage","1/4 cup Pico de Gallo","1/4 Avocado","Lime","Cilantro","Chipotle Crema"],steps:["Season fish with cumin, chili powder","Grill or pan sear fish 3-4 mins per side","Warm corn tortillas","Flake fish into tortillas","Top with cabbage, pico, avocado","Drizzle with crema and lime","Garnish with cilantro"],why:"White fish = lean omega-3 protein. Corn tortillas = whole grain. Cabbage = cruciferous fiber. Perfect balance.",colors:['white','green','red','yellow']},
{title:"Salmon Quinoa Power Bowl",time:"20min",servings:1,macros:{p:58,o:4200,f:20,cal:720,poly:200},ingredients:["6oz Wild Salmon","1/2 cup Quinoa","1/2 cup Brown Rice","1 cup Edamame","1/2 Avocado","Lemon","Olive Oil","Sea Salt"],steps:["Cook quinoa and brown rice","Boil edamame 3 mins","Season salmon with salt, pepper","Pan sear salmon 4 mins per side","Plate grains and edamame","Top with salmon and sliced avocado","Drizzle with olive oil and lemon"],why:"Salmon = omega-3 DHA/EPA. Quinoa = complete protein with all 9 amino acids. Edamame adds 8g fiber + plant protein. Brown rice = sustained energy. Avocado = healthy fats for nutrient absorption.",colors:['pink','brown','green']},
{title:"Mendo Farms Turkey Avo Salsa Verde",time:"0min",servings:1,macros:{p:41,o:200,f:8,cal:840,poly:80},ingredients:["Roasted Turkey","Smashed Avocado","Smoked Gouda","Cotija","Mama Lil's Sweet Hot Peppers","JalapeÃ±o Salsa Aioli","Tomatoes","Shredded Romaine","Red Onions","Panini-Pressed Sourdough","Side JalapeÃ±o Salsa Verde"],steps:["Order from Mendocino Farms","Enjoy"],why:"41g protein from roasted turkey. Avocado healthy fats. Gouda + cotija for calcium. Convenient restaurant option with solid macros.",colors:['green','red','white','yellow']},
{title:"Caballo Blanco Chile Verde",time:"0min",servings:1,macros:{p:42,o:300,f:12,cal:650,poly:60},ingredients:["Tender Pork in Tomatillo Salsa Verde","Rice","Beans","Tortillas"],steps:["Order Chile Verde plate from Caballo Blanco","5604 Franklin Blvd, Sacramento","Enjoy"],why:"Slow-simmered pork = high bioavailable protein. Tomatillo sauce = vitamin C + antioxidants. Beans add fiber + plant protein. Sacramento staple since 1961.",colors:['green','brown','white']},
{title:"The Golden Shield",time:"25min",servings:1,macros:{p:56,o:200,f:12,cal:570,poly:480},ingredients:["6oz Chicken Breast","1 tsp Turmeric","1/2 tsp Black Pepper","1 Zucchini (sliced)","1 cup Mushrooms (sliced)","1/2 cup Quinoa","1/2 cup Brown Rice","1 tbsp EVOO","2 cloves Garlic","2 cups Fresh Spinach","Sea Salt"],steps:["Cook quinoa and brown rice together","Season chicken with turmeric, black pepper, salt","Sear chicken in EVOO 5 min per side","Remove chicken, sautÃ© garlic, zucchini, mushrooms 4 min","Wilt spinach into vegetables last 30 seconds","Slice chicken, plate over grains","Top with sautÃ©ed vegetables and spinach","Drizzle remaining pan juices over everything"],why:"Curcumin + piperine = 2000% absorption boost. Anti-inflammatory powerhouse targeting NF-ÎºB pathway. Mushrooms add beta-glucan for immune support. Quinoa = complete protein. High protein, moderate cal, massive polyphenol hit.",colors:['yellow','green','brown','white']},
{title:"The Barley Particle Sweep",time:"30min",servings:1,macros:{p:44,o:1900,f:22,cal:620,poly:160},ingredients:["1 cup Pearl Barley (cooked)","1/2 cup Lentils (cooked)","5oz Grilled Salmon","2 cups Spinach","1/2 Avocado","Cherry Tomatoes","1 tbsp EVOO","Lemon","2 tbsp Walnuts"],steps:["Cook barley and lentils (can batch prep)","Grill or bake salmon","Build bowl: barley and lentils base","Add spinach, halved cherry tomatoes","Top with salmon and sliced avocado","Scatter walnuts","Dress with EVOO and lemon juice"],why:"Barley beta-glucan is clinically equivalent to oats for LDL reduction â€” 3g/day = 5-10% ApoB drop. Lentils add resistant starch + soluble fiber that binds bile acids. Salmon EPA/DHA lowers VLDL particle production in the liver. Walnuts = ALA + plant sterols. This is a full-spectrum ApoB assault.",colors:['brown','green','pink','red']},
{title:"Chicken Fried Rice",time:"20min",servings:1,macros:{p:38,o:400,f:6,cal:650,poly:40},ingredients:["6oz Chicken Breast (diced)","2 cups Jasmine Rice (cooked)","2 Eggs","1 cup Mixed Vegetables (peas, carrots, corn)","2 tbsp Soy Sauce","1 tbsp Sesame Oil","3 cloves Garlic","Green Onions"],steps:["Cook rice ahead (day-old best)","Scramble eggs, set aside","Sear diced chicken in sesame oil","Add garlic, then vegetables","Add rice, toss on high heat","Add soy sauce and eggs back in","Top with green onions"],why:"High-volume comfort meal. Day-old rice = resistant starch (feeds gut bacteria). Eggs add choline. Sesame oil adds flavor with minimal sat fat.",colors:['brown','green','yellow','white']},
{title:"Chicken Enchiladas",time:"35min",servings:1,macros:{p:42,o:300,f:8,cal:680,poly:80},ingredients:["6oz Shredded Chicken","2 Flour Tortillas","1/2 cup Black Beans","1/2 cup Enchilada Sauce","1/4 cup Monterey Jack Cheese","1/4 Avocado","Cilantro","Onion"],steps:["Shred chicken and mix with beans and sauce","Fill tortillas and roll","Place in baking dish, top with remaining sauce and cheese","Bake at 375Â°F for 20 min","Top with avocado and cilantro"],why:"Black beans add resistant starch + soluble fiber for ApoB. Chicken = lean protein. Avocado = monounsaturated fat + plant sterols.",colors:['brown','red','green','black']},
{title:"Mediterranean Salmon (Yard House)",time:"0min",servings:1,macros:{p:50,o:3000,f:8,cal:630,poly:100},ingredients:["Atlantic Salmon","Artichoke Hearts","Sun-Dried Tomatoes","Kalamata Olives","Couscous","Arugula","Lemon Herb Vinaigrette","Capers"],steps:["Order at Yard House","Enjoy"],why:"Restaurant salmon done right. Atlantic salmon delivers ~3000mg EPA/DHA. Artichoke hearts = prebiotic inulin fiber. Kalamata olives = oleic acid + polyphenols. Arugula = glucosinolates (anti-cancer). Use HALF portion to keep macros in range.",colors:['pink','green','yellow','purple']},
{title:"Chipotle Chicken & Steak Burrito",time:"0min",servings:1,macros:{p:68,o:200,f:18,cal:1370,poly:60},ingredients:["Flour Tortilla","4oz Chicken","4oz Steak","Pinto & Black Bean Mix","Fajita Veggies (peppers, onions)","Cilantro-Lime White Rice","Fresh Tomato Salsa","Guacamole","Romaine Lettuce"],steps:["Order at Chipotle","Double protein: chicken + steak","Mixed beans (pinto + black)","Add fajita veggies","Rice, salsa, guac, lettuce","NO cheese, NO sour cream"],why:"68g protein monster. Mixed beans = 15g soluble fiber binding bile acids for ApoB reduction + resistant starch feeding gut bacteria. Fajita veggies add vitamin C. Guac = monounsaturated fat + plant sterols. Skipping cheese/sour cream saves 200cal + saturated fat.",colors:['brown','green','red','black']},
{title:"Black Beans & Mackerel",time:"20min",servings:1,macros:{p:55,o:4400,f:15,cal:710,poly:80},ingredients:["6oz Atlantic Mackerel (fillets)","1 cup Black Beans (cooked)","1 tbsp EVOO","3 cloves Garlic","1 Lime","Fresh Cilantro","1 tsp Cumin","Sea Salt","Red Pepper Flakes"],steps:["Season mackerel with cumin, salt, pepper flakes","Sear in EVOO 3-4 min per side","Warm black beans with garlic","Squeeze lime over beans, stir in cilantro","Plate beans, top with mackerel","Garnish with extra cilantro and lime wedge"],why:"Mackerel is the highest omega-3 fish per serving (4200mg EPA/DHA) â€” 3x more than salmon. Combined with 15g soluble fiber from black beans binding bile acids, this is a dual ApoB attack: reduce VLDL production (omega-3) + remove LDL from blood (fiber). Resistant starch in beans feeds gut bacteria.",colors:['black','silver','green']},
{title:"Bean Soup w/ Chicken Kale & Oxtail",time:"2hrs",servings:2,macros:{p:58,o:300,f:16,cal:720,poly:150},ingredients:["6oz Chicken Thigh (bone-in)","8oz Oxtail","1 cup White Beans","1 cup Kidney Beans","2 cups Kale (chopped)","Onion","Garlic","Celery","Carrots","Tomato Paste","Cumin","Smoked Paprika","Bay Leaves","Chicken Broth"],steps:["Brown oxtail in pot, sear all sides, 6 min","Remove oxtail, sautÃ© onion, garlic, celery, carrots","Add tomato paste, cumin, smoked paprika, stir 1 min","Return oxtail, add chicken broth and bay leaves","Simmer 90 min until oxtail is fall-off-bone tender","Add chicken thighs, beans, simmer 20 min","Add kale last 5 min to wilt","Remove bay leaves, season to taste"],why:"58g protein from triple sources. Oxtail = collagen + gelatin for joint health and gut lining repair. 16g fiber from dual beans binds bile acids (ApoB reduction). Kale adds sulforaphane + vitamin K. Makes 2 servings â€” meal prep friendly.",colors:['brown','green','white','red']},
{title:"Southwest Tortilla Soup",time:"30min",servings:2,macros:{p:48,o:200,f:18,cal:660,poly:150},ingredients:["6oz Chicken Breast (diced)","1/3 cup Kidney Beans","1/3 cup Black Beans","1/3 cup Pinto Beans","1 can Fire-Roasted Diced Tomatoes","1 cup Chicken Broth","1/2 cup Corn","1 Bell Pepper (diced)","1 JalapeÃ±o (diced)","1 Onion (diced)","3 cloves Garlic","1 tbsp Cumin","1 tsp Chili Powder","1 tsp Smoked Paprika","Tortilla Strips","1/4 Avocado","Fresh Cilantro","Lime"],steps:["SautÃ© onion, pepper, jalapeÃ±o, garlic in EVOO","Add chicken, brown 3-4 min","Add cumin, chili powder, smoked paprika","Pour in broth, tomatoes, all three beans, corn","Simmer 20 min","Ladle into bowl","Top with tortilla strips, avocado, cilantro, lime squeeze"],why:"Triple bean stack = 18g soluble fiber from three sources (kidney, black, pinto) â€” each binds bile acids differently for maximum ApoB clearance. Resistant starch from all three feeds diverse gut bacteria. Chicken = lean protein. Lycopene from fire-roasted tomatoes. Capsaicin from jalapeÃ±o boosts metabolism.",colors:['red','black','brown','green']},
{title:"Chipotle Chicken & Steak Bowl",time:"0min",servings:1,macros:{p:76,o:200,f:19,cal:850,poly:60},ingredients:["4oz Chicken","4oz Steak","Brown Rice","1/2 cup Black Beans","1/2 cup Pinto Beans","Fajita Veggies (peppers, onions)","Spinach","Romaine Lettuce"],steps:["Order at Chipotle","Double protein: chicken + steak","Brown rice (more fiber than white)","Both beans","Fajita veggies","Spinach and lettuce","NO cheese, NO sour cream, NO tortilla"],why:"76g protein bowl. Double beans = 19g soluble fiber binding bile acids for ApoB. Brown rice adds resistant starch. No tortilla saves 300 cal. Spinach adds folate + magnesium. This is a clean macro monster.",colors:['brown','green','black','red']},
{title:"Steak Salad (Adalberto's)",time:"0min",servings:1,macros:{p:35,o:100,f:6,cal:550,poly:30},ingredients:["Carne Asada","Romaine Lettuce","Tomatoes","Carrots","Sliced Avocado","Cheese","Ranch Dressing"],steps:["Order at Adalberto's","Enjoy"],why:"Carne asada = bioavailable iron + zinc + B12. Avocado adds monounsaturated fat + plant sterols. Lettuce and tomato add fiber + lycopene. Ask for dressing on the side to control calories.",colors:['brown','green','red','yellow']},
{title:"Steak Rolled Tacos (Adalberto's)",time:"0min",servings:1,macros:{p:35,o:50,f:4,cal:700,poly:20},ingredients:["5 Beef Rolled Tacos (fried)","Guacamole","Cheese","Lettuce"],steps:["Order 5-piece steak rolled tacos at Adalberto's","Enjoy"],why:"Quick protein hit. Fried but 35g protein across 5 taquitos. Guac adds healthy fat. Use half portion for 2-3 tacos to keep calories in check.",colors:['brown','green','yellow']},
{title:"In-N-Out Double Double (Protein Style)",time:"0min",servings:1,macros:{p:52,o:50,f:3,cal:520,poly:10},ingredients:["2 Beef Patties","2 slices American Cheese","Lettuce Wrap (no bun)","Tomato","Onion","Spread"],steps:["Order Double-Double Protein Style","Enjoy"],why:"Protein style = lettuce wrap saves ~150 cal + 30g refined carbs vs bun. 52g bioavailable animal protein. Keep it simple â€” balance with high-fiber, high-omega-3 meals the rest of the day.",colors:['brown','green','yellow','red']},
{title:"Protein Power Smoothie",time:"5min",servings:1,macros:{p:50,o:3200,f:10,cal:460,poly:120},ingredients:["1 scoop Pea Protein","1 tbsp Peanut Butter Powder","1 tbsp Ground Flaxseed","1 tbsp Chia Seeds","1 cup Spinach","1 cup Frozen Berries","1 tbsp Almond Butter","1 cup Oat Milk","Ice"],steps:["Add oat milk and spinach to blender","Add frozen berries, pea protein, peanut powder, flax, chia","Add almond butter and ice","Blend until smooth"],why:"Pea + peanut protein stack. Flax + chia = soluble fiber + ALA omega-3 for ApoB reduction. Oat milk adds beta-glucan. Spinach = magnesium + folate. Berries = anthocyanin polyphenols.",colors:['purple','green','brown']}

],
dinner:[
{title:"Whole Branzino w/ Seafood Medley",time:"40min",servings:2,macros:{p:58,o:3000,f:20,cal:680,poly:100},ingredients:["2 Whole Branzino (cleaned)","1/2lb Shrimp","1/2lb Mussels","1 cup White Beans (cannellini)","Cherry Tomatoes","1/2 cup White Wine","Garlic & Parsley","Lemon Slices"],steps:["Score fish, stuff with lemon/herbs","Place in roasting pan","Surround with shrimp, mussels, white beans, tomatoes","Pour wine and garlic over everything","Bake at 400\u00b0F for 25 mins"],why:"Whole Fish = Collagen/Glycine from skin/bones. Shellfish = Zinc stack. White beans add 8g fiber + plant protein.",colors:['white','pink','red']},
{title:"Turkey Chili",time:"35min",servings:2,macros:{p:35,o:400,f:15,cal:500,poly:200},ingredients:["1lb ground turkey","1 can kidney beans","1 can diced tomatoes","1 onion","1 bell pepper","Chili powder","Cumin","Garlic","1 tbsp EVOO finish","Turmeric + Cumin","Fresh Cilantro"],steps:["Brown turkey with onion/garlic","Add peppers and spices","Add tomatoes and beans","Simmer 30 mins"],why:"Turkey = lean protein. Beans = fiber. Tomatoes = lycopene.",colors:['brown','red','yellow']},
{title:"Beef Bolognese (Zoodles)",time:"40min",servings:2,macros:{p:40,o:2100,f:14,cal:600,poly:200},ingredients:["1lb ground beef","1 jar marinara (no sugar)","1 onion","2 carrots","Celery","Zucchini noodles","1 tbsp EVOO","Fresh Basil + Oregano","1 tbsp Ground Flaxseed"],steps:["Brown beef","Add chopped veg, cook 5 min","Add sauce, simmer 20 min","Serve over raw or lightly saut\u00e9ed zoodles"],why:"Beef = iron. Tomato sauce = lycopene.",colors:['red','green']},
{title:"Stuffed Peppers",time:"50min",servings:4,macros:{p:30,o:400,f:14,cal:500,poly:200},ingredients:["Bell Peppers","Ground Bison","Brown Rice","Spinach","Tomato Sauce","1 tbsp EVOO drizzle","Turmeric in filling","Fresh Parsley"],steps:["Hollow peppers","Mix meat/rice/veg","Stuff peppers","Bake at 375F for 40m"],why:"Vitamin C from peppers boosts iron absorption from bison.",colors:['red','green','brown','yellow']},
{title:"Sesame Seared Tuna",time:"15min",servings:2,macros:{p:50,o:1500,f:10,cal:480,poly:200},ingredients:["Ahi Tuna Steaks","Sesame Seeds","Soy Sauce","Ginger","Asparagus","Side Edamame","Wakame Seaweed Salad","1 tbsp EVOO"],steps:["Coat tuna in seeds","Sear 1 min/side","Serve with steamed asparagus"],why:"High selenium content in tuna. Ginger aids digestion.",colors:['red','white','green']},
{title:"Seafood Cioppino",time:"40min",servings:2,macros:{p:48,o:2000,f:16,cal:580,poly:120},ingredients:["White Fish","Mussels/Shrimp","1 cup White Beans","Tomato Broth","Fennel","Garlic"],steps:["Saute fennel and garlic","Add broth, white beans and simmer","Poach fish gently in broth"],why:"Tomato (cooked) = high Lycopene. White beans add 8g fiber. Low calorie, high mineral.",colors:['white','red','green']},
{title:"Herb Crusted Cod",time:"20min",servings:1,macros:{p:52,o:2800,f:10,cal:580,poly:200},ingredients:["8oz wild cod","\u00bd cup almond flour","1 egg","Parsley","Dill","Lemon zest","Asparagus","1 tbsp EVOO","1 tbsp EVOO","Fresh Herb Crust (parsley/dill)","Lemon Zest"],steps:["Mix almond flour, herbs, zest","Dip cod in egg, then flour","Pan fry 4min per side in EVOO","Steam asparagus","Plate with lemon wedges"],why:"Cod = lean protein. Almonds = Vitamin E. Asparagus = prebiotic fiber.",colors:['white','green']},
{title:"Grass-Fed Steak & Sprouts",time:"25min",servings:1,macros:{p:60,o:1200,f:14,cal:720,poly:250},ingredients:["8oz grass-fed sirloin","2 cups Brussels sprouts","\u00bd sweet potato","Garlic","Rosemary","Balsamic vinegar","1 tbsp EVOO","1 tbsp EVOO","Fresh Rosemary + Thyme","Balsamic Reduction"],steps:["Halve sprouts, toss in balsamic","Roast sprouts and potato 20min at 400\u00b0F","Sear steak 3min per side","Rest steak 5min","Slice against grain"],why:"Grass-fed beef = CLA and Omega-3. Brussels = sulforaphane. Sweet potato = potassium.",colors:['red','green','orange']},
{title:"Mediterranean Chicken",time:"25min",servings:1,macros:{p:55,o:800,f:12,cal:640,poly:250},ingredients:["8oz chicken breast","1 cup quinoa","Cucumber","Cherry tomatoes","Kalamata olives","Feta cheese","Oregano","Olive oil","1 tbsp EVOO","Kalamata Olives","Fresh Oregano + Lemon"],steps:["Cook quinoa","Grill chicken with oregano","Chop veg","Mix quinoa, veg, olives","Top with sliced chicken and feta","Drizzle olive oil"],why:"Chicken = lean complete protein. Olives = hydroxytyrosol (potent antioxidant). Quinoa = complete plant protein.",colors:['white','black','red']},
{title:"Tempeh Stir Fry (Plant)",time:"15min",servings:1,macros:{p:50,o:2600,f:26,cal:680,poly:200},ingredients:["8oz tempeh","1 cup edamame","Broccoli","Bell peppers","Snap peas","Ginger","Garlic","Tamari","Sesame oil","Brown rice"],steps:["Steam tempeh 5min (removes bitterness)","Cube and saut\u00e9 in sesame oil","Add edamame, veggies, ginger, garlic","Add splash of water to steam veg","Finish with tamari","Serve over rice"],why:"Tempeh = fermented soy (gut health). Edamame adds 8g fiber. Ginger = anti-inflammatory. Broccoli = sulforaphane.",colors:['brown','green','red']},
{title:"Sheet Pan Salmon & Veggies",time:"20min",servings:1,macros:{p:45,o:3200,f:10,cal:620,poly:200},ingredients:["6oz salmon fillet","1 cup broccoli florets","1 cup bell peppers","1 tbsp olive oil","Lemon slices","Dill","Garlic powder","1 tbsp EVOO","Turmeric + Black Pepper","Fresh Dill"],steps:["Preheat oven to 400\u00b0F","Toss veggies in oil and spices","Place salmon and veggies on pan","Top salmon with lemon/dill","Roast 15-18 mins"],why:"Salmon = omega-3. One pan meal. Broccoli = detox support.",colors:['orange','green','red','yellow']},
{title:"Shrimp Scampi with Zoodles",time:"15min",servings:1,macros:{p:32,o:2200,f:10,cal:480,poly:200},ingredients:["6oz shrimp","2 zucchini (spiralized)","2 tbsp butter/ghee","3 cloves garlic","Lemon juice","Parsley","Red pepper flakes","1 tbsp EVOO","Fresh Parsley + Basil","1 tbsp Ground Flaxseed"],steps:["Saut\u00e9 garlic in butter","Add shrimp, cook pink","Add lemon and flakes","Toss in zoodles for 1 min","Garnish parsley"],why:"Shrimp = iodine/selenium. Zucchini = low cal volume.",colors:['pink','green','white']},
{title:"Lamb Kofta Bowl",time:"25min",servings:1,macros:{p:46,o:1100,f:18,cal:780,poly:110},ingredients:["6oz ground lamb","1 tsp cumin/coriander","1/2 cup Black Beans","Cucumber yogurt sauce","Tomatoes","Onion","Mixed greens","Pita"],steps:["Mix lamb with spices","Form small oblong patties","Grill or pan fry 8 mins","Warm black beans","Assemble bowl with greens and beans","Top with kofta and sauce"],why:"Lamb = zinc/iron. Fermented yogurt = gut health. Black beans add 8g fiber + resistant starch.",colors:['brown','green','white','red','black']},
{title:"Pesto Chicken Zoodles",time:"15min",servings:1,macros:{p:45,o:500,f:8,cal:550,poly:200},ingredients:["6oz chicken breast","2 zucchini","1/4 cup basil pesto","Cherry tomatoes","Parmesan","Basil Pesto (EVOO base)","Pine Nuts","Lemon Zest"],steps:["Cook chicken pieces","Spiralize zucchini","Toss chicken and zoodles with pesto","Add halved tomatoes","Warm through"],why:"Basil = anti-bacterial. Chicken = protein base.",colors:['green','white','red']},
{title:"Seared Scallops & Risotto",time:"30min",servings:1,macros:{p:35,o:700,f:8,cal:630,poly:200},ingredients:["6oz sea scallops","1/2 cup arborio rice","2 cups broth","White wine (splash)","Parmesan","Peas","Butter","1 tbsp EVOO finish","Fresh Herbs","Side Arugula Salad"],steps:["Cook risotto (ladle broth slowly)","Stir in peas/parm","Sear scallops in hot butter (2 min/side)","Serve scallops atop risotto"],why:"Scallops = B12/magnesium. Peas = plant protein.",colors:['white','green']},
{title:"Chicken Stir Fry",time:"15min",servings:1,macros:{p:48,o:700,f:16,cal:620,poly:120},ingredients:["6oz chicken breast","1 cup edamame","Broccoli","Snap peas","Carrots","Soy sauce","Ginger/Garlic","Sesame oil"],steps:["Slice chicken thin","Stir fry chicken","Remove, stir fry edamame and veg","Combine with sauce","Simmer 1 min"],why:"Lean protein + fiber rich veg. Edamame adds 8g fiber + plant protein.",colors:['white','green','orange']},
{title:"Baked Cod with Salsa",time:"20min",servings:1,macros:{p:45,o:2000,f:14,cal:540,poly:180},ingredients:["8oz cod fillet","1/2 cup salsa","1/4 avocado","Cilantro","Lime","Asparagus side","Fresh Cilantro + Lime","1 tbsp EVOO","Side Black Beans"],steps:["Place cod in baking dish","Top with salsa","Bake 400\u00b0F for 15 min","Top with avocado/cilantro","Serve with steamed asparagus"],why:"Cod = low calorie protein source.",colors:['white','red','green']},
{title:"Egg Roll in a Bowl",time:"15min",servings:1,macros:{p:35,o:600,f:14,cal:530,poly:200},ingredients:["1/2lb ground pork/turkey","1 bag coleslaw mix","Ginger","Garlic","Soy sauce","Sriracha","Green onions","1 tbsp EVOO","Turmeric + Ginger","Fresh Cilantro + Lime"],steps:["Brown meat","Add slaw mix, ginger, garlic","Saut\u00e9 until wilted","Stir in soy/sriracha","Top with green onions"],why:"Cabbage = cruciferous benefits. High volume meal.",colors:['white','green','yellow']},
{title:"Lemon Garlic Shrimp",time:"15min",servings:1,macros:{p:30,o:500,f:10,cal:440,poly:200},ingredients:["8oz shrimp","2 tbsp butter","3 cloves garlic","Lemon juice","Parsley","Green beans","1 tbsp EVOO","Side Roasted Broccoli","Fresh Herbs"],steps:["Steam green beans","Saut\u00e9 garlic in butter","Cook shrimp","Finish with lemon/parsley","Plate together"],why:"Shrimp = high protein low fat.",colors:['pink','green','white']},
{title:"Meatballs & Marinara",time:"30min",servings:2,macros:{p:32,o:2000,f:12,cal:600,poly:250},ingredients:["1lb ground beef","1 egg","1/4 cup almond flour","Italian herbs","Marinara sauce","Spinach side","1 tbsp EVOO","1 tbsp Ground Flaxseed (in meatballs)","Fresh Basil"],steps:["Mix meat, egg, flour, herbs","Roll balls","Bake 400\u00b0F 20 min","Simmer in sauce 5 min","Serve with wilted spinach"],why:"Beef = B12/Zinc. Spinach = folate.",colors:['red','green']},
{title:"Curry Chicken Salad",time:"10min",servings:1,macros:{p:40,o:800,f:8,cal:560,poly:250},ingredients:["5oz cooked chicken","Greek yogurt","Curry powder","Grapes/Raisins","Cashews","Celery","Turmeric + Black Pepper","1 tbsp EVOO dressing","Fresh Cilantro"],steps:["Chop chicken","Mix yogurt and curry powder","Combine all","Serve in lettuce cups"],why:"Curry = turmeric anti-inflammatory. Yogurt = probiotics.",colors:['yellow','green','yellow']},
{title:"Chicken Breast Power Bowl",time:"25min",servings:1,macros:{p:58,o:600,f:22,cal:720,poly:120},ingredients:["8oz chicken breast","1/2 cup quinoa","1/2 cup brown rice","1/2 cup black beans","2 cups broccoli","Garlic","Olive oil","Lemon"],steps:["Cook quinoa and brown rice together","Season chicken with salt, pepper, garlic","Grill or bake chicken 20 min at 375\u00b0F","Steam broccoli for 5 min","Warm black beans","Plate rice/quinoa base with beans","Top with sliced chicken and broccoli","Drizzle with olive oil and lemon"],why:"Complete protein + complex carbs + fiber. Quinoa = all 9 amino acids. Black beans add 8g fiber. Broccoli = sulforaphane.",colors:['white','brown','green','black']},
{title:"Mediterranean Mussels Pasta",time:"25min",servings:1,macros:{p:44,o:1800,f:10,cal:580,poly:200},ingredients:["2lbs Mussels (cleaned)","Chickpea Pasta","Cherry Tomatoes","Kalamata Olives","Garlic","White Wine","Fresh Basil","Olive Oil","Red Pepper Flakes","Parmesan","1 tbsp EVOO finish","Fresh Parsley + Basil","Lemon Zest"],steps:["Cook chickpea pasta al dente","Saut\u00e9 garlic in olive oil","Add tomatoes, cook until blistered","Add white wine, bring to boil","Add mussels, cover 5-7 mins until open","Discard unopened mussels","Toss pasta with mussel broth","Top with olives, basil, red pepper","Finish with parmesan"],why:"Mussels = zinc, iron, B12, omega-3 stack. Chickpea pasta = protein + fiber. Mediterranean diet gold.",colors:['black','red','green']},
{title:"Mixed Fajitas with Black Beans",time:"20min",servings:1,macros:{p:62,o:1400,f:16,cal:620,poly:150},ingredients:["4oz Chicken Breast","6oz Shrimp","1/2 cup Black Beans","Bell Peppers (red, yellow, green)","Onion","Fajita Seasoning","Lime","Cilantro","Pico de Gallo","Avocado"],steps:["Slice chicken into strips","Season chicken and shrimp with fajita spices","Slice peppers and onions","Heat cast iron skillet","Sear chicken strips 4-5 mins","Add shrimp, cook 2-3 mins until pink","Remove proteins, saut\u00e9 peppers and onions","Warm black beans","Plate veggies and beans","Top with chicken and shrimp","Add pico, avocado, cilantro, lime"],why:"Shrimp + chicken = lean protein stack. Shrimp = astaxanthin + selenium. Bell peppers = vitamin C. Black beans add 8g fiber + resistant starch. No tortillas = lower carb, higher protein.",colors:['pink','white','red','yellow','green','black']},
{title:"The Golden Shield",time:"25min",servings:1,macros:{p:56,o:200,f:12,cal:570,poly:480},ingredients:["6oz Chicken Breast","1 tsp Turmeric","1/2 tsp Black Pepper","1 Zucchini (sliced)","1 cup Mushrooms (sliced)","1/2 cup Quinoa","1/2 cup Brown Rice","1 tbsp EVOO","2 cloves Garlic","2 cups Fresh Spinach","Sea Salt"],steps:["Cook quinoa and brown rice together","Season chicken with turmeric, black pepper, salt","Sear chicken in EVOO 5 min per side","Remove chicken, sautÃ© garlic, zucchini, mushrooms 4 min","Wilt spinach into vegetables last 30 seconds","Slice chicken, plate over grains","Top with sautÃ©ed vegetables and spinach","Drizzle remaining pan juices over everything"],why:"Curcumin + piperine = 2000% absorption boost. Anti-inflammatory powerhouse targeting NF-ÎºB pathway. Mushrooms add beta-glucan for immune support. Quinoa = complete protein. High protein, moderate cal, massive polyphenol hit.",colors:['yellow','green','brown','white']},
{title:"The Sterol Fortress",time:"25min",servings:1,macros:{p:52,o:4800,f:18,cal:640,poly:220},ingredients:["6oz Wild Salmon","1 cup Edamame","1/2 cup Chickpeas","2 cups Kale","1/2 Avocado","2 tbsp Almonds (slivered)","1 tbsp EVOO","1 tbsp Ground Flaxseed","Lemon","Garlic"],steps:["Bake salmon at 400Â°F for 12 min","Steam edamame","Warm chickpeas with garlic and EVOO","Massage kale with lemon and olive oil","Plate kale, top with salmon","Add edamame, chickpeas, sliced avocado","Scatter almonds and flaxseed over top"],why:"Plant sterol triple stack: Edamame (soy sterols block cholesterol absorption in gut), almonds (natural plant sterols), avocado (beta-sitosterol). Salmon EPA/DHA reduces hepatic VLDL production. Chickpeas + kale add soluble fiber for bile acid binding. Flax = lignans + ALA. Full spectrum ApoB warfare.",colors:['pink','green','brown','white']},
{title:"Chicken Fried Rice",time:"20min",servings:1,macros:{p:38,o:400,f:6,cal:650,poly:40},ingredients:["6oz Chicken Breast (diced)","2 cups Jasmine Rice (cooked)","2 Eggs","1 cup Mixed Vegetables (peas, carrots, corn)","2 tbsp Soy Sauce","1 tbsp Sesame Oil","3 cloves Garlic","Green Onions"],steps:["Cook rice ahead (day-old best)","Scramble eggs, set aside","Sear diced chicken in sesame oil","Add garlic, then vegetables","Add rice, toss on high heat","Add soy sauce and eggs back in","Top with green onions"],why:"High-volume comfort meal. Day-old rice = resistant starch (feeds gut bacteria). Eggs add choline. Sesame oil adds flavor with minimal sat fat.",colors:['brown','green','yellow','white']},
{title:"Chicken Enchiladas",time:"35min",servings:1,macros:{p:42,o:300,f:8,cal:680,poly:80},ingredients:["6oz Shredded Chicken","2 Flour Tortillas","1/2 cup Black Beans","1/2 cup Enchilada Sauce","1/4 cup Monterey Jack Cheese","1/4 Avocado","Cilantro","Onion"],steps:["Shred chicken and mix with beans and sauce","Fill tortillas and roll","Place in baking dish, top with remaining sauce and cheese","Bake at 375Â°F for 20 min","Top with avocado and cilantro"],why:"Black beans add resistant starch + soluble fiber for ApoB. Chicken = lean protein. Avocado = monounsaturated fat + plant sterols.",colors:['brown','red','green','black']},
{title:"Pepperoni Pizza (2 slices)",time:"0min",servings:1,macros:{p:22,o:100,f:4,cal:560,poly:20},ingredients:["2 slices Pepperoni Pizza"],steps:["Enjoy"],why:"Life needs pizza sometimes. 22g protein per 2 slices. Log it, own it, balance with high-fiber meals around it.",colors:['red','yellow','white']},
{title:"Combo Pizza (2 slices)",time:"0min",servings:1,macros:{p:24,o:150,f:5,cal:580,poly:40},ingredients:["2 slices Combo Pizza (pepperoni, sausage, peppers, onions, olives)"],steps:["Enjoy"],why:"More vegetable toppings = more phytonutrients than plain pepperoni. Peppers add vitamin C, olives add monounsaturated fat. Balance with ApoB-attack meals.",colors:['red','yellow','green','black']},
{title:"Steak Salad (Adalberto's)",time:"0min",servings:1,macros:{p:35,o:100,f:6,cal:550,poly:30},ingredients:["Carne Asada","Romaine Lettuce","Tomatoes","Carrots","Sliced Avocado","Cheese","Ranch Dressing"],steps:["Order at Adalberto's","Enjoy"],why:"Carne asada = bioavailable iron + zinc + B12. Avocado adds monounsaturated fat + plant sterols. Lettuce and tomato add fiber + lycopene. Ask for dressing on the side to control calories.",colors:['brown','green','red','yellow']},
{title:"Steak Rolled Tacos (Adalberto's)",time:"0min",servings:1,macros:{p:35,o:50,f:4,cal:700,poly:20},ingredients:["5 Beef Rolled Tacos (fried)","Guacamole","Cheese","Lettuce"],steps:["Order 5-piece steak rolled tacos at Adalberto's","Enjoy"],why:"Quick protein hit. Fried but 35g protein across 5 taquitos. Guac adds healthy fat. Use half portion for 2-3 tacos to keep calories in check.",colors:['brown','green','yellow']},
{title:"In-N-Out Double Double (Protein Style)",time:"0min",servings:1,macros:{p:52,o:50,f:3,cal:520,poly:10},ingredients:["2 Beef Patties","2 slices American Cheese","Lettuce Wrap (no bun)","Tomato","Onion","Spread"],steps:["Order Double-Double Protein Style","Enjoy"],why:"Protein style = lettuce wrap saves ~150 cal + 30g refined carbs vs bun. 52g bioavailable animal protein. Keep it simple â€” balance with high-fiber, high-omega-3 meals the rest of the day.",colors:['brown','green','yellow','red']},
{title:"Protein Power Smoothie",time:"5min",servings:1,macros:{p:50,o:3200,f:10,cal:460,poly:120},ingredients:["1 scoop Pea Protein","1 tbsp Peanut Butter Powder","1 tbsp Ground Flaxseed","1 tbsp Chia Seeds","1 cup Spinach","1 cup Frozen Berries","1 tbsp Almond Butter","1 cup Oat Milk","Ice"],steps:["Add oat milk and spinach to blender","Add frozen berries, pea protein, peanut powder, flax, chia","Add almond butter and ice","Blend until smooth"],why:"Pea + peanut protein stack. Flax + chia = soluble fiber + ALA omega-3 for ApoB reduction. Oat milk adds beta-glucan. Spinach = magnesium + folate. Berries = anthocyanin polyphenols.",colors:['purple','green','brown']},
{title:"Chipotle Chicken & Steak Burrito",time:"0min",servings:1,macros:{p:68,o:200,f:18,cal:1370,poly:60},ingredients:["Flour Tortilla","4oz Chicken","4oz Steak","Pinto & Black Bean Mix","Fajita Veggies (peppers, onions)","Cilantro-Lime White Rice","Fresh Tomato Salsa","Guacamole","Romaine Lettuce"],steps:["Order at Chipotle","Double protein: chicken + steak","Mixed beans (pinto + black)","Add fajita veggies","Rice, salsa, guac, lettuce","NO cheese, NO sour cream"],why:"68g protein monster. Mixed beans = 15g soluble fiber binding bile acids for ApoB reduction + resistant starch feeding gut bacteria. Fajita veggies add vitamin C. Guac = monounsaturated fat + plant sterols. Skipping cheese/sour cream saves 200cal + saturated fat.",colors:['brown','green','red','black']},
{title:"Chicken Tikka Pizza (Pi Bar)",time:"0min",servings:1,macros:{p:26,o:100,f:3,cal:500,poly:40},ingredients:["2 slices Chicken Tikka Pizza","Tandoori Chicken","Purple Cauliflower","Onion","Cilantro","Fresno Chilis","Tikka Ranch","Mozzarella"],steps:["Order at Pi Bar, Woodbridge/Lodi","Enjoy"],why:"Craft pizza with real ingredients. Cauliflower adds fiber + sulforaphane. Fresno chilis = capsaicin (anti-inflammatory, boosts metabolism). Tikka spices include turmeric + cumin. Log it, balance with high-fiber meals.",colors:['red','yellow','white','green']},
{title:"Pepperoni Pizza (Viaggio Winery)",time:"0min",servings:1,macros:{p:20,o:50,f:3,cal:520,poly:20},ingredients:["2 slices Wood-Fired Pepperoni Pizza","Pepperoni","Mozzarella","San Marzano Sauce"],steps:["Order at Viaggio Estate & Winery, Acampo","Enjoy with a glass of their estate wine"],why:"Wood-fired = higher heat, thinner crust, fewer empty carbs than chain pizza. San Marzano tomatoes add lycopene. Pair with a Zinfandel for resveratrol if drinking. Balance with ApoB-attack meals around it.",colors:['red','yellow','white']},
{title:"Mongolian BBQ",time:"20min",servings:1,macros:{p:55,o:200,f:8,cal:850,poly:120},ingredients:["6oz Flank Steak (sliced)","4oz Chicken Breast (sliced)","Broccoli","Cabbage","Carrots","Bell Peppers","Onions","Mushrooms","Rice Noodles","Mongolian Sauce","Sesame Oil","Garlic","Ginger"],steps:["Load bowl with sliced steak and chicken","Add broccoli, cabbage, carrots, peppers, onions, mushrooms","Top with minced garlic and ginger","Choose rice noodles as base","Hand to grill cook â€” cooked on flat iron grill","Finish with Mongolian sauce and sesame oil"],why:"55g dual-source protein (steak + chicken). Heavy vegetable load adds 8g fiber from cruciferous veggies. Ginger and garlic are anti-inflammatory. Build-your-own lets you control the veggie-to-noodle ratio.",colors:['brown','green','orange','red']},
{title:"Chicken Parmesan",time:"25min",servings:1,macros:{p:62,o:50,f:4,cal:680,poly:80},ingredients:["8oz Chicken Breast (breaded)","1/2 cup Marinara Sauce","2oz Mozzarella Cheese","1 tbsp EVOO","Garlic","Fresh Basil","Parmesan (grated)"],steps:["Bread chicken breast with seasoned breadcrumbs","Pan-fry in EVOO until golden, 4 min per side","Transfer to baking dish","Top with marinara, mozzarella, grated Parmesan","Bake at 400Â°F for 15 min until cheese melts","Garnish with fresh basil"],why:"62g protein from chicken + cheese. Marinara = cooked lycopene (more bioavailable than raw tomato). EVOO increases lycopene absorption. Comfort food that still delivers serious protein.",colors:['brown','red','white','green']},
{title:"Salmon & Broccoli",time:"20min",servings:1,macros:{p:46,o:3100,f:10,cal:540,poly:60},ingredients:["6oz Atlantic Salmon","2 cups Broccoli","1 tbsp EVOO","3 cloves Garlic","Lemon","Sea Salt","Black Pepper"],steps:["Season salmon with salt, pepper, garlic","Bake at 400Â°F for 12 min","Steam or roast broccoli with EVOO and garlic","Plate broccoli, top with salmon","Squeeze lemon over everything"],why:"Simple and effective. Salmon EPA/DHA reduces VLDL production for ApoB. Broccoli sulforaphane activates Nrf2 pathway â€” the master antioxidant switch. 10g fiber from broccoli alone.",colors:['pink','green']},
{title:"Black Beans & Mackerel",time:"20min",servings:1,macros:{p:55,o:4400,f:15,cal:710,poly:80},ingredients:["6oz Atlantic Mackerel (fillets)","1 cup Black Beans (cooked)","1 tbsp EVOO","3 cloves Garlic","1 Lime","Fresh Cilantro","1 tsp Cumin","Sea Salt","Red Pepper Flakes"],steps:["Season mackerel with cumin, salt, pepper flakes","Sear in EVOO 3-4 min per side","Warm black beans with garlic","Squeeze lime over beans, stir in cilantro","Plate beans, top with mackerel","Garnish with extra cilantro and lime wedge"],why:"Mackerel is the highest omega-3 fish per serving (4200mg EPA/DHA) â€” 3x more than salmon. Combined with 15g soluble fiber from black beans binding bile acids, this is a dual ApoB attack: reduce VLDL production (omega-3) + remove LDL from blood (fiber). Resistant starch in beans feeds gut bacteria.",colors:['black','silver','green']},

],
juices:[
{title:"The Red Pipe Clearer",macros:{p:2,o:0,f:2,cal:140,poly:450},ingredients:["1 Beet","3 Carrots","1 Pomegranate (seeds)","1 inch Ginger","1 Lemon"],steps:["Wash produce","Juice beets and carrots first","Add pomegranate seeds through juicer","Finish with ginger and lemon","Stir and drink immediately"],why:"Beets increase Nitric Oxide, dilating blood vessels. Pomegranate punicalagins shown to reduce Lp(a) and improve arterial function. Ginger anti-inflammatory.",colors:['red','orange']},
{title:"The ANA Green Soother",macros:{p:2,o:0,f:2,cal:110,poly:350},ingredients:["4 Celery Stalks","1 Cucumber","1 Green Apple","1 inch Turmeric","1 inch Ginger","Pinch Black Pepper"],steps:["Juice turmeric and ginger first","Follow with celery and cucumber","Finish with green apple for sweetness","Add pinch black pepper (2000% curcumin absorption)","Stir and drink immediately"],why:"Turmeric + Ginger = ultimate anti-inflammatory stack. Green apple adds quercetin + malic acid. Black pepper activates curcumin.",colors:['green','yellow']},
{title:"The Citrus Alkalizer",macros:{p:2,o:0,f:2,cal:120,poly:150},ingredients:["2 Apples","2 Oranges","2 cups Spinach","4 Celery Stalks","1 Lemon"],steps:["Wash all produce thoroughly","Juice spinach and celery first","Follow with apples and oranges","Finish with lemon","Stir and drink immediately"],why:"Apple + Celery = potassium flush. Spinach = alkalizing minerals. Citrus = Vitamin C boost.",colors:['green','orange']},
{title:"Longevity Gold Elixir",macros:{p:1,o:0,f:1,cal:90,poly:300},ingredients:["2 Oranges","1 cup Pineapple chunks","1 tbsp Sea Moss Gel","1 inch Turmeric","Pinch Black Pepper"],steps:["Juice oranges and pineapple","Stir in sea moss gel","Add turmeric and black pepper","Drink immediately"],why:"Vitamin C + bromelain (anti-inflammatory enzyme). Sea moss = 92 minerals. Turmeric activated by piperine + fat from sea moss.",colors:['orange','yellow']},
{title:"Homemade Kombucha Flight",macros:{p:0,o:0,f:0,cal:35,poly:80},ingredients:["16oz Homemade Kombucha","Ice","Lemon slice","Mint sprig"],steps:["Pour chilled kombucha over ice","Garnish with fresh mint and lemon"],why:"Potent probiotics for gut microbiome diversity.",colors:['yellow']},
{title:"Golden Milk (Hot)",macros:{p:2,o:0,f:0,cal:95,poly:250},ingredients:["1 cup Coconut Milk","1 tsp Turmeric","1/4 tsp Black Pepper","1 tbsp Sea Moss Gel","1 tsp Coconut Oil","1/2 tsp Cinnamon","Pinch Ginger"],steps:["Heat coconut milk in saucepan","Whisk in turmeric, pepper, sea moss","Add coconut oil and spices","Simmer 5 minutes","Strain and serve hot"],why:"Turmeric needs fat + heat + black pepper for 2000% better absorption. Sea moss adds 92 minerals. Perfect anti-inflammatory nightcap.",colors:['yellow','white']},
{title:"Ceremonial Matcha Latte",macros:{p:3,o:0,f:0,cal:80,poly:400},ingredients:["1 tsp Ceremonial Grade Matcha","4oz Hot Water (175F)","8oz Oat Milk","Optional: 1 tsp Honey"],steps:["Sift matcha into bowl","Add hot water (not boiling)","Whisk vigorously until frothy","Heat oat milk, froth if desired","Combine matcha and milk"],why:"L-theanine + caffeine = calm focus without jitters. EGCG antioxidants fight cellular aging. Ceremonial grade is highest quality.",colors:['green','white']},
{title:"Green Tea (Sencha)",macros:{p:0,o:0,f:0,cal:5,poly:300},ingredients:["2 tsp Sencha Green Tea","8oz Water (175F)"],steps:["Heat water to 175F (not boiling)","Steep tea 2-3 minutes","Remove leaves, drink plain"],why:"EGCG catechins activate autophagy (cellular cleanup). 175F preserves delicate compounds. L-theanine calms without drowsiness.",colors:['green']},
{title:"Ginger Turmeric Tea",macros:{p:0,o:0,f:0,cal:15,poly:350},ingredients:["1 inch Fresh Ginger","1 inch Fresh Turmeric","1 Lemon","1/4 tsp Black Pepper","1 tsp Honey"],steps:["Slice ginger and turmeric thinly","Boil in 2 cups water for 10 min","Add lemon juice and pepper","Strain, add honey"],why:"Fresh ginger aids digestion. Turmeric fights inflammation. Black pepper activates curcumin. Lemon vitamin C.",colors:['yellow','orange']},
{title:"Tart Cherry Recovery",macros:{p:1,o:0,f:0,cal:120,poly:500},ingredients:["8oz Tart Cherry Juice (unsweetened)","4oz Water","Ice"],steps:["Mix cherry juice with water","Pour over ice","Drink post-workout"],why:"Anthocyanins reduce muscle soreness + inflammation. Natural melatonin precursors aid sleep. Best post-workout recovery drink.",colors:['red']},
{title:"Bone Broth Elixir",macros:{p:10,o:0,f:0,cal:45,poly:60},ingredients:["8oz Bone Broth","1/4 tsp Sea Salt","1/4 tsp Black Pepper","Pinch Turmeric"],steps:["Heat bone broth","Add spices","Sip slowly"],why:"Collagen + glycine heal gut lining. Bioavailable minerals. Pairs with savory meals. Fasting-friendly protein hit.",colors:['brown']},
{title:"Adaptogen Cacao",macros:{p:4,o:0,f:0,cal:85,poly:350},ingredients:["1 tbsp Raw Cacao Powder","1/2 tsp Ashwagandha","1/4 tsp Reishi Powder","8oz Oat Milk","1 tsp Honey"],steps:["Heat oat milk","Whisk in cacao and adaptogens","Add honey","Blend until frothy"],why:"Raw cacao = flavonoids for heart. Ashwagandha regulates cortisol. Reishi supports immune system.",colors:['brown','white']},
{title:"Lemon Ginger Water",macros:{p:0,o:0,f:0,cal:10,poly:30},ingredients:["1/2 Lemon (juiced)","1 inch Fresh Ginger (grated)","16oz Water","Ice"],steps:["Grate ginger into water","Add lemon juice","Stir and serve over ice"],why:"Stimulates digestive enzymes. Vitamin C boost. Perfect meal companion for fat digestion.",colors:['yellow']},
{title:"ACV Digestive Tonic",macros:{p:0,o:0,f:0,cal:15,poly:50},ingredients:["1 tbsp Apple Cider Vinegar (with mother)","1 tsp Honey","1/4 tsp Cinnamon","8oz Warm Water"],steps:["Mix ACV and honey in warm water","Add cinnamon","Stir well","Drink 15 min before meals"],why:"Increases stomach acid for protein digestion. Regulates blood sugar. The mother = probiotics. Drink before meals.",colors:['brown','yellow']},
{title:"Chamomile Magnesium Night",macros:{p:0,o:0,f:0,cal:5,poly:100},ingredients:["1 Chamomile Tea Bag","8oz Hot Water","200mg Magnesium Glycinate Powder"],steps:["Steep chamomile 5 minutes","Remove tea bag","Stir in magnesium powder","Drink 30 min before bed"],why:"Chamomile activates GABA for sleep. Magnesium glycinate relaxes muscles. Perfect evening wind-down ritual.",colors:['yellow']},
{title:"Coconut Water Electrolyte",macros:{p:1,o:0,f:0,cal:45,poly:0},ingredients:["8oz Coconut Water","Pinch Sea Salt","Squeeze Lime"],steps:["Pour coconut water over ice","Add sea salt and lime","Stir"],why:"Natural electrolytes (potassium). Low sugar. Perfect post-workout hydration.",colors:['white']},
{title:"Dutch Bros Large Golden Eagle (Protein)",macros:{p:16,o:0,f:0,cal:240,poly:0},ingredients:["Large Golden Eagle","Protein Shot"],steps:["Order Large Golden Eagle","Add protein shot","Enjoy"],why:"Caffeine boost + 16g protein. Vanilla + caramel flavor. Convenient protein on the go.",colors:['brown','yellow']},
{title:"The Lp(a) Crusher",macros:{p:2,o:0,f:3,cal:140,poly:600},ingredients:["1 Pomegranate (seeds)","1 Beet","1 inch Ginger","1 Lemon","1/2 cup Blueberries"],steps:["Deseed pomegranate","Juice beet first, then pomegranate seeds","Add blueberries through juicer","Finish with ginger and lemon","Stir and drink immediately"],why:"Pomegranate punicalagins clinically shown to reduce Lp(a) and oxidized LDL. Beet nitrates for vasodilation. Blueberry anthocyanins amplify effect. Your #1 biomarker juice.",colors:['red','purple']},
{title:"The ApoB Binder",macros:{p:2,o:0,f:3,cal:130,poly:250},ingredients:["2 Green Apples","3 Carrots","4 Celery Stalks","1 inch Ginger","1 Lemon","2 cups Spinach"],steps:["Juice spinach and celery first","Follow with carrots and apples","Finish with ginger and lemon","Stir and drink immediately"],why:"Apple pectin = soluble fiber that binds bile acids, forcing liver to pull LDL from blood â†’ lowers ApoB. Carrots add beta-carotene. Spinach adds nitrates.",colors:['green','orange']},
{title:"The Inflammation Killer",macros:{p:1,o:0,f:1,cal:110,poly:400},ingredients:["1 cup Pineapple","1 Cucumber","1 inch Turmeric","1 inch Ginger","Pinch Black Pepper","1/2 Lemon"],steps:["Juice pineapple and cucumber first","Add turmeric and ginger","Squeeze lemon, add black pepper","Stir and drink immediately"],why:"Bromelain (pineapple) + curcumin (turmeric) + gingerols = triple anti-inflammatory cascade. Perfect for low HRV recovery days.",colors:['yellow','green']},
{title:"The Nitric Oxide Flood",macros:{p:2,o:0,f:1,cal:120,poly:300},ingredients:["1 Beet","2 cups Watermelon","3 Celery Stalks","1 Lemon","Fresh Mint"],steps:["Juice beet first","Add watermelon and celery","Finish with lemon","Garnish with mint","Drink 30 min before workout"],why:"Beet nitrates + watermelon citrulline = maximum vasodilation and blood flow. Pre-workout timing amplifies Zone 2 efficiency.",colors:['red','green']},
{title:"The Liver Reset",macros:{p:1,o:0,f:2,cal:90,poly:200},ingredients:["1 cup Dandelion Greens","1 Green Apple","4 Celery Stalks","1 inch Ginger","1 Lemon"],steps:["Juice dandelion greens and celery first","Follow with green apple","Finish with ginger and lemon","Drink on empty stomach for best absorption"],why:"Dandelion stimulates Phase II liver detoxification. Green apple malic acid supports bile flow. Celery electrolytes. Morning detox juice.",colors:['green','yellow']},
{title:"The Purple Longevity",macros:{p:2,o:0,f:2,cal:130,poly:700},ingredients:["1/4 Red Cabbage","1 Beet","1 cup Blueberries","1 inch Ginger","1 Lemon"],steps:["Juice red cabbage first","Add beet and blueberries","Finish with ginger and lemon","Stir and drink immediately"],why:"Triple anthocyanin source (cabbage + beet + blueberry) = highest antioxidant juice possible. Anthocyanins protect endothelial cells and reduce vascular age. Your longevity powerhouse.",colors:['purple','red']},
{title:"The ANA Soother",macros:{p:2,o:0,f:2,cal:120,poly:550},ingredients:["1 inch Turmeric","1 inch Ginger","1 cup Pineapple","1 Beet","1 Green Apple","Pinch Black Pepper"],steps:["Juice turmeric and ginger first","Follow with beet and pineapple","Finish with green apple","Add pinch black pepper","Stir and drink immediately"],why:"Curcumin modulates autoimmune response by dampening NF-ÎºB and COX-2 pathways. Bromelain anti-inflammatory enzyme. Beet nitrates improve circulation. Designed for high ANA markers.",colors:['yellow','red','green']},
{title:"Homemade Yogurt Drink",macros:{p:12,o:0,f:0,cal:180,poly:0},ingredients:["1 cup Homemade Yogurt (whole milk + Fage starter, Chef IQ)","1 tbsp Raw Honey","1/2 cup Cold Water"],steps:["Blend homemade yogurt and water until smooth","Stir in honey","Serve chilled"],why:"Fresh-fermented yogurt = highest live probiotic count (billions CFU vs store-bought). Whole milk fat improves fat-soluble vitamin absorption (A, D, E, K). Fage starter = Lactobacillus bulgaricus + Streptococcus thermophilus strains. Honey adds prebiotic oligosaccharides feeding beneficial bacteria.",colors:['white']}
],
alcohol:[
{title:"Bogle Old Vine Zinfandel",macros:{p:0,o:0,f:0,cal:125,poly:350},ingredients:["5oz Red Wine"],steps:["Pour into wine glass","Let breathe 5 minutes","Enjoy with dinner"],why:"Red wine = resveratrol (activates sirtuins for longevity). Old vine = concentrated polyphenols. Moderate consumption linked to cardiovascular benefits.",colors:['red']},
{title:"Sake (Junmai)",macros:{p:0,o:0,f:0,cal:105,poly:50},ingredients:["4oz Sake"],steps:["Serve chilled or warm","Pour into sake cup","Sip slowly with meal"],why:"Lower alcohol than wine. Amino acids from rice fermentation. Traditional pairing with omega-3 rich fish.",colors:['white']},
{title:"Sapporo Premium Beer",macros:{p:1,o:0,f:0,cal:140,poly:30},ingredients:["12oz Sapporo"],steps:["Serve cold","Pour into glass","Enjoy"],why:"Japanese lager. Lower bitterness. Moderate alcohol content. Pairs well with sushi and Asian cuisine.",colors:['yellow']},
{title:"Tito's Vodka Soda",macros:{p:0,o:0,f:0,cal:100,poly:0},ingredients:["1.5oz Tito's Handmade Vodka","Club Soda","Lime Wedge"],steps:["Fill glass with ice","Pour vodka","Top with club soda","Squeeze lime"],why:"Lowest calorie spirit option. Zero sugar, zero carbs. Club soda keeps it clean. Lime adds vitamin C.",colors:['white']},
{title:"El Dorado Guyanese Rum",macros:{p:0,o:0,f:0,cal:110,poly:0},ingredients:["1.5oz El Dorado Rum","Ice"],steps:["Pour over ice or neat","Sip slowly"],why:"Premium Demerara rum. Sipping neat = no mixer calories. Enjoy the craft, respect the protocol â€” one and done.",colors:['brown']}

],
snack1:[
{title:"Mikuni Pepper Fin",macros:{p:8,o:1200,f:2,cal:120,poly:50},ingredients:["1 serving Pepper Fin Tuna","Wasabi","Soy Sauce"],steps:["Open container","Add wasabi and soy to taste","Enjoy"],why:"High-quality sashimi-grade tuna. Omega-3 + protein. Quick restaurant-quality snack.",colors:['red','green']},
{title:"Edamame",macros:{p:12,o:400,f:8,cal:150,poly:100},ingredients:["1 cup Edamame (in pods)","Sea Salt"],steps:["Boil edamame 5 mins","Drain and sprinkle with sea salt","Enjoy while warm"],why:"Complete plant protein. Isoflavones support cardiovascular health. High fiber.",colors:['green']},
{title:"Crunchy Edamame",macros:{p:14,o:300,f:6,cal:130,poly:120},ingredients:["1 serving Dry Roasted Edamame","Sea Salt"],steps:["Open bag","Enjoy"],why:"Soy plant sterols block cholesterol absorption in the gut â€” direct ApoB reduction. Dry roasted = crunchy satisfying texture with 14g protein per serving. Isoflavones are concentrated in dried form.",colors:['green']},
{title:"Yogurt Bowl (Hemp + Flax + Granola)",macros:{p:18,o:3100,f:6,cal:345,poly:90},ingredients:["1/2 cup Homemade Yogurt (Chef IQ, whole milk + Fage starter)","2 tbsp Hemp Hearts","1 tbsp Ground Flaxseed","1/4 cup Granola"],steps:["Scoop yogurt into bowl","Top with hemp hearts and flaxseed","Add granola","Enjoy"],why:"Live probiotics from fresh-fermented yogurt + hemp hearts deliver complete plant protein with all 9 amino acids + GLA (gamma-linolenic acid). Flax = ALA omega-3 + lignans that bind bile acids for ApoB reduction. Crunchy + creamy texture.",colors:['white','brown']},
{title:"Caprese Salad",time:"5min",servings:1,macros:{p:26,o:100,f:4,cal:380,poly:120},ingredients:["4oz Fresh Mozzarella (sliced)","2 Large Heirloom Tomatoes (sliced)","Fresh Basil Leaves","2 tbsp EVOO","1 tbsp Balsamic Glaze","Sea Salt","Black Pepper"],steps:["Alternate slices of tomato and mozzarella on plate","Tuck fresh basil leaves between slices","Drizzle EVOO and balsamic glaze","Season with sea salt and cracked pepper"],why:"Tomato lycopene is fat-soluble â€” EVOO dramatically increases absorption. Lycopene lowers oxidized LDL (works alongside ApoB reduction). Fresh basil = eugenol (anti-inflammatory). Simple, clean, no-cook.",colors:['red','white','green']},
{title:"Beef Jerky (Grass-Fed)",macros:{p:12,o:0,f:0,cal:80,poly:0},ingredients:["1oz Beef Jerky (Grass-fed)"],steps:["Open and enjoy"],why:"Pure bioavailable protein. Zero prep. convenient.",colors:['brown']},
{title:"Savory Pulp Crackers",macros:{p:6,o:1200,f:12,cal:140,poly:50},ingredients:["Veggie Pulp","Flaxseed","Chia Seeds","Water"],steps:["Mix pulp and seeds","Spread thin on sheet","Dehydrate 8hrs"],why:"Zero waste. Massive fiber hit binds to cholesterol.",colors:['brown']},
{title:"Citrus Ginger Pulp Chews",macros:{p:3,o:200,f:8,cal:110,poly:80},ingredients:["fruit pulp","almond flour","coconut"],steps:["Mix ingredients","Dehydrate until chewy"],why:"Uses leftover pulp. High fiber treat.",colors:['orange','white']},
{title:"Dark Chocolate Oatmeal Balls",macros:{p:10,o:300,f:5,cal:210,poly:200},ingredients:["1.5 cups rolled oats","1/2 cup dark chocolate chips","1/2 cup almond butter"],steps:["Mix oats, protein, and salt","Fold in chocolate chips","Roll into balls"],why:"Oats = beta-glucan (lowers LDL). Dark chocolate = flavonols.",colors:['brown']},
{title:"Centurion Protein Balls (PB)",macros:{p:12,o:800,f:4,cal:220,poly:30},ingredients:["1 cup oats","1/2 cup peanut butter","1/3 cup honey","Protein powder"],steps:["Mix all ingredients in a bowl","Roll into balls","Refrigerate"],why:"Quick protein hit + omega-3 from flax/chia.",colors:['brown']},
{title:"Hummus & Carrots",macros:{p:4,o:0,f:6,cal:150,poly:40},ingredients:["1/2 cup Hummus","2 Carrots (sliced)"],steps:["Slice carrots","Scoop hummus","Enjoy"],why:"Fiber rich carb with healthy fats.",colors:['orange','white']},
{title:"Roasted Seaweed Snacks",macros:{p:1,o:100,f:1,cal:30,poly:20},ingredients:["1 pack Seaweed sheets"],steps:["Eat straight from pack"],why:"Iodine powerhouse for thyroid health.",colors:['green']},
{title:"Omega Nut Mix",macros:{p:6,o:2500,f:4,cal:180,poly:150},ingredients:["Walnuts","Brazil Nuts","Almonds"],steps:["Combine nuts"],why:"Walnuts essential for lowering Lp(a).",colors:['brown']},
{title:"Hard Boiled Eggs",macros:{p:12,o:100,f:0,cal:140,poly:0},ingredients:["2 Eggs","Salt","Pepper"],steps:["Boil eggs for 10 mins","Cool in ice water","Peel and season"],why:"Choline source for brain health. Pure bioavailable protein.",colors:['white','yellow']},
{title:"Sardines",macros:{p:22,o:2800,f:0,cal:190,poly:0},ingredients:["1 tin Wild-Caught Sardines","Lemon","Hot Sauce (optional)"],steps:["Open tin","Squeeze lemon over sardines","Add hot sauce if desired","Eat with fork"],why:"Sardines = highest omega-3 per calorie. Small fish = low mercury. Bones = calcium. B12 + Vitamin D. Sustainable seafood.",colors:['silver','white']},
{title:"Tru Fru Dark Chocolate Raspberries",macros:{p:2,o:0,f:3,cal:130,poly:350},ingredients:["1 serving Tru Fru Dark Chocolate Raspberries"],steps:["Open bag","Enjoy frozen or room temp"],why:"Dark chocolate flavanols lower blood pressure + improve endothelial function. Raspberries = ellagic acid (anti-inflammatory). Polyphenol powerhouse snack.",colors:['red','brown']}
],
snack2:[
{title:"Mikuni Pepper Fin",macros:{p:8,o:1200,f:2,cal:120,poly:50},ingredients:["1 serving Pepper Fin Tuna","Wasabi","Soy Sauce"],steps:["Open container","Add wasabi and soy to taste","Enjoy"],why:"High-quality sashimi-grade tuna. Omega-3 + protein. Quick restaurant-quality snack.",colors:['red','green']},
{title:"Edamame",macros:{p:12,o:400,f:8,cal:150,poly:100},ingredients:["1 cup Edamame (in pods)","Sea Salt"],steps:["Boil edamame 5 mins","Drain and sprinkle with sea salt","Enjoy while warm"],why:"Complete plant protein. Isoflavones support cardiovascular health. High fiber.",colors:['green']},
{title:"Crunchy Edamame",macros:{p:14,o:300,f:6,cal:130,poly:120},ingredients:["1 serving Dry Roasted Edamame","Sea Salt"],steps:["Open bag","Enjoy"],why:"Soy plant sterols block cholesterol absorption in the gut â€” direct ApoB reduction. Dry roasted = crunchy satisfying texture with 14g protein per serving. Isoflavones are concentrated in dried form.",colors:['green']},
{title:"Yogurt Bowl (Hemp + Flax + Granola)",macros:{p:18,o:3100,f:6,cal:345,poly:90},ingredients:["1/2 cup Homemade Yogurt (Chef IQ, whole milk + Fage starter)","2 tbsp Hemp Hearts","1 tbsp Ground Flaxseed","1/4 cup Granola"],steps:["Scoop yogurt into bowl","Top with hemp hearts and flaxseed","Add granola","Enjoy"],why:"Live probiotics from fresh-fermented yogurt + hemp hearts deliver complete plant protein with all 9 amino acids + GLA (gamma-linolenic acid). Flax = ALA omega-3 + lignans that bind bile acids for ApoB reduction. Crunchy + creamy texture.",colors:['white','brown']},
{title:"Caprese Salad",time:"5min",servings:1,macros:{p:26,o:100,f:4,cal:380,poly:120},ingredients:["4oz Fresh Mozzarella (sliced)","2 Large Heirloom Tomatoes (sliced)","Fresh Basil Leaves","2 tbsp EVOO","1 tbsp Balsamic Glaze","Sea Salt","Black Pepper"],steps:["Alternate slices of tomato and mozzarella on plate","Tuck fresh basil leaves between slices","Drizzle EVOO and balsamic glaze","Season with sea salt and cracked pepper"],why:"Tomato lycopene is fat-soluble â€” EVOO dramatically increases absorption. Lycopene lowers oxidized LDL (works alongside ApoB reduction). Fresh basil = eugenol (anti-inflammatory). Simple, clean, no-cook.",colors:['red','white','green']},
{title:"Beef Jerky (Grass-Fed)",macros:{p:12,o:0,f:0,cal:80,poly:0},ingredients:["1oz Beef Jerky (Grass-fed)"],steps:["Open and enjoy"],why:"Pure bioavailable protein. Zero prep. convenient.",colors:['brown']},
{title:"Savory Pulp Crackers",macros:{p:6,o:1200,f:12,cal:140,poly:50},ingredients:["Veggie Pulp","Flaxseed","Chia Seeds","Water"],steps:["Mix pulp and seeds","Spread thin on sheet","Dehydrate 8hrs"],why:"Zero waste. Massive fiber hit binds to cholesterol.",colors:['brown']},
{title:"Citrus Ginger Pulp Chews",macros:{p:3,o:200,f:8,cal:110,poly:80},ingredients:["fruit pulp","almond flour","coconut"],steps:["Mix ingredients","Dehydrate until chewy"],why:"Uses leftover pulp. High fiber treat.",colors:['orange','white']},
{title:"Dark Chocolate Oatmeal Balls",macros:{p:10,o:300,f:5,cal:210,poly:200},ingredients:["1.5 cups rolled oats","1/2 cup dark chocolate chips","1/2 cup almond butter"],steps:["Mix oats, protein, and salt","Fold in chocolate chips","Roll into balls"],why:"Oats = beta-glucan (lowers LDL). Dark chocolate = flavonols.",colors:['brown']},
{title:"Centurion Protein Balls (PB)",macros:{p:12,o:800,f:4,cal:220,poly:30},ingredients:["1 cup oats","1/2 cup peanut butter","1/3 cup honey","Protein powder"],steps:["Mix all ingredients in a bowl","Roll into balls","Refrigerate"],why:"Quick protein hit + omega-3 from flax/chia.",colors:['brown']},
{title:"Hummus & Carrots",macros:{p:4,o:0,f:6,cal:150,poly:40},ingredients:["1/2 cup Hummus","2 Carrots (sliced)"],steps:["Slice carrots","Scoop hummus","Enjoy"],why:"Fiber rich carb with healthy fats.",colors:['orange','white']},
{title:"Roasted Seaweed Snacks",macros:{p:1,o:100,f:1,cal:30,poly:20},ingredients:["1 pack Seaweed sheets"],steps:["Eat straight from pack"],why:"Iodine powerhouse for thyroid health.",colors:['green']},
{title:"Omega Nut Mix",macros:{p:6,o:2500,f:4,cal:180,poly:150},ingredients:["Walnuts","Brazil Nuts","Almonds"],steps:["Combine nuts"],why:"Walnuts essential for lowering Lp(a).",colors:['brown']},
{title:"Hard Boiled Eggs",macros:{p:12,o:100,f:0,cal:140,poly:0},ingredients:["2 Eggs","Salt","Pepper"],steps:["Boil eggs for 10 mins","Cool in ice water","Peel and season"],why:"Choline source for brain health. Pure bioavailable protein.",colors:['white','yellow']},
{title:"Sardines",macros:{p:22,o:2800,f:0,cal:190,poly:0},ingredients:["1 tin Wild-Caught Sardines","Lemon","Hot Sauce (optional)"],steps:["Open tin","Squeeze lemon over sardines","Add hot sauce if desired","Eat with fork"],why:"Sardines = highest omega-3 per calorie. Small fish = low mercury. Bones = calcium. B12 + Vitamin D. Sustainable seafood.",colors:['silver','white']},
{title:"Tru Fru Dark Chocolate Raspberries",macros:{p:2,o:0,f:3,cal:130,poly:350},ingredients:["1 serving Tru Fru Dark Chocolate Raspberries"],steps:["Open bag","Enjoy frozen or room temp"],why:"Dark chocolate flavanols lower blood pressure + improve endothelial function. Raspberries = ellagic acid (anti-inflammatory). Polyphenol powerhouse snack.",colors:['red','brown']}
],
snack3:null, // Will be set to snack pool below
juice1:null, // Will be set to juices array below
juice2:null,
juice3:null
};
// Map all juice slots to the same juices array
MEALS.juice1=MEALS.juices;
MEALS.juice2=MEALS.juices;
MEALS.juice3=MEALS.juices;
// snack3 shares the same pool as snack1/snack2
MEALS.snack3=MEALS.snack1;

// ============================================================================
// USER CONFIG & TOKENS
// ============================================================================
const USERS={
jermaine:{name:"Jermaine",dob:"1983-01-13",goals:{protein:175,omega3:4000,fiber:50,water:140,poly:600,weightTarget:210,heightInches:76.5,z2:45,z5:20,calBurn:500,sleepHours:8},defaultBios:{bmr:'2028',apob:'114',lpa:'178',weight:'215.7',hscrp:'0.4',hba1c:'5.4',bodyfat:'21.6',muscle:'97.0'},hrvBaseline:45},
sophia:{name:"Sophia",dob:"1987-01-25",goals:{protein:130,omega3:4000,fiber:35,water:100,poly:500,weightTarget:118,heightInches:62,z2:30,z5:15,calBurn:350,sleepHours:8},defaultBios:{bmr:'1264',apob:'70',lpa:'20',weight:'136',hscrp:'0.5',hba1c:'5.0',bodyfat:'33.0',muscle:'50.0',ana:'positive',glucose:'84',creatinine:'0.82',egfr:'94',ferritin:'75',tsh:'1.35',ast:'23',alt:'27',calcium:'9',albumin:'4.7'},hrvBaseline:55}
};
const TOKENS={jermaine:'WLIGFPFJQY73G43BY7CK7H6UJXPQ7N5Y',sophia:'4QSDWYJJUZFHRWRH727NCK7WH4COQJF4'};
const COLORS={red:'#ff4757',orange:'#ff9500',yellow:'#ffd60a',green:'#34d399',purple:'#a855f7',white:'#fff',brown:'#A0522D',pink:'#f093fb',black:'#333',silver:'#ccc'};

// ============================================================================
// PROTOCOLS (v21)
// ============================================================================
const PROTOCOLS={
microcurrent:{title:"âš¡ MICROCURRENT",steps:["1. CLEANSE: Oil-free","2. GEL: Thick layer","3. FOREHEAD: Upward 3min","4. CHEEKS: Nose to ear 4min each","5. JAWLINE: Jaw to ear 3min","6. NECK: Upward only 2min","7. SLOW movements"]},
microneedling:{title:"ðŸ“ MICRONEEDLING",steps:["1. SANITIZE device","2. CLEANSE 2x","3. SERUM: Apply HA","4. NEEDLE: Cross-hatch","5. WAIT 10min","6. NO actives 24hrs","7. SPF mandatory next day"]},
massage:{title:"ðŸ’† MASSAGE",steps:["1. OIL: Apply facial oil","2. JAW: Chin to ear","3. CHEEKS: Lift to temples","4. EYES: Gentle circles","5. FOREHEAD: Horizontal","6. DRAIN: Down to collarbone"]},
cupping:{title:"ðŸ”µ CUPPING",steps:["1. OIL back","2. STATIC 3-5min on knots","3. SLIDING along spine","4. AVOID direct spine","5. MARKS = stagnation","6. HEAT: Hyperice 15min after"]},
clubstudio:{title:"ðŸ¢ CLUB STUDIO",steps:["OPTION A: Full Recovery","1. CRYO 3min","2. WAIT 5min","3. SAUNA 20min","4. MASSAGE BED 20min","","OPTION B: Quick","1. CRYO or Sauna only","2. MASSAGE BED 15min"]},
hipflexor:{title:"ðŸ§˜ HIP FLEXOR STRETCH",steps:["DURATION: 5 min total","","1. Kneeling lunge position","2. Engage core, tuck pelvis","3. Shift weight forward","4. Hold 2.5 min each side"]},
shoulder:{title:"ðŸ¦¾ SHOULDER MOBILITY",steps:["1. ARM CIRCLES (1 min)","2. DOORWAY PEC STRETCH (2 min)","3. SLEEPER STRETCH (2 min)"]},
lowhrv:{title:"ðŸ’œ LOW HRV PROTOCOL",steps:["HRV IS BELOW BASELINE","","â€¢ Skip HIIT today","â€¢ Focus on Zone 2 only","â€¢ Extra 30min sleep","â€¢ No alcohol today"]},
sauna:{title:"ðŸ”¥ SAUNA PROTOCOL",steps:["DURATION: 20-25 min","","1. HYDRATE: 16oz water before","2. TEMP: 170-185Â°F (infrared: 130-150Â°F)","3. SESSION: 20-25min continuous","4. BREATHE: Deep nasal breathing","5. COOL: 2-3min cold shower after","6. HYDRATE: 24oz water + electrolytes","7. REST: 10min before activity","","BENEFITS: Growth hormone â†‘, HSP activation,","cardiovascular conditioning, detox"]},
cryo:{title:"â„ï¸ CRYO PROTOCOL",steps:["DURATION: 3 min","","1. DRY SKIN: Remove moisture","2. PROTECT: Gloves, socks, ear cover","3. ENTER: -130Â°F to -270Â°F","4. KEEP MOVING: Rotate slowly","5. BREATHE: Steady controlled breaths","6. EXIT: After 3min max","7. WARM: Natural rewarming 5-10min","","BENEFITS: Inflammation â†“, NE â†‘ 200-300%,","vasoconstriction â†’ vasodilation, recovery"]},
contrast:{title:"ðŸ”¥â„ï¸ CONTRAST PROTOCOL",steps:["TOTAL: 20-30 min","","1. SAUNA: 15-20min at 170Â°F+","2. COLD: 3min cryo or cold plunge","3. REST: 5min natural rewarming","4. REPEAT: 2-3 rounds if time allows","","SEQUENCE: Always end on COLD","","BENEFITS: Vascular elasticity, norepinephrine,","deep recovery, immune activation"]},
normatec:{title:"ðŸ¦µ NORMATEC",steps:["1. SETUP Legs/Hips","2. LEVEL 7 flush","3. TIME 30-45min","4. ZONE boost if sore","5. HYDRATE 16oz after","6. Can do 2x daily"]},
inshape:{title:"ðŸŠ INSHAPE",steps:["1. STEAM 15min","2. SAUNA 20min","3. POOL 20min light","4. AQUA BED 30min","5. SHOWER cold finish","6. NORMATEC 45min home"]}
};

// ============================================================================
// BASE PROTOCOL (v21)
// ============================================================================
const BASE=[
{id:'morningBeverage',time:'7:15 AM',title:'Morning Beverage',desc:'Tap to select',macros:{p:0,o:0,f:0,cal:0,poly:0},colors:[],clickable:true,mealSlot:'juice2',cssClass:'optional'},
{id:'breakfast',time:'7:30 AM',title:'Breakfast',desc:'Tap to select',macros:{p:0,o:0,f:0,cal:0,poly:0},colors:[],clickable:true,mealSlot:'breakfast'},
{id:'breakfastSnack',time:'10:00 AM',title:'Morning Snack',desc:'Tap to select',macros:{p:0,o:0,f:0,cal:0,poly:0},colors:[],clickable:true,mealSlot:'snack1'},
{id:'lunch',time:'1:00 PM',title:'Lunch',desc:'Tap to select',macros:{p:0,o:0,f:0,cal:0,poly:0},colors:[],clickable:true,mealSlot:'lunch'},
{id:'lunchSnack',time:'3:00 PM',title:'Afternoon Snack',desc:'Tap to select',macros:{p:0,o:0,f:0,cal:0,poly:0},colors:[],clickable:true,mealSlot:'snack2'},
{id:'afternoonBeverage',time:'3:30 PM',title:'Afternoon Beverage',desc:'Tap to select',macros:{p:0,o:0,f:0,cal:0,poly:0},colors:[],clickable:true,mealSlot:'juice3',cssClass:'optional'},
{id:'eveningSnack',time:'5:00 PM',title:'Evening Snack',desc:'Tap to select',macros:{p:0,o:0,f:0,cal:0,poly:0},colors:[],clickable:true,mealSlot:'snack3'},
{id:'dinner',time:'6:30 PM',title:'Dinner',desc:'Tap to select',macros:{p:0,o:0,f:0,cal:0,poly:0},colors:[],clickable:true,mealSlot:'dinner'},
{id:'alcohol',time:'8:00 PM',title:'Alcohol (Optional)',desc:'Tap to select',macros:{p:0,o:0,f:0,cal:0,poly:0},colors:[],clickable:true,mealSlot:'alcohol',cssClass:'optional'}
];

// ============================================================================
// MAIN APPLICATION - MERGED v21 Logic + v22 Oura Features
// ============================================================================
class CenturionApp{
constructor(){
console.log('ðŸš€ Centurion v23.1 SKELETON');
this.user=localStorage.getItem('c_user')||'jermaine';
this.history=[];this.currentIndex=0;this.currentDateStr=new Date().toLocaleDateString('en-CA');
this.checked=JSON.parse(localStorage.getItem(`c_chk_${this.user}`)||'{}');
this.meals=JSON.parse(localStorage.getItem(`c_meals_${this.user}`)||'{}');
this.portions=JSON.parse(localStorage.getItem(`c_portions_${this.user}`)||'{}');
this.water=JSON.parse(localStorage.getItem(`c_water_${this.user}`)||'{}');
this.bios=JSON.parse(localStorage.getItem(`c_bios_${this.user}`)||'null')||USERS[this.user].defaultBios;
this.protocol=[];this.currentPortion=1;this.currentMealSlot=null;this.inRecipeView=false;this.streak=0;
this.removedIngredients=JSON.parse(localStorage.getItem(`c_remIng_${this.user}`)||'{}');
this.sideItems=JSON.parse(localStorage.getItem(`c_sides_${this.user}`)||'{}');
document.querySelectorAll('.user-switch button').forEach(b=>b.classList.remove('active'));
document.getElementById(`btn-${this.user}`)?.classList.add('active');
// Seed manual sleep for 2026-02-16 (Oura died, Apple Health backup)
if(!localStorage.getItem('c_manualSleep_jermaine')){
localStorage.setItem('c_manualSleep_jermaine',JSON.stringify({'2026-02-16':{totalSec:18420,deepSec:4200,remSec:4500,rhr:59,score:55}}));
}
this.setPlaceholder();this.restoreSectionStates();this.render();this.fetchOura();
}

save(){
localStorage.setItem(`c_chk_${this.user}`,JSON.stringify(this.checked));
localStorage.setItem(`c_meals_${this.user}`,JSON.stringify(this.meals));
localStorage.setItem(`c_portions_${this.user}`,JSON.stringify(this.portions));
localStorage.setItem(`c_water_${this.user}`,JSON.stringify(this.water));
localStorage.setItem(`c_bios_${this.user}`,JSON.stringify(this.bios));
localStorage.setItem(`c_remIng_${this.user}`,JSON.stringify(this.removedIngredients));
localStorage.setItem(`c_sides_${this.user}`,JSON.stringify(this.sideItems));
}

setPlaceholder(){this.history=[{date:this.currentDateStr,score:0,totalSec:0,deepSec:0,remSec:0,rhr:'-',cal:0,high:0,med:0,workouts:[],hrv:null,tempDev:0,respRate:null,readiness:null,vascularAge:null}];this.currentIndex=0}

async fetchOura(){
this.setText('syncStatus','SYNCING...');
try{
const end=new Date();end.setDate(end.getDate()+1);const start=new Date();start.setDate(start.getDate()-14);
const startStr=start.toISOString().split('T')[0],endStr=end.toISOString().split('T')[0];
const token=TOKENS[this.user],proxy='https://oura-proxy.jclarke-9a0.workers.dev?url=';
const eps=['sleep','workout','daily_activity','daily_readiness','daily_hrv'];
const results=await Promise.allSettled(eps.map(async ep=>{
const url=`${proxy}${encodeURIComponent(`https://api.ouraring.com/v2/usercollection/${ep}?start_date=${startStr}&end_date=${endStr}`)}`;
const res=await fetch(url,{headers:{'Authorization':`Bearer ${token}`}});
if(!res.ok)throw new Error(ep);
return{name:ep,data:(await res.json()).data||[]};
}));
const data={};results.forEach(r=>{if(r.status==='fulfilled')data[r.value.name]=r.value.data});
this.processData(data);this.setText('syncStatus','SYNCED âœ“');this.render();
}catch(e){console.error(e);this.setText('syncStatus','OFFLINE');this.render()}
}

processData(data){
const m=new Map();
const g=d=>{if(!m.has(d))m.set(d,{date:d,score:0,totalSec:0,deepSec:0,remSec:0,rhr:'-',cal:0,high:0,med:0,workouts:[],hrv:null,tempDev:0,respRate:null,readiness:null,vascularAge:null});return m.get(d)};
(data.sleep||[]).forEach(s=>{const d=g(s.day);d.totalSec+=s.total_sleep_duration||0;d.deepSec+=s.deep_sleep_duration||0;d.remSec+=s.rem_sleep_duration||0;if(s.lowest_heart_rate>=35&&s.lowest_heart_rate<=100)d.rhr=Math.round(s.lowest_heart_rate);if(s.average_breath)d.respRate=s.average_breath;if(s.average_hrv)d.hrv=Math.round(s.average_hrv);const sc=s.score||(s.efficiency?Math.round(s.efficiency):0);if(sc>d.score)d.score=sc});
// daily_hrv endpoint only has contributor scores (0-100), NOT actual HRV in ms
// Actual HRV comes from sleep endpoint's average_hrv field â€” do not use daily_hrv as fallback
(data.daily_readiness||[]).forEach(r=>{const d=g(r.day);d.readiness=r.score||null;if(r.contributors?.body_temperature!=null){const btScore=r.contributors.body_temperature;d.tempDev=btScore>=95?0:btScore>=85?0.1:btScore>=75?0.3:btScore>=60?0.5:btScore>=40?0.8:1.2;if(r.temperature_deviation!=null)d.tempDev=r.temperature_deviation}});
(data.daily_activity||[]).forEach(a=>{const d=g(a.day);d.cal=a.active_calories||0;d.high=(a.high_activity_time||0)/60;d.med=(a.medium_activity_time||0)/60});
(data.workout||[]).forEach(w=>{const d=g(w.day);d.workouts.push({type:w.label||w.activity||'workout',calories:w.calories||300,time:new Date(w.start_datetime).toLocaleTimeString('en-US',{hour:'numeric',minute:'2-digit'})})});
this.history=Array.from(m.values()).sort((a,b)=>b.date.localeCompare(a.date));
this.currentIndex=this.history.findIndex(h=>h.date===this.currentDateStr);
if(this.currentIndex===-1){this.history.unshift({date:this.currentDateStr,score:0,totalSec:0,deepSec:0,remSec:0,rhr:'-',cal:0,high:0,med:0,workouts:[],hrv:null,tempDev:0,respRate:null,readiness:null,vascularAge:null});this.currentIndex=0}
// Manual sleep overrides (Apple Health backup when Oura dies)
const manualSleep=JSON.parse(localStorage.getItem(`c_manualSleep_${this.user}`)||'{}');
Object.keys(manualSleep).forEach(date=>{
const entry=this.history.find(h=>h.date===date);
if(entry){const ms=manualSleep[date];
if(entry.totalSec===0&&ms.totalSec)entry.totalSec=ms.totalSec;
if(entry.deepSec===0&&ms.deepSec)entry.deepSec=ms.deepSec;
if(entry.remSec===0&&ms.remSec)entry.remSec=ms.remSec;
if(entry.rhr==='-'&&ms.rhr)entry.rhr=ms.rhr;
if(!entry.score&&ms.score)entry.score=ms.score;
}});
// Calculate rolling HRV baseline from last 30 days of actual data
const hrvDays=this.history.filter(h=>h.hrv&&h.hrv>0).slice(0,30);
if(hrvDays.length>=7){
this.calculatedHrvBaseline=Math.round(hrvDays.reduce((s,h)=>s+h.hrv,0)/hrvDays.length);
}else{
this.calculatedHrvBaseline=null; // not enough data, fall back to hardcoded
}
}

changeDate(dir){const n=this.currentIndex-dir;if(n>=0&&n<this.history.length){this.currentIndex=n;this.currentDateStr=this.history[n].date;this.render()}}

switchUser(u){if(u===this.user)return;this.user=u;localStorage.setItem('c_user',u);document.querySelectorAll('.user-switch button').forEach(b=>b.classList.remove('active'));document.getElementById(`btn-${u}`).classList.add('active');this.checked=JSON.parse(localStorage.getItem(`c_chk_${u}`)||'{}');this.meals=JSON.parse(localStorage.getItem(`c_meals_${u}`)||'{}');this.portions=JSON.parse(localStorage.getItem(`c_portions_${u}`)||'{}');this.water=JSON.parse(localStorage.getItem(`c_water_${u}`)||'{}');this.bios=JSON.parse(localStorage.getItem(`c_bios_${u}`)||'null')||USERS[u].defaultBios;this.removedIngredients=JSON.parse(localStorage.getItem(`c_remIng_${u}`)||'{}');this.sideItems=JSON.parse(localStorage.getItem(`c_sides_${u}`)||'{}');this.history=[];this.setPlaceholder();this.render();this.fetchOura()}

toggleTask(id){const dk=this.currentDateStr;if(!this.checked[dk])this.checked[dk]=[];const i=this.checked[dk].indexOf(id);if(i===-1)this.checked[dk].push(id);else this.checked[dk].splice(i,1);this.save();this.render()}

setText(id,txt){const el=document.getElementById(id);if(el)el.innerText=txt}

calcMacros(){const sel=this.meals[this.currentDateStr]||{};const portions=this.portions[this.currentDateStr]||{};const chk=this.checked[this.currentDateStr]||[];const slotToId={};BASE.forEach(b=>{if(b.mealSlot)slotToId[b.mealSlot]=b.id});let t={protein:0,omega3:0,fiber:0,calories:0,polyphenol:0};Object.keys(sel).forEach(slot=>{const pid=slotToId[slot]||slot;if(!chk.includes(pid))return;const idx=sel[slot];const m=MEALS[slot]?.[idx];if(m){const p=portions[slot]||1;const removed=this.getRemovedSet(slot,idx);const adj=this.getAdjustedMacros(m,p,removed);t.protein+=adj.p;t.omega3+=adj.o;t.fiber+=adj.f;t.calories+=adj.cal;t.polyphenol+=adj.poly;
const sides=this.sideItems[`${this.currentDateStr}:${slot}`]||[];
sides.forEach(s=>{t.protein+=(s.macros.p||0);t.omega3+=(s.macros.o||0);t.fiber+=(s.macros.f||0);t.calories+=(s.macros.cal||0);t.polyphenol+=(s.macros.poly||0)})}});return t}

calcRainbow(){const sel=this.meals[this.currentDateStr]||{};const chk=this.checked[this.currentDateStr]||[];const slotToId={};BASE.forEach(b=>{if(b.mealSlot)slotToId[b.mealSlot]=b.id});let s=new Set();Object.keys(sel).forEach(slot=>{const pid=slotToId[slot]||slot;if(!chk.includes(pid))return;const m=MEALS[slot]?.[sel[slot]];if(m?.colors)m.colors.forEach(c=>s.add(c))});return s}

addWater(){const d=this.currentDateStr;if(!this.water[d])this.water[d]=0;this.water[d]+=17;const target=USERS[this.user].goals.water;if(this.water[d]>target)this.water[d]=target;this.save();this.updateWater()}

toggleSection(header){
const body=header.nextElementSibling;
if(!body||!body.classList.contains('section-body'))return;
const isCollapsed=header.classList.toggle('collapsed');
if(isCollapsed){
body.style.maxHeight=body.scrollHeight+'px';
requestAnimationFrame(()=>{body.style.maxHeight='0px';body.style.opacity='0'});
}else{
body.style.maxHeight=body.scrollHeight+'px';body.style.opacity='1';
setTimeout(()=>{body.style.maxHeight='none'},400);
}
// Save state
const sectionId=body.id;
const states=JSON.parse(localStorage.getItem('c_sections')||'{}');
states[sectionId]=isCollapsed;
localStorage.setItem('c_sections',JSON.stringify(states));
}

restoreSectionStates(){
const states=JSON.parse(localStorage.getItem('c_sections')||'{}');
Object.keys(states).forEach(id=>{
if(states[id]){
const body=document.getElementById(id);
if(body){
const header=body.previousElementSibling;
if(header){header.classList.add('collapsed')}
body.style.maxHeight='0px';body.style.opacity='0';
}
}
});
}

updateSectionSummaries(){
const goals=USERS[this.user].goals;
const mac=this.calcMacros();
// Fuel summary
const fs=document.getElementById('fuelSummary');
if(fs)fs.textContent=`P:${Math.round(mac.protein)}g Î©3:${Math.round(mac.omega3/1000)}k F:${Math.round(mac.fiber)}g`;
// Metabolism summary
const ms=document.getElementById('metabSummary');
if(ms){const bal=Math.round(mac.calories-(parseFloat(this.bios.bmr||2000)+(this.ouraCalBurn||0)));ms.textContent=`${bal>=0?'+':''}${bal} cal`}
// Vascular summary
const vs=document.getElementById('vascSummary');
if(vs)vs.textContent=`Age: ${this.bios.vascAge||'--'}`;
// Cardio summary
const cs=document.getElementById('cardioSummary');
const day=this.history[this.currentIndex]||{};
if(cs)cs.textContent=`RHR:${day.rhr||'--'} Z2:${day.med||0}m`;
// Hydration summary
const hs=document.getElementById('hydroSummary');
const waterOz=this.water[this.currentDateStr]||0;
if(hs)hs.textContent=`${waterOz}/${goals.water}oz`;
// Rainbow summary
const rs=document.getElementById('rainbowSummaryText');
if(rs){const colors=this.calcRainbow();rs.textContent=`${colors.size}/7 colors`}
}

updateWater(){const cur=this.water[this.currentDateStr]||0;const target=USERS[this.user].goals.water;this.setText('waterScore',`${cur} / ${target} oz`);document.getElementById('waterFill').style.width=`${Math.min(100,cur/target*100)}%`}

openMealPicker(slot){
this.currentMealSlot=slot;this.inRecipeView=false;
this.setText('modalTitle',slot.toUpperCase());
const all=MEALS[slot]||[];const sel=this.meals[this.currentDateStr]?.[slot];
if(all.length===0){document.getElementById('modalBody').innerHTML='<div style="text-align:center;padding:40px;color:var(--text-tertiary)">No meals in database yet.<br>Add meals to MEALS.'+slot+' array.</div>';document.getElementById('mainModal').classList.add('show');return}
this.renderMealList(slot,all,sel,'');
document.getElementById('mainModal').classList.add('show');
}

renderMealList(slot,all,sel,query){
const q=query.toLowerCase().trim();
const filtered=q?all.map((m,i)=>({m,i})).filter(({m})=>{
const searchStr=(m.title+' '+(m.ingredients||[]).join(' ')+' '+(m.why||'')).toLowerCase();
return q.split(/\s+/).every(word=>searchStr.includes(word));
}):all.map((m,i)=>({m,i}));
// On first render, build the full structure with search bar + results container
if(!document.getElementById('mealResults')){
let html=`<div style="position:sticky;top:0;z-index:10;background:var(--bg);padding:8px 0 12px">
<input type="text" id="mealSearch" placeholder="Search meals, ingredients..." value="${query.replace(/"/g,'&quot;')}" oninput="app.filterMeals('${slot}')" style="width:100%;padding:12px 16px;background:var(--panel);border:1px solid var(--border);color:var(--text);border-radius:10px;font-size:0.95rem;outline:none;box-sizing:border-box">
<div style="font-size:0.6rem;color:var(--text-tertiary);margin-top:6px;text-align:center" id="mealCount">${filtered.length} of ${all.length} items</div></div><div id="mealResults"></div>`;
document.getElementById('modalBody').innerHTML=html;
}else{
const countEl=document.getElementById('mealCount');
if(countEl)countEl.textContent=`${filtered.length} of ${all.length} items`;
}
// Only update results div, not the search input
let items=filtered.map(({m,i})=>`<div class="menu-item" ${sel===i?'style="border-color:var(--acid)"':''} onclick="app.showRecipe('${slot}',${i})"><div><div class="menu-name">${sel===i?'âœ“ ':''}${m.title}</div><div class="menu-meta">P:${m.macros.p}g F:${m.macros.f}g Î©3:${m.macros.o}mg Cal:${m.macros.cal}</div></div><div class="menu-arrow">â€º</div></div>`).join('');
if(filtered.length===0)items=`<div style="text-align:center;padding:30px;color:var(--text-tertiary)">No matches for "${q}"</div>`;
document.getElementById('mealResults').innerHTML=items;
}

filterMeals(slot){
const q=document.getElementById('mealSearch')?.value||'';
const all=MEALS[slot]||[];
const sel=this.meals[this.currentDateStr]?.[slot];
this.renderMealList(slot,all,sel,q);
}

showRecipe(slot,idx){
this.currentMealSlot=slot;this.currentMealIdx=idx;this.inRecipeView=true;
const meal=MEALS[slot][idx];
const allowHalf=['breakfast','lunch','dinner','snack1','snack2','snack3'].includes(slot);
const savedPortion=this.portions[this.currentDateStr]?.[slot]||1;
if(this.currentPortion===1&&savedPortion!==1)this.currentPortion=savedPortion;
const p=this.currentPortion;
const removed=this.getRemovedSet(slot,idx);
const adj=this.getAdjustedMacros(meal,p,removed);
// Add side item macros to display totals
const sides=this.getSides(slot);
const totalAdj={p:adj.p,o:adj.o,f:adj.f,cal:adj.cal,poly:adj.poly};
sides.forEach(s=>{totalAdj.p+=(s.macros.p||0);totalAdj.o+=(s.macros.o||0);totalAdj.f+=(s.macros.f||0);totalAdj.cal+=(s.macros.cal||0);totalAdj.poly+=(s.macros.poly||0)});
let html=`<div class="recipe-hero"><div class="recipe-title">${meal.title}${sides.length?` + ${sides.length} side${sides.length>1?'s':''}`:''}</div><div class="recipe-stats">${meal.time||'Quick'} â€¢ ${meal.servings||1} serving</div></div>`;
if(allowHalf){
html+=`<div style="display:flex;gap:10px;margin:15px 0;justify-content:center">
<button onclick="app.setCurrentPortion(0.5)" style="flex:1;padding:12px;background:${p===0.5?'var(--acid)':'var(--panel)'};color:${p===0.5?'#000':'var(--text)'};border:1px solid ${p===0.5?'var(--acid)':'var(--border)'};border-radius:8px;font-weight:700;cursor:pointer">HALF</button>
<button onclick="app.setCurrentPortion(1)" style="flex:1;padding:12px;background:${p===1?'var(--acid)':'var(--panel)'};color:${p===1?'#000':'var(--text)'};border:1px solid ${p===1?'var(--acid)':'var(--border)'};border-radius:8px;font-weight:700;cursor:pointer">FULL</button>
</div>`}
html+=`<div class="macro-grid" id="recipeMacros"><div class="macro-stat"><div class="m-val">${Math.round(totalAdj.p)}g</div><div class="m-lbl">PROTEIN</div></div><div class="macro-stat"><div class="m-val">${Math.round(totalAdj.o)}mg</div><div class="m-lbl">OMEGA-3</div></div><div class="macro-stat"><div class="m-val">${Math.round(totalAdj.f)}g</div><div class="m-lbl">FIBER</div></div><div class="macro-stat"><div class="m-val">${Math.round(totalAdj.cal)}</div><div class="m-lbl">CALORIES</div></div></div>`;
if(removed.size>0)html+=`<div style="text-align:center;margin:-15px 0 15px;font-size:0.6rem;color:var(--orange);font-weight:700">${removed.size} INGREDIENT${removed.size>1?'S':''} REMOVED â€” MACROS ADJUSTED</div>`;
if(meal.why)html+=`<div class="synergy-box"><div class="syn-title">ðŸ§¬ BIO HACK</div><div class="syn-text">${meal.why}</div></div>`;
if(meal.ingredients){html+=`<div style="margin-bottom:20px"><div style="font-size:0.8rem;font-weight:900;color:var(--acid);margin-bottom:4px">INGREDIENTS</div><div class="ing-hint">Tap to remove ingredients you don't have</div>`;meal.ingredients.forEach((ing,i)=>{const isRemoved=removed.has(i);html+=`<div class="ing-item ${isRemoved?'removed':''}" onclick="app.toggleIngredient('${slot}',${idx},${i})">${ing}</div>`});html+=`</div>`}
if(meal.steps){html+=`<div><div style="font-size:0.8rem;font-weight:900;color:var(--acid);margin-bottom:10px">PREPARATION</div>`;meal.steps.forEach((step,i)=>{html+=`<div class="step-item"><div style="font-weight:900;color:var(--cyan);font-size:1.2rem;min-width:30px">${i+1}</div><div>${step}</div></div>`});html+=`</div>`}
// Beverage pairing (v21)
if(meal.suggestedBeverage&&MEALS.juices){
const bevIdx=MEALS.juices.findIndex(b=>b.title===meal.suggestedBeverage);
if(bevIdx!==-1){const bev=MEALS.juices[bevIdx];
html+=`<div onclick="app.showBeverageRecipe(${bevIdx})" style="background:var(--panel-elevated);border:1px solid var(--cyan);border-radius:10px;padding:15px;margin:20px 0;cursor:pointer"><div style="font-size:0.7rem;color:var(--cyan);font-weight:900;margin-bottom:5px">ðŸ¹ PAIRS WELL WITH</div><div style="font-size:1rem;font-weight:900;color:#fff;margin-bottom:3px">${bev.title}</div><div style="font-size:0.75rem;color:var(--text-secondary)">${bev.why||''}</div></div>`;
}}
// Side items display
if(sides.length>0){
html+=`<div style="margin:20px 0"><div style="font-size:0.8rem;font-weight:900;color:var(--cyan);margin-bottom:10px">SIDE ITEMS</div>`;
sides.forEach((s,si)=>{
html+=`<div style="display:flex;justify-content:space-between;align-items:center;padding:10px 12px;background:var(--panel);border:1px solid var(--border);border-radius:8px;margin-bottom:6px">
<div><div style="font-weight:700;font-size:0.85rem;color:#fff">${s.title}</div><div style="font-size:0.7rem;color:var(--text-secondary)">P:${s.macros.p}g F:${s.macros.f}g Î©3:${s.macros.o}mg Cal:${s.macros.cal}</div></div>
<div onclick="app.removeSide('${slot}',${si})" style="color:var(--alert);cursor:pointer;font-weight:900;font-size:1.2rem;padding:0 8px">âœ•</div></div>`;
});
html+=`</div>`;
}
html+=`<button onclick="app.addSide('${slot}')" style="width:100%;background:var(--panel);color:var(--cyan);padding:14px;margin-top:10px;border:1px solid var(--cyan);border-radius:10px;font-weight:800;font-size:0.9rem;cursor:pointer">+ ADD SIDE ITEM</button>`;
html+=`<button onclick="app.selectMeal('${slot}',${idx});app.closeModal()" style="width:100%;background:linear-gradient(135deg,#c8ff00,#00d4ff);color:#000;padding:18px;margin-top:12px;border:none;border-radius:12px;font-weight:900;font-size:1.1rem;cursor:pointer">ADD TO PROTOCOL</button>`;
document.getElementById('modalBody').innerHTML=html;
this.setText('modalTitle',meal.title.toUpperCase());
document.getElementById('mainModal').scrollTop=0;
}

toggleIngredient(slot,mealIdx,ingIdx){
const key=`${this.currentDateStr}:${slot}:${mealIdx}`;
if(!this.removedIngredients[key])this.removedIngredients[key]=[];
const arr=this.removedIngredients[key];
const i=arr.indexOf(ingIdx);
if(i===-1)arr.push(ingIdx);else arr.splice(i,1);
if(arr.length===0)delete this.removedIngredients[key];
this.save();
this.showRecipe(slot,mealIdx);
}

getRemovedSet(slot,mealIdx){
const key=`${this.currentDateStr}:${slot}:${mealIdx}`;
return new Set(this.removedIngredients[key]||[]);
}

getAdjustedMacros(meal,portion,removed){
if(!meal.ingredients||removed.size===0){
return{p:(meal.macros.p||0)*portion,o:(meal.macros.o||0)*portion,f:(meal.macros.f||0)*portion,cal:(meal.macros.cal||0)*portion,poly:(meal.macros.poly||0)*portion};
}
// If per-ingredient macros exist, use exact subtraction
if(meal.ingredientMacros){
let adj={p:(meal.macros.p||0),o:(meal.macros.o||0),f:(meal.macros.f||0),cal:(meal.macros.cal||0),poly:(meal.macros.poly||0)};
removed.forEach(idx=>{
const im=meal.ingredientMacros?.[idx];
if(im){adj.p-=(im.p||0);adj.o-=(im.o||0);adj.f-=(im.f||0);adj.cal-=(im.cal||0);adj.poly-=(im.poly||0)}
});
adj.p=Math.max(0,adj.p)*portion;adj.o=Math.max(0,adj.o)*portion;adj.f=Math.max(0,adj.f)*portion;adj.cal=Math.max(0,adj.cal)*portion;adj.poly=Math.max(0,adj.poly)*portion;
return adj;
}
// Otherwise estimate: distribute macros proportionally across ingredients
const total=meal.ingredients.length;
const kept=total-removed.size;
const ratio=kept/total;
return{p:Math.round((meal.macros.p||0)*ratio*portion),o:Math.round((meal.macros.o||0)*ratio*portion),f:Math.round((meal.macros.f||0)*ratio*portion),cal:Math.round((meal.macros.cal||0)*ratio*portion),poly:Math.round((meal.macros.poly||0)*ratio*portion)};
}

setCurrentPortion(size){this.currentPortion=size;this.showRecipe(this.currentMealSlot,this.currentMealIdx)}

// Side Items System
getSideKey(slot){return `${this.currentDateStr}:${slot}`}
getSides(slot){return this.sideItems[this.getSideKey(slot)]||[]}

addSide(slot){
// Show a searchable picker of ALL meals/snacks as potential sides
this.sidePickerSlot=slot;
const pools=[
...MEALS.breakfast.map((m,i)=>({m,pool:'breakfast',i})),
...MEALS.lunch.map((m,i)=>({m,pool:'lunch',i})),
...MEALS.dinner.map((m,i)=>({m,pool:'dinner',i})),
...(MEALS.snack||[]).map((m,i)=>({m,pool:'snack',i})),
...(MEALS.juices||[]).map((m,i)=>({m,pool:'juices',i}))
];
// Deduplicate by title
const seen=new Set();
this.sidePool=pools.filter(({m})=>{if(seen.has(m.title))return false;seen.add(m.title);return true});
this.renderSidePicker('');
}

renderSidePicker(query){
const q=query.toLowerCase().trim();
const filtered=q?this.sidePool.filter(({m})=>{
const s=(m.title+' '+(m.ingredients||[]).join(' ')).toLowerCase();
return q.split(/\s+/).every(w=>s.includes(w));
}):this.sidePool;
if(!document.getElementById('sideResults')){
let html=`<div style="position:sticky;top:0;z-index:10;background:var(--bg);padding:8px 0 12px">
<div style="font-size:0.8rem;font-weight:900;color:var(--cyan);margin-bottom:8px">ADD SIDE ITEM</div>
<input type="text" id="sideSearch" placeholder="Search all foods..." value="${query.replace(/"/g,'&quot;')}" oninput="app.filterSides()" style="width:100%;padding:12px 16px;background:var(--panel);border:1px solid var(--border);color:var(--text);border-radius:10px;font-size:0.95rem;outline:none;box-sizing:border-box">
<div style="font-size:0.6rem;color:var(--text-tertiary);margin-top:6px;text-align:center" id="sideCount">${filtered.length} items</div></div><div id="sideResults"></div>`;
document.getElementById('modalBody').innerHTML=html;
this.setText('modalTitle','ADD SIDE');
}else{
const countEl=document.getElementById('sideCount');
if(countEl)countEl.textContent=`${filtered.length} items`;
}
let items=filtered.slice(0,30).map(({m,pool,i})=>`<div class="menu-item" onclick="app.selectSide('${pool}',${i})"><div><div class="menu-name">${m.title}</div><div class="menu-meta">P:${m.macros.p}g F:${m.macros.f}g Î©3:${m.macros.o}mg Cal:${m.macros.cal}</div></div><div class="menu-arrow">+</div></div>`).join('');
if(filtered.length>30)items+=`<div style="text-align:center;padding:15px;color:var(--text-tertiary);font-size:0.75rem">Showing first 30 â€” type to narrow results</div>`;
items+=`<button onclick="app.showRecipe(app.currentMealSlot,app.currentMealIdx)" style="width:100%;background:var(--panel);color:var(--text);padding:15px;margin-top:15px;border:1px solid var(--border);border-radius:10px;font-weight:700;cursor:pointer">â† BACK TO MEAL</button>`;
document.getElementById('sideResults').innerHTML=items;
}

filterSides(){
const q=document.getElementById('sideSearch')?.value||'';
this.renderSidePicker(q);
}

selectSide(pool,idx){
const slot=this.sidePickerSlot;
const key=this.getSideKey(slot);
if(!this.sideItems[key])this.sideItems[key]=[];
const meal=MEALS[pool][idx];
this.sideItems[key].push({pool,idx,title:meal.title,macros:{...meal.macros}});
this.save();
this.showRecipe(this.currentMealSlot,this.currentMealIdx);
}

removeSide(slot,sideIdx){
const key=this.getSideKey(slot);
if(this.sideItems[key]){this.sideItems[key].splice(sideIdx,1);if(this.sideItems[key].length===0)delete this.sideItems[key]}
this.save();
this.showRecipe(this.currentMealSlot,this.currentMealIdx);
}

selectMeal(slot,idx){
const d=this.currentDateStr;
if(!this.meals[d])this.meals[d]={};
this.meals[d][slot]=idx;
if(['breakfast','lunch','dinner','snack1','snack2','snack3'].includes(slot)){if(!this.portions[d])this.portions[d]={};this.portions[d][slot]=this.currentPortion}
const protocolItem=this.protocol.find(p=>p.mealSlot===slot);
if(protocolItem){if(!this.checked[d])this.checked[d]=[];if(!this.checked[d].includes(protocolItem.id))this.checked[d].push(protocolItem.id)}
this.currentMealSlot=null;this.inRecipeView=false;this.currentPortion=1;
this.save();this.closeModal();this.render();
}

closeModal(){
if(this.inRecipeView&&this.currentMealSlot){this.inRecipeView=false;this.openMealPicker(this.currentMealSlot);return}
this.currentMealSlot=null;this.inRecipeView=false;
document.getElementById('mainModal').classList.remove('show');
}

openBio(){
this.setText('modalTitle','BIOMETRICS');
const w=this.bios.weight||'--';const bmr=this.bios.bmr||'--';
document.getElementById('modalBody').innerHTML=`<div style="padding:10px"><div style="display:grid;grid-template-columns:1fr 1fr;gap:12px">${['weight','bmr','apob','lpa','hscrp','hba1c','bodyfat','muscle'].map(f=>`<div style="background:var(--panel);padding:12px;border-radius:10px;border:1px solid var(--border)"><div style="font-size:0.6rem;color:var(--text-tertiary);margin-bottom:6px;font-weight:700">${f.toUpperCase()}</div><input id="bio-${f}" type="number" step="0.1" value="${this.bios[f]||''}" style="width:100%;padding:8px;background:var(--bg);border:1px solid var(--border);color:var(--text);border-radius:6px;font-size:1rem"></div>`).join('')}</div><button onclick="app.saveBio()" style="width:100%;background:linear-gradient(135deg,#c8ff00,#00d4ff);color:#000;padding:15px;margin-top:20px;border:none;border-radius:10px;font-weight:800">SAVE BIOMETRICS</button></div>`;
document.getElementById('mainModal').classList.add('show');
}

saveBio(){['weight','bmr','apob','lpa','hscrp','hba1c','bodyfat','muscle'].forEach(f=>{const el=document.getElementById(`bio-${f}`);if(el?.value)this.bios[f]=el.value});this.save();this.closeModal();this.render()}

showSynergyDashboard(){
this.setText('modalTitle','ðŸ’‘ COUPLES SYNERGY');
const last14=this.history.slice(0,14);
// Load the other user's data from localStorage
const otherUser=this.user==='jermaine'?'sophia':'jermaine';
const otherMeals=JSON.parse(localStorage.getItem(`c_meals_${otherUser}`)||'{}');
const otherChecked=JSON.parse(localStorage.getItem(`c_chk_${otherUser}`)||'{}');
const otherPortions=JSON.parse(localStorage.getItem(`c_portions_${otherUser}`)||'{}');
const myMeals=this.meals;
const myChecked=this.checked;
const myGoals=USERS[this.user].goals;
const otherGoals=USERS[otherUser].goals;
const dayNames=['Sun','Mon','Tue','Wed','Thu','Fri','Sat'];

// ========== SLEEP PATTERN ANALYSIS ==========
const sleepByDay=[0,0,0,0,0,0,0];
const sleepCountByDay=[0,0,0,0,0,0,0];
last14.forEach(d=>{
if(d.totalSec>0){
const dow=new Date(d.date+'T12:00:00').getDay();
sleepByDay[dow]+=d.totalSec/3600;
sleepCountByDay[dow]++;
}
});
const avgSleepByDay=sleepByDay.map((s,i)=>sleepCountByDay[i]>0?(s/sleepCountByDay[i]).toFixed(1):'--');
const bestSleepDay=avgSleepByDay.reduce((best,v,i)=>(v!=='--'&&(best.v==='--'||parseFloat(v)>parseFloat(best.v)))?{i,v}:best,{i:0,v:'--'});
const worstSleepDay=avgSleepByDay.reduce((worst,v,i)=>(v!=='--'&&(worst.v==='--'||parseFloat(v)<parseFloat(worst.v)))?{i,v}:worst,{i:0,v:'99'});

// ========== FIBER COMPLIANCE ==========
let fiberHitDays=0,fiberMissDays=0,fiberByDay=[0,0,0,0,0,0,0],fiberDayCount=[0,0,0,0,0,0,0];
last14.forEach(d=>{
const mac=this.calculateMacrosForDate(d.date);
if(mac.fiber>0){
const dow=new Date(d.date+'T12:00:00').getDay();
fiberByDay[dow]+=mac.fiber;
fiberDayCount[dow]++;
if(mac.fiber>=myGoals.fiber)fiberHitDays++;else fiberMissDays++;
}
});

// ========== WORKOUT SYNERGY ==========
let togetherWorkouts=0,soloWorkouts=0;
const workoutDays=[];
last14.forEach(d=>{
const myW=d.workouts.length>0;
const otherDate=d.date;
// Check if other user has workouts on same date (via Oura cache or localStorage)
const otherKey=`c_oura_${otherUser}`;
// We check by day-of-week pattern: Mon/Wed = together (Club Studio), Wed/Fri = Sophia Rebound
const dow=new Date(d.date+'T12:00:00').getDay();
const bothActive=(dow===1||dow===3||dow===5); // Mon/Wed/Fri Club Studio together
if(myW){
if(bothActive){togetherWorkouts++;workoutDays.push({date:d.date,type:'together',dow})}
else{soloWorkouts++;workoutDays.push({date:d.date,type:'solo',dow})}
}
});

// ========== BEDTIME ANALYSIS ==========
// Oura sleep data includes bedtime offset â€” we estimate from totalSec
const bedtimeInsights=[];
last14.forEach(d=>{
if(d.totalSec>0){
const hrs=(d.totalSec/3600).toFixed(1);
const dow=new Date(d.date+'T12:00:00').getDay();
bedtimeInsights.push({date:d.date,dow,sleep:parseFloat(hrs)});
}
});
// Weekend vs weekday sleep
const weekdaySleep=bedtimeInsights.filter(d=>d.dow>=1&&d.dow<=5);
const weekendSleep=bedtimeInsights.filter(d=>d.dow===0||d.dow===6);
const avgWeekday=weekdaySleep.length?(weekdaySleep.reduce((s,d)=>s+d.sleep,0)/weekdaySleep.length).toFixed(1):'--';
const avgWeekend=weekendSleep.length?(weekendSleep.reduce((s,d)=>s+d.sleep,0)/weekendSleep.length).toFixed(1):'--';

// ========== RENDER ==========
let html=`<div style="padding:10px">`;

// SLEEP PATTERNS
html+=`<div style="margin-bottom:25px">
<div style="font-size:0.75rem;font-weight:900;color:var(--purple);margin-bottom:12px">ðŸ˜´ SLEEP PATTERNS (${USERS[this.user].name})</div>
<div style="display:grid;grid-template-columns:repeat(7,1fr);gap:4px;margin-bottom:12px">
${dayNames.map((d,i)=>{
const v=avgSleepByDay[i];
const hrs=v==='--'?0:parseFloat(v);
const color=hrs>=7?'var(--success)':hrs>=6?'var(--cyan)':hrs>=5?'var(--orange)':'var(--alert)';
const bg=hrs>=7?'rgba(52,211,153,0.15)':hrs>=6?'rgba(0,212,255,0.1)':hrs>=5?'rgba(255,149,0,0.1)':'rgba(255,71,87,0.1)';
return`<div style="text-align:center;background:${bg};padding:8px 2px;border-radius:8px;border:1px solid ${color}30">
<div style="font-size:0.5rem;color:var(--text-tertiary)">${d}</div>
<div style="font-size:0.95rem;font-weight:800;color:${color}">${v}</div>
<div style="font-size:0.4rem;color:var(--text-tertiary)">hrs</div></div>`;
}).join('')}
</div>
<div style="display:flex;gap:8px">
<div style="flex:1;background:var(--panel);padding:10px;border-radius:8px;border:1px solid var(--border)">
<div style="font-size:0.5rem;color:var(--text-tertiary)">BEST NIGHT</div>
<div style="font-size:0.85rem;font-weight:800;color:var(--success)">${dayNames[bestSleepDay.i]} â†’ ${bestSleepDay.v}h</div>
</div>
<div style="flex:1;background:var(--panel);padding:10px;border-radius:8px;border:1px solid var(--border)">
<div style="font-size:0.5rem;color:var(--text-tertiary)">WORST NIGHT</div>
<div style="font-size:0.85rem;font-weight:800;color:var(--alert)">${dayNames[worstSleepDay.i]} â†’ ${worstSleepDay.v}h</div>
</div>
</div>
<div style="display:flex;gap:8px;margin-top:8px">
<div style="flex:1;background:var(--panel);padding:10px;border-radius:8px;border:1px solid var(--border)">
<div style="font-size:0.5rem;color:var(--text-tertiary)">WEEKDAY AVG</div>
<div style="font-size:0.85rem;font-weight:800;color:${parseFloat(avgWeekday)>=7?'var(--success)':'var(--orange)'}">${avgWeekday}h</div>
</div>
<div style="flex:1;background:var(--panel);padding:10px;border-radius:8px;border:1px solid var(--border)">
<div style="font-size:0.5rem;color:var(--text-tertiary)">WEEKEND AVG</div>
<div style="font-size:0.85rem;font-weight:800;color:${parseFloat(avgWeekend)>=7?'var(--success)':'var(--orange)'}">${avgWeekend}h</div>
</div>
</div>
</div>`;

// FIBER COMPLIANCE
const fiberPct=fiberHitDays+fiberMissDays>0?Math.round(fiberHitDays/(fiberHitDays+fiberMissDays)*100):0;
html+=`<div style="margin-bottom:25px">
<div style="font-size:0.75rem;font-weight:900;color:var(--success);margin-bottom:12px">ðŸ¥¦ FIBER COMPLIANCE (target: ${myGoals.fiber}g)</div>
<div style="display:flex;align-items:center;gap:12px;margin-bottom:10px">
<div style="font-size:2.5rem;font-weight:900;color:${fiberPct>=70?'var(--success)':fiberPct>=40?'var(--orange)':'var(--alert)'}">${fiberPct}%</div>
<div><div style="font-size:0.7rem;font-weight:700;color:var(--text)">${fiberHitDays} days hit / ${fiberHitDays+fiberMissDays} tracked</div>
<div style="font-size:0.55rem;color:var(--text-tertiary)">Last 14 days</div></div>
</div>
<div style="display:grid;grid-template-columns:repeat(7,1fr);gap:4px">
${dayNames.map((d,i)=>{
const avg=fiberDayCount[i]>0?Math.round(fiberByDay[i]/fiberDayCount[i]):0;
const hit=avg>=myGoals.fiber;
return`<div style="text-align:center;background:${hit?'rgba(52,211,153,0.15)':'rgba(255,71,87,0.08)'};padding:6px 2px;border-radius:6px;border:1px solid ${hit?'var(--success)30':'var(--alert)20'}">
<div style="font-size:0.45rem;color:var(--text-tertiary)">${d}</div>
<div style="font-size:0.75rem;font-weight:800;color:${hit?'var(--success)':'var(--alert)'}">${avg||'--'}g</div></div>`;
}).join('')}
</div>
</div>`;

// TRAINING SYNERGY
html+=`<div style="margin-bottom:25px">
<div style="font-size:0.75rem;font-weight:900;color:var(--cyan);margin-bottom:12px">ðŸ‹ï¸ TRAINING SYNERGY</div>
<div style="display:flex;gap:8px;margin-bottom:12px">
<div style="flex:1;background:rgba(168,85,247,0.1);padding:14px;border-radius:10px;border:1px solid rgba(168,85,247,0.3);text-align:center">
<div style="font-size:1.8rem;font-weight:900;color:var(--purple)">${togetherWorkouts}</div>
<div style="font-size:0.55rem;color:var(--text-tertiary)">TOGETHER</div>
<div style="font-size:0.45rem;color:var(--purple)">Mon/Wed/Fri Studio</div>
</div>
<div style="flex:1;background:rgba(0,212,255,0.1);padding:14px;border-radius:10px;border:1px solid rgba(0,212,255,0.3);text-align:center">
<div style="font-size:1.8rem;font-weight:900;color:var(--cyan)">${soloWorkouts}</div>
<div style="font-size:0.55rem;color:var(--text-tertiary)">SOLO</div>
<div style="font-size:0.45rem;color:var(--cyan)">Individual sessions</div>
</div>
</div>
<div style="font-size:0.55rem;color:var(--text-secondary);background:var(--panel);padding:10px;border-radius:8px;border:1px solid var(--border)">
${togetherWorkouts>soloWorkouts?
'ðŸ’ª Strong couples training sync. Joint sessions outpace solo â€” accountability is working.':
togetherWorkouts>0?
'âš ï¸ More solo than couples sessions. Try to protect Mon/Wed/Fri Club Studio together.':
'âŒ No joint training detected. Schedule at least 2 sessions together this week.'}
</div>
</div>`;

// PROTOCOL SYNC â€” are both logging meals on same days?
let bothLogged=0,onlyMe=0,onlyThem=0;
last14.forEach(d=>{
const myMealCount=Object.keys(myMeals[d.date]||{}).length;
const otherMealCount=Object.keys(otherMeals[d.date]||{}).length;
if(myMealCount>0&&otherMealCount>0)bothLogged++;
else if(myMealCount>0)onlyMe++;
else if(otherMealCount>0)onlyThem++;
});

html+=`<div style="margin-bottom:25px">
<div style="font-size:0.75rem;font-weight:900;color:var(--acid);margin-bottom:12px">ðŸ“‹ PROTOCOL SYNC</div>
<div style="display:flex;gap:6px">
<div style="flex:1;text-align:center;background:rgba(52,211,153,0.12);padding:12px 6px;border-radius:8px;border:1px solid rgba(52,211,153,0.3)">
<div style="font-size:1.5rem;font-weight:800;color:var(--success)">${bothLogged}</div>
<div style="font-size:0.45rem;color:var(--text-tertiary)">BOTH LOGGED</div>
</div>
<div style="flex:1;text-align:center;background:rgba(0,212,255,0.1);padding:12px 6px;border-radius:8px;border:1px solid rgba(0,212,255,0.2)">
<div style="font-size:1.5rem;font-weight:800;color:var(--cyan)">${onlyMe}</div>
<div style="font-size:0.45rem;color:var(--text-tertiary)">ONLY ${USERS[this.user].name.toUpperCase()}</div>
</div>
<div style="flex:1;text-align:center;background:rgba(255,149,0,0.1);padding:12px 6px;border-radius:8px;border:1px solid rgba(255,149,0,0.2)">
<div style="font-size:1.5rem;font-weight:800;color:var(--orange)">${onlyThem}</div>
<div style="font-size:0.45rem;color:var(--text-tertiary)">ONLY ${USERS[otherUser].name.toUpperCase()}</div>
</div>
</div>
<div style="font-size:0.55rem;color:var(--text-secondary);background:var(--panel);padding:10px;border-radius:8px;border:1px solid var(--border);margin-top:8px">
${bothLogged>=10?'ðŸ”¥ Protocol sync is strong â€” you\'re both logging consistently together.':
bothLogged>=5?'ðŸ‘ Decent sync. Aim to log meals together on the same days.':
'âš ï¸ Low sync. Sunday evening meal prep + planning together could fix this.'}
</div>
</div>`;

// KEY INSIGHTS
html+=`<div style="margin-bottom:15px">
<div style="font-size:0.75rem;font-weight:900;color:#fff;margin-bottom:12px">ðŸ§  KEY INSIGHTS</div>
<div style="display:flex;flex-direction:column;gap:6px">`;

// Sleep insight
if(parseFloat(avgWeekend)>parseFloat(avgWeekday)+0.5){
html+=`<div style="background:rgba(168,85,247,0.1);padding:10px;border-radius:8px;border-left:3px solid var(--purple);font-size:0.65rem;color:var(--text)">
<strong>Sleep debt recovery on weekends.</strong> You sleep ${(parseFloat(avgWeekend)-parseFloat(avgWeekday)).toFixed(1)}h more on weekends â€” your body is catching up. Moving weekday bedtime 30min earlier would be more effective than weekend sleep-ins.
</div>`;
}

// Fiber insight
if(fiberPct<60){
html+=`<div style="background:rgba(255,71,87,0.08);padding:10px;border-radius:8px;border-left:3px solid var(--alert);font-size:0.65rem;color:var(--text)">
<strong>Fiber compliance below 60%.</strong> Add psyllium to morning smoothie (5g) or swap one snack for hummus + veggies. Each 10g fiber increase drops ApoB ~3-5 points.
</div>`;
}

// Training insight
html+=`<div style="background:rgba(0,212,255,0.08);padding:10px;border-radius:8px;border-left:3px solid var(--cyan);font-size:0.65rem;color:var(--text)">
<strong>Couples training ratio: ${togetherWorkouts}:${soloWorkouts} (together:solo).</strong> ${togetherWorkouts>=soloWorkouts?'Strong accountability loop. Protect these joint sessions â€” they\'re the hardest to rebuild once lost.':'Increasing joint sessions improves adherence by 40% in longitudinal studies. Even a 20-min walk together counts.'}
</div>`;

html+=`</div></div>`;

html+=`<button onclick="app.showWeeklySummary()" style="width:100%;background:var(--panel);color:var(--text);padding:14px;border:1px solid var(--border);border-radius:10px;font-weight:700;cursor:pointer">â† BACK TO WEEKLY SUMMARY</button>`;
html+=`</div>`;
document.getElementById('modalBody').innerHTML=html;
document.getElementById('mainModal').classList.add('show');
}

showWeeklySummary(){
const last7=this.history.slice(0,7);
const goals=USERS[this.user].goals;
const daysWithData=last7.filter(d=>d.score>0);
const n=daysWithData.length||1;

// AVERAGES
const avgScore=Math.round(daysWithData.reduce((s,d)=>s+(d.score||0),0)/n);
const avgSleep=(daysWithData.reduce((s,d)=>s+d.totalSec,0)/n/3600).toFixed(1);
const avgDeep=(daysWithData.reduce((s,d)=>s+d.deepSec,0)/n/3600).toFixed(1);
const avgRem=(daysWithData.reduce((s,d)=>s+d.remSec,0)/n/3600).toFixed(1);
const rhrDays=daysWithData.filter(d=>d.rhr!=='-'&&d.rhr>0);
const avgRHR=rhrDays.length?Math.round(rhrDays.reduce((s,d)=>s+parseInt(d.rhr),0)/rhrDays.length):'--';
const hrvDays=daysWithData.filter(d=>d.hrv>0);
const avgHRV=hrvDays.length?Math.round(hrvDays.reduce((s,d)=>s+d.hrv,0)/hrvDays.length):'--';
const readyDays=daysWithData.filter(d=>d.readiness>0);
const avgReady=readyDays.length?Math.round(readyDays.reduce((s,d)=>s+d.readiness,0)/readyDays.length):'--';

// TOTALS
const totalZ2=Math.round(last7.reduce((s,d)=>s+(d.med||0),0));
const totalZ5=Math.round(last7.reduce((s,d)=>s+(d.high||0),0));
const totalCalBurn=Math.round(last7.reduce((s,d)=>s+(d.cal||0),0));
const realWorkoutTypes=['cs4','box','boxing','heat','h.e.a.t.','club dance','dance','ride','rebound','yoga sculpt','cs strength','strength','reform','hot pilates','pilates','barre','yoga flow','flow','hiit','running','cycling','swimming','weight training','walking'];
const totalWorkouts=last7.reduce((s,d)=>s+d.workouts.filter(w=>{const t=(w.type||'').toLowerCase();return realWorkoutTypes.includes(t)||w.calories>150}).length,0);

// NUTRITION TOTALS (from checked meals across 7 days â€” uses calculateMacrosForDate for accuracy)
let totalProtein=0,totalOmega3=0,totalFiber=0,totalCal=0,totalPoly=0;
last7.forEach(d=>{
const mac=this.calculateMacrosForDate(d.date);
totalProtein+=mac.protein;
totalOmega3+=mac.omega3;
totalFiber+=mac.fiber;
totalCal+=mac.calories;
totalPoly+=mac.polyphenol;
});

// WATER TOTAL
let totalWater=0;
last7.forEach(d=>{totalWater+=(this.water[d.date]||0)});

// STREAK
const streak=this.streak||0;

// DAILY BREAKDOWN SPARKLINE
const dayLabels=['S','M','T','W','T','F','S'];
const sparkData=last7.map(d=>{
const dow=new Date(d.date+'T12:00:00').getDay();
return{label:dayLabels[dow],score:d.score||0,sleep:(d.totalSec/3600).toFixed(1),z2:d.med||0,rhr:d.rhr!=='-'?d.rhr:'--',hrv:d.hrv||'--'};
}).reverse();

const scoreColor=s=>s>=85?'var(--success)':s>=70?'var(--cyan)':s>=50?'var(--orange)':'var(--alert)';
const pctBar=(val,max,color)=>`<div style="height:4px;background:var(--panel-elevated);border-radius:2px;margin-top:4px"><div style="height:100%;width:${Math.min(100,val/max*100)}%;background:${color};border-radius:2px"></div></div>`;

const stat=(label,val,unit,color)=>`<div style="background:var(--panel);padding:14px 10px;border-radius:12px;border:1px solid var(--border);text-align:center"><div style="font-size:1.4rem;font-weight:800;color:${color}">${val}<span style="font-size:0.6rem;font-weight:600">${unit}</span></div><div style="font-size:0.55rem;color:var(--text-tertiary);margin-top:4px;text-transform:uppercase">${label}</div></div>`;

const totalStat=(label,val,unit,color,target)=>{
const pct=target?Math.min(100,val/target*100):100;
return`<div style="background:var(--panel);padding:12px 10px;border-radius:10px;border:1px solid var(--border)"><div style="display:flex;justify-content:space-between;align-items:baseline"><div style="font-size:0.55rem;color:var(--text-tertiary);text-transform:uppercase">${label}</div><div style="font-size:0.9rem;font-weight:800;color:${color}">${val}<span style="font-size:0.5rem;font-weight:600">${unit}</span></div></div>${target?`<div style="height:3px;background:var(--panel-elevated);border-radius:2px;margin-top:6px"><div style="height:100%;width:${pct}%;background:${color};border-radius:2px"></div></div><div style="font-size:0.45rem;color:var(--text-tertiary);margin-top:3px;text-align:right">target: ${target}${unit}/wk</div>`:''}</div>`;
};

this.setText('modalTitle','7-DAY COMMAND CENTER');
document.getElementById('modalBody').innerHTML=`<div style="padding:10px">

<div style="text-align:center;margin-bottom:20px">
<div style="font-size:3rem;font-weight:800;background:linear-gradient(135deg,#c8ff00,#00d4ff);-webkit-background-clip:text;-webkit-text-fill-color:transparent">${avgScore}</div>
<div style="font-size:0.7rem;color:var(--text-tertiary)">AVG LONGEVITY SCORE</div>
<div style="font-size:0.6rem;color:var(--text-secondary);margin-top:4px">${n} days tracked Â· ${streak} day streak</div>
</div>

<div style="font-size:0.6rem;font-weight:700;color:var(--text-tertiary);letter-spacing:1.5px;margin:16px 0 8px">RECOVERY AVERAGES</div>
<div style="display:grid;grid-template-columns:repeat(3,1fr);gap:8px">
${stat('Avg Sleep',avgSleep,'h','var(--cyan)')}
${stat('Avg RHR',avgRHR,'','var(--alert)')}
${stat('Avg HRV',avgHRV,'ms','var(--success)')}
</div>
<div style="display:grid;grid-template-columns:repeat(3,1fr);gap:8px;margin-top:8px">
${stat('Deep Sleep',avgDeep,'h','var(--purple)')}
${stat('REM Sleep',avgRem,'h','var(--cyan)')}
${stat('Readiness',avgReady,'','var(--success)')}
</div>

<div style="font-size:0.6rem;font-weight:700;color:var(--text-tertiary);letter-spacing:1.5px;margin:20px 0 8px">TRAINING TOTALS</div>
<div style="display:grid;grid-template-columns:repeat(4,1fr);gap:8px">
${stat('Workouts',totalWorkouts,'','var(--acid)')}
${stat('Zone 2',totalZ2,'m','var(--cyan)')}
${stat('Zone 5',totalZ5,'m','var(--alert)')}
${stat('Cal Burn',totalCalBurn,'','var(--orange)')}
</div>

<div style="font-size:0.6rem;font-weight:700;color:var(--text-tertiary);letter-spacing:1.5px;margin:20px 0 8px">NUTRITION TOTALS</div>
<div style="display:grid;grid-template-columns:1fr 1fr;gap:8px">
${totalStat('Protein',Math.round(totalProtein),'g','#fff',goals.protein*7)}
${totalStat('Omega-3',Math.round(totalOmega3/1000),'k mg','var(--cyan)',goals.omega3*7/1000)}
${totalStat('Fiber',Math.round(totalFiber),'g','var(--success)',goals.fiber*7)}
${totalStat('Polyphenols',Math.round(totalPoly),'mg','var(--purple)',goals.poly*7)}
</div>
<div style="display:grid;grid-template-columns:1fr 1fr;gap:8px;margin-top:8px">
${totalStat('Water',totalWater,'oz','var(--cyan)',goals.water*7)}
${(()=>{
const bmr=parseFloat(this.bios.bmr||2000);
const weeklyBurn=bmr*7+totalCalBurn;
const weeklyNet=Math.round(totalCal-weeklyBurn);
const isDeficit=weeklyNet<0;
const color=isDeficit?'var(--success)':'var(--orange)';
const label=isDeficit?'DEFICIT':'SURPLUS';
const dailyAvg=Math.round(weeklyNet/7);
return`<div style="background:var(--panel);padding:12px 10px;border-radius:10px;border:1px solid var(--border)"><div style="display:flex;justify-content:space-between;align-items:baseline"><div style="font-size:0.55rem;color:var(--text-tertiary);text-transform:uppercase">Cal ${label}</div><div style="font-size:0.9rem;font-weight:800;color:${color}">${isDeficit?'':'+'}${weeklyNet}</div></div><div style="font-size:0.45rem;color:var(--text-tertiary);margin-top:6px">Eaten: ${Math.round(totalCal)} Â· Burned: ${Math.round(weeklyBurn)} (BMR ${Math.round(bmr*7)} + Active ${totalCalBurn})</div><div style="font-size:0.45rem;color:${color};margin-top:3px">${isDeficit?'':'+'}${dailyAvg}/day avg â†’ ${isDeficit?Math.round(Math.abs(weeklyNet)/3500*10)/10+'lb/wk loss est':'gaining'}</div></div>`;
})()}
</div>

<div style="font-size:0.6rem;font-weight:700;color:var(--text-tertiary);letter-spacing:1.5px;margin:20px 0 8px">DAILY BREAKDOWN</div>
<div style="display:grid;grid-template-columns:repeat(7,1fr);gap:4px">
${sparkData.map(d=>`<div style="text-align:center;background:var(--panel);padding:8px 2px;border-radius:8px;border:1px solid var(--border)">
<div style="font-size:0.5rem;color:var(--text-tertiary);font-weight:700">${d.label}</div>
<div style="font-size:0.85rem;font-weight:800;color:${scoreColor(d.score)};margin:4px 0">${d.score||'â€”'}</div>
<div style="font-size:0.45rem;color:var(--text-tertiary)">${d.sleep}h</div>
<div style="font-size:0.45rem;color:var(--cyan)">${d.z2}m Z2</div>
<div style="font-size:0.45rem;color:var(--alert)">â™¡${d.rhr}</div>
</div>`).join('')}
</div>

<button onclick="app.showSynergyDashboard()" style="width:100%;background:var(--panel);color:var(--purple);padding:14px;border:1px solid var(--purple);border-radius:12px;font-weight:800;margin-top:15px;font-size:0.8rem;cursor:pointer">ðŸ’‘ COUPLES SYNERGY DASHBOARD</button>

<button onclick="app.closeModal()" style="width:100%;background:linear-gradient(135deg,#c8ff00,#00d4ff);color:#000;padding:16px;border:none;border-radius:12px;font-weight:800;margin-top:10px;font-size:0.8rem">CLOSE</button>
</div>`;
document.getElementById('mainModal').classList.add('show');
}

// ============================================================================
// v21 WORKOUT IMPACT DATABASE
// ============================================================================
getWorkoutImpact(workoutType){
const type=workoutType.toLowerCase();
const database={
'cs4':{impact:'high',zones:['full-body','cardio','joints'],intensity:10,recovery:'cryo+sauna+massage'},
'box':{impact:'high',zones:['upper-body','shoulders','cardio','footwork'],intensity:9,recovery:'cryo+sauna'},
'boxing':{impact:'high',zones:['upper-body','shoulders','cardio','footwork'],intensity:9,recovery:'cryo+sauna'},
'h.e.a.t.':{impact:'high',zones:['full-body','explosive-power','agility'],intensity:9,recovery:'cryo+massage'},
'heat':{impact:'high',zones:['full-body','explosive-power','agility'],intensity:9,recovery:'cryo+massage'},
'club dance':{impact:'high',zones:['cardio','legs','coordination'],intensity:9,recovery:'ice+normatec'},
'dance':{impact:'high',zones:['cardio','legs','coordination'],intensity:9,recovery:'ice+normatec'},
'ride':{impact:'low',zones:['legs','cardio','hip-flexors'],intensity:8,recovery:'normatec+stretch'},
'rebound':{impact:'low',zones:['legs','core','cardio','lymphatic'],intensity:8,recovery:'normatec+hydration'},
'yoga sculpt':{impact:'low',zones:['full-body','strength','heat-stress'],intensity:8,recovery:'sauna+stretch+hydration'},
'cs strength':{impact:'low',zones:['muscular-strength','joints'],intensity:8,recovery:'massage+ice'},
'strength':{impact:'low',zones:['muscular-strength','joints'],intensity:8,recovery:'massage+ice'},
'reform':{impact:'low',zones:['core','glutes','stabilizers'],intensity:6,recovery:'stretch+optional'},
'hot pilates':{impact:'low',zones:['core','full-body','heat-stress'],intensity:7,recovery:'hydration+stretch'},
'pilates':{impact:'low',zones:['core','full-body'],intensity:5,recovery:'stretch+optional'},
'barre':{impact:'low',zones:['glutes','legs','isometric'],intensity:6,recovery:'stretch+normatec'},
'yoga flow':{impact:'low',zones:['flexibility','core','balance'],intensity:6,recovery:'optional'},
'flow':{impact:'low',zones:['flexibility','core','balance'],intensity:6,recovery:'optional'},
'yoga restore':{impact:'none',zones:['mobility','connective-tissue'],intensity:3,recovery:'none'},
'restore':{impact:'none',zones:['mobility','connective-tissue'],intensity:3,recovery:'none'},
'cryo':{impact:'none',zones:['cellular-repair','inflammation'],intensity:1,recovery:'none',thermal:'cold'},
'cold_exposure':{impact:'none',zones:['cellular-repair','inflammation','vasoconstriction'],intensity:1,recovery:'none',thermal:'cold'},
'cold exposure':{impact:'none',zones:['cellular-repair','inflammation','vasoconstriction'],intensity:1,recovery:'none',thermal:'cold'},
'sauna':{impact:'none',zones:['heat-stress','detox','cardiovascular','growth-hormone'],intensity:2,recovery:'hydration',thermal:'heat'},
'infrared sauna':{impact:'none',zones:['heat-stress','detox','deep-tissue'],intensity:2,recovery:'hydration',thermal:'heat'},
'contrast':{impact:'none',zones:['vasodilation','vasoconstriction','recovery'],intensity:2,recovery:'none',thermal:'contrast'},
'recovery':{impact:'none',zones:['cellular-repair'],intensity:1,recovery:'none'},
'hiit':{impact:'high',zones:['full-body','cardio'],intensity:9,recovery:'cryo+sauna'},
'running':{impact:'medium',zones:['legs','joints','cardio'],intensity:7,recovery:'normatec+ice'},
'cycling':{impact:'low',zones:['legs','hip-flexors'],intensity:7,recovery:'normatec'},
'walking':{impact:'low',zones:['cardio'],intensity:3,recovery:'optional'},
'other':{impact:'medium',zones:['unknown'],intensity:5,recovery:'massage'}
};
return database[type]||database['other'];
}

// ============================================================================
// v21 SMART RECOVERY (workout-aware)
// ============================================================================
getSmartRecovery(day){
const workouts=day.workouts||[];
if(workouts.length===0)return null;
let maxImpact=0;let workoutNames=[];
workouts.forEach(w=>{const impact=this.getWorkoutImpact(w.type);maxImpact=Math.max(maxImpact,impact.intensity);workoutNames.push(w.type.toUpperCase())});
let protocol={time:'6:30 PM',title:'',desc:'',type:'clubstudio'};
if(maxImpact>=9){
protocol.title='ðŸ”¥ FULL RECOVERY PROTOCOL';
protocol.desc=`Post-${workoutNames[0]} | Club Studio: Cryo â†’ Sauna â†’ Massage | Home: Theragun â†’ Normatec`;
}else if(maxImpact>=8){
protocol.title='ðŸ’ª ACTIVE RECOVERY';
protocol.desc=`Post-${workoutNames[0]} | Club Studio: Sauna â†’ Local Cryo | Home: Normatec 30min`;
}else if(maxImpact>=6){
protocol.title='âœ¨ MAINTENANCE RECOVERY';
protocol.desc=`Post-${workoutNames[0]} | Massage Bed 20min | Home: Normatec + Stretch`;
}else if(maxImpact>=4){
protocol.title='ðŸŒ™ LIGHT RECOVERY';
protocol.desc='Optional stretch or massage bed';
}else{return null}
return protocol;
}

// ============================================================================
// v21 DAY-OF-WEEK RECOVERY FALLBACKS
// ============================================================================
getEveningRecovery(d,hadW,wType){
if(this.user==='jermaine'){
if(d===0)return{time:'2:00 PM',title:'ðŸŠ InShape',desc:'Full ritual',type:'clubstudio'};
if((d===2||d===4)&&hadW)return{time:'7:30 PM',title:'ðŸ¥Š Post-Boxing',desc:'Club Studio: Cryo + Sauna OR Home: Theragun + Normatec',type:'clubstudio'};
if(d===2||d===4)return{time:'6:30 PM',title:'ðŸ”µ Cupping',desc:'Both 15min each + Hyperice after',type:'cupping'};
if(d===1&&hadW)return{time:'7:00 PM',title:'ðŸ’ª Post-Lift',desc:'Club Studio: Cryo + Sauna OR Home: Full stack',type:'clubstudio'};
if(d===3)return{time:'6:30 PM',title:'ðŸ§˜ Mid-Week Recovery',desc:'Sauna 20min + Local Cryo + Massage Bed',type:'clubstudio'};
return{time:'6:30 PM',title:'âœ¨ Light Recovery',desc:'Massage bed 20min OR Normatec 30min',type:'clubstudio'}}
if(this.user==='sophia'){
if(d===0)return{time:'2:00 PM',title:'ðŸŠ InShape',desc:'Together',type:'clubstudio'};
if((d===3||d===5)&&hadW)return{time:'7:00 PM',title:'ðŸƒ Post-Rebound',desc:'Cryo + Sauna OR Theragun + Normatec',type:'clubstudio'};
if(d===2||d===4)return{time:'6:30 PM',title:'ðŸ”µ Cupping',desc:'Both 15min + Hyperice',type:'cupping'};
if(d===1)return{time:'6:30 PM',title:'ðŸ’ª Recovery Day',desc:'Massage bed + Sauna OR Normatec',type:'clubstudio'};
return{time:'6:30 PM',title:'âœ¨ Light Recovery',desc:'Optional',type:'clubstudio'}}
return null}

// ============================================================================
// v21 FACIAL PROTOCOLS
// ============================================================================
getEndOfDayFacial(d,isFirstWeek){
if(this.user==='jermaine'){
if(d===0&&isFirstWeek)return{title:'ðŸ“ Sophia Needle',desc:'45min - SPF 24hrs',type:'microneedling'};
if(d===1||d===3||d===5||d===0)return{title:'âš¡ Sophia Micro',desc:'Lift + Tone',type:'microcurrent'};
if(d===2||d===4)return{title:'ðŸ’† Sophia Massage',desc:'Hand + Wands',type:'massage'};
return{title:'âœ¨ Sophia Maint',desc:'Optional',type:'massage'}}
if(this.user==='sophia'){
if(d===1||d===3||d===5||d===0)return{title:'âš¡ Jermaine Micro',desc:'Jawline focus',type:'microcurrent'};
if(d===2||d===4)return{title:'ðŸ’ª Jermaine Recovery',desc:'Cold + Jaw massage',type:'massage'};
return{title:'âœ¨ Jermaine Maint',desc:'Optional',type:'massage'}}
return null}

// ============================================================================
// v21 LUNCH RECOVERY (stretching)
// ============================================================================
getLunchRecovery(dow){
if(this.user==='jermaine'&&(dow===1||dow===3||dow===5))return{title:'ðŸ§˜ Hip Flexor',desc:'5min stretch',type:'hipflexor',clickable:true};
if(this.user==='jermaine'&&(dow===2||dow===4))return{title:'ðŸ¦¾ Shoulder',desc:'5min mobility',type:'shoulder',clickable:true};
return null}

// ============================================================================
// THERMAL EXPOSURE DETECTION (Sauna + Cryo)
// ============================================================================
detectThermalExposure(day){
const result={sauna:false,cryo:false,contrast:false,source:[]};
// 1. Check Oura workout labels
(day.workouts||[]).forEach(w=>{
const t=w.type.toLowerCase();
const impact=this.getWorkoutImpact(t);
if(impact.thermal==='heat'||t.includes('sauna')){result.sauna=true;result.source.push('Oura: '+w.type)}
if(impact.thermal==='cold'||t.includes('cryo')||t.includes('cold')){result.cryo=true;result.source.push('Oura: '+w.type)}
if(impact.thermal==='contrast'||t.includes('contrast')){result.contrast=true;result.sauna=true;result.cryo=true;result.source.push('Oura: Contrast')}
});
// 2. Check manual quick-log
const thermalLog=this.getThermalLog(day.date);
if(thermalLog.sauna){result.sauna=true;result.source.push('Logged: Sauna')}
if(thermalLog.cryo){result.cryo=true;result.source.push('Logged: Cryo')}
// 3. Temperature pattern detection (next-morning signal)
if(day.tempDev>0.3&&!result.sauna){result.possibleSauna=true}
return result;
}

getThermalLog(date){
const logs=JSON.parse(localStorage.getItem(`c_thermal_${this.user}`)||'{}');
return logs[date]||{};
}

logThermal(type){
const d=this.currentDateStr;
const logs=JSON.parse(localStorage.getItem(`c_thermal_${this.user}`)||'{}');
if(!logs[d])logs[d]={};
logs[d][type]=logs[d][type]?false:true;
if(!logs[d][type])delete logs[d][type];
if(Object.keys(logs[d]).length===0)delete logs[d];
localStorage.setItem(`c_thermal_${this.user}`,JSON.stringify(logs));
// Auto-check the protocol item
const id=type==='sauna'?'thermal_sauna':type==='cryo'?'thermal_cryo':'thermal_contrast';
if(!this.checked[d])this.checked[d]=[];
if(logs[d]?.[type]){if(!this.checked[d].includes(id))this.checked[d].push(id)}
else{const i=this.checked[d].indexOf(id);if(i!==-1)this.checked[d].splice(i,1)}
this.save();
this.render();
}

getThermalInsights(day,thermal){
let insights='';
// Sauna detected + elevated temp = expected
if(thermal.sauna&&day.tempDev>0.3){
insights+=`<div class="insight-card" style="border-left:3px solid var(--success)"><div class="insight-header"><span class="insight-icon">ðŸ”¥</span><span class="insight-title">Sauna Recovery Active</span></div><div class="insight-body">Temp +${(day.tempDev).toFixed(1)}Â° consistent with sauna session. Heat stress proteins activated.</div><div class="insight-action">â†’ Hydrate extra 24oz, electrolytes recommended</div></div>`;
}
// Cryo detected
if(thermal.cryo){
insights+=`<div class="insight-card" style="border-left:3px solid var(--cyan)"><div class="insight-header"><span class="insight-icon">â„ï¸</span><span class="insight-title">Cryo Recovery Logged</span></div><div class="insight-body">Cold exposure boosts norepinephrine 200-300%. Inflammation reduction active.</div><div class="insight-action">â†’ Allow 10min natural rewarming, avoid hot shower immediately</div></div>`;
}
// Elevated temp but NO sauna = possible illness/overtraining
if(day.tempDev>0.5&&!thermal.sauna&&!thermal.possibleSauna){
insights+=`<div class="insight-card warning"><div class="insight-header"><span class="insight-icon">ðŸŒ¡ï¸</span><span class="insight-title">Unexplained Temperature Elevation</span></div><div class="insight-body">Temp is +${(day.tempDev).toFixed(1)}Â° with no Sauna logged. May indicate illness or overtraining.</div><div class="insight-action">â†’ Monitor symptoms, reduce intensity, consider rest day</div></div>`;
}else if(thermal.possibleSauna&&day.tempDev>0.3){
insights+=`<div class="insight-card" style="border-left:3px solid var(--orange)"><div class="insight-header"><span class="insight-icon">ðŸ¤”</span><span class="insight-title">Possible Sauna Detected</span></div><div class="insight-body">Temp +${(day.tempDev).toFixed(1)}Â° â€” did you do a Sauna session? Tap below to log it.</div></div>`;
}
return insights;
}

// ============================================================================
// AI WORKOUT RECOMMENDATION
// ============================================================================
getRecommendedWorkout(day,dow,hrvLow,thermal){
const goals=USERS[this.user].goals;
const readiness=day.readiness||70;
const sleepHrs=(day.totalSec||0)/3600;
const hrvBaseline=this.calculatedHrvBaseline||USERS[this.user].hrvBaseline;
const hrvPct=day.hrv?(day.hrv/hrvBaseline*100):100;
const hadWorkout=day.workouts.length>0;
const z2Done=day.med||0;
const z5Done=day.high||0;
const z2Need=goals.z2-z2Done;
const z5Need=goals.z5-z5Done;

// Already worked out today
if(hadWorkout){
const types=day.workouts.map(w=>w.type.toUpperCase()).join(', ');
const totalCal=day.workouts.reduce((s,w)=>s+(w.calories||0),0);
let recov=thermal.sauna?'Sauna âœ“':'Add Sauna 20min';
if(z2Need>15)recov+=` + ${Math.round(z2Need)}min walk`;
return{icon:'âœ…',title:types+' Complete',detail:`${totalCal} cal burned | Z2: ${Math.round(z2Done)}/${goals.z2}min | Z5: ${Math.round(z5Done)}/${goals.z5}min`,why:`Recovery: ${recov}`,bg:'rgba(52,211,153,0.15)',border:'var(--success)'};
}

// HRV critically low or readiness <60 = full rest
if(hrvLow||readiness<60){
return{icon:'ðŸ’œ',title:'Active Recovery Only',detail:`HRV ${day.hrv||'--'}ms (${Math.round(hrvPct)}%) | Readiness: ${readiness} | Sleep: ${sleepHrs.toFixed(1)}h`,why:'Walk 30min Z2 + Sauna 20min + Cryo 3min. Skip all HIIT.',bg:'rgba(168,85,247,0.15)',border:'var(--purple)'};
}

// Sleep deprived = low intensity
if(sleepHrs<6){
return{icon:'ðŸ˜´',title:'Low Intensity - Sleep Deficit',detail:`Only ${sleepHrs.toFixed(1)}h sleep | Z2 walk or light yoga recommended`,why:'Yoga Flow, Walking, or Reform. Avoid high-impact.',bg:'rgba(255,149,0,0.15)',border:'var(--orange)'};
}

// User-specific day-of-week + readiness-aware
if(this.user==='jermaine'){
if(dow===0)return{icon:'ðŸŠ',title:'InShape + Recovery',detail:'Pool â†’ Sauna â†’ Cryo â†’ Massage Bed',why:`Readiness ${readiness} â€” full recovery ritual`,bg:'rgba(0,212,255,0.12)',border:'var(--cyan)'};
if(dow===1||dow===3){
if(readiness>=75)return{icon:'ðŸ¥Š',title:'Boxing / CS4 (High Intensity)',detail:`Readiness ${readiness} âœ“ | HRV ${Math.round(hrvPct)}% | Target: Z5 ${goals.z5}min`,why:`Strong recovery metrics â†’ push Zone 5 today`,bg:'rgba(255,71,87,0.12)',border:'var(--alert)'};
return{icon:'ðŸ’ª',title:'CS Strength / Reform',detail:`Readiness ${readiness} â€” moderate. Save HIIT for better recovery day.`,why:'Strength + Zone 2 walk after',bg:'rgba(255,149,0,0.12)',border:'var(--orange)'};
}
if(dow===2||dow===4){
if(readiness>=80&&z5Need>5)return{icon:'ðŸ”¥',title:'H.E.A.T. / Club Dance',detail:`Readiness ${readiness} âœ“ | Z5 gap: ${Math.round(z5Need)}min`,why:'High readiness â€” explosive cardio day',bg:'rgba(255,71,87,0.12)',border:'var(--alert)'};
return{icon:'ðŸš´',title:'Ride / Rebound',detail:`Z2 focus: ${Math.round(z2Need)}min remaining | Readiness ${readiness}`,why:'Steady cardio, protect recovery for tomorrow',bg:'rgba(0,212,255,0.12)',border:'var(--cyan)'};
}
if(dow===5){
if(readiness>=70)return{icon:'ðŸ¥Š',title:'Boxing / CS4 (High Intensity)',detail:`Friday push | Readiness ${readiness} | HRV ${Math.round(hrvPct)}%`,why:'End-of-week intensity at Club Studio',bg:'rgba(255,71,87,0.12)',border:'var(--alert)'};
return{icon:'ðŸ§˜',title:'Yoga Sculpt / Hot Pilates',detail:`Readiness ${readiness} â€” save energy for weekend`,why:'Heat-based flexibility + core',bg:'rgba(168,85,247,0.12)',border:'var(--purple)'};
}
if(dow===6){
return{icon:'ðŸš¶',title:'Active Recovery Walk',detail:`Z2: ${Math.round(z2Need>0?z2Need:30)}min outdoor walk`,why:'Saturday reset. Sauna + Cryo if available.',bg:'rgba(52,211,153,0.12)',border:'var(--success)'};
}
}

if(this.user==='sophia'){
if(dow===0)return{icon:'ðŸŠ',title:'InShape Together',detail:'Pool â†’ Sauna â†’ Cryo',why:`Recovery day with Jermaine`,bg:'rgba(0,212,255,0.12)',border:'var(--cyan)'};
if(dow===1||dow===3){
if(readiness>=75)return{icon:'ðŸ”¥',title:'Rebound / H.E.A.T.',detail:`Readiness ${readiness} âœ“ | Cardio + explosive power`,why:'Strong day â€” full intensity',bg:'rgba(255,71,87,0.12)',border:'var(--alert)'};
return{icon:'ðŸ§˜',title:'Barre / Reform',detail:`Readiness ${readiness} â€” moderate intensity`,why:'Core + glutes, save energy',bg:'rgba(168,85,247,0.12)',border:'var(--purple)'};
}
if(dow===2||dow===4){
return{icon:'ðŸ§˜',title:'Yoga Flow / Hot Pilates',detail:`Mid-week balance | Readiness ${readiness}`,why:'Flexibility + core strength',bg:'rgba(168,85,247,0.12)',border:'var(--purple)'};
}
if(dow===5){
if(readiness>=70)return{icon:'ðŸ’ƒ',title:'Club Dance / Rebound',detail:`Friday energy | Readiness ${readiness}`,why:'End-of-week cardio burst',bg:'rgba(255,71,87,0.12)',border:'var(--alert)'};
return{icon:'ðŸš¶',title:'Walking + Stretch',detail:'Low key Friday',why:'Save energy for the weekend',bg:'rgba(52,211,153,0.12)',border:'var(--success)'};
}
if(dow===6)return{icon:'ðŸš¶',title:'Active Recovery',detail:`Z2 walk ${Math.round(z2Need>0?z2Need:20)}min`,why:'Weekend reset',bg:'rgba(52,211,153,0.12)',border:'var(--success)'};
}

return{icon:'ðŸƒ',title:'Zone 2 Cardio',detail:`${Math.round(z2Need>0?z2Need:30)}min walk or light jog`,why:'Base aerobic maintenance',bg:'rgba(52,211,153,0.12)',border:'var(--success)'};
}

// ============================================================================
// AI MEAL RECOMMENDATIONS (biomarker + recovery + macro-gap aware)
// ============================================================================
getRecommendedMeals(day,mac,hrvLow){
const goals=USERS[this.user].goals;
const apob=parseFloat(this.bios.apob||0);
const lpa=parseFloat(this.bios.lpa||0);
const hscrp=parseFloat(this.bios.hscrp||0);
const sel=this.meals[this.currentDateStr]||{};
const recommendations=[];

// Build recent meal history (last 5 days) for variety
const recentMeals={};
const today=new Date(this.currentDateStr+'T12:00:00');
for(let i=1;i<=5;i++){
const d=new Date(today);d.setDate(d.getDate()-i);
const dk=d.toLocaleDateString('en-CA');
const dayMeals=this.meals[dk]||{};
Object.keys(dayMeals).forEach(slot=>{
if(!recentMeals[slot])recentMeals[slot]=[];
recentMeals[slot].push({idx:dayMeals[slot],daysAgo:i});
});
}

// Compute what's already been selected
const proteinSoFar=mac.protein;
const omega3SoFar=mac.omega3;
const fiberSoFar=mac.fiber;
const calSoFar=mac.calories;

// Priority needs
const needs=[];
const ana=this.bios.ana||'';
if(lpa>150)needs.push('omega3');
if(apob>80)needs.push('apob_attack');
if(apob>100)needs.push('fiber');
if(hscrp>1.0)needs.push('polyphenol');
if(ana==='positive'){needs.push('omega3');needs.push('anti-inflammatory');needs.push('polyphenol')}
if(goals.protein-proteinSoFar>30)needs.push('protein');
if(goals.omega3-omega3SoFar>1000)needs.push('omega3');
if(goals.fiber-fiberSoFar>10)needs.push('fiber');
if(hrvLow)needs.push('anti-inflammatory');

const scoreMeal=(meal,idx,slot)=>{
let score=0;
const m=meal.macros||{};
const isBeverage=slot.startsWith('juice');
if(needs.includes('protein'))score+=(m.p||0)*2;
if(needs.includes('omega3'))score+=(m.o||0)/100;
if(needs.includes('fiber'))score+=(m.f||0)*3;
if(needs.includes('polyphenol'))score+=(m.poly||0)/10;
if(needs.includes('anti-inflammatory')){score+=(m.o||0)/200;score+=(m.poly||0)/20;if(meal.colors?.includes('green'))score+=10}
// ApoB Attack: heavy fiber weighting + omega-3 + ingredient bonus for bile-acid binders
if(needs.includes('apob_attack')){
score+=(m.f||0)*4;
score+=(m.o||0)/150;
const ing=(meal.ingredients||[]).join(' ').toLowerCase();
if(ing.includes('oat'))score+=15;
if(ing.includes('psyllium'))score+=20;
if(ing.includes('barley'))score+=15;
if(ing.includes('flax'))score+=12;
if(ing.includes('bean')||ing.includes('lentil')||ing.includes('chickpea'))score+=12;
if(ing.includes('edamame')||ing.includes('soy'))score+=12;
if(ing.includes('almond')||ing.includes('walnut'))score+=10;
if(ing.includes('avocado'))score+=8;
if(ing.includes('olive oil'))score+=8;
if(ing.includes('chia'))score+=10;
if(ing.includes('apple'))score+=8;
if(ing.includes('salmon')||ing.includes('sardine'))score+=12;
if(ing.includes('quinoa'))score+=6;
if(ing.includes('kale')||ing.includes('spinach'))score+=6;
}
// Beverages: weight polyphenols much higher, and prefer low-cal options
if(isBeverage){score+=(m.poly||0)/5;if((m.cal||0)<80)score+=10}
// Bonus for rainbow colors not yet hit
const existingColors=this.calcRainbow();
(meal.colors||[]).forEach(c=>{if(!existingColors.has(c))score+=8});
// Variety penalty: reduce score for recently eaten meals
const recent=recentMeals[slot]||[];
recent.forEach(r=>{if(r.idx===idx){
const penalty=r.daysAgo===1?40:r.daysAgo===2?25:r.daysAgo<=4?12:6;
score-=penalty;
}});
return score;
};

const whyMeal=(meal)=>{
const reasons=[];
const m=meal.macros||{};
if(needs.includes('protein')&&m.p>=20)reasons.push(`P:${m.p}g`);
if(needs.includes('omega3')&&m.o>=500)reasons.push(`Î©3:${m.o}mg`);
if(needs.includes('fiber')&&m.f>=5)reasons.push(`Fiber:${m.f}g`);
if(needs.includes('polyphenol')&&m.poly>=50)reasons.push('Polyphenols');
if(needs.includes('apob_attack')&&(m.f>=8||m.o>=1000))reasons.push('ApoBâ†“');
if(hrvLow&&m.o>=500)reasons.push('Anti-inflammatory');
const existingColors=this.calcRainbow();
const newColors=(meal.colors||[]).filter(c=>!existingColors.has(c));
if(newColors.length)reasons.push(`+${newColors.length} rainbow`);
return reasons.length?reasons.join(' â€¢ '):'Balanced nutrition';
};

const slots=['breakfast','juice2','snack1','lunch','snack2','juice3','snack3','dinner'];
const slotLabels={breakfast:'Breakfast',juice2:'Morning Beverage',snack1:'AM Snack',lunch:'Lunch',snack2:'PM Snack',juice3:'Afternoon Beverage',snack3:'Evening Snack',dinner:'Dinner'};

// Track picks from shared pools to prevent doubling
const pickedFromPool={};

slots.forEach(slot=>{
const pool=MEALS[slot]||[];
if(pool.length===0)return;
const alreadySelected=sel[slot]!==undefined;

// Score and rank all meals in this slot
let ranked=pool.map((meal,idx)=>({meal,idx,score:scoreMeal(meal,idx,slot),why:whyMeal(meal)})).sort((a,b)=>b.score-a.score);

// Prevent snack/beverage doubling: if same underlying pool, skip already-picked indices
const poolKey=(slot==='snack1'||slot==='snack2'||slot==='snack3')?'snack':(slot==='juice2'||slot==='juice3')?'juice':slot;
if(!pickedFromPool[poolKey])pickedFromPool[poolKey]=new Set();
ranked=ranked.filter(r=>!pickedFromPool[poolKey].has(r.idx));

const best=ranked[0];
if(!best)return;

pickedFromPool[poolKey].add(best.idx);

recommendations.push({
slot,
slotLabel:slotLabels[slot]||slot,
mealIdx:best.idx,
title:best.meal.title,
macros:best.meal.macros,
why:best.why,
selected:alreadySelected,
selectedIdx:alreadySelected?sel[slot]:null,
selectedTitle:alreadySelected?pool[sel[slot]]?.title:null
});
});

return recommendations;
}

// ============================================================================
// v21 AI DAILY RECOMMENDATION (biomarker-aware)
// ============================================================================
getDailyRecommendation(mac,day,avgScore){
const apob=parseFloat(this.bios.apob||0);
const lpa=parseFloat(this.bios.lpa||0);
const hscrp=parseFloat(this.bios.hscrp||0);
const ana=this.bios.ana||'';
const goals=USERS[this.user].goals;
const hrvBaseline=this.calculatedHrvBaseline||USERS[this.user].hrvBaseline;
// HRV-aware recommendations (v22 integration)
if(day.hrv&&day.hrv<hrvBaseline*0.85)return`âš ï¸ LOW HRV (${day.hrv}ms) â†’ RECOVERY MODE: Z2 only, skip HIIT, sleep +1hr`;
// Biomarker priorities
if(ana==='positive'&&mac.omega3<3000)return'ðŸ¦‹ ANA 1:320 â†’ Î©3 AT '+Math.round(mac.omega3)+'mg â€” NEED 4000mg+ TO SUPPRESS TNF-Î± & IL-6';
if(lpa>150&&mac.omega3<3000)return'LP(A) ELEVATED â†’ WALNUTS + FLAX ESSENTIAL';
if(apob>80&&mac.fiber<30)return'APOB '+apob+' â†’ DRIVE IT DOWN: OATS + FLAX + BEANS + OMEGA-3. FIBER TARGET: '+Math.round(goals.fiber)+'G';
if(hscrp>1.0)return'INFLAMMATION DETECTED â†’ TURMERIC STACK';
if(ana==='positive'&&mac.polyphenol<200)return'ðŸ¦‹ ANA+ â†’ POLYPHENOL SHIELD LOW: ADD TURMERIC TEA, BERRIES, DARK CHOCOLATE';
if(ana==='positive'&&mac.fiber<goals.fiber*0.6)return'ðŸ¦‹ ANA+ â†’ FIBER AT '+Math.round(mac.fiber)+'g â€” GUT HEALTH = IMMUNE REGULATION';
if(ana==='positive')return'ðŸ¦‹ ANA+ PROTOCOL ACTIVE â†’ Î©3: '+Math.round(mac.omega3)+'mg Â· POLY: '+Math.round(mac.polyphenol)+'mg';
// Macro gaps
const proteinGap=goals.protein-mac.protein;
const omega3Gap=goals.omega3-mac.omega3;
const fiberGap=goals.fiber-mac.fiber;
if(proteinGap>50)return`PROTEIN GAP: +${Math.round(proteinGap)}G NEEDED`;
if(omega3Gap>2000)return`OMEGA-3 LOW â†’ +${Math.round(omega3Gap/1000)}G FISH/FLAX`;
if(fiberGap>20)return`FIBER DEFICIT: +${Math.round(fiberGap)}G BEANS/OATS`;
// Zone targets
const z2Remaining=Math.max(0,goals.z2-(day.med||0));
const z5Remaining=Math.max(0,goals.z5-(day.high||0));
if(z2Remaining>20)return`ZONE 2: +${Math.round(z2Remaining)}MIN WALK NEEDED`;
if(z5Remaining>10)return`ZONE 5: +${Math.round(z5Remaining)}MIN HIIT PENDING`;
// Sleep
if((day.totalSec||0)/3600<7)return`SLEEP DEBT: ${((day.totalSec||0)/3600).toFixed(1)}H â†’ TARGET 8H TONIGHT`;
// Score feedback
if(avgScore>=90)return`OPTIMAL PROTOCOL â†’ LONGEVITY SCORE: ${avgScore}`;
if(avgScore>=75)return`SOLID WEEK â†’ SCORE ${avgScore} â†’ FINE TUNE`;
if(avgScore<60)return`FOCUS MODE â†’ SCORE ${avgScore} â†’ SLEEP + MOVEMENT`;
return'ALL SYSTEMS OPTIMAL â†’ PROTOCOL LOCKED';
}

// ============================================================================
// v21 STREAK CALCULATOR
// ============================================================================
calculateStreak(){
let streak=0;
for(let i=0;i<this.history.length;i++){
const day=this.history[i];
const chk=this.checked[day.date]||[];
const requiredIds=BASE.filter(t=>!t.cssClass?.includes('optional')).map(t=>t.id);
const allChecked=requiredIds.every(id=>chk.includes(id));
if(allChecked&&requiredIds.length>0)streak++;else break;
}
this.streak=streak;
}

// ============================================================================
// v21 MACRO CALCULATOR FOR ANY DATE
// ============================================================================
calculateMacrosForDate(date){
const sel=this.meals[date]||{};
const portions=this.portions[date]||{};
const chk=this.checked[date]||[];
const slotToId={};(this.protocol||BASE).forEach(b=>{if(b.mealSlot)slotToId[b.mealSlot]=b.id});
let t={protein:0,omega3:0,fiber:0,calories:0,polyphenol:0};
Object.keys(sel).forEach(slot=>{
const pid=slotToId[slot]||slot;
if(!chk.includes(pid))return;
const idx=sel[slot];
const meal=MEALS[slot]?.[idx];
if(meal){
const portion=['breakfast','lunch','dinner','snack1','snack2','snack3'].includes(slot)?(portions[slot]||1):1;
const key=`${date}:${slot}:${idx}`;
const removed=new Set(this.removedIngredients[key]||[]);
const adj=this.getAdjustedMacros(meal,portion,removed);
t.protein+=adj.p;t.omega3+=adj.o;t.fiber+=adj.f;t.calories+=adj.cal;t.polyphenol+=adj.poly;
const sides=this.sideItems[`${date}:${slot}`]||[];
sides.forEach(s=>{t.protein+=(s.macros.p||0);t.omega3+=(s.macros.o||0);t.fiber+=(s.macros.f||0);t.calories+=(s.macros.cal||0);t.polyphenol+=(s.macros.poly||0)});
}
});
return t}

// ============================================================================
// v21 BEVERAGE RECIPE VIEW
// ============================================================================
showBeverageRecipe(idx){
const bev=MEALS.juices[idx];
if(!bev)return;
const mb=document.getElementById('modalBody');
this.setText('modalTitle',bev.title.toUpperCase());
let html=`<div class="recipe-hero"><div class="recipe-title">${bev.title}</div></div>`;
html+=`<div class="macro-grid"><div class="macro-stat"><div class="m-val">${bev.macros.p}g</div><div class="m-lbl">PROTEIN</div></div><div class="macro-stat"><div class="m-val">${bev.macros.o}mg</div><div class="m-lbl">OMEGA-3</div></div><div class="macro-stat"><div class="m-val">${bev.macros.f}g</div><div class="m-lbl">FIBER</div></div><div class="macro-stat"><div class="m-val">${bev.macros.cal}</div><div class="m-lbl">CALORIES</div></div></div>`;
if(bev.why)html+=`<div class="synergy-box"><div class="syn-title">ðŸ¹ WHY THIS WORKS</div><div class="syn-text">${bev.why}</div></div>`;
if(bev.ingredients){html+=`<div style="margin-bottom:20px"><div style="font-size:0.8rem;font-weight:900;color:var(--acid);margin-bottom:10px">INGREDIENTS</div>`;bev.ingredients.forEach(ing=>{html+=`<div class="ing-item">${ing}</div>`});html+=`</div>`}
if(bev.steps){html+=`<div><div style="font-size:0.8rem;font-weight:900;color:var(--acid);margin-bottom:10px">PREPARATION</div>`;bev.steps.forEach((step,i)=>{html+=`<div class="step-item"><div style="font-weight:900;color:var(--cyan);font-size:1.2rem;min-width:30px">${i+1}</div><div>${step}</div></div>`});html+=`</div>`}
html+=`<button onclick="app.closeModal()" style="width:100%;background:linear-gradient(135deg,#c8ff00,#00d4ff);color:#000;padding:18px;margin-top:25px;border:none;border-radius:12px;font-weight:900;font-size:1.1rem;cursor:pointer">CLOSE</button>`;
mb.innerHTML=html;
document.getElementById('mainModal').scrollTop=0;
}

showProtocolDetails(type){
const p=PROTOCOLS[type]||{title:"ROUTINE",steps:["Follow standard procedure."]};
let html=`<div style="text-align:center;margin:30px 0"><div style="font-size:1.8rem;font-weight:900;color:#fff">${p.title}</div></div><div style="background:var(--panel);border-radius:12px;border:1px solid var(--border);overflow:hidden">${p.steps.map(s=>`<div style="padding:18px 20px;border-bottom:1px solid var(--border);font-size:0.95rem;color:#ddd;line-height:1.6">${s}</div>`).join('')}</div>`;
this.setText('modalTitle','PROTOCOL');
document.getElementById('modalBody').innerHTML=html;
document.getElementById('mainModal').classList.add('show');
}

render(){
if(!this.history.length)return;
const day=this.history[this.currentIndex];
const date=day.date;
const sel=this.meals[date]||{};
const chk=this.checked[date]||[];
const goals=USERS[this.user].goals;
const hrvBaseline=this.calculatedHrvBaseline||USERS[this.user].hrvBaseline;
const hrvLow=day.hrv&&day.hrv<hrvBaseline*0.85;
this.setText('dateLabel',date);

// Recovery Battery â€” composite score (HRV 30%, Sleep 25%, Readiness 25%, Strain-inverse 20%)
const hrvPct=day.hrv?Math.min((day.hrv/hrvBaseline)*100,120):50;
const sleepPct=Math.min(((day.totalSec||0)/3600/goals.sleepHours)*100,120);
const readyPct=Math.min(day.readiness||50,100);
const strainFromZones=(day.high||0)+(day.med||0)*0.5;
const strainFromWorkouts=day.workouts.reduce((s,w)=>s+(w.calories||0),0)/50;
const strainRaw=Math.max(strainFromZones,strainFromWorkouts);
const strainCap=goals.z5+goals.z2*0.5;
const strainPct=strainCap>0?Math.min((strainRaw/strainCap)*100,150):50;
// Strain is inverted for recovery: over-training lowers battery, under-training is neutral
const strainRecovery=strainPct<=100?100:Math.max(0,200-strainPct);
const batteryScore=Math.round(hrvPct*0.30+sleepPct*0.25+readyPct*0.25+strainRecovery*0.20);
this.setText('batteryScore',batteryScore||'--');
const bf=document.getElementById('batteryFill');
bf.style.width=`${Math.min(batteryScore,100)}%`;
bf.style.background=batteryScore>=80?'linear-gradient(90deg,#34d399,#00f2fe)':batteryScore>=60?'linear-gradient(90deg,#4facfe,#00f2fe)':batteryScore>=40?'linear-gradient(90deg,#ff9500,#ffcc00)':'linear-gradient(90deg,#ff4757,#ff6b81)';
this.setText('bcHrv',day.hrv?`${day.hrv}`:'--');
if(day.hrv&&document.getElementById('bcHrvTrend')){
const bl=this.calculatedHrvBaseline||USERS[this.user].hrvBaseline;
const pct=Math.round(day.hrv/bl*100);
document.getElementById('bcHrvTrend').innerHTML=`<span style="font-size:0.55rem;color:${pct>=85?'var(--success)':'var(--orange)'}"> ${pct}% of ${bl}ms avg</span>`;
}
this.setText('bcSleep',`${((day.totalSec||0)/3600).toFixed(1)}h`);
this.setText('bcReadiness',day.readiness||'--');
this.setText('bcStrain',strainRaw>0?Math.round(strainRaw):'0');

// Trends
const last7=this.history.slice(0,7);
const calcTrend=(cur,key)=>{if(!cur)return'';const prev=last7.slice(1,4).filter(d=>d[key]).map(d=>d[key]);if(!prev.length)return'';const avg=prev.reduce((a,b)=>a+b,0)/prev.length;const diff=cur-avg;if(Math.abs(diff)<2)return'';return diff>0?'<span class="trend-up">â†‘</span>':'<span class="trend-down">â†“</span>'};
// HRV trend now shows baseline context inline above
document.getElementById('bcSleepTrend').innerHTML=calcTrend(day.totalSec/3600,'totalSec');

// Scores
const avgScore=last7.length?Math.round(last7.reduce((s,d)=>s+(d.score||0),0)/last7.length):0;
this.setText('longevityScore',avgScore);
document.getElementById('longevityOrb').style.strokeDashoffset=251-(avgScore/100*251);
const dayScore=Math.min(100,Math.round(((day.totalSec||0)/3600/8)*100));
this.setText('dayGrade',dayScore>=85?'A':dayScore>=70?'B':'C');
document.getElementById('dayScoreOrb').style.strokeDashoffset=251-(dayScore/100*251);

// Status & Insights (v22 HRV-aware + v21 AI recommendations)
// Step 1: Detect thermal exposure (doesn't need macros)
const thermal=this.detectThermalExposure(day);

// Step 2: Auto-fill empty meal slots BEFORE calculating macros
const prelimMac=this.calcMacros(); // rough pass for recommendation scoring
const mealRecs=this.getRecommendedMeals(day,prelimMac,hrvLow);
mealRecs.forEach(r=>{
if(!r.selected&&sel[r.slot]===undefined){
sel[r.slot]=r.mealIdx;
if(!this.meals[date])this.meals[date]={};
this.meals[date][r.slot]=r.mealIdx;
}
});

// Step 3: NOW calculate real macros (with auto-filled meals included)
const mac=this.calcMacros();
let status=this.getDailyRecommendation(mac,day,avgScore);
let insights='';
if(hrvLow){
insights+=`<div class="insight-card warning"><div class="insight-header"><span class="insight-icon">ðŸ’œ</span><span class="insight-title">HRV Below Baseline</span></div><div class="insight-body">Your HRV is ${day.hrv}ms vs baseline ${hrvBaseline}ms. Body needs recovery.</div><div class="insight-action">â†’ Skip HIIT, walk 30min Z2, sleep +1hr</div></div>`;
}
// Thermal-aware insights (replaces simple temp check)
insights+=this.getThermalInsights(day,thermal);

// ANA+ Autoimmune Protocol Insights (Sophia-specific)
if(this.bios.ana==='positive'){
const omega3So=mac.omega3||0;
const polySo=mac.polyphenol||0;
const fiberSo=mac.fiber||0;
const bodyfatSo=parseFloat(this.bios.bodyfat||0);
const ferritinSo=parseFloat(this.bios.ferritin||0);

// Always show ANA status reminder
insights+=`<div class="insight-card" style="border-left:3px solid #a855f7"><div class="insight-header"><span class="insight-icon">ðŸ¦‹</span><span class="insight-title">ANA 1:320 â€” Autoimmune Protocol Active</span></div><div class="insight-body">Speckled nuclear pattern detected. Anti-inflammatory nutrition prioritized. Rheumatology referral in progress.</div><div class="insight-action">â†’ Î©3 target: 4000mg+ Â· Turmeric daily Â· Minimize processed foods & refined sugar</div></div>`;

// Omega-3 critical for ANA
if(omega3So<2000){
insights+=`<div class="insight-card warning"><div class="insight-header"><span class="insight-icon">ðŸŸ</span><span class="insight-title">Omega-3 Critical for ANA+</span></div><div class="insight-body">Only ${Math.round(omega3So)}mg Î©3 today. EPA/DHA directly suppresses pro-inflammatory cytokines (TNF-Î±, IL-6) elevated in autoimmune conditions. You need 4000mg+.</div><div class="insight-action">â†’ Add salmon, sardines, or flax-heavy meals. Consider fish oil supplement.</div></div>`;
}

// Polyphenol check
if(polySo<200){
insights+=`<div class="insight-card" style="border-left:3px solid var(--orange)"><div class="insight-header"><span class="insight-icon">ðŸ«</span><span class="insight-title">Polyphenols Low â€” Inflammation Shield Down</span></div><div class="insight-body">Only ${Math.round(polySo)}mg polyphenols. Curcumin, quercetin, and anthocyanins modulate NF-ÎºB pathway â€” the same pathway ANA antibodies over-activate.</div><div class="insight-action">â†’ Add turmeric tea, berries, dark chocolate, or The ANA Soother juice</div></div>`;
}

// Body comp insight (her biggest modifiable factor)
if(bodyfatSo>28){
insights+=`<div class="insight-card" style="border-left:3px solid var(--cyan)"><div class="insight-header"><span class="insight-icon">âš–ï¸</span><span class="insight-title">Body Recomp â€” ANA Connection</span></div><div class="insight-body">Body fat at ${bodyfatSo}% amplifies systemic inflammation. Adipose tissue produces IL-6 and TNF-Î± â€” the same inflammatory cytokines worsened by autoimmune activity. Losing 17 lbs fat mass would significantly reduce baseline inflammation.</div><div class="insight-action">â†’ Calorie deficit of 300-400/day + progressive resistance training to preserve muscle</div></div>`;
}

// Ferritin insight (she's doing well here)
if(ferritinSo>=50&&ferritinSo<=100){
insights+=`<div class="insight-card" style="border-left:3px solid var(--success)"><div class="insight-header"><span class="insight-icon">âœ…</span><span class="insight-title">Ferritin Optimal for ANA+</span></div><div class="insight-body">Ferritin at ${ferritinSo} ng/mL â€” excellent. Iron stores matter more with autoimmune conditions because chronic inflammation can block iron absorption. You're in the sweet spot.</div></div>`;
}

// Sleep quality matters more with autoimmune
if(day.totalSec>0&&day.totalSec/3600<7){
insights+=`<div class="insight-card warning"><div class="insight-header"><span class="insight-icon">ðŸ˜´</span><span class="insight-title">Sleep Critical for ANA+</span></div><div class="insight-body">Only ${(day.totalSec/3600).toFixed(1)}h sleep. Sleep deprivation increases CRP and IL-6 â€” directly worsening autoimmune flare risk. ANA+ bodies need 8+ hours for immune regulation.</div><div class="insight-action">â†’ Chamomile tea, magnesium glycinate, screens off by 9pm</div></div>`;
}

// Temp elevation is more significant with ANA+
if(day.tempDev>0.3&&!thermal.sauna){
insights+=`<div class="insight-card warning"><div class="insight-header"><span class="insight-icon">ðŸŒ¡ï¸</span><span class="insight-title">Temp Elevation + ANA = Monitor Closely</span></div><div class="insight-body">Temp +${(day.tempDev).toFixed(1)}Â° with ANA 1:320 could indicate autoimmune flare activity. Track for patterns: joint pain, fatigue, rash, or swelling.</div><div class="insight-action">â†’ Log symptoms, increase Î©3+turmeric, rest if needed. Report to rheumatologist if persistent.</div></div>`;
}
}
this.setText('statusMsg',status);
document.getElementById('insightContainer').innerHTML=insights;

// Battery Detail Row (consolidated recovery + sleep + debt)
const upd=(id,val,max)=>{const el=document.getElementById(id);if(el)el.style.strokeDashoffset=138-(Math.min(val/max,1)*138)};
this.setText('deepVal',`${Math.round((day.deepSec||0)/60)}m`);
this.setText('remVal',`${Math.round((day.remSec||0)/60)}m`);
this.setText('tempVal',`${day.tempDev>0?'+':''}${(day.tempDev||0).toFixed(1)}Â°`);
this.setText('respVal',day.respRate?day.respRate.toFixed(1):'--');
const sleepTarget=goals.sleepHours*7;
const sleepActual=last7.reduce((s,d)=>s+(d.totalSec||0)/3600,0);
const sleepDebt=sleepActual-sleepTarget;
this.setText('sleepDebtValue',`${sleepDebt>0?'+':''}${sleepDebt.toFixed(1)}h`);
// HRV card color in battery
const hrvComp=document.getElementById('hrvCard');
if(hrvComp){hrvComp.style.background=hrvLow?'rgba(255,149,0,0.15)':(day.hrv&&day.hrv>=hrvBaseline)?'rgba(52,211,153,0.1)':''}

// Nutrition
const updMac=(id,val,max)=>{upd(id,val,max);const txt=document.getElementById(id.replace('Orb','Val'));if(txt)txt.innerText=Math.round(val)};
updMac('proteinOrb',mac.protein,goals.protein);
updMac('omega3Orb',mac.omega3,4000);
updMac('fiberOrb',mac.fiber,goals.fiber);
this.setText('polyphenolVal',Math.round(mac.polyphenol||0));
upd('polyphenolOrb',mac.polyphenol||0,1000);

// Metabolism (v21)
const bmr=parseFloat(this.bios.bmr||2000);
const totalBurn=bmr+(day.cal||0);
const balance=mac.calories-totalBurn;
this.setText('balanceVal',`${balance>0?'+':''}${Math.round(balance)}`);
this.setText('balanceLabel',balance<0?'DEFICIT':'SURPLUS');
this.setText('eatenVal',Math.round(mac.calories));
this.setText('burnedVal',Math.round(totalBurn));
this.setText('bmrVal',Math.round(bmr));
upd('balanceOrb',Math.abs(balance),500);

// Vascular Age (calculated from biomarkers)
const actualAge=this.user==='jermaine'?43:39;
const calcVascularAge=()=>{
const apob=parseFloat(this.bios.apob||0);
const lpa=parseFloat(this.bios.lpa||0);
const hscrp=parseFloat(this.bios.hscrp||0);
const hba1c=parseFloat(this.bios.hba1c||0);
const bodyfat=parseFloat(this.bios.bodyfat||0);
if(!apob&&!hscrp)return null;
let vAge=actualAge;
// === MODIFIABLE (heavy weight) ===
// ApoB: optimal <80, primary CVD driver you CAN move
if(apob>80)vAge+=(apob-80)/8*1.2;
// hsCRP: optimal <1.0, inflammation you CAN control
if(hscrp>1.0)vAge+=(hscrp-1.0)/0.5*1.0;
// HbA1c: optimal <5.4, metabolic health
if(hba1c>5.4)vAge+=(hba1c-5.4)/0.2*1.2;
// Body fat: optimal <15% men, <22% women
const bfTarget=this.user==='jermaine'?15:22;
if(bodyfat>bfTarget)vAge+=(bodyfat-bfTarget)/5*0.5;
// === GENETIC (acknowledged, low weight) ===
// Lp(a): genetic, capped at +2 max regardless of level
if(lpa>75)vAge+=Math.min((lpa-75)/50*0.5,2);
// === FITNESS DISCOUNT (you earn this) ===
// Good RHR (<65) subtracts up to 4 years
const rhr=day.rhr!=='-'?parseFloat(day.rhr):0;
if(rhr>0&&rhr<65)vAge-=(65-rhr)/5;
// HRV above baseline subtracts up to 3 years
const currentHrv=day.hrv||0;
const baseline=USERS[this.user].hrvBaseline;
if(currentHrv>baseline)vAge-=Math.min((currentHrv-baseline)/baseline*3,3);
// Sleep quality bonus: 7.5+ hours subtracts up to 2 years
const sleepHrs=day.totalSec?day.totalSec/3600:0;
if(sleepHrs>=7.5)vAge-=Math.min((sleepHrs-7)/1,2);
// Zone 2 cardio bonus: hitting 180+ min/week subtracts up to 2 years
const weekZ2=this.history.slice(0,7).reduce((s,d)=>s+(d.med||0),0);
if(weekZ2>=90)vAge-=Math.min(weekZ2/180*2,2);
return Math.round(vAge);
};
const vascAge=calcVascularAge();
if(vascAge!==null){
const diff=actualAge-vascAge;
this.setText('vascularAge',vascAge);
this.setText('ageDiff',Math.abs(diff));
document.getElementById('ageDiff').style.color=diff>=0?'var(--success)':'var(--alert)';
document.getElementById('ageDiffLabel').style.color=diff>=0?'var(--success)':'var(--alert)';
this.setText('ageDiffLabel',diff>=0?'YOUNGER':'OLDER');
}else{this.setText('vascularAge','--');this.setText('ageDiff','--');this.setText('vascularTrend','--')}

// Cardio
this.setText('rhrVal',day.rhr!=='-'?day.rhr:'--');
const updHeart=(id,val,max)=>{const el=document.getElementById(id);if(el)el.style.strokeDashoffset=100-(Math.min(val/max,1)*100)};
updHeart('z2Heart',day.med||0,45);
if(hrvLow){document.getElementById('z5Heart').style.stroke='var(--orange)';this.setText('z5Val','â˜…');this.setText('z5Label','RECOVERY')}
else{document.getElementById('z5Heart').style.stroke='var(--alert)';this.setText('z5Val',Math.round(day.high||0));this.setText('z5Label','ZONE 5');updHeart('z5Heart',day.high||0,20)}
this.setText('z2Val',Math.round(day.med||0));
this.setText('calVal',Math.round(day.cal||0));
updHeart('calHeart',day.cal||0,500);

// Water & Rainbow
this.updateWater();
const cols=this.calcRainbow();
this.setText('rainbowScore',Math.round((cols.size/6)*100)+'%');
document.getElementById('rainbowTrack').innerHTML=['red','orange','yellow','green','purple','white'].map(c=>`<div class="rainbow-seg" style="background:${cols.has(c)?COLORS[c]:'#333'};width:${cols.has(c)?16.6:0}%"></div>`).join('');

// Build Protocol (merged v21 + v22)
this.protocol=[...BASE];
const dateObj=new Date(date+'T12:00:00');
const dow=dateObj.getDay();
const weekOfMonth=Math.ceil(dateObj.getDate()/7);
const isFirstWeek=weekOfMonth===1;
const hadWorkout=day.workouts.length>0;
const workoutType=hadWorkout?day.workouts[0].type:'';

// Auto-detected workouts
day.workouts.forEach((w,i)=>{
const impact=this.getWorkoutImpact(w.type);
this.protocol.push({id:`workout_${i}`,time:w.time,title:`${w.type.toUpperCase()} Detected`,desc:`${w.calories} cal | Impact: ${impact.impact.toUpperCase()} (${impact.intensity}/10)`,autoDetected:true});
});

// AI Workout Recommendation â†’ inject into protocol
const workoutRec=this.getRecommendedWorkout(day,dow,hrvLow,thermal);
if(!hadWorkout){
this.protocol.push({id:'ai_workout',time:workoutRec.time||'6:00 AM',title:`${workoutRec.icon} ${workoutRec.title}`,desc:`${workoutRec.detail} â€” ${workoutRec.why}`,cssClass:'workout-rec',clickable:false});
}

// Lunch recovery stretching (v21)
const lunchRec=this.getLunchRecovery(dow);
if(lunchRec)this.protocol.push({id:'lunch_recovery',time:'12:30 PM',title:lunchRec.title,desc:lunchRec.desc,clickable:lunchRec.clickable,type:lunchRec.type,cssClass:'recovery'});

// Smart recovery (workout-aware) or day-of-week fallback (v21)
const smartRec=this.getSmartRecovery(day);
if(smartRec){
this.protocol.push({id:'smart_recovery',time:smartRec.time,title:smartRec.title,desc:smartRec.desc,clickable:true,type:smartRec.type,cssClass:'recovery'});
}else{
const eveningRec=this.getEveningRecovery(dow,hadWorkout,workoutType);
if(eveningRec)this.protocol.push({id:'evening_recovery',time:eveningRec.time,title:eveningRec.title,desc:eveningRec.desc,clickable:true,type:eveningRec.type,cssClass:'recovery'});
}

// Facial protocol (v21)
const facial=this.getEndOfDayFacial(dow,isFirstWeek);
if(facial)this.protocol.push({id:'facial',time:'9:00 PM',title:facial.title,desc:facial.desc,clickable:true,type:facial.type,cssClass:'facial'});

// Sauna & Cryo quick-log (thermal detection)
const thermalLog=this.getThermalLog(date);
this.protocol.push({id:'thermal_sauna',time:'5:30 PM',title:'ðŸ”¥ Sauna',desc:thermalLog.sauna?'âœ“ LOGGED':'Tap âœ“ to log session',clickable:true,type:'sauna',cssClass:'recovery'});
this.protocol.push({id:'thermal_cryo',time:'5:45 PM',title:'â„ï¸ Cryo',desc:thermalLog.cryo?'âœ“ LOGGED':'Tap âœ“ to log session',clickable:true,type:'cryo',cssClass:'recovery'});
// Auto-detect from Oura
if(thermal.sauna&&!thermalLog.sauna){
const saunaItem=this.protocol.find(p=>p.id==='thermal_sauna');
if(saunaItem){saunaItem.desc='AUTO-DETECTED via Oura';saunaItem.autoDetected=true}
}
if(thermal.cryo&&!thermalLog.cryo){
const cryoItem=this.protocol.find(p=>p.id==='thermal_cryo');
if(cryoItem){cryoItem.desc='AUTO-DETECTED via Oura';cryoItem.autoDetected=true}
}

// HRV low override (v22)
if(hrvLow)this.protocol.push({id:'hrv_rec',time:'ALL DAY',title:'âš ï¸ LOW HRV - RECOVERY',desc:'Skip HIIT, focus Zone 2',hrvAdjusted:true,clickable:true,type:'lowhrv'});

// Sort by time
this.protocol.sort((a,b)=>{const pt=t=>{const m=t.match(/(\d+):(\d+)\s*(AM|PM)/i);if(!m)return 0;let h=parseInt(m[1]);if(m[3].toUpperCase()==='PM'&&h!==12)h+=12;if(m[3].toUpperCase()==='AM'&&h===12)h=0;return h*60+parseInt(m[2])};return pt(a.time)-pt(b.time)});

// Streak (v21)
this.calculateStreak();
this.setText('streakCount',this.streak);
const streakPct=Math.min(this.streak/7,1);
document.getElementById('streakOrb').style.strokeDashoffset=251-(streakPct*251);

// Vascular trend (based on biomarker targets)
if(vascAge!==null){
const diff=actualAge-vascAge;
if(diff>=3)this.setText('vascularTrend','ðŸŸ¢ GREAT');
else if(diff>=0)this.setText('vascularTrend','ðŸŸ¡ OK');
else this.setText('vascularTrend','ðŸ”´ HIGH');
}else{this.setText('vascularTrend','--')}

// Apply meal selections (mark AI-filled ones)
const userPickedSlots=this.meals[date]?Object.keys(this.meals[date]).filter(s=>chk.includes(this.protocol.find(p=>p.mealSlot===s)?.id)):[];
this.protocol.forEach(t=>{if(t.mealSlot&&sel[t.mealSlot]!==undefined){const m=MEALS[t.mealSlot]?.[sel[t.mealSlot]];if(m){const portion=this.portions[date]?.[t.mealSlot]||1;const sides=this.sideItems[`${date}:${t.mealSlot}`]||[];const sideP=sides.reduce((s,x)=>s+(x.macros.p||0),0);const sideO=sides.reduce((s,x)=>s+(x.macros.o||0),0);const sideF=sides.reduce((s,x)=>s+(x.macros.f||0),0);const sideCal=sides.reduce((s,x)=>s+(x.macros.cal||0),0);t.title=m.title+(sides.length?` + ${sides.length}`:'')+(portion===0.5?' (HALF)':'');t.desc=`P:${Math.round((m.macros.p||0)*portion+sideP)}g F:${Math.round((m.macros.f||0)*portion+sideF)}g Î©3:${Math.round((m.macros.o||0)*portion+sideO)}mg Cal:${Math.round((m.macros.cal||0)*portion+sideCal)}`;t.macros={p:(m.macros.p||0)*portion+sideP,o:(m.macros.o||0)*portion+sideO,f:(m.macros.f||0)*portion+sideF,cal:(m.macros.cal||0)*portion+sideCal,poly:(m.macros.poly||0)*portion};t.colors=m.colors;t.aiFilled=!chk.includes(t.id)}}});

// Render timeline
document.getElementById('timeline').innerHTML=this.protocol.map(t=>{
const isC=chk.includes(t.id);
const isAiFilled=t.mealSlot&&t.aiFilled&&!isC;
const cc=`task-card ${isC?'checked':''} ${t.autoDetected?'auto-detected':''} ${t.hrvAdjusted?'hrv-adjusted':''} ${isAiFilled?'ai-filled':''} ${t.cssClass||''}`;
let ca='';
if(t.clickable&&t.type&&PROTOCOLS[t.type])ca=`onclick="app.showProtocolDetails('${t.type}')"`;
else if(t.mealSlot)ca=`onclick="app.openMealPicker('${t.mealSlot}')"`;
const isThermal=t.id&&t.id.startsWith('thermal_');
const thermalType=isThermal?t.id.replace('thermal_',''):'';
const checkAction=isThermal?`app.logThermal('${thermalType}')`:`app.toggleTask('${t.id}')`;
return `<div class="task"><div class="task-time">${t.time}</div><div class="${cc}" ${ca}><div class="task-info"><div class="task-title">${t.title}</div><div class="task-desc">${t.desc||'Tap to select'}</div></div>${(t.mealSlot||t.clickable)?'<div class="chevron">â€º</div>':''}${!t.autoDetected&&!t.hrvAdjusted?`<div class="check-btn" onclick="event.stopPropagation();${checkAction}"><div class="check-circle">${isC?'âœ“':''}</div></div>`:''}</div></div>`;
}).join('');
// Update collapsed section summaries
this.updateSectionSummaries();
}

sync(){this.fetchOura()}
}

let app;window.onload=()=>{app=new CenturionApp();window.app=app};
</script>

</body>
</html>