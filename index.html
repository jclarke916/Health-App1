<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no">
    <title>The Centurion | v228.40 Robust</title>
    <link rel="apple-touch-icon" href="https://img.icons8.com/?size=512&id=104334&format=png">
    <link rel="icon" type="image/png" href="https://img.icons8.com/?size=512&id=104334&format=png">
    <link href="https://fonts.googleapis.com/css2?family=Inter:wght@300;400;600;700;800&display=swap" rel="stylesheet">
    <style>
        :root{--bg:#050505; --card:#141414; --gold:#D4AF37; --green:#00E676; --blue:#00B0FF; --purple:#D500F9; --text:#fff;
        --g-pro:linear-gradient(90deg,#FF5252,#D50000); --g-carb:linear-gradient(90deg,#FFAB40,#FF6D00);
        --g-cal:linear-gradient(90deg,#B388FF,#6200EA); --g-fib:linear-gradient(90deg,#00E676,#00C853);}
        *{box-sizing:border-box;-webkit-tap-highlight-color:transparent}
        body{font-family:'Inter',sans-serif;background:var(--bg);color:var(--text);margin:0;padding:15px;font-size:14px}
        .container{max-width:500px;margin:0 auto; padding-bottom: 50px;}
        header { text-align: center; margin-bottom: 10px; }
        .app-logo { width: 40px; height: 40px; vertical-align: middle; margin-right: 8px; border-radius: 50%; border: 1px solid var(--gold); }
        h1{display: inline-block; vertical-align: middle; font-weight:200; letter-spacing:5px; text-transform:uppercase; font-size:1.2rem; margin:0;}
        .version-tag { display: block; text-align: center; font-size: 0.5rem; color: #444; margin-top: 5px; margin-bottom: 15px; letter-spacing: 2px; }
        .badge-row{display:flex;justify-content:center;gap:8px;margin-bottom:15px}
        .u-badge{background:#000;padding:8px 16px;border-radius:20px;border:1px solid #333;font-size:0.6rem;font-weight:800;cursor:pointer;color:#666}
        .u-badge.active{border-color:var(--gold);color:var(--gold)}
        .status-bar{text-align:center;color:#888;font-size:0.65rem;font-weight:800;margin-bottom:10px;text-transform:uppercase; min-height:20px}
        .controls{display:flex;gap:5px;margin-bottom:15px}
        .nav-btn{background:#111;border:1px solid #222;color:#888;padding:10px;flex:1;border-radius:8px;font-size:0.55rem;font-weight:800;cursor:pointer}
        .card, .macro-dashboard{background:var(--card);border-radius:20px;padding:20px;margin-bottom:15px;border:1px solid rgba(255,255,255,0.03);position:relative}
        .card::before{content:"";position:absolute;left:0;top:20px;bottom:20px;width:3px;background:var(--gold);border-radius:0 4px 4px 0}
        .label{color:#666;font-size:0.5rem;text-transform:uppercase;font-weight:900;margin-bottom:4px; display: flex; justify-content: space-between;}
        .value{ font-size: 0.95rem; margin-bottom: 12px; font-weight: 500; cursor: pointer; border-bottom: 1px solid #222; padding-bottom: 4px; display: flex; justify-content: space-between; align-items: center; }
        .macro-row{margin-bottom:10px}
        .macro-label{display:flex;justify-content:space-between;font-size:0.55rem;font-weight:800;color:#777;margin-bottom:3px}
        .macro-bg{height:5px;background:#222;border-radius:10px;overflow:hidden}
        .macro-fill{height:100%;border-radius:10px;transition:width 0.8s}
        .tabs{display:flex;gap:4px;margin-bottom:15px}
        .tab{flex:1;padding:10px 0;background:#111;border:1px solid #222;color:#444;border-radius:8px;font-size:0.55rem;font-weight:800;text-align:center;cursor:pointer}
        .tab.active{background:#222;color:#fff;border-color:444}
        .modal{display:none;position:fixed;top:0;left:0;width:100%;height:100%;background:rgba(0,0,0,0.9);z-index:2000;overflow-y:auto;backdrop-filter:blur(5px);}
        .modal-content{background:#0a0a0a;margin:0;padding:25px;border:none;border-radius:0;width:100%;min-height:100%;}
        .close-btn-float { position: fixed; top: 25px; right: 25px; width: 45px; height: 45px; background: rgba(30,30,30,0.8); border-radius: 50%; border: 1px solid #333; color: #fff; font-size: 28px; text-align: center; line-height: 42px; cursor: pointer; z-index: 3000; }
        .bio-section{margin-bottom:12px;padding:15px;background:rgba(255,255,255,0.03);border-radius:15px;border:1px solid rgba(255,255,255,0.05)}
        .macro-pill { background: #1a1a1a; border: 1px solid #333; padding: 3px 8px; border-radius: 12px; font-size: 0.55rem; color: #888; font-weight: 800; letter-spacing: 0.5px; text-transform: uppercase; }
        .bar-row{display:flex;align-items:center;margin-bottom:8px}
        .bar-lbl{width:45px;font-size:0.55rem;color:#666;font-weight:900;text-transform:uppercase}
        .bar-track{flex:1;height:8px;background:#111;border-radius:10px;margin:0 10px;border:1px solid #222;overflow:hidden}
        .bar-fill{height:100%;border-radius:10px;transition:width 1s}
        .oura-hist-row { display: flex; justify-content: space-between; padding: 10px 0; border-bottom: 1px solid #222; font-size: 0.7rem; color: #888; }
        .snack-grid { display: flex; gap: 10px; margin-bottom: 15px; }
        .snack-slot { flex: 1; border: 1px dashed #333; border-radius: 12px; padding: 12px 5px; text-align: center; cursor: pointer; min-height: 60px; display: flex; flex-direction: column; justify-content: center; align-items: center; background: rgba(255,255,255,0.02); }
        .snack-slot.filled { border: 1px solid var(--gold); background: #111; }
        .remove-snack { position: absolute; top: -5px; right: -5px; background: #333; border-radius: 50%; width: 16px; height: 16px; font-size: 9px; line-height: 16px; text-align: center; }
    </style>
</head>
<body>
<div class="container">
    <header>
        <img src="https://img.icons8.com/?size=512&id=104334&format=png" class="app-logo">
        <h1>THE CENTURION</h1>
        <div class="badge-row"><div id="bj" class="u-badge active" onclick="switchU('J')">üßîüèæ‚Äç‚ôÇÔ∏è JERMAINE</div><div id="bs" class="u-badge" onclick="switchU('S')">üë©üèæ‚Äçü¶± SOPHIA</div></div>
    </header>
    <div id="dateDisplay" class="status-bar">...</div>
    <div class="controls">
        <button class="nav-btn" onclick="changeW(-1)">PREV</button>
        <button class="nav-btn" onclick="resetD()">TODAY</button>
        <button class="nav-btn" onclick="changeW(1)">NEXT</button>
        <button class="nav-btn" onclick="safeOpenBio()" style="color:var(--green)">MY DATA</button>
    </div>
    <div id="dayTabs" class="tabs"></div>
    <div id="dayContent"></div>
</div>

<div id="masterModal" class="modal" onclick="closeM(event)">
    <div class="close-btn-float" onclick="forceClose(event)">&times;</div>
    <div class="modal-content" onclick="event.stopPropagation()">
        <h2 id="mTitle" style="font-size:1.5rem; margin-top:10px; color:white"></h2>
        <div id="mSub" style="color:var(--gold); font-size:0.85rem; margin-bottom:15px; text-transform:uppercase;"></div>
        <div id="mBody"></div>
        <div id="bioContentArea"></div>
    </div>
</div>

<script>
// --- GLOBAL STATE ---
let user = localStorage.getItem('centurion_active_user') || 'J';
let offset = 0;
let selDate = getCaDate();
let snackLog = {};
window.ouraHistory = [];

function getCaDate() {
    let d = new Date(new Date().toLocaleString("en-US", {timeZone: "America/Los_Angeles"}));
    d.setHours(12, 0, 0, 0); return d;
}
function getDateKey(d) { return d.toISOString().split('T')[0]; }
function getMon(o){ 
    let d = getCaDate(); let day = d.getDay(); 
    let diff = d.getDate() - day + (day === 0 ? -6 : 1); 
    d.setDate(diff + (o * 7)); return d; 
}

// --- DATABASES ---
const pDB={"HEAVY LIFT":[{h:"Theragun"},{h:"Heavy Lift"},{h:"Sauna"}],"BOXING":[{h:"Mobility"},{h:"Boxing"},{h:"Normatec"}],"REFORM":[{h:"Sweep"},{h:"Reform"},{h:"Sauna"}],"REFORM/YOGA":[{h:"Sweep"},{h:"Yoga"},{h:"Heat"}],"CS4":[{h:"Hydrate"},{h:"CS4"},{h:"Contrast"}],"RELAX":[{h:"Walk"},{h:"Relax"},{h:"Massage"}]};
const jDB={"PINEAPPLE GREEN Vitality":["Detox","Spinach, Pineapple",1,28,120,1],"PLASMA FLUSH Juice":["Recovery","Watermelon, Lime",1,32,140,1],"TITAN RED Juice":["Endurance","Beets, Carrots",2,42,185,2],"ZENITH GREEN Juice":["Alkalizer","Kale, Cucumber",2,18,120,1],"APOLLO GOLD Juice":["Anti-Inflam","Pears, Turmeric",1,45,195,2]};

// --- MDB PLACEHOLDER (WILL BE REPLACED IN STEP 3) ---
const mDB = {
    b: [
        "Beef & Liver Sausage|80/20 Beef-Liver Blend,Sage,Thyme,Blueberries|sear|<strong>The 'Ancestral Sausage'</strong><hr><strong>BENEFIT</strong><br>Heme iron + Vitamin A powerhouse for hormone health.<br><br><strong>CHEF TIP</strong><br>Mix herbs into ground blend. Form patties. Pan fry until browned. Serve with fresh berries.|25|8|280|15",
        "Avocado Egg Toast|Ezekiel Bread,Avocado,Egg Whites,Hemp Seeds|toast|<strong>The 'Centurion Toast'</strong><hr><strong>BENEFIT</strong><br>High fiber + healthy fats for sustained energy.<br><br><strong>CHEF TIP</strong><br>Toast sprouted bread. Mash avocado with lemon. Scramble whites separately. Top with seeds.|35|30|450|12",
        "Oat Protein Pancakes|Oat Flour,Whey Isolate,Blueberries,Almond Milk|griddle|<strong>'Fluffy Pro-Cakes'</strong><hr><strong>BENEFIT</strong><br>Complex carbs + fast protein for workout fuel.<br><br><strong>CHEF TIP</strong><br>Mix flour, protein, and baking powder. Cook on low-med griddle. Drop berries into wet batter.|35|25|380|6",
        "Turkey Bacon Scramble|Turkey Bacon,2 Eggs,Spinach,Tomato|sear|<strong>'The Classic Plate'</strong><hr><strong>BENEFIT</strong><br>Nitrate-free protein + magnesium-rich greens.<br><br><strong>CHEF TIP</strong><br>Crisp turkey bacon first. Wilt spinach and tomato in the same pan. Scramble eggs in.|30|5|340|18",
        "Turmeric Shrimp Scramble|Shrimp,Egg Whites,Turmeric,Green Onion|sear|<strong>'Golden Anti-Inflammatory'</strong><hr><strong>BENEFIT</strong><br>Curcumin + lean protein for joint recovery.<br><br><strong>CHEF TIP</strong><br>Dust shrimp with turmeric. Sear quickly. Pour in egg whites and scramble fluffy.|35|2|290|5",
        "Greek Yogurt Bowl|0% Greek Yogurt,Raspberries,Walnuts,Collagen|raw|<strong>'The Power Bowl'</strong><hr><strong>BENEFIT</strong><br>Probiotics + collagen for gut and skin health.<br><br><strong>CHEF TIP</strong><br>Stir collagen thoroughly into yogurt. Top with berries and walnut halves.|42|15|380|9",
        "Smoked Salmon Toast|Smoked Salmon,Sprouted Toast,Cucumber,Dill|raw|<strong>'Nordic Morning'</strong><hr><strong>BENEFIT</strong><br>Omega-3 fatty acids for brain function.<br><br><strong>CHEF TIP</strong><br>Layer salmon over toasted bread. Use a mandoline for paper-thin cucumber rounds.|35|15|360|10",
        "Zucchini Mushroom Eggs|3 Eggs,Zucchini,Mushrooms,Nutritional Yeast|sear|<strong>'Volume Scramble'</strong><hr><strong>BENEFIT</strong><br>High volume, low calorie filling breakfast.<br><br><strong>CHEF TIP</strong><br>Saut√© zucchini and mushrooms until soft. Nutritional yeast adds a cheesy flavor.|28|8|350|18",
        "Green Protein Smoothie|Spinach,Protein Powder,Avocado,Pineapple|blend|<strong>'Velvet Green'</strong><hr><strong>BENEFIT</strong><br>Chlorophyll + fast-absorbing aminos.<br><br><strong>CHEF TIP</strong><br>Blend spinach and water first to remove leaves. Add protein and avocado last.|35|25|390|10",
        "Chocolate Oat Waffles|Oat Flour,Chocolate Protein,Cocoa Powder,Egg White|griddle|<strong>'Dark Choc Waffles'</strong><hr><strong>BENEFIT</strong><br>Antioxidant-rich cocoa + slow carbs.<br><br><strong>CHEF TIP</strong><br>Keep batter thick. Cook until the iron stops steaming for max crunch.|35|30|410|7",
        "Turkey Sausage & Apple|Turkey Sausage,Green Apple,Sage|sear|<strong>'Autumn Scramble'</strong><hr><strong>BENEFIT</strong><br>Lean protein + pectin for digestion.<br><br><strong>CHEF TIP</strong><br>Pan-fry sausage. Sear apple wedges until caramelized. Garnish with fresh sage.|25|15|320|12",
        "Cottage Cheese Bowl|Cottage Cheese,Peach,Ground Flax,Cinnamon|raw|<strong>'High Pro Creamy'</strong><hr><strong>BENEFIT</strong><br>Slow-digesting casein protein for muscle sparing.<br><br> cottage cheese with sliced peaches and flax. Cinnamon stabilizes blood sugar.|28|15|280|5",
        "Steak & Eggs|Lean Steak,2 Eggs,Asparagus|sear|<strong>'The Builder'</strong><hr><strong>BENEFIT</strong><br>Creatine-rich beef + choline for focus.<br><br><strong>CHEF TIP</strong><br>Sear steak to medium-rare. Fry eggs sunny side up. Steam asparagus.|40|2|420|20",
        "Berry Protein Smoothie|Whey Isolate,Mixed Berries,Ground Flax,Almond Milk|blend|<strong>'Berry Alchemy'</strong><hr><strong>BENEFIT</strong><br>Polyphenols + lignans for cardiovascular health.<br><br><strong>CHEF TIP</strong><br>Use frozen berries to get a thick, milkshake-like consistency.|35|20|320|8",
        "Egg White Frittata|Egg Whites,Spinach,Feta,Olives|bake|<strong>'Mediterranean Frittata'</strong><hr><strong>BENEFIT</strong><br>Low calorie, high micronutrient density.<br><br><strong>CHEF TIP</strong><br>Mix ingredients. Pour into skillet. Cook stove-top then broil until golden.|30|3|310|10",
        "Almond Flour Pancakes|Almond Flour,Eggs,Vanilla,Monk Fruit|griddle|<strong>'Keto Cakes'</strong><hr><strong>BENEFIT</strong><br>Zero grain, high healthy fats.<br><br><strong>CHEF TIP</strong><br>Use a non-stick pan. These are delicate; flip only when bubbles form.|20|6|380|28",
        "Sardines on Sourdough|Sardines,Sourdough,Lemon,Parsley|raw|<strong>'Omega Toast'</strong><hr><strong>BENEFIT</strong><br>Calcium + D3 + Omega-3s.<br><br><strong>CHEF TIP</strong><br>Mash sardines onto toast with a fork. Drizzle lemon and fresh parsley.|25|15|340|12",
        "Mango Turmeric Shake|Protein Powder,Mango,Turmeric,Coconut Milk|blend|<strong>'Tropical Anti-Inflam'</strong><hr><strong>BENEFIT</strong><br>Joint support + vitamin C.<br><br><strong>CHEF TIP</strong><br>Fresh mango is best. Add a pinch of black pepper to activate turmeric.|30|25|360|8",
        "Turkey Bacon Wrap|Turkey Bacon,Eggs,Low-Carb Tortilla,Salsa|sear|<strong>'Morning Burrito'</strong><hr><strong>BENEFIT</strong><br>High protein portability.<br><br><strong>CHEF TIP</strong><br>Scramble eggs and bacon. Roll in tortilla and sear the seam closed in a hot pan.|30|15|380|15",
        "Ricotta Pear Toast|Ricotta Cheese,Pear,Cinnamon,Walnuts|toast|<strong>'Sweet Ricotta'</strong><hr><strong>BENEFIT</strong><br>Calcium + manganese for bone health.<br><br><strong>CHEF TIP</strong><br>Spread ricotta thick. Top with pear slices. Walnuts add essential crunch.|18|25|320|10",
        "Matcha Protein Shake|Matcha Powder,Vanilla Protein,Almond Milk|blend|<strong>'Zen Shake'</strong><hr><strong>BENEFIT</strong><br>L-Theanine for calm focus.<br><br><strong>CHEF TIP</strong><br>Blend with plenty of ice. Matcha adds an earthy, vibrant profile.|25|2|180|2",
        "Egg Veggie Muffins|Egg Whites,Spinach,Peppers,Onion|bake|<strong>'Meal Prep Cups'</strong><hr><strong>BENEFIT</strong><br>Easy grab-and-go nutrition.<br><br><strong>CHEF TIP</strong><br>Pour eggs over veggies in a silicone muffin tin. Bake 350¬∞F for 20m.|30|4|160|2",
        "Coconut Yogurt Parfait|Coconut Yogurt,Granola(Grain-Free),Blueberries|raw|<strong>'Dairy-Free Parfait'</strong><hr><strong>BENEFIT</strong><br>MCTs for quick brain fuel.<br><br><strong>CHEF TIP</strong><br>Layer yogurt and grain-free granola. Blueberries add antioxidants.|10|20|320|15",
        "Shrimp & Grits (Cauli)|Shrimp,Cauliflower Rice,Nutritional Yeast|sear|<strong>'Low Carb Grits'</strong><hr><strong>BENEFIT</strong><br>High protein, low insulin impact.<br><br><strong>CHEF TIP</strong><br>Mash steamed cauliflower with yeast for 'grits'. Sear shrimp with garlic.|30|10|310|6",
        "Chocolate Avocado Mousse|Chocolate Protein,Avocado,Cocoa,Almond Milk|blend|<strong>'Keto Mousse'</strong><hr><strong>BENEFIT</strong><br>Healthy monounsaturated fats + potassium.<br><br><strong>CHEF TIP</strong><br>Blend with minimal liquid for a thick mousse texture. Serve chilled.|30|8|360|20",
        "Hummus Cucumber Toast|Hummus,Toast,Cucumber,Hemp Seeds|toast|<strong>'Savory Vegan'</strong><hr><strong>BENEFIT</strong><br>Plant protein + hydration.<br><br><strong>CHEF TIP</strong><br>Spread hummus over sprouted toast. Layer cucumber rounds for crunch.|12|25|280|8",
        "Coffee Walnut Shake|Cold Brew Coffee,Protein,Walnuts,Banana|blend|<strong>'Morning Buzz'</strong><hr><strong>BENEFIT</strong><br>Metabolic boost + healthy fats.<br><br><strong>CHEF TIP</strong><br>Use high-quality cold brew. Walnuts add a rich, nutty finish.|30|20|340|12",
        "Pumpkin Spice Waffles|Pumpkin Puree,Egg Whites,Oat Flour,Spice|griddle|<strong>'Pumpkin Waffles'</strong><hr><strong>BENEFIT</strong><br>Beta-carotene for eye health.<br><br><strong>CHEF TIP</strong><br>Whisk pumpkin into batter. Use cinnamon, nutmeg, and ginger spices.|20|20|280|5",
        "Turkey Kale Scramble|Ground Turkey,Kale,Onion,Garlic|sear|<strong>'Lean Green Scramble'</strong><hr><strong>BENEFIT</strong><br>Sulforaphane + lean aminos.<br><br><strong>CHEF TIP</strong><br>Brown turkey with onion. Steam kale directly on top of the meat.|30|5|310|10",
        "PB Strawberry Shake|Vanilla Protein,Peanut Butter Powder,Strawberries|blend|<strong>'PB&J Shake'</strong><hr><strong>BENEFIT</strong><br>Classic flavor profile with reduced fat.<br><br><strong>CHEF TIP</strong><br>Peanut butter powder keeps calories low while providing the signature taste.|30|15|250|5"
    ],
    l: [
        "Beef & Liver Meatballs|80/20 Beef-Liver Blend,Carrot Sticks,Cucumber|bake|<strong>'Legacy Meatballs'</strong><hr><strong>BENEFIT</strong><br>Vitamin A + B12 for recovery.<br><br><strong>CHEF TIP</strong><br>Form meatballs. Bake 375¬∞F 15m. Serve with crisp raw veggie sticks.|25|15|340|15",
        "Ground Beef & Lentils|96% Lean Beef,Black Lentils,Broccoli,Cauliflower|sear|<strong>The 'Super Mince'</strong><hr><strong>BENEFIT</strong><br>Iron + Zinc + high fiber.<br><br><strong>CHEF TIP</strong><br>Brown beef. Add lentils and riced veggies for volume without calories.|50|25|550|15",
        "Chicken Artichoke Salad|Chicken Breast,Artichoke Hearts,Arugula,Lemon|sear|<strong>'Liver Detox Bowl'</strong><hr><strong>BENEFIT</strong><br>Liver-supporting artichokes + lean protein.<br><br><strong>CHEF TIP</strong><br>Sear chicken. Toss with marinated artichokes and peppery arugula.|40|15|420|10",
        "Seared Salmon Salad|Sockeye Salmon,Spinach,Avocado,Radish|sear|<strong>'Omega Salad XL'</strong><hr><strong>BENEFIT</strong><br>Cardiovascular support + potassium.<br><br><strong>CHEF TIP</strong><br>Sear salmon skin-side down for 4 mins. Flake over a large bed of spinach.|38|12|480|22",
        "Bison Veggie Chili|Ground Bison,Carrots,Celery,Bone Broth|stew|<strong>'No-Bean Chili'</strong><hr><strong>BENEFIT</strong><br>High-iron wild game + gut-friendly broth.<br><br><strong>CHEF TIP</strong><br>Simmer browned bison with mirepoix and broth until thick.|48|18|500|15",
        "Turkey Lettuce Cups|Ground Turkey,Water Chestnuts,Ginger,Romaine|sear|<strong>'Crunch Lettuce Cups'</strong><hr><strong>BENEFIT</strong><br>Low carb, high crunch mineral dense meal.<br><br><strong>CHEF TIP</strong><br>Stir fry turkey and chestnuts. Spoon into cold, crisp romaine leaves.|40|10|350|8",
        "Steak & Brussels|Top Sirloin,Brussels Sprouts,Balsamic Vinegar|sear|<strong>'Steak & Green'</strong><hr><strong>BENEFIT</strong><br>Sulfur-rich veggies for detox + aminos.<br><br><strong>CHEF TIP</strong><br>Char sprouts face down in a hot pan. Sear steak to preferred temp.|42|15|460|18",
        "Tuna Cucumber Boats|Tuna,Avocado,Cucumber,Celery|raw|<strong>'Tuna Boats'</strong><hr><strong>BENEFIT</strong><br>Lean selenium + heart-healthy fats.<br><br><strong>CHEF TIP</strong><br>Mix tuna and avocado. Scoop into hollowed-out large cucumber.|35|12|420|20",
        "Shrimp Caesar Salad|Shrimp,Romaine,Tahini-Lemon Dressing|sear|<strong>'Dairy-Free Caesar'</strong><hr><strong>BENEFIT</strong><br>Calcium + iodine for thyroid support.<br><br><strong>CHEF TIP</strong><br>Sear shrimp with lemon. Tahini makes a creamy dairy-free dressing.|30|8|380|15",
        "Venison Stuffed Peppers|Ground Venison,Bell Peppers,Cauli-Rice|bake|<strong>'Game Peppers'</strong><hr><strong>BENEFIT</strong><br>Leanest game meat + vitamin C peppers.<br><br><strong>CHEF TIP</strong><br>Stuff peppers with raw venison/rice mix. Bake at 375¬∞F until tender.|38|20|410|12",
        "Cod & Cabbage Slaw|Cod Fillet,Purple Cabbage,Apple Cider Vinegar|sear|<strong>'Purple Detox'</strong><hr><strong>BENEFIT</strong><br>Anthocyanins for brain health.<br><br><strong>CHEF TIP</strong><br>Sear cod with sea salt. Braise cabbage in ACV for a tangy crunch.|35|12|340|5",
        "Lamb & Cucumber|Lean Lamb Loin,Cucumber,Mint,Lemon|sear|<strong>'Greek Lamb'</strong><hr><strong>BENEFIT</strong><br>Conjugated Linoleic Acid (CLA) + hydration.<br><br><strong>CHEF TIP</strong><br>Sear lamb loin fast. Serve with a cold, chopped cucumber salad.|40|5|420|20",
        "Chicken Waldorf|Chicken Breast,Apple,Walnuts,Celery|raw|<strong>'Chicken Waldorf'</strong><hr><strong>BENEFIT</strong><br>Vitamin E for nerve health.<br><br><strong>CHEF TIP</strong><br>Mix diced chicken, apple, and walnuts with a touch of Greek yogurt.|35|22|440|15",
        "Steak & Beet Jar|Sirloin,Roasted Beets,Arugula,Walnuts|sear|<strong>'Nitrate Jar'</strong><hr><strong>BENEFIT</strong><br>Nitrates for blood flow + red meat iron.<br><br><strong>CHEF TIP</strong><br>Great for prep. Layer beets at bottom, steak in middle, arugula on top.|40|18|450|15",
        "Snapper & Greens|Red Snapper,Collard Greens,Garlic,Lemon|sear|<strong>'Southern Fish'</strong><hr><strong>BENEFIT</strong><br>Vitamin K for bone density.<br><br><strong>CHEF TIP</strong><br>Saut√© greens with garlic. Sear snapper in a separate pan.|35|10|360|8",
        "Turkey Burger & Avo|Turkey Patty,Avocado,Tomato,Lettuce Wrap|sear|<strong>'Bun-less Burger'</strong><hr><strong>BENEFIT</strong><br>Lean building blocks + satiating fats.<br><br><strong>CHEF TIP</strong><br>Sear patty until juice runs clear. Use avocado as the 'sauce'.|40|10|410|18",
        "Bison Asparagus Stir-Fry|Bison Steak,Asparagus,Garlic|sear|<strong>'Zinc Stir-Fry'</strong><hr><strong>BENEFIT</strong><br>Testosterone support from zinc and aminos.<br><br><strong>CHEF TIP</strong><br>Flash fry asparagus. Sear bison strips on very high heat.|42|8|430|12",
        "Sardine Fennel Salad|Sardines,Fennel Bulb,Carrots,Lemon|raw|<strong>'Shaved Fennel Salad'</strong><hr><strong>BENEFIT</strong><br>Digestive enzymes from fennel.<br><br><strong>CHEF TIP</strong><br>Shave fennel thin. Top with sardines and lemon vinaigrette.|25|15|380|15",
        "Chicken Zoodles Pesto|Chicken Breast,Zucchini Noodles,Basil Pesto|sear|<strong>'Pesto Zoodles'</strong><hr><strong>BENEFIT</strong><br>Low calorie, antioxidant basil sauce.<br><br><strong>CHEF TIP</strong><br>Sear chicken. Toss zoodles in hot pan for only 60 seconds to stay crisp.|38|10|420|18",
        "Steak Tartare|Raw Lean Sirloin,Capers,Egg Yolk|raw|<strong>'Classic Tartare'</strong><hr><strong>BENEFIT</strong><br>Maximum nutrient bioavailability.<br><br><strong>CHEF TIP</strong><br>Dice steak very fine. Mix with capers and a raw pasture yolk.|38|2|350|18",
        "Shrimp Ceviche|Shrimp,Avocado,Lime,Cilantro|sear|<strong>'Shrimp Ceviche'</strong><hr><strong>BENEFIT</strong><br>Enzymatic protein digestion.<br><br><strong>CHEF TIP</strong><br>Mix cooked shrimp with avocado and fresh lime. Serve chilled.|30|12|400|20",
        "Liver Pate Plate|Beef Liver Pat√©,Carrot Sticks,Cucumber|raw|<strong>'Vitamin A Box'</strong><hr><strong>BENEFIT</strong><br>Immune supporting organ meats.<br><br><strong>CHEF TIP</strong><br>Use a high-quality liver pat√©. Serve with cold veggie sticks.|25|15|340|20",
        "Venison & Squash|Venison,Butternut Squash,Sage|sear|<strong>'Hunter Plate'</strong><hr><strong>BENEFIT</strong><br>Cleanest protein source available.<br><br><strong>CHEF TIP</strong><br>Roast squash cubes. Sear venison with sage and butter.|40|25|450|12",
        "Mussels & Broth|Mussels,Garlic,Parsley,Bone Broth|steam|<strong>'Moules (No Frites)'</strong><hr><strong>BENEFIT</strong><br>Massive B12 + minerals.<br><br><strong>CHEF TIP</strong><br>Steam mussels in a savory garlic broth until they open.|30|5|300|8",
        "Turkey Pear Rollups|Deli Turkey,Pear,Walnuts|raw|<strong>'Sweet Savory Roll'</strong><hr><strong>BENEFIT</strong><br>Balanced snack/lunch on the go.<br><br><strong>CHEF TIP</strong><br>Wrap fresh pear slices and walnuts in deli turkey slices.|35|18|390|15",
        "Clam Zucchini Linguine|Clams,Zucchini,Garlic,Parsley|sear|<strong>'Clam Zoodles'</strong><hr><strong>BENEFIT</strong><br>Iron-rich shellfish + low carb fiber.<br><br><strong>CHEF TIP</strong><br>Toss zoodles with canned clams and their natural juices.|30|10|280|5",
        "Chicken Braised Kale|Chicken Breast,Lacinato Kale,Lemon|sear|<strong>'Iron Chicken'</strong><hr><strong>BENEFIT</strong><br>Folate + lean amino acids.<br><br><strong>CHEF TIP</strong><br>Braise kale soft in broth. Top with seared chicken.|40|12|400|10",
        "Bison Cabbage Skillet|Ground Bison,Red Cabbage,ACV|sear|<strong>'Purple Skillet'</strong><hr><strong>BENEFIT</strong><br>Strong detox properties from cabbage.<br><br><strong>CHEF TIP</strong><br>Brown bison. Braise cabbage with a splash of apple cider vinegar.|38|15|420|18",
        "Salmon & Broccoli|Salmon,Broccoli,Sesame Oil,Ginger|sear|<strong>'Sesame Salmon'</strong><hr><strong>BENEFIT</strong><br>Iodine + Omega-3 brain support.<br><br><strong>CHEF TIP</strong><br>Sear salmon. Stir fry broccoli with fresh ginger and sesame oil.|38|10|440|22",
        "Roast Beef & Radishes|Sirloin,Radishes,Thyme|sear|<strong>'Faux Potato Roast'</strong><hr><strong>BENEFIT</strong><br>Low calorie potato alternative.<br><br><strong>CHEF TIP</strong><br>Roasted radishes lose their bite and taste like potatoes. Perfect with steak.|40|8|410|18"
    ],
    d: [
        "Bison Portobello Burger|Ground Bison,Portobello,Avocado,Lettuce|sear|<strong>'The Portobello Stack'</strong><hr><strong>BENEFIT</strong><br>High protein Wild game + vitamin D mushroom bun.<br><br><strong>CHEF TIP</strong><br>Clean mushroom. Form bison patty. Sear both. Stack with avocado.|45|8|480|22",
        "Balsamic Beef & Mushrooms|80/20 Beef-Liver Blend,Mushrooms,Balsamic|sear|<strong>'Balsamic Beef'</strong><hr><strong>BENEFIT</strong><br>Vitamin A and iron masked by rich balsamic flavor.<br><br><strong>CHEF TIP</strong><br>Saut√© mushrooms first. Add meat blend. Deglaze with vinegar.|42|12|430|20",
        "Filet & Lentils|Filet Mignon,Black Lentils,Asparagus,Lemon|sear|<strong>'Steak & Lentils'</strong><hr><strong>BENEFIT</strong><br>Maximum protein absorption + fiber.<br><br><strong>CHEF TIP</strong><br>Sear steak to desired temp. Serve over warm lentils and steamed stems.|45|25|520|18",
        "Chicken & Avocado Mash|Chicken Breast,Avocado,Brussels Sprouts|sear|<strong>'Chicken Guac'</strong><hr><strong>BENEFIT</strong><br>Potassium-rich healthy fats + lean protein.<br><br><strong>CHEF TIP</strong><br>Sear chicken. Mash fresh avocado on top as a clean sauce.|42|15|550|25",
        "Halibut White Beans|Halibut,Cannellini Beans,Kale,Garlic|bake|<strong>'White Fish Stew'</strong><hr><strong>BENEFIT</strong><br>Clean sea protein + slow-burning beans.<br><br><strong>CHEF TIP</strong><br>Saut√© kale and beans together. Pan-sear fish and place on top.|38|20|420|10",
        "Venison Squash Bowl|Venison,Acorn Squash,Pomegranate|sear|<strong>'Harvest Bowl'</strong><hr><strong>BENEFIT</strong><br>Iron + complex carbohydrates + antioxidants.<br><br><strong>CHEF TIP</strong><br>Roast squash until soft. Sear venison with salt and pomegranate.|40|35|480|12",
        "Bison Stuffed Peppers|Bison,Bell Peppers,Lentils|bake|<strong>'Bison Peppers'</strong><hr><strong>BENEFIT</strong><br>Vitamin C booster with high-zinc bison.<br><br><strong>CHEF TIP</strong><br>Stuff peppers with pre-cooked meat and lentils. Bake until tender.|38|25|450|15",
        "Salmon & Artichokes|Salmon,Artichoke Hearts,Lemon|bake|<strong>'Sheet Pan Salmon'</strong><hr><strong>BENEFIT</strong><br>Detox support from artichokes + omega-3s.<br><br><strong>CHEF TIP</strong><br>Bake salmon and marinated artichokes on one pan for 15 mins.|38|15|460|22",
        "Duck & Cherries|Duck Breast,Cherries,Spinach|sear|<strong>'Duck Confit Lite'</strong><hr><strong>BENEFIT</strong><br>Rich minerals + sleep-supporting melatonin in cherries.<br><br><strong>CHEF TIP</strong><br>Sear duck skin-side down until crispy. Serve with warm cherries.|35|20|520|28",
        "Scallops & Spinach|Scallops,Spinach,Bacon|sear|<strong>'Seared Scallops'</strong><hr><strong>BENEFIT</strong><br>Leanest protein + magnesium.<br><br><strong>CHEF TIP</strong><br>Hard sear scallops 2m per side. Saut√© spinach in the same pan.|30|5|350|12",
        "Ribeye & Mushrooms|Ribeye,Mushrooms,Thyme|sear|<strong>'Keto Ribeye'</strong><hr><strong>BENEFIT</strong><br>Satiating fats for better sleep + aminos.<br><br><strong>CHEF TIP</strong><br>Sear ribeye in butter and thyme. Use plenty of mushrooms for volume.|35|2|600|40",
        "Turkey Meatloaf|Turkey,Almond Flour,Tomato Paste|bake|<strong>'Lean Loaf'</strong><hr><strong>BENEFIT</strong><br>High volume meal prep staple.<br><br><strong>CHEF TIP</strong><br>Form loaf with turkey and almond flour. Bake 375¬∞F for 30m.|40|10|380|15",
        "Lamb Chops & Mint|Lamb Chops,Mint,Peas|sear|<strong>'Spring Lamb'</strong><hr><strong>BENEFIT</strong><br>B12 density for nerve health.<br><br><strong>CHEF TIP</strong><br>Sear chops quickly. Serve with mint sauce and fresh peas.|38|15|480|25",
        "Cod in Tomato Water|Cod,Cherry Tomatoes,Basil|poach|<strong>'Aqua Pazza'</strong><hr><strong>BENEFIT</strong><br>Lycopene + clean white protein.<br><br><strong>CHEF TIP</strong><br>Simmer fish in tomato water until it flakes easily.|35|8|320|5",
        "Chicken & Asparagus|Chicken Breast,Asparagus,Lemon|sear|<strong>'Sheet Pan Chicken'</strong><hr><strong>BENEFIT</strong><br>Diuretic asparagus + lean amino acids.<br><br><strong>CHEF TIP</strong><br>Roast everything at 400¬∞F with lemon slices for flavor.|40|5|380|10",
        "Pork Chop & Apple|Pork Chop,Apple,Fennel|sear|<strong>'Pork & Apple'</strong><hr><strong>BENEFIT</strong><br>Thiamine + vitamin C.<br><br><strong>CHEF TIP</strong><br>Sear pork loin chops. Saut√© apples and fennel bulb alongside.|38|20|450|18",
        "Shrimp Stir Fry|Shrimp,Broccoli,Snap Peas|sear|<strong>'Shrimp Fry'</strong><hr><strong>BENEFIT</strong><br>Fast protein for busy nights.<br><br><strong>CHEF TIP</strong><br>High heat sear all ingredients in 5 mins. Keep veggies crisp.|35|12|350|8",
        "Bison & Sweet Potato|Bison Steak,Sweet Potato,Kale|sear|<strong>'Bison Mash'</strong><hr><strong>BENEFIT</strong><br>Glycogen replenishment + high iron recovery.<br><br><strong>CHEF TIP</strong><br>Sear bison steak. Serve with boiled and mashed sweet potato.|40|30|500|15",
        "Trout & Almonds|Trout,Almonds,Green Beans|sear|<strong>'Trout Amandine'</strong><hr><strong>BENEFIT</strong><br>Brain-healthy phosphorus + healthy nut fats.<br><br><strong>CHEF TIP</strong><br>Sear trout. Top with toasted almond slivers and green beans.|38|8|460|20",
        "Chicken Curry|Chicken,Coconut Milk,Cauliflower|stew|<strong>'Keto Curry'</strong><hr><strong>BENEFIT</strong><br>Immune-boosting spices + satiating coconut fat.<br><br><strong>CHEF TIP</strong><br>Simmer chicken in coconut milk and yellow curry spices.|35|10|450|25",
        "Beef & Broccoli|Flank Steak,Broccoli,Soy Sauce|sear|<strong>'Beef & Broc'</strong><hr><strong>BENEFIT</strong><br>High zinc + vitamin K.<br><br><strong>CHEF TIP</strong><br>Flash fry flank steak strips and broccoli florets on high heat.|40|10|420|18",
        "Turkey Stuffed Squash|Turkey,Acorn Squash,Sage|bake|<strong>'Squash Boats'</strong><hr><strong>BENEFIT</strong><br>High fiber + lean building blocks.<br><br><strong>CHEF TIP</strong><br>Roast squash. Fill with cooked ground turkey and sage.|35|25|400|12",
        "Salmon & Cucumber|Salmon,Cucumber,Dill|sear|<strong>'Cold Salmon Plate'</strong><hr><strong>BENEFIT</strong><br>Light dinner for deep sleep.<br><br><strong>CHEF TIP</strong><br>Sear salmon. Serve with a cold dill cucumber salad.|38|5|440|22",
        "Liver & Onions|Beef Liver,Onions,Bacon|sear|<strong>'The Original'</strong><hr><strong>BENEFIT</strong><br>Ultimate multivitamin from organ meat.<br><br><strong>CHEF TIP</strong><br>Soak liver in milk first. Sear very quickly with onions and bacon.|45|12|400|15",
        "Chicken & Zucchini|Chicken Thighs,Zucchini,Garlic|bake|<strong>'Chicken Bake'</strong><hr><strong>BENEFIT</strong><br>Juicy protein + hydration.<br><br><strong>CHEF TIP</strong><br>Bake bone-in thighs until crispy. Serve with roasted zucchini.|35|5|450|25",
        "Steak Salad|Sirloin,Mixed Greens,Vinaigrette|sear|<strong>'Steakhouse Salad'</strong><hr><strong>BENEFIT</strong><br>Lean iron + polyphenols from greens.<br><br><strong>CHEF TIP</strong><br>Sear sirloin steak. Slice thin over a large mixed green salad.|40|5|420|20",
        "White Fish & Olives|Cod,Kalamata Olives,Tomatoes|bake|<strong>'Mediterranean Cod'</strong><hr><strong>BENEFIT</strong><br>Healthy monounsaturated fats + white protein.<br><br><strong>CHEF TIP</strong><br>Bake fish with olives and cherry tomatoes on top.|35|5|350|12",
        "Bison & Cabbage|Bison,Red Cabbage,Caraway|sear|<strong>'Hunter Skillet'</strong><hr><strong>BENEFIT</strong><br>Hormone health + digestive caraway seeds.<br><br><strong>CHEF TIP</strong><br>Saut√© bison and cabbage in one pan until wilted.|40|10|420|15",
        "Shrimp & Pesto|Shrimp,Zucchini Noodles,Pesto|sear|<strong>'Pesto Shrimp'</strong><hr><strong>BENEFIT</strong><br>High iodine + magnesium.<br><br><strong>CHEF TIP</strong><br>Toss cooked shrimp and zoodles in high-quality pesto.|30|8|380|18",
        "Turkey & Sweet Potato|Turkey Breast,Sweet Potato,Green Beans|roast|<strong>'Thanksgiving Lite'</strong><hr><strong>BENEFIT</strong><br>Tryptophan for sleep + beta-carotene.<br><br><strong>CHEF TIP</strong><br>Roast turkey and potato cubes with green beans at 400¬∞F.|40|30|450|10"
    ],
    s: [
        "Beef Isolate Shake|Beef Isolate Protein,Water,Ice|shake|<strong>Prep:</strong> 2m<hr><strong>Longevity Win</strong><br>Collagen rich for joint and skin structural support.|25|0|110|0",
        "Sardines (Water)|Sardines,Lemon,Hot Sauce|raw|<strong>Prep:</strong> 1m<hr><strong>Longevity Win</strong><br>Omega-3 powerhouse for brain and heart health.|22|0|190|10",
        "Avocado Cup|1/2 Avocado,Sea Salt|raw|<strong>Prep:</strong> 1m<hr><strong>Longevity Win</strong><br>Healthy fats and potassium for electrolyte balance.|2|8|160|15",
        "Bone Broth Cup|Bone Broth,Salt,Turmeric|heat|<strong>Prep:</strong> 3m<hr><strong>Longevity Win</strong><br>Gelatin and glycine for gut lining repair.|10|0|50|0",
        "Hard Boiled Eggs|2 Eggs,Salt,Pepper|boil|<strong>Prep:</strong> 10m<hr><strong>Longevity Win</strong><br>Choline for brain membrane and focus.|12|1|140|10"
    ]
};

// --- BIOMETRIC DATA ---
var defaultUH = {
    'J': {
        now: {bf:19.0, m:99.0, w:217.0, vf:10, bmr:2050}, 
        goal: {bf:15.0, m:105.0, w:212.0, vf:7, bmr:2150},
        labs: {apob:{val:95,goal:60,unit:"mg/dL",name:"ApoB",lowerIsBetter:true},hba1c:{val:5.4,goal:5.0,unit:"%",name:"HbA1c",lowerIsBetter:true}},
        tests: {vo2:{val:45,goal:55,unit:"ml/kg",name:"VO2 Max"},hang:{val:85,goal:120,unit:"s",name:"Dead Hang"}}
    },
    'S': {
        now: {bf:36.1, m:49.2, w:141.5, vf:9, bmr:1250},
        goal: {bf:22.0, m:60.0, w:135.0, vf:4, bmr:1450}, 
        labs: {ana:{val:320,goal:40,unit:" titer",name:"ANA",lowerIsBetter:true},gluc:{val:84,goal:75,unit:"mg/dL",name:"Glucose",lowerIsBetter:true},hba1c:{val:5.6,goal:5.0,unit:"%",name:"HbA1c",lowerIsBetter:true},crp:{val:1.8,goal:0.5,unit:"mg/L",name:"hs-CRP",lowerIsBetter:true}},
        tests: {vo2:{val:32,goal:50,unit:"ml/kg",name:"VO2 Max"},hang:{val:40,goal:90,unit:"s",name:"Dead Hang"}}
    }
};

var uH = JSON.parse(localStorage.getItem('centurion_bio_v2')) || defaultUH;

// --- RENDER LOGIC ---
function render(){
    const mon = getMon(offset);
    const tabs = document.getElementById('dayTabs'); tabs.innerHTML='';
    const days = ["MON","TUE","WED","THU","FRI","SAT","SUN"];
    for(let i=0; i<7; i++){
        let d = new Date(mon); d.setDate(mon.getDate()+i);
        let active = getDateKey(d) === getDateKey(selDate);
        let t = document.createElement('div'); t.className='tab'+(active?' active':'');
        t.innerHTML=`${days[i]}<br>${d.getDate()}`;
        t.onclick=()=>{selDate=d; render();}; tabs.appendChild(t);
        if(active) showDay(d, i);
    }
}

function showDay(d, i){
    if(!mDB.b.length) return; // Prevent Step 2 crash
    const sch=["HEAVY LIFT","BOXING","REFORM","BOXING","REFORM/YOGA","CS4","RELAX"];
    const jcs=["PINEAPPLE GREEN Vitality","TITAN RED Juice","ZENITH GREEN Juice","TITAN RED Juice","ZENITH GREEN Juice","TITAN RED Juice","APOLLO GOLD Juice"];
    const w = sch[i]; const id = Math.floor(d.getTime()/864e5);
    const b=mDB.b[Math.abs(id)%mDB.b.length].split('|'), l=mDB.l[Math.abs(id)%mDB.l.length].split('|'), dn=mDB.d[Math.abs(id)%mDB.d.length].split('|');
    const sc = (user==='J')?1:0.6;
    
    document.getElementById('dayContent').innerHTML = `
        <div class="card" style="border-bottom:4px solid var(--blue)">
            <div style="display:flex; justify-content:space-between; text-align:center">
                <div><div class="label">WARM</div>${pDB[w][0].h}</div>
                <div style="color:var(--blue); font-weight:900">‚ûú ${w}</div>
                <div><div class="label">RECOVER</div>${pDB[w][2].h}</div>
            </div>
        </div>
        <div class="label">üç≥ BREAKFAST</div><div class="value"><span>${b[0]}</span><span class="macro-pill">${Math.round(b[4]*sc)}P</span></div>
        <div class="label">ü•ó LUNCH</div><div class="value"><span>${l[0]}</span><span class="macro-pill">${Math.round(l[4]*sc)}P</span></div>
        <div class="label">üçΩÔ∏è DINNER</div><div class="value"><span>${dn[0]}</span><span class="macro-pill">${Math.round(dn[4]*sc)}P</span></div>
        <div class="macro-dashboard">
            <div class="macro-label">PROTEIN <span>${Math.round(150*sc)}g Goal</span></div>
            <div class="macro-bg"><div class="macro-fill" style="width:75%; background:var(--g-pro)"></div></div>
        </div>
    `;
}

// --- BIO/OURA LOGIC ---
function safeOpenBio() { document.getElementById('mBody').innerHTML=''; openBio(); }
function openBio() {
    document.getElementById('mTitle').innerText = (user==='J'?'JERMAINE':'SOPHIA');
    document.getElementById('mSub').innerText = "CLINICAL DATA";
    document.getElementById('mBody').innerHTML = `
        <div class="tabs">
            <div class="tab active" id="btPhys" onclick="renderBioTab('phys')">BODY</div>
            <div class="tab" id="btLabs" onclick="renderBioTab('labs')">LABS</div>
            <div class="tab" id="btOura" onclick="renderOuraTab()">OURA</div>
        </div>
        <div id="bioContentArea"></div>
    `;
    renderBioTab('phys');
    document.getElementById('masterModal').style.display='block';
}

function bioBar(label, val, goal, unit, lowerBetter=false) {
    const pct = Math.min(lowerBetter ? (goal / val) * 100 : (val / goal) * 100, 100);
    const color = pct >= 100 ? 'var(--green)' : 'var(--gold)';
    return `<div class="bio-section">
        <div class="label" style="color:white; margin-bottom:8px">${label}</div>
        <div class="bar-row"><div class="bar-lbl">NOW</div><div class="bar-track"><div class="bar-fill" style="width:${pct}%;background:${color}"></div></div><div class="bar-lbl" style="text-align:right">${val}${unit}</div></div>
        <div class="bar-row"><div class="bar-lbl" style="color:var(--blue)">GOAL</div><div class="bar-track"><div class="bar-fill" style="width:100%;background:var(--blue);opacity:0.3"></div></div><div class="bar-lbl" style="text-align:right;color:var(--blue)">${goal}${unit}</div></div>
    </div>`;
}

function renderBioTab(tab) {
    const area = document.getElementById('bioContentArea');
    const u = uH[user];
    document.querySelectorAll('.tab').forEach(t=>t.classList.remove('active'));
    document.getElementById('bt'+tab.charAt(0).toUpperCase()+tab.slice(1)).classList.add('active');
    
    if(tab==='phys') {
        area.innerHTML = bioBar("Body Fat", u.now.bf, u.goal.bf, "%", true) + bioBar("Muscle", u.now.m, u.goal.m, "lbs") + bioBar("Visceral", u.now.vf, u.goal.vf, "", true);
    } else if(tab==='labs') {
        area.innerHTML = Object.keys(u.labs).map(k => {
            const l = u.labs[k];
            return `<div onclick="updateBioVal('labs','${k}','${l.name}')">${bioBar(l.name, l.val, l.goal, l.unit, l.lowerIsBetter)}</div>`;
        }).join('');
    }
}

function renderOuraTab() {
    const area = document.getElementById('bioContentArea');
    document.querySelectorAll('.tab').forEach(t=>t.classList.remove('active'));
    document.getElementById('btOura').classList.add('active');
    
    if(!window.ouraHistory.length) { area.innerHTML="<p style='text-align:center;padding:20px;color:#666'>No Sync Data</p>"; return; }
    
    const latest = window.ouraHistory[0];
    area.innerHTML = `
        <div class="bio-section" style="text-align:center"><div class="label">READINESS</div><div style="font-size:2.5rem;font-weight:800">${latest.score}</div></div>
        <div class="bio-section">
            <div class="oura-hist-row"><span>Deep Sleep</span><span style="color:white">${Math.round(latest.deep/60)}m</span></div>
            <div class="oura-hist-row"><span>REM Sleep</span><span style="color:white">${Math.round(latest.rem/60)}m</span></div>
            <div class="oura-hist-row"><span>Resting HR</span><span style="color:var(--green)">${latest.rhr} bpm</span></div>
        </div>
    `;
}

async function fetchOuraData() {
    let token = getActiveToken(); if(!token) return;
    const PROXY = "https://corsproxy.io/?";
    const today = new Date().toISOString().split('T')[0];
    const lookback = new Date(Date.now() - 864e5*7).toISOString().split('T')[0];
    try {
        const [r, s] = await Promise.all([
            fetch(PROXY + encodeURIComponent(`https://api.ouraring.com/v2/usercollection/daily_readiness?start_date=${lookback}&end_date=${today}`), {headers:{'Authorization':`Bearer ${token}`}}),
            fetch(PROXY + encodeURIComponent(`https://api.ouraring.com/v2/usercollection/daily_sleep?start_date=${lookback}&end_date=${today}`), {headers:{'Authorization':`Bearer ${token}`}})
        ]);
        const rJ = await r.json(), sJ = await s.json();
        if(rJ.data) {
            window.ouraHistory = rJ.data.map(d => {
                const sleep = sJ.data.find(x=>x.day===d.day) || {};
                return { date: d.day, score: d.score, rhr: sleep.lowest_heart_rate || 0, deep: sleep.deep_sleep_duration || 0, rem: sleep.rem_sleep_duration || 0 };
            }).reverse();
            const top = window.ouraHistory[0];
            document.getElementById('dateDisplay').innerHTML = `<span style="color:var(--green)">üíç ${user}: ${top.score} (RHR: ${top.rhr || '-'})</span>`;
        }
    } catch(e) { document.getElementById('dateDisplay').innerText="Sync Error"; }
}

function updateBioVal(s, k, n) {
    let v = prompt("New value for "+n, uH[user][s][k].val);
    if(v) { uH[user][s][k].val = parseFloat(v); localStorage.setItem('centurion_bio_v2', JSON.stringify(uH)); renderBioTab(s); }
}
function switchU(uID){ user=uID; localStorage.setItem('centurion_active_user',uID); render(); fetchOuraData(); }
function changeW(d){ offset+=d; selDate.setDate(selDate.getDate()+(d*7)); render(); }
function resetD(){ offset=0; selDate=getCaDate(); render(); }
function forceClose(){ document.getElementById('masterModal').style.display='none'; }
function closeM(e){ if(e.target.className==='modal') forceClose(); }

window.onload = ()=>{ render(); fetchOuraData(); };
</script>
</body>
</html>