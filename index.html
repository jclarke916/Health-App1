<!DOCTYPE html>

<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no">
    <title>The Centurion | v17.0 STABLE</title>
    <link href="https://fonts.googleapis.com/css2?family=JetBrains+Mono:wght@400;700&family=Inter:wght@300;400;600;800;900&display=swap" rel="stylesheet">
    <style>
        :root {
            --bg: #000000; --panel: #0a0a0a; --border: #222; --acid: #ccff00; --cyan: #00f0ff;
            --gold: #FFD60A; --alert: #ff453a; --purple: #bf5af2; --text: #ffffff; --muted: #666;
            --font-ui: 'Inter', sans-serif; --font-data: 'JetBrains Mono', monospace;
        }
        * { box-sizing: border-box; -webkit-tap-highlight-color: transparent; }
        body { margin: 0; padding: 0 0 120px 0; background: var(--bg); color: var(--text); font-family: var(--font-ui); min-height: 100vh; }
        .hud-header { padding: 15px 16px; background: rgba(0,0,0,0.95); position: sticky; top: 0; z-index: 100; border-bottom: 1px solid var(--border); }
        .top-bar { display: flex; justify-content: space-between; align-items: center; margin-bottom: 10px; }
        .app-name { font-size: 0.6rem; font-weight: 900; letter-spacing: 2px; color: var(--muted); }
        .user-switch { display: flex; gap: 4px; background: #222; padding: 2px; border-radius: 20px; }
        .u-badge { padding: 6px 14px; border-radius: 16px; font-size: 0.6rem; font-weight: 700; color: #666; background: transparent; border: none; cursor: pointer; transition: all 0.2s; }
        .u-badge.active { background: var(--text); color: #000; }
        .date-nav { display: flex; justify-content: center; align-items: center; gap: 20px; font-family: var(--font-data); font-size: 0.8rem; font-weight: 700; color: #fff; padding-top: 10px; border-top: 1px solid #222; margin-top: 10px; }
        .nav-btn { background: transparent; border: 1px solid var(--border); color: var(--gold); padding: 8px 20px; border-radius: 4px; cursor: pointer; font-size: 0.8rem; font-weight: 900; }
        .date-display { min-width: 120px; text-align: center; letter-spacing: 1px; color: var(--acid); }

```
    .hero-section { padding: 20px 16px; display: flex; align-items: center; justify-content: space-between; }
    .score-box { position: relative; display: flex; flex-direction: column; align-items: center; justify-content: center; border-radius: 50%; border: 3px solid var(--border); cursor: pointer; }
    .score-box.small { width: 70px; height: 70px; }
    .score-val { font-family: var(--font-data); font-size: 1.4rem; font-weight: 900; color: #fff; }
    .score-label { font-size: 0.45rem; font-weight: 700; color: var(--muted); text-transform: uppercase; margin-top: 2px; }
    
    .tactical-box { flex: 1; margin-left: 20px; border-left: 3px solid var(--acid); padding: 10px 0 10px 15px; }
    .tac-cmd { font-size: 0.75rem; font-weight: 700; color: #fff; line-height: 1.3; }
    
    .alert-banner { margin: 0 16px 20px; padding: 12px; border-radius: 8px; font-size: 0.65rem; font-weight: 800; text-align: center; display: none; text-transform: uppercase; }
    .alert-banner.show { display: block; }
    .alert-warning { background: #FFD60A; color: #000; }
    
    .timeline-container { padding: 0 16px; margin-bottom: 40px; }
    .time-slot { display: flex; gap: 12px; margin-bottom: 15px; }
    .ts-time { width: 50px; font-family: var(--font-data); font-size: 0.7rem; color: var(--muted); text-align: right; padding-top: 5px; }
    .ts-card { flex: 1; background: var(--panel); border: 1px solid var(--border); border-radius: 12px; padding: 12px 50px 12px 12px; position: relative; transition: all 0.2s; }
    .ts-card:active { transform: scale(0.98); }
    .ts-title { font-size: 0.75rem; font-weight: 700; color: #fff; margin-bottom: 3px; }
    .ts-desc { font-size: 0.6rem; color: #888; line-height: 1.3; }
    
    .check-btn { position: absolute; top: 0; right: 0; width: 50px; height: 50px; display: flex; align-items: center; justify-content: center; cursor: pointer; }
    .check-circle { width: 28px; height: 28px; border-radius: 50%; border: 2px solid #666; background: rgba(0,0,0,0.5); display: flex; align-items: center; justify-content: center; font-weight: 900; font-size: 0.9rem; transition: all 0.2s; }
    .ts-card.checked .check-circle { background: var(--acid); border-color: var(--acid); color: #000; }
    .ts-card.checked { border-color: var(--acid); background: rgba(204,255,0,0.03); }
    
    .sync-footer { position: fixed; bottom: 0; left: 0; width: 100%; background: rgba(0,0,0,0.98); padding: 12px 16px; border-top: 1px solid var(--border); display: flex; justify-content: space-between; align-items: center; z-index: 200; }
    .sync-status { font-family: var(--font-data); font-size: 0.6rem; color: #666; }
    .sync-btn { background: var(--acid); color: #000; border: none; padding: 8px 16px; border-radius: 6px; cursor: pointer; font-weight: 900; font-size: 0.7rem; }
</style>
```

</head>
<body>
    <div class="hud-header">
        <div class="top-bar">
            <div class="app-name">CENTURION v17.0 STABLE</div>
            <div class="user-switch">
                <button id="btn-jermaine" class="u-badge active" onclick="if(window.app)app.switchUser('jermaine')">JER</button>
                <button id="btn-sophia" class="u-badge" onclick="if(window.app)app.switchUser('sophia')">SOPH</button>
            </div>
        </div>
        <div class="date-nav">
            <button class="nav-btn" onclick="if(window.app)app.changeDate(-1)">â—€</button>
            <span class="date-display" id="dateLabel">LOADING...</span>
            <button class="nav-btn" onclick="if(window.app)app.changeDate(1)">â–¶</button>
        </div>
    </div>

```
<div id="alertBanner" class="alert-banner"></div>

<div class="hero-section">
    <div class="score-box small">
        <div class="score-val" id="dayScore">--</div>
        <div class="score-label">TODAY</div>
    </div>
    <div class="tactical-box">
        <div class="tac-cmd" id="statusMsg">INITIALIZING...</div>
    </div>
</div>

<div class="timeline-container" id="timeline"></div>

<div class="sync-footer">
    <span class="sync-status" id="syncStatus">INIT</span>
    <button class="sync-btn" onclick="if(window.app)app.sync()">ðŸ”„ SYNC</button>
</div>

<script>
```

// === GLOBAL DATA ===
const USERS = {
jermaine: {
name: â€œJermaineâ€,
goals: { water: 140 },
defaultBios: { bmr: â€˜2057â€™ }
},
sophia: {
name: â€œSophiaâ€,
goals: { water: 100 },
defaultBios: { bmr: â€˜1450â€™ }
}
};

const BASE_PROTOCOL = [
{id:â€˜sunriseâ€™, time:â€˜06:00â€™, title:â€˜Morning Walkâ€™, desc:â€˜15min walk + cold showerâ€™, macros:{p:0,o:0,cal:0}, calBurn:60},
{id:â€˜breakfastâ€™, time:â€˜07:30â€™, title:â€˜Breakfast ðŸ‘†â€™, desc:â€˜High protein omega-3â€™, macros:{p:54,o:4000,cal:640}, clickable:true},
{id:â€˜trainâ€™, time:â€˜09:00â€™, title:â€˜Training ðŸ‘†â€™, desc:â€˜Strength or cardioâ€™, macros:{p:0,o:0,cal:0}, calBurn:400, clickable:true},
{id:â€˜lunchâ€™, time:â€˜13:00â€™, title:â€˜Lunch ðŸ‘†â€™, desc:â€˜Balanced protein mealâ€™, macros:{p:52,o:3800,cal:680}, clickable:true},
{id:â€˜dinnerâ€™, time:â€˜18:30â€™, title:â€˜Dinner ðŸ‘†â€™, desc:â€˜Light evening mealâ€™, macros:{p:56,o:3600,cal:720}, clickable:true},
{id:â€˜eveningâ€™, time:â€˜21:00â€™, title:â€˜Wind Downâ€™, desc:â€˜Chamomile tea + stretchâ€™, macros:{p:0,o:0,cal:0}, calBurn:0}
];

const TOKENS = {
jermaine: â€˜WLIGFPFJQY73G43BY7CK7H6UJXPQ7N5Yâ€™,
sophia: â€˜4QSDWYJJUZFHRWRH727NCK7WH4COQJF4â€™
};

// === CORE APP CLASS ===
class CenturionApp {
constructor() {
console.log(â€˜ðŸš€ Initializing Centurion v17.0â€™);

```
    this.user = localStorage.getItem('centurion_user') || 'jermaine';
    this.history = [];
    this.currentIndex = 0;
    this.currentDateStr = new Date().toLocaleDateString('en-CA');
    this.checked = {};
    this.bios = {};
    this.sleepDebtCritical = false;
    this.protocol = [];
    
    this.loadUserData();
    this.setPlaceholderData();
    this.fetchOuraData();
}

loadUserData() {
    console.log('ðŸ“¦ Loading user data for:', this.user);
    const savedChecked = localStorage.getItem(`c_checked_${this.user}`);
    this.checked = savedChecked ? JSON.parse(savedChecked) : {};
    const savedBios = localStorage.getItem(`c_bios_${this.user}`);
    this.bios = savedBios ? JSON.parse(savedBios) : USERS[this.user].defaultBios;
    console.log('âœ… Loaded:', Object.keys(this.checked).length, 'days of tasks');
}

saveUserData() {
    localStorage.setItem(`c_checked_${this.user}`, JSON.stringify(this.checked));
    localStorage.setItem(`c_bios_${this.user}`, JSON.stringify(this.bios));
    console.log('ðŸ’¾ Saved user data');
}

setPlaceholderData() {
    this.history = [{
        date: this.currentDateStr,
        score: 0,
        totalSec: 0,
        deepSec: 0,
        remSec: 0,
        rhr: '-',
        cal: 0,
        workouts: []
    }];
    this.currentIndex = 0;
}

async fetchOuraData() {
    console.log('ðŸ”„ Fetching Oura data...');
    this.setText('syncStatus', 'SYNCING...');
    
    try {
        const end = new Date();
        end.setDate(end.getDate() + 1);
        const start = new Date();
        start.setDate(start.getDate() - 10);
        
        const startStr = start.toISOString().split('T')[0];
        const endStr = end.toISOString().split('T')[0];
        const token = TOKENS[this.user];
        
        const url = `https://corsproxy.io/?${encodeURIComponent(
            `https://api.ouraring.com/v2/usercollection/sleep?start_date=${startStr}&end_date=${endStr}`
        )}`;
        
        const response = await fetch(url, {
            headers: { 'Authorization': `Bearer ${token}` }
        });
        
        if (!response.ok) throw new Error('API request failed');
        
        const data = await response.json();
        console.log('ðŸ“Š Received', data.data?.length || 0, 'sleep records');
        
        this.processSleepData(data.data || []);
        this.setText('syncStatus', 'SYNCED âœ“');
        this.render();
        
    } catch (error) {
        console.error('âŒ Sync failed:', error);
        this.setText('syncStatus', 'OFFLINE');
        this.render();
    }
}

processSleepData(sleepData) {
    const sleepMap = new Map();
    
    sleepData.forEach(session => {
        if (!sleepMap.has(session.day)) {
            sleepMap.set(session.day, {
                date: session.day,
                score: 0,
                totalSec: 0,
                deepSec: 0,
                remSec: 0,
                rhr: '-',
                cal: 0,
                workouts: []
            });
        }
        
        const day = sleepMap.get(session.day);
        day.totalSec += session.total_sleep_duration || 0;
        day.deepSec += session.deep_sleep_duration || 0;
        day.remSec += session.rem_sleep_duration || 0;
    });
    
    this.history = Array.from(sleepMap.values())
        .sort((a, b) => b.date.localeCompare(a.date));
    
    this.currentIndex = this.history.findIndex(h => h.date === this.currentDateStr);
    if (this.currentIndex === -1) {
        this.history.unshift({
            date: this.currentDateStr,
            score: 0,
            totalSec: 0,
            deepSec: 0,
            remSec: 0,
            rhr: '-',
            cal: 0,
            workouts: []
        });
        this.currentIndex = 0;
    }
    
    console.log('âœ… Processed', this.history.length, 'days');
}

changeDate(direction) {
    const newIndex = this.currentIndex - direction;
    if (newIndex >= 0 && newIndex < this.history.length) {
        this.currentIndex = newIndex;
        this.currentDateStr = this.history[newIndex].date;
        console.log('ðŸ“… Changed to:', this.currentDateStr);
        this.render();
    }
}

switchUser(newUser) {
    if (newUser === this.user) return;
    console.log('ðŸ‘¤ Switching to:', newUser);
    
    document.querySelectorAll('.u-badge').forEach(b => b.classList.remove('active'));
    document.getElementById(`btn-${newUser}`).classList.add('active');
    
    this.user = newUser;
    localStorage.setItem('centurion_user', newUser);
    this.loadUserData();
    this.setPlaceholderData();
    this.render();
    this.fetchOuraData();
}

toggleTask(taskId) {
    const dateKey = this.history[this.currentIndex].date;
    if (!this.checked[dateKey]) this.checked[dateKey] = [];
    
    const index = this.checked[dateKey].indexOf(taskId);
    if (index === -1) {
        this.checked[dateKey].push(taskId);
        console.log('âœ… Checked:', taskId);
    } else {
        this.checked[dateKey].splice(index, 1);
        console.log('â¬œ Unchecked:', taskId);
    }
    
    this.saveUserData();
    this.render();
}

render() {
    console.log('ðŸ”„ Rendering...');
    
    // Run intelligence
    this.protocol = JSON.parse(JSON.stringify(BASE_PROTOCOL));
    const sleepDebt = this.calculateSleepDebt();
    console.log('ðŸ’¤ Sleep debt:', sleepDebt.toFixed(1), 'hours');
    
    if (sleepDebt > 7) {
        this.sleepDebtCritical = true;
        const trainTask = this.protocol.find(t => t.id === 'train');
        if (trainTask) {
            trainTask.title = 'ðŸ›ï¸ FORCED REST';
            trainTask.desc = `Sleep debt: ${sleepDebt.toFixed(1)}h - No training`;
            trainTask.calBurn = 0;
        }
    } else {
        this.sleepDebtCritical = false;
    }
    
    // Inject supplements
    const supplements = [
        { id: 'fish-oil', time: '07:30', title: 'Fish Oil 2g', desc: 'Omega-3', macros: {p:0,o:2000,cal:20} },
        { id: 'vitamin-d', time: '07:30', title: 'Vitamin D3', desc: '5000 IU', macros: {p:0,o:0,cal:0} },
        { id: 'magnesium', time: '21:00', title: 'Magnesium', desc: '400mg', macros: {p:0,o:0,cal:0} }
    ];
    supplements.forEach(supp => {
        if (!this.protocol.find(t => t.id === supp.id)) {
            this.protocol.push(supp);
        }
    });
    this.protocol.sort((a, b) => a.time.localeCompare(b.time));
    
    // Render UI
    this.renderHeader();
    this.renderStatus();
    this.renderTimeline();
    console.log('âœ… Render complete');
}

calculateSleepDebt() {
    const today = new Date().toLocaleDateString('en-CA');
    const last7 = this.history
        .filter(day => day.date !== today && day.totalSec > 0)
        .slice(0, 7);
    
    if (last7.length === 0) return 0;
    
    let totalDebt = 0;
    last7.forEach(day => {
        const actual = day.totalSec / 3600;
        const deficit = 8 - actual;
        if (deficit > 0) totalDebt += deficit;
    });
    
    return totalDebt;
}

renderHeader() {
    const day = this.history[this.currentIndex];
    this.setText('dateLabel', day.date);
    
    const sleepHours = (day.totalSec || 0) / 3600;
    const score = Math.min(100, Math.round(sleepHours / 8 * 100));
    this.setText('dayScore', score);
    
    const scoreEl = document.getElementById('dayScore');
    if (scoreEl) {
        scoreEl.style.color = score >= 80 ? '#ccff00' : score >= 60 ? '#FFD60A' : '#ff453a';
    }
}

renderStatus() {
    const day = this.history[this.currentIndex];
    const sleepHours = (day.totalSec || 0) / 3600;
    
    let status = '';
    if (this.sleepDebtCritical) {
        status = 'âš ï¸ SLEEP DEBT CRITICAL - Recovery Mode';
    } else if (sleepHours >= 7.5) {
        status = 'âœ… OPTIMAL - Ready for training';
    } else if (sleepHours >= 6) {
        status = 'âš ï¸ MODERATE - Light training only';
    } else if (sleepHours > 0) {
        status = 'ðŸ›ï¸ POOR SLEEP - Rest day';
    } else {
        status = 'ðŸ“Š Waiting for data...';
    }
    
    this.setText('statusMsg', status);
    
    const banner = document.getElementById('alertBanner');
    if (this.sleepDebtCritical) {
        banner.className = 'alert-banner alert-warning show';
        banner.innerText = 'âš ï¸ SLEEP DEBT OVER 7 HOURS - FORCED RECOVERY';
    } else {
        banner.className = 'alert-banner';
    }
}

renderTimeline() {
    const dateKey = this.history[this.currentIndex].date;
    const checked = this.checked[dateKey] || [];
    
    let html = '';
    this.protocol.forEach(task => {
        const isChecked = checked.includes(task.id);
        html += `
            <div class="time-slot">
                <div class="ts-time">${task.time}</div>
                <div class="ts-card ${isChecked ? 'checked' : ''}">
                    <div class="ts-title">${task.title}</div>
                    <div class="ts-desc">${task.desc}</div>
                    <div class="check-btn" onclick="app.toggleTask('${task.id}')">
                        <div class="check-circle">${isChecked ? 'âœ“' : ''}</div>
                    </div>
                </div>
            </div>
        `;
    });
    
    document.getElementById('timeline').innerHTML = html;
    console.log('ðŸ“‹ Rendered', this.protocol.length, 'tasks');
}

setText(id, text) {
    const el = document.getElementById(id);
    if (el) el.innerText = text;
}

sync() {
    this.fetchOuraData();
}
```

}

// === DEBUG CONSOLE ===
class DebugConsole {
constructor() {
this.logs = [];
this.maxLogs = 50;
this.createUI();
this.hijackConsole();
}

```
createUI() {
    const debugDiv = document.createElement('div');
    debugDiv.id = 'debugConsole';
    debugDiv.style.cssText = `
        position: fixed; bottom: 60px; left: 0; right: 0; height: 200px;
        background: rgba(0,0,0,0.95); border-top: 2px solid #ccff00;
        z-index: 9999; display: none; overflow-y: auto;
        font-family: 'JetBrains Mono', monospace; font-size: 0.65rem;
        padding: 10px; color: #0f0;
    `;
    document.body.appendChild(debugDiv);
    
    const toggleBtn = document.createElement('button');
    toggleBtn.innerText = 'ðŸ› DEBUG';
    toggleBtn.style.cssText = `
        position: fixed; bottom: 70px; right: 10px; z-index: 10000;
        background: #ccff00; color: #000; border: none;
        padding: 8px 12px; border-radius: 6px;
        font-weight: 900; font-size: 0.7rem; cursor: pointer;
    `;
    toggleBtn.onclick = () => {
        const console = document.getElementById('debugConsole');
        console.style.display = console.style.display === 'none' ? 'block' : 'none';
    };
    document.body.appendChild(toggleBtn);
    
    const clearBtn = document.createElement('button');
    clearBtn.innerText = 'ðŸ—‘ï¸';
    clearBtn.style.cssText = `
        position: fixed; bottom: 70px; right: 90px; z-index: 10000;
        background: #ff453a; color: #fff; border: none;
        padding: 8px 12px; border-radius: 6px;
        font-weight: 900; font-size: 0.7rem; cursor: pointer;
    `;
    clearBtn.onclick = () => {
        this.logs = [];
        this.render();
    };
    document.body.appendChild(clearBtn);
}

hijackConsole() {
    const originalLog = console.log;
    const originalError = console.error;
    
    console.log = (...args) => {
        originalLog.apply(console, args);
        this.addLog('LOG', args.join(' '), '#0f0');
    };
    
    console.error = (...args) => {
        originalError.apply(console, args);
        this.addLog('ERROR', args.join(' '), '#ff453a');
    };
}

addLog(type, message, color) {
    const timestamp = new Date().toLocaleTimeString();
    this.logs.push({ timestamp, type, message, color });
    if (this.logs.length > this.maxLogs) this.logs.shift();
    this.render();
}

render() {
    const debugDiv = document.getElementById('debugConsole');
    if (!debugDiv) return;
    
    debugDiv.innerHTML = this.logs.map(log => 
        `<div style="color: ${log.color}; margin-bottom: 4px;">
            <span style="color: #666;">[${log.timestamp}]</span> 
            <span style="color: #00f0ff;">${log.type}</span>: ${log.message}
        </div>`
    ).join('');
    
    debugDiv.scrollTop = debugDiv.scrollHeight;
}
```

}

// === INITIALIZATION ===
const debugConsole = new DebugConsole();
let app;

if (document.readyState === â€˜loadingâ€™) {
document.addEventListener(â€˜DOMContentLoadedâ€™, initApp);
} else {
initApp();
}

function initApp() {
console.log(â€˜âš¡ DOM Ready - Starting appâ€¦â€™);
try {
app = new CenturionApp();
window.app = app;
console.log(â€˜ðŸŽ‰ App initializedâ€™);

```
    setTimeout(() => {
        console.log('ðŸ”§ Force render...');
        app.render();
    }, 100);
} catch (error) {
    console.error('ðŸ’¥ INIT ERROR:', error);
}
```

}

window.addEventListener(â€˜errorâ€™, (e) => console.error(â€˜ðŸ’¥ ERROR:â€™, e.error?.message));
console.log(â€˜âœ… Script loadedâ€™);
</script>

</body>
</html>